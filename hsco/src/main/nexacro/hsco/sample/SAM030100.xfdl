<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\default_typedef.xml"/>
  <Form id="SAM030100" classname="FileManager_test" left="0" top="0" width="1059" height="735" titletext="파일 관리자" oninit="form_oninit" onload="form_onload">
    <Layouts>
      <Layout>
        <Div id="div_multiFile" taborder="1" left="9" top="0" height="276" width="1039">
          <Layouts>
            <Layout>
              <Grid id="grd_fileMast" taborder="42" useinputpanel="false" left="0%" top="39" right="64.68%" height="148" binddataset="ds_fileMast" oncellclick="div_multiFile_grd_fileMast_oncellclick">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Column size="120"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="93"/>
                      <Column size="80"/>
                    </Columns>
                    <Rows>
                      <Row size="24" band="head"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="FILE_SN"/>
                      <Cell col="1" text="SYS_SE_CODE"/>
                      <Cell col="2" text="JOB_SE_CODE"/>
                      <Cell col="3" text="REGISTER_ID"/>
                      <Cell col="4" text="REGIST_DT"/>
                    </Band>
                    <Band id="body">
                      <Cell text="bind:FILE_SN"/>
                      <Cell col="1" text="bind:SYS_SE_CODE"/>
                      <Cell col="2" text="bind:JOB_SE_CODE"/>
                      <Cell col="3" text="bind:REGISTER_ID"/>
                      <Cell col="4" text="bind:REGIST_DT"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <Grid id="grd_fileList" taborder="43" useinputpanel="false" top="39" right="245" height="180" binddataset="ds_fileList" width="410" oncellclick="div_multiFile_grd_fileList_oncellclick" onheadclick="div_multiFile_grd_fileList_onheadclick">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Column size="40"/>
                      <Column size="120"/>
                      <Column size="66"/>
                      <Column size="63"/>
                      <Column size="63"/>
                      <Column size="73"/>
                    </Columns>
                    <Rows>
                      <Row size="24" band="head"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell displaytype="checkbox"/>
                      <Cell col="1" text="파일명"/>
                      <Cell col="2" text="확장자"/>
                      <Cell col="3" text="용량"/>
                      <Cell col="4" text="사용여부"/>
                      <Cell col="5" text="삭제"/>
                    </Band>
                    <Band id="body">
                      <Cell displaytype="checkbox" edittype="checkbox" text="bind:CHK"/>
                      <Cell col="1" text="bind:ORGINL_FILE_NM"/>
                      <Cell col="2" text="bind:FILE_EXTSN"/>
                      <Cell col="3" text="bind:FILE_MG"/>
                      <Cell col="4" text="bind:USE_AT"/>
                      <Cell col="5" displaytype="button" text="삭제"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <ImageViewer id="iv_files" taborder="44" top="39" right="9" height="180" width="222" stretch="fixaspectratio"/>
              <Button id="btn_uploadFiles" taborder="46" text="파일업로드" cssclass="btn_WF_Process" top="15" height="19" width="68" onclick="div_multiFile_btn_uploadFiles_onclick" left="638"/>
              <!--
              <Static id="sta_helpMessage" taborder="49" text="마우스로 파일을 끌어오십시오." onclick="sta_helpMessage_onclick" top="55" right="251" height="155" style="background:white;border:2 dashed #a9c1d9ff ;color:#c9ced9ff;bordertype:round 5 5 ;align:center middle;font:bold 14 굴림;opacity:60;" width="387"/>
			  -->
              <Static id="Static09" taborder="50" text="5" visible="false" left="0" top="34" right="0%" height="5" style="background:#dc143c3c;align:center middle;"/>
              <Static id="sta_title" taborder="51" text="파일 업로드/다운로드(multi)" cssclass="sta_WF_Title01" left="0%" top="14" right="73.67%" height="21"/>
              <Static id="Static06" taborder="52" text="15" visible="false" left="0" top="0" right="0" height="15" style="background:#dc143c3c;align:center middle;"/>
              <Static id="sta_title00" taborder="54" text="첨부파일 마스터 목록" left="23.77%" top="8" right="64.1%" height="21"/>
              <Static id="sta_title01" taborder="55" text="첨부파일 목록" left="44.56%" top="224" right="38.79%" height="21"/>
              <Static id="Static00" taborder="56" text="5" visible="false" left="0%" top="270" right="0.19%" height="5" style="background:#dc143c3c;align:center middle;"/>
              <Button id="btn_delFiles" taborder="57" text="선택삭제" onclick="div_multiFile_btn_delFiles_onclick" cssclass="btn_WF_Process" left="567" top="14" height="21" width="67"/>
              <Button id="btn_atchFiles" taborder="58" text="파일선택" onclick="div_multiFile_btn_atchFiles_onclick" left="497" top="14" height="21" width="67"/>
              <Button id="btn_downFiles" taborder="59" text="선택다운로드" onclick="div_multiFile_btn_downFiles_onclick" cssclass="btn_WF_Process" left="709" top="15" height="19" width="85"/>
              <Button id="btn_popupFile" taborder="60" text="파일업로드/다운로드 팝업" left="1.73%" top="201" height="19" onclick="div_multiFile_btn_popupFile_onclick" visible="true" width="167"/>
              <Button id="btn_fileUpload" taborder="61" text="파일업로드 전용 팝업" visible="true" left="17" top="225" height="19" onclick="div_multiFile_btn_fileUpload_onclick" width="150"/>
              <Button id="btn_download" taborder="62" text="다운로드 전용 팝업(다건)" visible="true" left="209" top="225" height="19" onclick="div_multiFile_btn_download_onclick" width="150"/>
              <Button id="btn_select01" taborder="63" text="FILE_SN 시퀀스" onclick="div_work_btn_select01_onclick" left="20.12%" top="201" right="69.97%" height="19" visible="true"/>
              <Button id="btn_popupMovable" taborder="64" text="Dragable Modal 팝업" left="1.64%" top="248" right="82.29%" height="19" onclick="div_multiFile_btn_popupMovable_onclick"/>
            </Layout>
          </Layouts>
        </Div>
        <Div id="div_singleFile" taborder="2" left="8" top="280" height="176" width="805">
          <Layouts>
            <Layout>
              <Static id="sta_WFDA_Label13" taborder="35" cssclass="sta_WF_Labelbg" left="0.75%" top="130" height="27" width="778"/>
              <Static id="sta_detAtchFile" taborder="36" text="첨부파일" cssclass="sta_WF_Label" left="0.12%" top="130" right="90.75%" height="27"/>
              <Edit id="edt_atchFile" taborder="37" readonly="true" enableevent="false" left="9.57%" top="133" right="22.11%" height="21"/>
              <Button id="btn_atchFile" taborder="38" cssclass="btn_WF_Search" left="75.16%" top="133" right="22.86%" height="21" onclick="div_singleFile_btn_atchFile_onclick"/>
              <Button id="btn_cancelAtchFile" taborder="39" text="취소" left="87.2%" top="133" height="21" onclick="div_singleFile_btn_cancelAtchFile_onclick" width="53"/>
              <Grid id="grd_singleFile" taborder="42" useinputpanel="false" left="0.12%" top="44" right="18" height="77" binddataset="ds_singleFile">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Col size="80"/>
                      <Col size="80"/>
                      <Col size="80"/>
                      <Col size="80"/>
                      <Col size="80"/>
                      <Col size="80"/>
                      <Col size="80"/>
                      <Col size="80"/>
                      <Col size="80"/>
                    </Columns>
                    <Rows>
                      <Row band="head" size="24"/>
                      <Row band="body" size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell col="0" disptype="normal" text="파일일련번호"/>
                      <Cell col="1" disptype="normal" text="파일순차번호"/>
                      <Cell col="2" disptype="normal" text="FILE_STRE_COURS"/>
                      <Cell col="3" disptype="normal" text="STRE_FILE_NM"/>
                      <Cell col="4" disptype="normal" text="파일명"/>
                      <Cell col="5" disptype="normal" text="FILE_EXTSN"/>
                      <Cell col="6" disptype="normal" text="FILE_CN"/>
                      <Cell col="7" disptype="normal" text="FILE_MG"/>
                      <Cell col="8" disptype="normal" text="USE_AT"/>
                    </Band>
                    <Band id="body">
                      <Cell col="0" disptype="normal" text="bind:FILE_SN"/>
                      <Cell col="1" disptype="normal" text="bind:FILE_ORDR"/>
                      <Cell col="2" disptype="normal" text="bind:FILE_STRE_COURS"/>
                      <Cell col="3" disptype="normal" text="bind:STRE_FILE_NM"/>
                      <Cell col="4" disptype="normal" text="bind:ORGINL_FILE_NM"/>
                      <Cell col="5" disptype="normal" text="bind:FILE_EXTSN"/>
                      <Cell col="6" disptype="normal" text="bind:FILE_CN"/>
                      <Cell col="7" disptype="normal" text="bind:FILE_MG"/>
                      <Cell col="8" disptype="normal" text="bind:USE_AT"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <Button id="btn_uploadFile" taborder="44" text="파일업로드" cssclass="btn_WF_Process" left="501" top="20" height="19" onclick="div_singleFile_btn_uploadFile_onclick" width="78"/>
              <Static id="Static00" taborder="46" text="5" visible="false" left="0.12%" top="39" right="19" height="5" style="background:#dc143c3c;align:center middle;"/>
              <Button id="btn_viewAtchFile" taborder="48" text="파일보기" cssclass="btn_WF_Process" top="20" height="19" onclick="div_singleFile_btn_viewAtchFile_onclick" width="66" left="649"/>
              <Button id="btn_delAtchFile" taborder="49" text="파일삭제" cssclass="btn_WF_Process" left="580" top="20" height="19" onclick="div_singleFile_btn_delAtchFile_onclick" width="68"/>
              <Static id="sta_title00" taborder="50" text="업로드/다운로드(단건)" cssclass="sta_WF_Title01" left="0.12%" top="19" right="67.03%" height="21"/>
              <Static id="Static01" taborder="51" text="5" visible="false" left="0.12%" top="10" right="2.46%" height="10" style="background:#dc143c3c;align:center middle;"/>
              <Button id="btn_searchSingleFile" taborder="52" text="파일 조회" left="430" top="20" height="19" visible="true" cssclass="btn_WF_Process" onclick="div_singleFile_btn_searchSingleFile_onclick" width="69"/>
              <Edit id="edt_fileSn" taborder="53" readonly="false" enableevent="false" left="253" top="20" height="19" width="107"/>
              <Static id="sta_detAtchFile00" taborder="54" text="파일일련번호" cssclass="sta_WF_Label" left="165" top="20" height="19" width="89"/>
              <Button id="btn_atchFile2" taborder="55" text="파일선택" left="78.14%" top="133" right="13.04%" height="21" onclick="div_singleFile_btn_atchFile2_onclick"/>
              <Button id="btn_downFile" taborder="56" text="다운로드" cssclass="btn_WF_Process" left="716" top="20" height="19" width="71" onclick="div_singleFile_btn_downFile_onclick"/>
              <Button id="btn_init" taborder="57" text="초기화" left="46.46%" top="20" right="46.96%" height="19" onclick="div_singleFile_btn_init_onclick"/>
            </Layout>
          </Layouts>
        </Div>
        <Div id="div_work" taborder="3" left="825" top="275" height="205" width="232">
          <Layouts>
            <Layout>
              <ImageViewer id="iv_files" taborder="0" stretch="fixaspectratio" left="0.86%" top="10" right="3.45%" height="180"/>
            </Layout>
          </Layouts>
        </Div>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_fileMast" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="FILE_SN" type="BIGDECIMAL" size="256"/>
          <Column id="SYS_SE_CODE" type="STRING" size="256"/>
          <Column id="JOB_SE_CODE" type="STRING" size="256"/>
          <Column id="REGISTER_ID" type="STRING" size="256"/>
          <Column id="REGIST_DT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_fileList" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CHK" type="STRING" size="256"/>
          <Column id="FILE_SN" type="BIGDECIMAL" size="20"/>
          <Column id="FILE_ORDR" type="INT" size="3"/>
          <Column id="FILE_STRE_COURS" type="STRING" size="2000"/>
          <Column id="STRE_FILE_NM" type="STRING" size="255"/>
          <Column id="ORGINL_FILE_NM" type="STRING" size="255"/>
          <Column id="FILE_EXTSN" type="STRING" size="20"/>
          <Column id="FILE_CN" type="STRING" size="4000"/>
          <Column id="FILE_MG" type="INT" size="8"/>
          <Column id="USE_AT" type="STRING" size="1"/>
          <Column id="FILE_ID" type="STRING" size="256"/>
          <Column id="SN" type="INT" size="5"/>
          <Column id="SYS_SE_CODE" type="STRING" size="6"/>
          <Column id="JOB_SE" type="STRING" size="3"/>
          <Column id="FILE_TY" type="STRING" size="256"/>
          <Column id="FILE_IMAGE" type="STRING" size="256"/>
          <Column id="PROGRS" type="INT" size="5"/>
          <Column id="TRNSMIS_FILE_SIZE" type="INT" size="256"/>
          <Column id="DELETE_IMAGE" type="STRING" size="256"/>
          <Column id="STTUS" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_singleFile" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="FILE_SN" type="BIGDECIMAL" size="20"/>
          <Column id="FILE_ORDR" type="INT" size="3"/>
          <Column id="FILE_STRE_COURS" type="STRING" size="2000"/>
          <Column id="STRE_FILE_NM" type="STRING" size="255"/>
          <Column id="ORGINL_FILE_NM" type="STRING" size="255"/>
          <Column id="FILE_EXTSN" type="STRING" size="20"/>
          <Column id="FILE_CN" type="STRING" size="4000"/>
          <Column id="FILE_MG" type="INT" size="8"/>
          <Column id="USE_AT" type="STRING" size="1"/>
          <Column id="FILE_ID" type="STRING" size="256"/>
          <Column id="SN" type="INT" size="5"/>
          <Column id="SYS_SE_CODE" type="STRING" size="6"/>
          <Column id="JOB_SE" type="STRING" size="3"/>
          <Column id="FILE_TY" type="STRING" size="256"/>
          <Column id="FILE_IMAGE" type="STRING" size="256"/>
          <Column id="PROGRS" type="INT" size="5"/>
          <Column id="TRNSMIS_FILE_SIZE" type="INT" size="256"/>
          <Column id="DELETE_IMAGE" type="STRING" size="256"/>
          <Column id="STTUS" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="form_url" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="FORM_URL" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="FORM_URL">com::COM010300_P01.xfdl</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_fileMastSingle" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="FILE_SN" type="BIGDECIMAL" size="256"/>
          <Column id="SYS_SE_CODE" type="STRING" size="256"/>
          <Column id="JOB_SE_CODE" type="STRING" size="256"/>
          <Column id="REGISTER_ID" type="STRING" size="256"/>
          <Column id="REGIST_DT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_fileSn" firefirstcount="0" firenextcount="0" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" useclientlayout="true">
        <ColumnInfo>
          <Column id="FILE_SN" type="BIGDECIMAL" size="20"/>
          <Column id="SYS_SE_CODE" type="STRING" size="6"/>
          <Column id="JOB_SE" type="STRING" size="3"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item0" compid="div_singleFile.edt_atchFile" propid="value" datasetid="ds_singleFile" columnid="ORGINL_FILE_NM"/>
      <BindItem id="item1" compid="div_singleFile.edt_fileSn" propid="value" datasetid="ds_fileMastSingle" columnid="FILE_SN"/>
    </Bind>
    <Script type="xscript5.0"><![CDATA[
include "lib::comInclude.xjs";	// 시스템 공통 라이브러리 Include
include "lib::comUpDownUtils.xjs";	// 메인화면 파일 업로드/다운로드 라이브러리


this.File_UpDownManager = null;

/*
 * 함수명  	: form_oninit
 * 설명 		: form oninit  이벤트 처리
 * params  		: None
 * return Type 	: None
 * 사용법		: this.form_oninit();
 */
this.form_oninit = function(obj:Form, e:nexacro.InitEventInfo)
{
	this.fn_init_form();				// Form 초기화
	this.fn_init_dataset();
}

/*
 * 함수명  	: form_onload
 * 설명 		: form onload 이벤트 처리
 * params  		: None
 * return Type 	: None
 * 사용법		: this.form_onload();
 */
this.form_onload = function(obj:Form, e:nexacro.LoadEventInfo)
{
	// 파일 메니저 설정
	var fileConfig = {
		//useMultiUpload : true,
		onChange: this.fn_onFileSelected,	// 파일 선택 이벤트 핸들러
		onSuccess : this.fn_onFileSuccess	// 전송 성공 이벤트 핸들러
		//responseGrid : this.div_multiFile.grd_fileList,
		//responseArea : this.div_multiFile.sta_helpMessage
	};
	this.File_UpDownManager = new this.fileUpDownManager(this, "SYS", "COM");
	this.File_UpDownManager.init(fileConfig);
	
	this.fn_setSingleFileView();
}

/***********************************************************************
 * Form/Dataset 오브젝트 초기화
 ***********************************************************************/
/*
 * 함수명  	: initForm
 * 설명 		: Form을 초기화한다.
 * params  		: None
 * return Type 	: None
 * 사용법		: this.initForm();
 */
this.fn_init_form = function()
{
	// 시스템 공통으로 Form을 Initialize 한다.
	this.gfn_initForm(this);
}

/*
 * 함수명  	: fn_init_dataset
 * 설명 		: Dataset을 초기화한다.
 *                주로, 조건 Dataset들(ds_cond, ds_cond_00, ds_cond_01, ...) 을 초기화한다.
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_init_dataset();
 */
this.fn_init_dataset = function()
{
	// 조건에 사용되는 Dataset 초기화
	this.gfn_initCondDs(this, this.div_search);
	//if(this.ds_cond00.rowcount == 0) this.ds_cond00.addRow();
}

/*
 * 함수명  	: fn_search
 * 설명 		: 조회 이벤트 처리
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_search();
 */
this.fn_search = function(){

	// 파일 업로드 초기화
	this.File_UpDownManager.cancelAllFile();
	
	// 데이터셋 초기화
	this.gfn_clearDataSet([this.ds_fileList]);

	// 조회
	this.fn_transaction("selectFileMastList");
}


/********************************************************************************************************
   공통
*********************************************************************************************************/

/**
 * 파일업로드 파일 선택 이벤트 핸들러
 * @param fileFullName 선택 전체 파일명
 * @param type 실행구분(ExtFileUpload/ExtFileDownload)
 * @param fileFullName 선택 파일명
 * @return void
 */
this.fn_onFileSelected = function(type, fileFullName){

	if(type == this.File_UpDownManager.TYPE_UPLOADER){
		var isNmArray = this.comUtils.isArray(fileFullName);
		if(isNmArray){
			// 다건처리
			//trace("다건처리");
			var selFileLeng = fileFullName.length;
			for(var i = 0; i < selFileLeng; i++){
				var newRowIdx = this.ds_fileList.addRow();
				this.ds_fileList.setColumn(newRowIdx, "ORGINL_FILE_NM", fileFullName[i]);	// 실제파일명
			}
		}else{
			//trace("단건처리");
			var dsLeng = this.ds_singleFile.getRowCount();
			var rowPos = -1;
			if(dsLeng > 0){
				rowPos = this.ds_singleFile.rowposition;
			}else{
				rowPos = this.ds_singleFile.addRow();
			}
			this.ds_singleFile.setColumn(rowPos, "ORGINL_FILE_NM", fileFullName);	// 첨부된 파일 데이터 셋 입력 처리
			this.fn_setSingleFileView();		// 첨부파일 영역 처리
		}
	}
}


/*
 * 함수명  	: fn_addAtchFile
 * 설명 		: 업로드 파일선택
 * params  		: isMulti   true(다건), false(단건)
 * return Type 	: None
 * 사용법		: this.fn_addAtchFile();
 */
this.fn_addAtchFile = function(isMulti){
	var allowFile = null;//["txt"];	// 선택 허용 파일유형 - Confilg에서 설정이 가능하나 선택시에도 처리가능하게
	var useMultiSelect = isMulti;
	this.File_UpDownManager.addFiles(allowFile, useMultiSelect);
}

 /*
 * 함수명  	: fn_canceAtchlFile
 * 설명 		: 파일업로드 선택 파일 취소
 * params  		: orgFileName 원본파일명
 *                oGrid     그리드
 *                isDelete  삭제 여부
 * return Type 	: None
 * 사용법		: this.fn_canceAtchlFile();
 */
this.fn_canceAtchlFile = function(orgFileName, oGrid, isDelete){

	var result = this.File_UpDownManager.cancelFiles(orgFileName);
	if(result){
		if(isDelete){
			this.gfn_deleteGridSelectedItem(oGrid);
			this.fn_setSingleFileView();
		}else{
			this.gfn_deleteGridSelectedItem(oGrid);
			this.fn_setSingleFileView();
		}
	}
}

 /*
 * 함수명  	: fn_download
 * 설명 		: 이미지인 경우, image Viewer에 표시되고, 그밖의 경우에는 다운로드
 * params  		: ds 데이터셋
 *                row 선택된 행 인덱스
 *                iv_file  ImageViewer 객체 Full 경로 (예, this.div_work.iv_files)
 * return Type 	: None
 * 사용법		: this.fn_download();
 */
this.fn_download = function(ds, row, iv_file){
// 다운로드
				var fileExtsn = ds.getColumn(row, "FILE_EXTSN");
				var fileSn = ds.getColumn(row, "FILE_SN");			// atchFileInfArr[0];	// 파일일련번호(파일경로)
				var fileOrder = ds.getColumn(row, "FILE_ORDR");	// atchFileInfArr.length > 2 ? atchFileInfArr[1] : "";	// 파일 순차번호
				var fileName = ds.getColumn(row, "ATCH_FILE");		// 실제 파일명
				var fileType = ds.getColumn(row, "FILE_TY");  // 파일 타입
				if(fileType.indexOf("image/")>-1){
					var param = {};
					param["FILE_SN"] = fileSn;
					param["FILE_ORDR"] = fileOrder;
					
					iv_file.set_image("");
					var strUrl = application.gv_host + "hsco/cmm/download/viewImage.do";
					var params = "?FILE_SN=" + fileSn + "&FILE_ORDR=" + fileOrder;
					iv_file.set_image(strUrl + params);
					
				}else{
					this.File_UpDownManager.download(fileSn, fileOrder, fileName);
				}
}

/**********************************************************************
 * CALL TRANSACTION 영역
 **********************************************************************/

/*
 * 함수명  	: fn_transaction
 * 설명 		: Transaction 요청 처리 함수
 * params  		: strSvcId : 서비스요청 ID
 * return Type 	: None
 * 사용법		: this.fn_transaction("SELECT");
 */
this.fn_transaction = function(strSvcId)
{
	var bSync = true;
	
	var sController = null;
	var oInDatasets = null;
	var sOutDatasets = null;
	var reqParam = null;
	switch (strSvcId) {

		case "selectFileMastList" : // 첨부파일 마스터 목록 조회
			
			reqParam = {};
			reqParam["FILE_SN"] = "";
			
			sController = "hsco/cmm/file/selectAtchmnFileMastList.do";
			oInDatasets = reqParam;
			sOutDatasets = "ds_fileMast=output1";
			break;
			
		case "selectAtchmnFileList" :	// 다건 첨부파일 목록 조회
			
			reqParam = this.gfn_getGridSelectedItem(this.div_multiFile.grd_fileMast);
			
			sController = "hsco/cmm/file/selectAtchmnFileList.do";
			oInDatasets = reqParam;
			sOutDatasets = "ds_fileList=output1";
			break;
			
		 case "deleteFiles" :  // 다건 선택 파일 삭제
		    var sController   	= "hsco/cmm/file/deleteFile.do";	
			var sInDatasets   	= "input1=ds_fileList:U";
			var sOutDatasets  	= "ds_fileList=output1";
		    break;
			
	    case "selectSingleFileList" :	// 단건 첨부파일 목록 조회
			reqParam = {};
			reqParam["FILE_SN"] = this.ds_singleFile.getColumn(0, "FILE_SN");
			sController = "hsco/cmm/file/selectAtchmnFileMastList.do"; // 
			//sController = "hsco/cmm/file/selectAtchmnFileList.do"; // 단건 파일목록만 조회할 때
			oInDatasets   	= "input1=ds_fileMastSingle";
			//sOutDatasets = "ds_singleFile=output1";  // 파일목록만 조회할 때
			sOutDatasets = "ds_fileMastSingle=output1 ds_singleFile=output2";  
			break;

		case "deleteFile" :  // 단건 파일 삭제
		    var sController   	= "hsco/cmm/file/fileDelete.do"; //(단건 파일 및 첨부마스터  모두  삭제)	
		    //var sController   	= "hsco/cmm/file/deleteFile.do"; //(단건 파일만  삭제)	
			var sInDatasets   	= "input1=ds_singleFile";
			var sOutDatasets = "ds_fileMastSingle=output1 ds_singleFile=output2";    //단건 파일 및 첨부마스터  모두  삭제 시
			//var sOutDatasets  	= "ds_singleFile=output1";  //단건 파일 시에만)	
		    break;
		case "GetFileSn": // 파일일련번호 조회
			var sController   	= "hsco/cmm/file/getFileSn.do";
			var sInDatasets   	= "";
			var sOutDatasets  	= "ds_fileSn=output_fsn";
			break;
		default :
			break;
	}

	if(sController == null) return;
	
	var sInDataType = typeof(oInDatasets);
 	if(oInDatasets == null) {
 	    Ex.core.tran(this, strSvcId, sController, sInDatasets, sOutDatasets); 
 	} else {
	    if(sInDataType == "object"){
		    this.gfn_mapTran(strSvcId, sController, oInDatasets, sOutDatasets, null, null, false);
	    } else{
		    Ex.core.tran(this, strSvcId, sController, oInDatasets, sOutDatasets, null, null, null, bSync);
	    }
    }
	
}


/*
 * 함수명  	: fn_callBack
 * 설명 		: Transaction Callback 처리
 * params  		: strSvcId    : 서비스요청 ID
 *                nErrorCode  : 오류 메시지 코드 ([예] 0 : Success, 그밖의 경우, error)
 *                strErrorMsg : 오류 메시지([예]  success.insert|정상적으로 등록되었습니다.)
 * return Type 	: None
 * 사용법		: 
 */
this.fn_callBack = function (strSvcId,nErrorCode,strErrorMsg)
{
	var bSuccess = nErrorCode == 0 ? true : false;
	
    // 오류 및 성공 메시지를 화면에 보여준다.
	this.gfn_callback_message(strSvcId, nErrorCode, strErrorMsg);
	if (nErrorCode != 0){
	    switch(strSvcId){
			case "selectFileMastList" :			// 첨부파일 마스터 목록 조회
				break;
			case "selectAtchmnFileList" :			// 다건 첨부파일 목록 조회
				break;
			case "selectSingleFileList" :			// 단건 첨부파일 목록 조회
				break;
			case "deleteFiles" :  // 다건 선택 파일 삭제
			    break;
			case "deleteFile" :  // 단건 파일 삭제
				break;
			case "GetFileSn": // 파일일련번호 조회	
			default :
				break;
		}
	} else {
	    switch(strSvcId){
			case "selectFileMastList" :			// 첨부파일 마스터 목록 조회
				break;
			case "selectAtchmnFileList" :			// 다건 첨부파일 목록 조회
				break;
			case "selectSingleFileList" :			// 단건 첨부파일 마스터 목록 조회
			        this.fn_setSingleFileView();
				break;
			case "deleteFiles" :  // 다건 선택 파일 삭제
			    break;
			case "deleteFile" :  // 단건 파일 삭제
			        this.ds_fileMastSingle.clearData();  // 단건 첨부마스터/파일 모두 삭제 시
			        this.ds_singleFile.clearData();
			        this.fn_setSingleFileView();
				break;	
			case "GetFileSn": // 파일일련번호 조회
		        this.alert("FILE_SN = " + this.ds_fileSn.getColumn(0, "FILE_SN"));
		        
		        //this.ds_fileSn.setColumn(0, "SYS_SE_CODE", "SYS");
	            //this.ds_fileSn.setColumn(0, "JOB_SE", "COM");
			    break;
			
			default :
				break;
		}
	}
}

/**********************************************************************
 * TRANSACTION 영역 끝
 **********************************************************************/

/********************************************************************************************************
   다건
*********************************************************************************************************/



/**
 * 함수명 : div_multiFile_btn_atchFiles_onclick
 * 설명 :  파일선택 버튼  클릭 이벤트 처리
 * params  		: None
 * return Type 	: None
 * @return void
 * 사용법 :  this.div_multiFile_btn_atchFiles_onclick();
 */
this.div_multiFile_btn_atchFiles_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	// 파일 선택(다건)
    this.fn_addAtchFile(true);
}


/**
 * 함수명 : div_multiFile_btn_delFiles_onclick
 * 설명 :  선택삭제 버튼  클릭 이벤트 처리
 * params  		: None
 * return Type 	: None
 * @return void
 * 사용법 :  this.div_multiFile_btn_delFiles_onclick();
 */
this.div_multiFile_btn_delFiles_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	        // 선택 삭제
			
			var option = {};
			option["viewRow"] = "expr:CHK == '1'"
			var exprStr = "CHK==1";
			var fRow = this.ds_fileList.findRowExpr(exprStr);
			//var checkDelList = this.gfn_datasetToObject(this.ds_fileList, option, true);			
			//var checkDelLeng = checkDelList == null ? 0 : checkDelList.length;
			
			// 선택자료 여부 체크
			if ( fRow == -1 ) {
				this.gfn_message("comm.데이터.선택.없음");
				return;
			}
			
			// ds_condTemp00 데이터셋이 동적으로 생성된다.
			//var sInDatasets = this.gfn_setDynamicInDataset(checkDelList, true);
			//trace(sInDatasets);
			if(this.gfn_message("confirm.선택파일.삭제여부", "들")){
			    //this.gfn_deleteGridSelectedItem(grd_fileList);
			    this.gfn_delMultiDsRow(this.ds_fileList);
			    this.fn_transaction("deleteFiles");
		    }
			
}


/**
 * 함수명 : div_multiFile_grd_fileMast_oncellclick
 * 설명 : 첨부파일 마스터 그리드 셀 클릭 이벤트 처리
 * params  		: None
 * return Type 	: None
 * @return void
 * 사용법 :  this.div_multiFile_grd_fileMast_oncellclick();
 */
this.div_multiFile_grd_fileMast_oncellclick = function(obj:Grid, e:nexacro.GridClickEventInfo)
{
	var gridName = obj.name;
	var oldRowPosition = e.oldrow;
	var selRowPosition = e.row;
	var selColPosition = e.col;
	var selCellPosition = e.cell;	
	
	if(selRowPosition > -1) {
	    this.ds_fileMastSingle.clearData();
	    if(this.ds_fileMastSingle.getRowCount() == 0) this.ds_fileMastSingle.addRow();
	    this.ds_fileMastSingle.setColumn(0, "FILE_SN", this.ds_fileMast.getColumn(selRowPosition, "FILE_SN"));
	}
		
	// 파일 업로드 초기화
	this.File_UpDownManager.cancelAllFile();
	
	// 첨부파일 목록 조회
	this.fn_transaction("selectAtchmnFileList");
}

/**
 * 함수명 : div_multiFile_btn_downFiles_onclick
 * 설명 :  선택다운로드 버튼  클릭 이벤트 처리
 * params  		: None
 * return Type 	: None
 * @return void
 * 사용법 :  this.div_multiFile_btn_downFiles_onclick();
 */
this.div_multiFile_btn_downFiles_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
			
			var option = {};
			option["viewRow"] = "expr:CHK == '1'";
			var checkDownList = this.gfn_datasetToObject(this.ds_fileList, option, true);
			var isArray = this.comUtils.isArray(checkDownList);
			
			if(isArray){
				
				var checkDownLeng = checkDownList == null ? 0 : checkDownList.length;
				
				// 선택자료 여부 체크
				if ( checkDownLeng == 0 ) {
					this.gfn_message("comm.데이터.선택.없음");
					return;
				}
				
				
				for(var i = 0; i < checkDownLeng; i++){
					var fileSn = checkDownList[i].FILE_SN;
					var fileOrder = checkDownList[i].FILE_ORDR;
					var fileName = checkDownList[i].ORGINL_FILE_NM;
					
					//trace(fileSn + " :: " + fileOrder);
					
					this.File_UpDownManager.download(fileSn, fileOrder, fileName);
				}
			}else{
				var fileSn = checkDownList.FILE_SN;
				var fileOrder = checkDownList.FILE_ORDR;
				var fileName = checkDownList.ORGINL_FILE_NM;
				
				this.File_UpDownManager.download(fileSn, fileOrder, fileName);
			}
}

/**
 * 함수명 : div_multiFile_btn_uploadFiles_onclick
 * 설명 :  파일업로드 버튼  클릭 이벤트 처리(다건)
 * params  		: None
 * return Type 	: None
 * @return void
 * 사용법 :  this.div_multiFile_btn_uploadFiles_onclick();
 */
this.div_multiFile_btn_uploadFiles_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	this.fn_uploadFiles();
}

/*
 * 함수명  	: fn_uploadFiles
 * 설명 		: 파일업로드 처리
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_uploadFiles();
 */
this.fn_uploadFiles = function()
{
	// 파일 업로드 처리
	// 파일 첨부여부 확인
	var hasAttFile = this.File_UpDownManager.hasFile();
	if(hasAttFile){
	    var reqParam ={};
	    var fileSn;
		var cRow = this.ds_fileMast.rowposition;
		if( cRow > -1) {
		    fileSn = this.ds_fileMast.getColumn(cRow, "FILE_SN");
		    if(fileSn != null && fileSn != undefined && fileSn > 0){
		        this.File_UpDownManager.setFileSn(fileSn);
		    } 
		}
		
		var sController = "hsco/cmm/file/fileUpload.do";
		var oInDatasets = "";
		var sOutDatasets = "ds_fileList=fileList";
	    
		this.File_UpDownManager.upload(sController, oInDatasets, sOutDatasets);
	}else{
		this.gfn_message("err.파일.업로드.정보없음");
	}
}




/**
 * 함수명 : div_multiFile_grd_fileList_oncellclick
 * 설명 :  첨부파일 목록그리드(다건) 셀  클릭 이벤트 처리(다건)
 * params  		: None
 * return Type 	: None
 * @return void
 * 사용법 :  this.div_multiFile_grd_fileList_oncellclick();
 */
this.div_multiFile_grd_fileList_oncellclick = function(obj:Grid, e:nexacro.GridClickEventInfo)
{
	var gridName = obj.name;
	var oldRowPosition = e.oldrow;
	var selRowPosition = e.row;
	var selColPosition = e.col;
	var selCellPosition = e.cell;	
	

			if(selColPosition == 0){
				obj.setCellProperty("Head", selCellPosition, "text", "0");
			} else if(selColPosition == 5){  // 그리드의 삭제 버튼 
				// 삭제 처리 - 업로드 된 파일인지 확인
				var streFileNm = this.ds_fileList.getColumn(selRowPosition, "STRE_FILE_NM");		// 저장파일명
				var orginlFileNm = this.ds_fileList.getColumn(selRowPosition, "ORGINL_FILE_NM");	// 실제파일명
				if(this.comUtils.isNullEmpty(streFileNm)){
					// 업로드 전 선택 파일
					this.fn_canceAtchlFile(orginlFileNm, obj, true);
				} else{
				    if(this.gfn_message("confirm.선택파일.삭제여부", orginlFileNm)){
				        //this.ds_fileList.setColumn(selRowPosition, "CHK", "1");
				        this.ds_fileList.deleteRow(e.row);
				        this.fn_transaction("deleteFiles");
				    }
				}
			} else {
				this.fn_download(this.ds_fileList, selRowPosition, this.div_multiFile.iv_files);
			}
}

/*
 * 함수명  	: div_multiFile_grd_fileList_onheadclick
 * 설명 		: 그리드 oncellclick 이벤트 처리(컬럼 선택)
 * params  		: obj 	: 이벤트 발생 그리드 Component
				  e		: 발생 이벤트
 * return Type 	: None
 * 사용법		: this.div_multiFile_grd_fileList_onheadclick()
 */
this.div_multiFile_grd_fileList_onheadclick = function(obj:Grid, e:nexacro.GridClickEventInfo)
{
	if(e.col == 0) {
				this.gfn_setGridCheckAll(obj, e);
	}
}
/********************************************************************************************************
   단건
*********************************************************************************************************/


/**
 * 함수명 : div_singleFile_btn_searchSingleFile_onclick
 * 설명 :  파일조회 버튼  클릭 이벤트 처리(단건)
 * params  		: None
 * return Type 	: None
 * @return void
 * 사용법 :  this.div_singleFile_btn_searchSingleFile_onclick();
 */

this.div_singleFile_btn_searchSingleFile_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	var fileSn = this.div_singleFile.edt_fileSn.value;
	if(fileSn == "" || fileSn == undefined || fileSn == null){
	    this.gfn_message("err.파일.다운로드.정보없음"); 	
	} else {
	    this.fn_transaction("selectSingleFileList");		// 조회
	    this.fn_setSingleFileView();
	}
}

/**
 * 함수명  	: fn_deleteAtchFile
 * 설명 		: 파일단건 삭제
 * params  		: null
 * return Type 	: None
 * 사용법		: this.fn_deleteAtchFile();
 */
this.fn_deleteAtchFile = function(){

	if(this.ds_singleFile.getRowCount() > 0) {
	    if(this.gfn_message("confirm.파일삭제여부")){
	       // trace(this.ds_singleFile.saveXML());
	        this.fn_transaction("deleteFile");		// 삭제
	    }
	} else {
	    this.gfn_message("info.파일정보.없음");
	}
	
}


/**
 * 함수명 : div_singleFile_btn_delAtchFile_onclick
 * 설명 :  파일삭제 버튼  클릭 이벤트 처리(단건)
 * params  		: None
 * return Type 	: None
 * @return void
 * 사용법 :  this.div_singleFile_btn_delAtchFile_onclick();
 */
this.div_singleFile_btn_delAtchFile_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	this.fn_deleteAtchFile();
	
	this.fn_search (); // 이 샘플 화면에서만 사용함.
}

/**
 * 함수명 : div_singleFile_btn_viewAtchFile_onclick
 * 설명 :  파일보기 버튼  클릭 이벤트 처리(단건)
 * params  		: None
 * return Type 	: None
 * @return void
 * 사용법 :  this.div_singleFile_btn_viewAtchFile_onclick();
 */
this.div_singleFile_btn_viewAtchFile_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	if(this.ds_singleFile.getRowCount() > 0) {
	    this.fn_download(this.ds_singleFile, 0, this.div_work.iv_files);
	} else {
	    
	    this.gfn_message("err.파일.다운로드.정보없음");
	}
	
}
/**
 * 함수명 : div_singleFile_btn_cancelAtchFile_onclick
 * 설명 :  취소 버튼  클릭 이벤트 처리(단건)
 * params  		: None
 * return Type 	: None
 * @return void
 * 사용법 :  this.div_singleFile_btn_cancelAtchFile_onclick();
 */
this.div_singleFile_btn_cancelAtchFile_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	var oGrid = this.div_singleFile.grd_singleFile;
			var selFileItem = this.gfn_getGridSelectedItem(oGrid);
			var streFileNm = selFileItem["STRE_FILE_NM"];		// 저장파일명(업무에서는 파일일련번호|순차번호)
			var orginlFileNm = selFileItem["ORGINL_FILE_NM"];	// 실제파일명
			if(this.comUtils.isNullEmpty(streFileNm)){
				// 업로드 전 선택 파일
				this.fn_canceAtchlFile(orginlFileNm, oGrid, false);
			}
}

/**
 * 함수명 : div_singleFile_btn_cancelAtchFile_onclick
 * 설명 :  파일업로드 버튼  클릭 이벤트 처리(단건)
 * params  		: None
 * return Type 	: None
 * @return void
 * 사용법 :  this.div_singleFile_btn_cancelAtchFile_onclick();
 */
this.div_singleFile_btn_uploadFile_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	this.fn_uploadFile();
}

/*
 * 함수명  	: fn_uploadFile
 * 설명 		: 파일업로드 처리
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_uploadFile();
 */
this.fn_uploadFile = function()
{
	// 파일 업로드 처리
	// 파일 첨부여부 확인
	var hasAttFile = this.File_UpDownManager.hasFile();
	if(hasAttFile){
		var reqParam ={};
		var fileSn;
		 fileSn = this.ds_fileMastSingle.getColumn(0, "FILE_SN");
		if(fileSn != null && fileSn != undefined && fileSn > 0){
		    this.File_UpDownManager.setFileSn(fileSn);
		} 
		
		var sController = "hsco/cmm/file/fileUpload.do";
		var oInDatasets = "";
		var sOutDatasets = "ds_singleFile=fileList";
	
		this.File_UpDownManager.upload(sController, oInDatasets, sOutDatasets);
	}else{
		this.gfn_message("err.파일.업로드.정보없음");
	}
}

/**
 * 
 */
 
 /**
 * 함수명 : fn_setSingleFileView
 * 설명 :  단건 영역 버튼 제어(단건)
 * params  		: None
 * return Type 	: None
 * @return void
 * 사용법 :  this.fn_setSingleFileView();
 */
this.fn_setSingleFileView = function(){
    

	// 첨부파일이 있으면 첨부파일의 검색버튼을 숨기고, 파일삭제, 파일보기 버튼 활성화 처리
	var hasAtch = false;			// 파일 경로(파일일련번호)
	var hasFile = false;	// 파일명
	
	if(this.ds_fileMastSingle.getColumn() > 0) {
	    var fileSn = this.ds_fileMastSingle.getColumn(0, "FILE_SN");
	    if(fileSn != null && fileSn != undefined && fileSn != 0) hasAtch = true;		
	}
	if(this.ds_singleFile.getColumn() > 0) {
	    var fileNm = this.ds_singleFile.getColumn(0, "ORGINL_FILE_NM");
	    if(fileNm != null && fileNm != undefined && fileNm != "") hasFile = true;
	}
	
	this.div_singleFile.btn_atchFile.set_visible(hasAtch);		 	// 파일검색
	
	this.div_singleFile.btn_cancelAtchFile.set_visible(hasFile); 	// 파일 선택 취소
	this.div_singleFile.btn_cancelAtchFile.set_enable(hasFile); // 파일 선택 취소
	this.div_singleFile.btn_delAtchFile.set_visible(hasFile);	 	// 파일삭제
	this.div_singleFile.btn_viewAtchFile.set_visible(hasFile);	 	// 파일보기(이미지/다운로드)
	this.div_singleFile.btn_downFile.set_visible(hasFile); // 다운로드
	
}
 /**
 * 함수명 : div_singleFile_btn_atchFile_onclick
 * 설명 :  파일선택 아이콘 클릭 이벤트 핸들러(단건)
 * params  		: None
 * return Type 	: None
 * @return void
 * 사용법 :  this.div_singleFile_btn_atchFile_onclick();
 */
this.div_singleFile_btn_atchFile_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	this.fn_addAtchFile(false);
}

 /**
 * 함수명 : div_singleFile_btn_atchFile2_onclick
 * 설명 :  파일선택 버튼 클릭 이벤트 핸들러(단건)
 * params  		: None
 * return Type 	: None
 * @return void
 * 사용법 :  this.div_singleFile_btn_atchFile2_onclick();
 */
this.div_singleFile_btn_atchFile2_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	this.fn_addAtchFile(false);
}

/*
 * 함수명  	: div_singleFile_btn_downFile_onclick
 * 설명 		: 단건 파일다운로드 처리
 * params  		: None
 * return Type 	: None
 * 사용법		: this.div_singleFile_btn_downFile_onclick();
 */
this.div_singleFile_btn_downFile_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	if(this.ds_fileMastSingle.getColumn() > 0) {
	    var fileSn = this.ds_fileMastSingle.getColumn(0, "FILE_SN");
	    if(fileSn != null && fileSn != undefined && fileSn > 0){
	        var fileOrder = this.ds_singleFile.getColumn(0, "FILE_ORDR");  
	        var fileName = this.ds_singleFile.getColumn(0, "ORGINL_FILE_NM");
				
	        this.File_UpDownManager.download(fileSn, fileOrder, fileName);
	    } else {
	        this.gfn_message("info.파일정보.없음");
	    }
	    
	} else {
	    this.gfn_message("err.파일.다운로드.정보없음");
	}
	
}
/*
 * 함수명  	: div_singleFile_btn_init_onclick
 * 설명 		: 단건 영역 초기화
 * params  		: None
 * return Type 	: None
 * 사용법		: this.div_singleFile_btn_init_onclick();
 */
this.div_singleFile_btn_init_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	this.ds_fileMastSingle.clearData();
	this.ds_singleFile.clearData();
	this.div_work.iv_files.set_image("");
}

/**************************************************************************************************/
/***************************** 팝업 ************************************/
/**************************************************************************************************/

/*
 * 함수명  	: div_singleFile_btn_init_onclick
 * 설명 		: 파일 업로드 다운로드 관리자 팝업
 * params  		: None
 * return Type 	: None
 * 사용법		: this.div_singleFile_btn_init_onclick();
 */
this.div_multiFile_btn_popupFile_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
    
    this.fn_popup_FileUpDownManager();
}
/*
 * 함수명  	: fn_popup_FileUpDownManager
 * 설명 		: 파일 업로드 다운로드 관리자 팝업
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_popup_FileUpDownManager();
 */
this.fn_popup_FileUpDownManager = function(movable){
    trace(this.ds_fileSn.saveXML());
    var selRowPosition = this.ds_fileMast.rowposition;
    if(this.ds_fileSn.getRowCount() == 0) this.ds_fileSn.addRow();
    if(selRowPosition > -1) {
       this.ds_fileSn.setColumn(0, "FILE_SN", this.ds_fileMast.getColumn(selRowPosition, "FILE_SN"));
       this.ds_fileSn.setColumn(0, "SYS_SE_CODE", this.ds_fileMast.getColumn(selRowPosition, "SYS_SE_CODE"));
       this.ds_fileSn.setColumn(0, "JOB_SE", this.ds_fileMast.getColumn(selRowPosition, "JOB_SE_CODE")); 
    } 
    
    //this.ds_fileSn.setColumn(0, "SYS_SE_CODE", "SYS");
    //this.ds_fileSn.setColumn(0, "JOB_SE", "COM");
    if(!this.fn_uploadPopUp_validate()) return;
    
	var parm = {
		arg_0 : this,  //==> 필수, 팝업을 호출하는 form을 참조할 수 있도록 팝업에 Argument로 넘겨준다. (반드시 기술해야 함.)
		arg_1 : this.ds_fileList,
		arg_2 : this.ds_fileSn
	};
	// 기존
	if(movable == null || movable == undefined){
	    this.gfn_popup("Popup_1", 694, 528, "업로드파일 선택 / 다운로드", parm, "com::COM010300_P01.xfdl", "div_multiFile_btn_popupFile_callback");
	} else {
	    var pageUrl = "com::COM010300_P11.xfdl";
	    if(movable) {
	        pageUrl = "com::COM010300_P11.xfdl";
	    } else {
	        pageUrl = "com::COM010300_P01.xfdl";
	    }
	    this.gfn_popup("Popup_1", 694, 528, "업로드파일 선택 / 다운로드", parm, pageUrl, "div_multiFile_btn_popupFile_callback", movable);
	}
}

/*
 * 함수명  	: div_multiFile_btn_popupFile_callback
 * 설명 		: 파일업로드/다운로드 관리자 팝업 콜백
 * params  		: None
 * return Type 	: None
 * 사용법		: this.div_multiFile_btn_popupFile_callback();
 */
this.div_multiFile_btn_popupFile_callback = function(id, rtn){
    if(rtn != null && rtn != undefined){
        this.ds_fileList.loadXML(rtn);
        trace("RETURN::::" + this.ds_fileList.saveXML());
    } 
}
/*
 * 함수명  	: fn_uploadPopUp_validate
 * 설명 		: 파일 업로드 다운로드 관리자 팝업 전달 아규먼트 validation
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_uploadPopUp_validate();
 */
this.fn_uploadPopUp_validate = function(){
    var boolChk = true;
    trace(this.ds_fileSn.saveXML());
    if(this.ds_fileSn.getRowCount() > 0) {
        var sysSeCode = this.ds_fileSn.getColumn(0, "SYS_SE_CODE");
        var jobSeCode = this.ds_fileSn.getColumn(0, "JOB_SE");
        if(sysSeCode == "" || sysSeCode == null || sysSeCode == undefined){
             
             boolChk = false;
             this.gfn_message("err.프로그램오류.항목누락", "시스템코드");
             return;
        }
        
        if(jobSeCode == "" || jobSeCode == null || jobSeCode == undefined){
            
            boolChk = false;
            this.gfn_message("err.프로그램오류.항목누락", "업무코드");
            return;
        }
    }
    return boolChk;
}


/*
 * 함수명  	: div_multiFile_btn_fileUpload_onclick
 * 설명 		: 파일업로드 전용 팝업
 * params  		: None
 * return Type 	: None
 * 사용법		: this.div_multiFile_btn_fileUpload_onclick();
 */
this.div_multiFile_btn_fileUpload_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
    

    this.fn_popupFileUploader();
	
}

/*
 * 함수명  	: fn_popupFileUploader
 * 설명 		: 파일업로드 전용 팝업
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_popupFileUploader();
 */
this.fn_popupFileUploader = function()
{
    
    if(this.ds_fileSn.getRowCount() == 0) this.ds_fileSn.addRow();
    var selRowPosition = this.ds_fileMast.rowposition;
    if(selRowPosition > -1) {
       this.ds_fileSn.setColumn(0, "FILE_SN", this.ds_fileMast.getColumn(selRowPosition, "FILE_SN"));
       this.ds_fileSn.setColumn(0, "SYS_SE_CODE", this.ds_fileMast.getColumn(selRowPosition, "SYS_SE_CODE"));
       this.ds_fileSn.setColumn(0, "JOB_SE", this.ds_fileMast.getColumn(selRowPosition, "JOB_SE_CODE")); 
    } 
    
        
    //this.ds_fileSn.setColumn(0, "SYS_SE_CODE", "SYS");
    //this.ds_fileSn.setColumn(0, "JOB_SE", "COM");
    if(!this.fn_uploadPopUp_validate()) return;
    
	var parm = {
		arg_0 : this,  
		arg_1 : this.ds_fileList,
		arg_2 : this.ds_fileSn
	};
	trace(this.ds_fileSn.saveXML());
	this.gfn_popup("Popup_2", 694, 528, "파일 업로드 관리자", parm, "com::COM010300_P02.xfdl", "div_work_btn_popupFile_callback");
	
}

// 
/*
 * 함수명  	: div_multiFile_btn_download_onclick
 * 설명 		: 다운로드 전용 팝업(다건)
 * params  		: None
 * return Type 	: None
 * 사용법		: this.div_multiFile_btn_download_onclick();
 */
this.div_multiFile_btn_download_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
    var selRowPosition = this.ds_fileMast.rowposition;
    if(selRowPosition > -1) {
       if(this.ds_fileSn.getRowCount() == 0) this.ds_fileSn.addRow();
       var sysSe = this.ds_fileMast.getColumn(selRowPosition, "SYS_SE_CODE");
       var jobSe = this.ds_fileMast.getColumn(selRowPosition, "JOB_SE_CODE");
       this.ds_fileSn.setColumn(0, "FILE_SN", this.ds_fileMast.getColumn(selRowPosition, "FILE_SN"));
       this.ds_fileSn.setColumn(0, "SYS_SE_CODE", sysSe);
       this.ds_fileSn.setColumn(0, "JOB_SE", jobSe);
       this.fn_popupDownloader(this.ds_fileSn, sysSe,  jobSe, this.ds_fileList);    
       
    } else {
        this.gfn_message("err.프로그램오류.항목누락", "파일일련번호");
    }
    
}
/*
 * 함수명  	: fn_popupDownloader
 * 설명 		: 다운로드 전용 팝업(다건)
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_popupDownloader();
 */
this.fn_popupDownloader = function(ds, sysSe, jobSe, targetDs)
{
    if(!this.fn_uploadPopUp_validate2()) return;
	var parm = {
		arg_0 : this,  //==> 필수, 팝업을 호출하는 form을 참조할 수 있도록 팝업에 Argument로 넘겨준다. (반드시 기술해야 함.)
		arg_1 : targetDs,
		arg_2 : ds
	};
	trace(this.ds_fileSn.saveXML());
	this.gfn_popup("Popup_3", 694, 528, "파일다운로드 관리자", parm, "com::COM010300_P03.xfdl", "div_work_btn_popupFile_callback");	
}

/*
 * 함수명  	: fn_uploadPopUp_validate2
 * 설명 		: 파일 업로드 다운로드 관리자 팝업 전달 아규먼트 validation
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_uploadPopUp_validate2();
 */
this.fn_uploadPopUp_validate2 = function(){
    var boolChk = true;
    if(this.ds_fileSn.getRowCount() == 0) {
        
        boolChk = false;
        
        this.gfn_message("err.프로그램오류.항목누락", "파일 초기화 정보");
        return;
    } else {
        var sysSeCode = this.ds_fileSn.getColumn(0, "SYS_SE_CODE");
        var jobSeCode = this.ds_fileSn.getColumn(0, "JOB_SE");
        var fileSn = this.ds_fileSn.getColumn(0, "FILE_SN");
        if(fileSn < 1 || fileSn == null || fileSn == undefined){
          this.gfn_message("err.프로그램오류.항목누락", "파일일련번호");
        }
        if(sysSeCode == "" || sysSeCode == null || sysSeCode == undefined){
             
             boolChk = false;
             this.gfn_message("err.프로그램오류.항목누락", "시스템코드");
             
             return;
        }
        
        if(jobSeCode == "" || jobSeCode == null || jobSeCode == undefined){
            
            boolChk = false;
            this.gfn_message("err.프로그램오류.항목누락", "업무코드");
            return;
        }
    }
    return boolChk;
}



//파일일련번호 조회
this.div_work_btn_select01_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	
	this.fn_transaction("GetFileSn");
	
}

/*
 * 함수명  	: div_multiFile_btn_popupMovable_onclick
 * 설명 		: Dragable model 팝업
 * params  		: None
 * return Type 	: None
 * 사용법		: this.div_multiFile_btn_popupMovable_onclick();
 */
this.div_multiFile_btn_popupMovable_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	this.fn_popup_FileUpDownManager(true);
}]]></Script>
  </Form>
</FDL>
