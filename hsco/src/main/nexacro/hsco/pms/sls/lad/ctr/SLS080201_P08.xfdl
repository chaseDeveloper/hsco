<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\..\..\..\default_typedef.xml"/>
  <Form id="SLS080201_P08" classname="SLS080201" left="0" top="0" width="500" height="598" titletext="대출등록" onload="SLS080201_P08_onload" oninit="SLS080201_P08_oninit" style="border:0 none #808080ff ;">
    <Layouts>
      <Layout>
        <Static id="Static01" taborder="0" text="대출 등록" cssclass="sta_WF_PopupTitle" left="2" top="2" width="496" height="34"/>
        <Static id="Static05" taborder="12" text="15" visible="false" left="2" top="2" width="15" height="590" style="background:#1b3cd23c;align:center middle;"/>
        <Static id="Static02" taborder="13" text="15" visible="false" left="483" top="2" width="15" height="590" style="background:#1b3cd23c;align:center middle;"/>
        <Static id="Static06" taborder="14" text="15" visible="false" left="2" top="36" width="496" height="15" style="background:#dc143c3c;align:center middle;"/>
        <Static id="Static12" taborder="15" text="5" visible="false" left="17" top="76" width="466" height="5" style="background:#dc143c3c;align:center middle;"/>
        <Button id="btn_close" taborder="16" text="종료" cssclass="btn_WF_CRUD" top="68" right="20" width="50" height="25" onclick="btn_close_onclick"/>
        <Static id="Static08" taborder="17" text="10" visible="false" left="-2" top="268" width="466" height="10" style="background:#dc143c3c;align:center middle;"/>
        <Button id="btn_save" taborder="18" text="저장" onclick="fn_save" cssclass="btn_WF_CRUD" top="68" right="128" width="50" height="25"/>
        <Static id="Static24" taborder="19" cssclass="sta_WF_Labelbg" left="15" top="100" width="465" height="27"/>
        <Static id="Static28" taborder="20" cssclass="sta_WF_Labelbg" left="15" top="204" width="465" height="27"/>
        <Static id="Static29" taborder="21" cssclass="sta_WF_Labelbg" left="15" top="178" width="465" height="27"/>
        <Static id="Static30" taborder="22" cssclass="sta_WF_Labelbg" left="15" top="256" width="465" height="27"/>
        <Static id="Static31" taborder="23" text="대출정보" cssclass="sta_WF_Label" left="15" top="100" width="90" height="27"/>
        <Static id="Static35" taborder="24" text="주소" cssclass="sta_WF_Label" left="15" top="204" width="90" height="27"/>
        <Static id="Static37" taborder="25" text="참고사항" cssclass="sta_WF_Label" left="15" top="256" width="90" height="27"/>
        <Static id="sta_title" taborder="26" text="대출 정보" cssclass="sta_WF_Title01" left="17" top="54" width="164" height="21"/>
        <Static id="Static00" taborder="27" readonly="true" cssclass="sta_WF_Labelbg" left="107" top="126" width="373" height="27"/>
        <Static id="Static03" taborder="28" cssclass="sta_WF_Labelbg" left="107" top="152" width="373" height="27"/>
        <Static id="Static34" taborder="29" text="채권자(은행)" cssclass="sta_WF_Label" left="15" top="178" width="90" height="27"/>
        <Static id="sta_title00" taborder="30" text="대출정보" left="17" top="80" width="164" height="21" cssclass="sta_WF_Title02"/>
        <Static id="Static39" taborder="31" text="10" visible="false" left="16" top="84" width="466" height="10" style="background:#dc143c3c;align:center middle;"/>
        <Edit id="edt_locplcZip02" taborder="3" lengthunit="utf8" left="107" top="207" width="93" height="21" style="background:#f0f0f0ff;"/>
        <Edit id="edt_locplcZip04" taborder="4" lengthunit="utf8" left="107" top="259" width="370" height="21" maxlength="200"/>
        <Button id="btn_del" taborder="32" text="삭제" cssclass="btn_WF_CRUD" top="68" right="74" width="50" height="25" onclick="fn_remove"/>
        <Combo id="Combo00" taborder="33" left="21.4%" top="103" right="50.8%" height="21" innerdataset="@ds_lonSeCode" codecolumn="CODE" datacolumn="ALL_CODE_NM"/>
        <Calendar id="Calendar01" taborder="34" left="21.4%" top="129" right="50.8%" height="21" style="background:#fffcfbff URL('theme://images/img_WF_Essential.png') left top;border:1 solid #f1b54dff ;" dateformat="yyyy-MM-dd" value="null"/>
        <Static id="Static04" taborder="35" text="접수일" cssclass="sta_WF_Label" left="15" top="126" width="90" height="27"/>
        <Static id="Static07" taborder="36" text="채권금액" cssclass="sta_WF_Label" left="15" top="152" width="90" height="27"/>
        <Edit id="edt_locplcZip01" taborder="2" lengthunit="utf8" left="107" top="181" width="139" height="21" style="background:#fffcfbff URL('theme://images/img_WF_Essential.png') left top;border:1 solid #f1b54dff ;" maxlength="50"/>
        <Static id="Static10" taborder="37" cssclass="sta_WF_Labelbg" left="107" top="230" width="373" height="27" readonly="true"/>
        <Calendar id="Calendar00" taborder="38" left="21.4%" top="233" right="50.8%" height="21" style="background:#ffffffff;" dateformat="yyyy-MM-dd" value="null"/>
        <Static id="Static11" taborder="39" text="해제일" cssclass="sta_WF_Label" left="15" top="230" width="90" height="27"/>
        <Edit id="edt_registerId00" taborder="51" readonly="true" cssclass="edt_WF_Readonly" left="248" top="103" width="72" height="21"/>
        <Static id="Static13" taborder="52" text="10" visible="false" left="16" top="522" width="466" height="10" style="background:#dc143c3c;align:center middle;"/>
        <Static id="sta_title01" taborder="53" text="실무담당정보" cssclass="sta_WF_Title02" left="17" top="520" width="164" height="21"/>
        <Static id="Static14" taborder="54" cssclass="sta_WF_Labelbg" left="17" top="564" width="465" height="27"/>
        <Static id="Static17" taborder="55" text="성명" cssclass="sta_WF_Label" left="15" top="538" width="90" height="27"/>
        <Edit id="edt_locplcZip00" taborder="56" lengthunit="utf8" left="109" top="538" width="139" height="27"/>
        <Static id="Static18" taborder="57" cssclass="sta_WF_Labelbg" left="109" top="538" width="373" height="27"/>
        <Static id="Static19" taborder="58" text="연락처" cssclass="sta_WF_Label" left="15" top="564" width="90" height="27"/>
        <Edit id="edt_locplcZip03" taborder="10" lengthunit="utf8" left="107" top="567" width="139" height="21" inputtype="number" maxlength="12"/>
        <Edit id="edt_locplcZip05" taborder="8" lengthunit="utf8" left="107" top="541" width="139" height="21" maxlength="30"/>
        <Static id="Static20" taborder="59" text="부서" cssclass="sta_WF_Label" left="248" top="538" width="90" height="27"/>
        <Static id="Static21" taborder="60" text="메일" cssclass="sta_WF_Label" left="248" top="564" width="90" height="27"/>
        <Edit id="edt_locplcZip06" taborder="9" lengthunit="utf8" left="340" top="541" width="137" height="21" maxlength="30"/>
        <Edit id="edt_locplcZip07" taborder="11" lengthunit="utf8" left="340" top="567" width="137" height="21" maxlength="30"/>
        <MaskEdit id="msk_detAmount" taborder="1" mask="###,###,###,###,###" left="107" top="155" width="139" height="21" style="background:#fffcfbff URL('theme://images/img_WF_Essential.png') left top;border:1 solid #f1b54dff ;"/>
        <Button id="btn_zipDmSearch" taborder="61" onclick="div_detail_btn_zipDmSearch_onclick" cssclass="btn_WF_Search" left="179" top="207" width="21" height="21"/>
        <Button id="btn_fileAdd" taborder="62" text="파일추가" onclick="fn_addAtchFile2" cssclass="btn_WF_Gridadd" left="251" top="342" width="75" height="19"/>
        <Button id="btn_fileDel" taborder="63" text="파일삭제" onclick="fn_deleteAtchFile" cssclass="btn_WF_Griddel" left="328" top="342" width="75" height="19"/>
        <Button id="btn_fileSave" taborder="64" text="다운로드" onclick="fn_downloadAtchFile" cssclass="btn_WF_Process" left="405" top="342" width="75" height="19"/>
        <Grid id="grd_ladPayStdrList" taborder="65" binddataset="ds_rpairs_file" autoenter="select" autoupdatetype="itemselect" useinputpanel="false" oncelldblclick="Tab00_tabpage1_grd_ladPayStdrList_oncelldblclick" left="15" top="365" right="20" bottom="78">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="30"/>
                <Column size="30"/>
                <Column size="400"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="checkbox" edittype="checkbox"/>
                <Cell col="1" text="순번"/>
                <Cell col="2" text="파일명"/>
              </Band>
              <Band id="body">
                <Cell displaytype="checkbox" edittype="checkbox" text="bind:CHK"/>
                <Cell col="1" expr="expr:currow + 1"/>
                <Cell col="2" text="bind:FILE_NM"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Button id="btn_add" taborder="66" text="신규" onclick="fn_add" cssclass="btn_WF_CRUD" top="68" right="182" width="50" height="25"/>
        <Edit id="edt_locplcZip08" taborder="68" lengthunit="utf8" left="203" top="207" width="274" height="21" maxlength="200"/>
        <Static id="Static15" taborder="69" cssclass="sta_WF_Labelbg" left="15" top="282" width="465" height="27"/>
        <Static id="Static22" taborder="70" cssclass="sta_WF_Labelbg" left="15" top="308" width="465" height="27"/>
        <Static id="Static09" taborder="67" cssclass="sta_WF_Labelbg" left="16" top="282" width="465" height="27"/>
        <Static id="Static16" taborder="49" text="최초등록" cssclass="sta_WF_Label" left="15" top="282" width="90" height="27" style="align:left middle;"/>
        <Static id="Static43" taborder="50" text="최종수정" cssclass="sta_WF_Label" left="248" top="282" width="90" height="27" style="align:left middle;"/>
        <Edit id="edt_updusrId" taborder="7" readonly="true" cssclass="edt_WF_Readonly" left="340" top="285" width="137" height="21"/>
        <Edit id="edt_registerId" taborder="6" readonly="true" cssclass="edt_WF_Readonly" left="107" top="285" width="139" height="21"/>
        <Static id="Static23" taborder="71" cssclass="sta_WF_Labelbg" left="15" top="308" width="465" height="27"/>
        <Static id="Static26" taborder="73" cssclass="sta_WF_Labelbg" left="16" top="308" width="465" height="27"/>
        <Static id="Static27" taborder="74" text="등록일시" cssclass="sta_WF_Label" left="15" top="308" width="90" height="27" style="align:left middle;"/>
        <Static id="Static32" taborder="75" text="수정일시" cssclass="sta_WF_Label" left="248" top="308" width="90" height="27" style="align:left middle;"/>
        <Calendar id="Calendar04" taborder="76" readonly="true" dateformat="yyyy-MM-dd" left="21.4%" top="311" right="50.8%" height="21" style="background:#f0f0f0ff;"/>
        <Calendar id="Calendar02" taborder="77" readonly="true" dateformat="yyyy-MM-dd" left="68%" top="311" right="4.6%" height="21" style="background:#f0f0f0ff;"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_lcntrctrLon" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CNTRCTR_NO" type="STRING" size="256"/>
          <Column id="LON_SN" type="STRING" size="256"/>
          <Column id="LON_SE" type="STRING" size="256"/>
          <Column id="TRNSFR_DE" type="STRING" size="256"/>
          <Column id="CDIT_TRNSFR_AMOUNT" type="STRING" size="256"/>
          <Column id="CDIT_GRNTE_BANK" type="STRING" size="256"/>
          <Column id="BANK_ADRES" type="STRING" size="256"/>
          <Column id="RELIS_DE" type="STRING" size="256"/>
          <Column id="RM" type="STRING" size="256"/>
          <Column id="PRCAFS_CHARGER" type="STRING" size="256"/>
          <Column id="PRCAFS_CHRG_DEPT" type="STRING" size="256"/>
          <Column id="PRCAFS_CHRG_CTTPC" type="STRING" size="256"/>
          <Column id="PRCAFS_CHRG_EMAIL" type="STRING" size="256"/>
          <Column id="LON_ATCHMNFL_COURS" type="STRING" size="256"/>
          <Column id="LON_ATCHMNFL" type="STRING" size="256"/>
          <Column id="FILE_ORDR" type="STRING" size="256"/>
          <Column id="FILE_SN" type="STRING" size="256"/>
          <Column id="REGISTER_ID" type="STRING" size="256"/>
          <Column id="REGIST_DT" type="STRING" size="256"/>
          <Column id="ORGINL_FILE_NM" type="STRING" size="256"/>
          <Column id="UPDUSR_ID" type="STRING" size="256"/>
          <Column id="UPDUSR_DT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_lonSeCode" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="GRP_CODE" type="STRING" size="256"/>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="CODE_NM" type="STRING" size="256"/>
          <Column id="ALL_CODE_NM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_fileSn" firefirstcount="0" firenextcount="0" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" useclientlayout="true">
        <ColumnInfo>
          <Column id="FILE_SN" type="BIGDECIMAL" size="256"/>
          <Column id="SYS_SE_CODE" type="STRING" size="256"/>
          <Column id="JOB_SE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_validation">
        <ColumnInfo>
          <Column id="compId" type="STRING" size="256"/>
          <Column id="colId" type="STRING" size="256"/>
          <Column id="PK" type="STRING" size="256"/>
          <Column id="notNull" type="STRING" size="256"/>
          <Column id="type" type="STRING" size="256"/>
          <Column id="nlength" type="STRING" size="256"/>
          <Column id="from" type="STRING" size="256"/>
          <Column id="to" type="STRING" size="256"/>
          <Column id="lengthChkGb" type="STRING" size="256"/>
          <Column id="msgId" type="STRING" size="256"/>
          <Column id="expr" type="STRING" size="256"/>
          <Column id="func" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="compId">ds_lcntrctrLon</Col>
            <Col id="colId">TRNSFR_DE</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">접수일</Col>
          </Row>
          <Row>
            <Col id="compId">ds_lcntrctrLon</Col>
            <Col id="colId">CDIT_TRNSFR_AMOUNT</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">채권금액</Col>
          </Row>
          <Row>
            <Col id="compId">ds_lcntrctrLon</Col>
            <Col id="colId">CDIT_GRNTE_BANK</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">채권자(은행)</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_file_delete" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CNTRCTR_NO" type="STRING" size="256"/>
          <Column id="FILE_SN" type="STRING" size="256"/>
          <Column id="FILE_ORDR" type="STRING" size="256"/>
          <Column id="LON_SN" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cond" useclientlayout="true">
        <ColumnInfo>
          <Column id="FILE_SN" type="STRING" size="256"/>
          <Column id="CNTRCTR_NO" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_rpairs_file" onrowposchanged="ds_rpairs_photo_onrowposchanged" useclientlayout="true">
        <ColumnInfo>
          <Column id="CHK" type="STRING" size="256"/>
          <Column id="CNTRCTR_NO" type="STRING" size="256"/>
          <Column id="FILE_NO" type="STRING" size="256"/>
          <Column id="FILE_NM" type="STRING" size="256"/>
          <Column id="FILE_SN" type="STRING" size="256"/>
          <Column id="FILE_ORDR" type="STRING" size="256"/>
          <Column id="FILE_EXTSN" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_outLon">
        <ColumnInfo>
          <Column id="LON_SN" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cond01" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CNTRCTR_NO" type="STRING" size="255"/>
          <Column id="ATCH_FILE" type="STRING" size="255"/>
          <Column id="ATCH_FLPTH" type="STRING" size="255"/>
          <Column id="FILE_SN" type="STRING" size="255"/>
          <Column id="FILE_ORDR" type="STRING" size="255"/>
          <Column id="FILE_EXTSN" type="STRING" size="256"/>
          <Column id="FILE_TY" type="STRING" size="256"/>
          <Column id="LON_SN" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item15" compid="edt_locplcZip02" propid="value" datasetid="ds_lcntrctrLon"/>
      <BindItem id="item5" compid="edt_locplcZip04" propid="value" datasetid="ds_lcntrctrLon" columnid="RM"/>
      <BindItem id="item0" compid="Calendar01" propid="value" datasetid="ds_lcntrctrLon" columnid="TRNSFR_DE"/>
      <BindItem id="item2" compid="edt_locplcZip01" propid="value" datasetid="ds_lcntrctrLon" columnid="CDIT_GRNTE_BANK"/>
      <BindItem id="item3" compid="Calendar00" propid="value" datasetid="ds_lcntrctrLon" columnid="RELIS_DE"/>
      <BindItem id="item52" compid="edt_updusrId" propid="value" datasetid="ds_lcntrctrLon" columnid="UPDUSR_ID"/>
      <BindItem id="item51" compid="edt_registerId" propid="value" datasetid="ds_lcntrctrLon" columnid="REGISTER_ID"/>
      <BindItem id="item6" compid="edt_registerId00" propid="value" datasetid="ds_lcntrctrLon" columnid="LON_SN"/>
      <BindItem id="item1" compid="edt_locplcZip00" propid="value" datasetid="ds_custCon" columnid="ADRES_DETAIL"/>
      <BindItem id="item7" compid="edt_locplcZip03" propid="value" datasetid="ds_lcntrctrLon" columnid="PRCAFS_CHRG_CTTPC"/>
      <BindItem id="item8" compid="edt_locplcZip05" propid="value" datasetid="ds_lcntrctrLon" columnid="PRCAFS_CHARGER"/>
      <BindItem id="item9" compid="edt_locplcZip06" propid="value" datasetid="ds_lcntrctrLon" columnid="PRCAFS_CHRG_DEPT"/>
      <BindItem id="item10" compid="edt_locplcZip07" propid="value" datasetid="ds_lcntrctrLon" columnid="PRCAFS_CHRG_EMAIL"/>
      <BindItem id="item11" compid="Combo00" propid="value" datasetid="ds_lcntrctrLon" columnid="LON_SE"/>
      <BindItem id="item53" compid="msk_detAmount" propid="value" datasetid="ds_lcntrctrLon" columnid="CDIT_TRNSFR_AMOUNT"/>
      <BindItem id="item4" compid="edt_locplcZip08" propid="value" datasetid="ds_lcntrctrLon" columnid="BANK_ADRES"/>
      <BindItem id="item22" compid="Calendar04" propid="value" datasetid="ds_lcntrctrLon" columnid="REGIST_DT"/>
      <BindItem id="item12" compid="Calendar02" propid="value" datasetid="ds_lcntrctrLon" columnid="UPDUSR_DT"/>
    </Bind>
    <Script type="xscript5.0"><![CDATA[/***********************************************************************
 * 화면ID   : SLS080201_P08
 * 화면명   : 대출등록
 * 화면설명 : 토지 계약자 대출을 등록한다.
 * 작성일   : 2016. 07. 16
 * 작성자   : 최인석
 * 수정이력 : 
 ***********************************************************************
 *     수정일     수정자   내용
 ***********************************************************************
 *    2015.00.00   홍길동   fn_xxx() 보완 수정
 ***********************************************************************
 */

/***********************************************************************
 * Script Include 
 ***********************************************************************/
// 시스템 공통 라이브러리 Include
include "pms_lib::pmsUtilInclude.xjs";
include "lib::comInnerSanct.xjs";


/***********************************************************************
 * 화면 변수 선언부
 ***********************************************************************/
// 화면 전역에서 사용할 Form 변수를 선언한다.
this.SYS_SE = "PMS";						// 시스템 구분
this.JOB_SE = "LAD";						// 업무 구분
this.FILE_MANAGER = null;					// 파일 업/다운로더


var tempLonNo;

/***********************************************************************
 * onInit / onLoad 영역
 ***********************************************************************/
this.SLS080201_P08_oninit = function(obj:Form, e:nexacro.InitEventInfo)
{

	this.fn_init();             // 공통 폼 초기화
	this.fn_init_form();		// Form 초기화
	this.fn_init_dataset();		// DataSet 초기화
}

this.SLS080201_P08_onload = function(obj:Form, e:nexacro.LoadEventInfo)
{
	this.ds_lcntrctrLon.clear();
	this.ds_lcntrctrLon.copyData(this.parent.arg_1);
	
	tempLonNo = this.ds_lcntrctrLon.getColumn(0,"CNTRCTR_NO");
	
	this.fn_loadCombo();		// Combo에 사용되는 Dataset Load
	
	// 파일 업/다운로더 설정
	var fileConfig = {
		onChange: this.fn_onFileSelected,
		onSuccess : this.fn_onFileSuccess,
		onError : this.fn_onFileError
	};
	this.FILE_MANAGER = new this.fileManager(this, this.SYS_SE, this.JOB_SE);
	this.FILE_MANAGER.init(fileConfig);
	
}

/*===================================================
 * 함수명  	: fn_loadCombo
 * 설명 		: 화면의 Combo 에 데이터를 불러온다.
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_loadCombo();
*===================================================*/
this.fn_loadCombo = function()
{
	// 공통코드 목록 조회 - 토지구분, 용도구분, 급지구분, 목차구분
 	var comCodeParam = [
 		{OUT_PUT:"ds_lonSeCode",   GRP_CODE:"LAD0A5",   USE_AT:"1"} // 대출구분
 	];
 	this.pmsUtil.getCommonCode("selectCommonCode", comCodeParam);
	
	// 토지 코드 목록 조회
	var ladCodeParam = {};
	ladCodeParam["UASE_AT"] = "1";
	this.pmsUtil.getLadCodeList(ladCodeParam, "ds_ladCodeSh");
	
	//대출 단건 조회
	this.fn_transaction("selectLcntrctrLon");
}



/***********************************************************************
 * Form/Dataset 오브젝트 초기화
 ***********************************************************************/
/*=========================================
 * 함수명  	: initForm
 * 설명 		: Form을 초기화한다.
 * params  		: None
 * return Type 	: None
 * 사용법		: this.initForm();
 *=========================================*/
this.fn_init_form = function()
{
	this.gfn_initForm(this);	// 시스템 공통으로 Form을 Initialize 한다.
}

/*==========================================================================================
 * 함수명  	: fn_init_dataset
 * 설명 		: Dataset을 초기화한다.
 *                주로, 조건 Dataset들(ds_cond, ds_cond_00, ds_cond_01, ...) 을 초기화한다.
 * params  		: None
 * return Type 	: None
 * 사용법		: this.initDataset();
*==========================================================================================*/
this.fn_init_dataset = function()
{
	this.gfn_initCondDs(this, this.div_search);	// 조건에 사용되는 Dataset 초기화
	
	//조회, 종료시에 수정여부 체크할 데이터셋 지정
	this.checkDs.push(this.ds_ladNmChangeList);
}



// 토지계약자대출 저장
this.fn_save = function()
{
	//업데이트 유무 체크
	if(this.fn_checkUpdate(this.ds_lcntrctrLon) == false){
		this.alert("comm.데이터.변경.없음");
		return false;
	}
	
	//토지계약자압류 유효성 체크(업데이트 유무 체크는 스킵)
	if(this.gfn_checkValidation_NoUpdChk(this.ds_lcntrctrLon, this.ds_validation) == false) {
		return;
	}
	
	if(this.confirm("저장하시겠습니까?")){
		
		if(!this.ds_lcntrctrLon.getColumn(0,"LON_SN")){ 
			//var nRow = this.ds_lcntrctrLon.addRow();
			this.ds_lcntrctrLon.setColumn(this.ds_lcntrctrLon.rowposition, "CNTRCTR_NO", tempLonNo);
			this.ds_lcntrctrLon.setColumn(this.ds_lcntrctrLon.rowposition, "LON_SE", this.ds_lcntrctrLon.getColumn(0,"LON_SE"));
			this.ds_lcntrctrLon.setColumn(this.ds_lcntrctrLon.rowposition, "TRNSFR_DE", this.ds_lcntrctrLon.getColumn(0,"TRNSFR_DE"));
			this.ds_lcntrctrLon.setColumn(this.ds_lcntrctrLon.rowposition, "CDIT_TRNSFR_AMOUNT", this.ds_lcntrctrLon.getColumn(0,"CDIT_TRNSFR_AMOUNT"));
			this.ds_lcntrctrLon.setColumn(this.ds_lcntrctrLon.rowposition, "CDIT_GRNTE_BANK", this.ds_lcntrctrLon.getColumn(0,"CDIT_GRNTE_BANK"));
			this.ds_lcntrctrLon.setColumn(this.ds_lcntrctrLon.rowposition, "BANK_ADRES", this.ds_lcntrctrLon.getColumn(0,"BANK_ADRES"));
			this.ds_lcntrctrLon.setColumn(this.ds_lcntrctrLon.rowposition, "RELIS_DE", this.ds_lcntrctrLon.getColumn(0,"RELIS_DE"));
			this.ds_lcntrctrLon.setColumn(this.ds_lcntrctrLon.rowposition, "RM", this.ds_lcntrctrLon.getColumn(0,"RM"));
			this.ds_lcntrctrLon.setColumn(this.ds_lcntrctrLon.rowposition, "LON_ATCHMNFL", this.ds_lcntrctrLon.getColumn(0,"LON_ATCHMNFL"));
			this.ds_lcntrctrLon.setColumn(this.ds_lcntrctrLon.rowposition, "PRCAFS_CHARGER", this.ds_lcntrctrLon.getColumn(0,"PRCAFS_CHARGER"));
			this.ds_lcntrctrLon.setColumn(this.ds_lcntrctrLon.rowposition, "PRCAFS_CHRG_DEPT", this.ds_lcntrctrLon.getColumn(0,"PRCAFS_CHRG_DEPT"));
			this.ds_lcntrctrLon.setColumn(this.ds_lcntrctrLon.rowposition, "PRCAFS_CHRG_CTTPC", this.ds_lcntrctrLon.getColumn(0,"PRCAFS_CHRG_CTTPC"));
			this.ds_lcntrctrLon.setColumn(this.ds_lcntrctrLon.rowposition, "PRCAFS_CHRG_EMAIL", this.ds_lcntrctrLon.getColumn(0,"PRCAFS_CHRG_EMAIL"));
			
			this.fn_transaction("saveLcntrctrLonList")  ;  //토지계약자대출 신규등록
		}else{
			this.fn_transaction("saveLcntrctrLonList")  ;  //토지계약자대출 수정
		}
	}
}


//토지계약자대출 삭제
this.fn_remove = function()
{
	var confirmMsg = "선택한 이미지를 삭제하시겠습니까?";
	if(confirm(confirmMsg)){
		if (this.ds_lcntrctrLon.rowcount > 0) {
			nRow = this.ds_lcntrctrLon.rowposition;		
			this.ds_lcntrctrLon.deleteRow(nRow);	
			this.fn_transaction("saveLcntrctrLonList")  ;  //토지계약자대출 삭제
		}else{
			this.alert("삭제할 데이터가 없습니다.");
		}
	}
}

//토지계약자대출 신규
this.fn_add = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	var nRow = this.ds_lcntrctrLon.addRow();
	this.ds_lcntrctrLon.setColumn(nRow, "CNTRCTR_NO", this.ds_lcntrctrLon.getColumn(0, "CNTRCTR_NO"));
	this.ds_rpairs_file.clearData();
}

// 닫기버튼
this.btn_close_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	this.close();
}

//저장버튼
this.btn_save_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	this.fn_save();
}



/**********************************************************************
 * CALL TRANSACTION 영역
 **********************************************************************/ 
 /*=====================================================
 * 함수명  	    : fn_transaction
 * 설명 		: Transaction 요청 처리 함수
 * params  		: strSvcId : 서비스요청 ID
 * return Type 	: None
 * 사용법		: this.fn_transaction("SELECT");
 *=====================================================*/
this.fn_transaction = function(strSvcId)
{
	switch (strSvcId) {
	
		// 토지계약자대출 단건 조회
		case "selectLcntrctrLon" :
			var sController   	= "hsco/pms/sls/lad/ctr/SLS080201/selectLcntrctrLon.do";
			var sInDatasets   	= "input1=ds_lcntrctrLon";
			var sOutDatasets  	= "ds_lcntrctrLon=output1";			
			break;
			
		// 토지계약자대출 저장
		case "saveLcntrctrLonList" :
			var sController   	= "hsco/pms/sls/lad/ctr/SLS080201/saveLcntrctrLonList.do";
			var sInDatasets   	= "input1=ds_lcntrctrLon:U";
			var sOutDatasets  	= "ds_outLon=output1";
			break;
			
		// 파일조회
		case "selectSlaryList2":
			trace("######################")
			trace(this.ds_cond.saveXML());
			trace("######################")
				
			var sController   	= "hsco/pms/sls/lad/std/SLS070102/getMultiFileList.do";
			var sInDatasets   	= "input1=ds_cond";
			var sOutDatasets  	= "ds_rpairs_file=multifileList";
			break;			
			
		// 파일 선택 파일 삭제	
		case "deleteFile" :			
		    var sController = "hsco/pms/sls/lad/ctr/SLS080201/atchLonDelete.do";
			var sInDatasets = "input1=ds_file_delete";
			var sOutDatasets = "";
			break;		
			
		default :
			break;
	}
	Ex.core.tran(this, strSvcId, sController, sInDatasets, sOutDatasets); 
}

/***********************************************************************
* Transaction 영역 끝
************************************************************************/




/*============================================================================================
 * 함수명  	: fn_callBack
 * 설명 		: Transaction Callback 처리
 * params  		: strSvcId    : 서비스요청 ID
 *                nErrorCode  : 오류 메시지 코드 ([예] 0 : Success, 그밖의 경우, error)
 *                strErrorMsg : 오류 메시지([예]  success.insert|정상적으로 등록되었습니다.)
 * return Type 	: None
 * 사용법		: 
 *============================================================================================*/
this.fn_callBack = function (strSvcId, nErrorCode, strErrorMsg)
{
	var bSuccess = nErrorCode == 0 ? true : false;
	if (bSuccess){
		
		var comboOption = null;
		var targetCombo = null;
		
		switch(strSvcId){
		
		   // 토지계약자대출 조회
			case "selectLcntrctrLon" :
				this.selectFileList(); // 파일목록 조회
				break;
				
			// 토지계약자대출 저장
			case "saveLcntrctrLonList" :
				this.ds_lcntrctrLon.clearData();
				var nRow = this.ds_lcntrctrLon.addRow();
				var ds = this.ds_lcntrctrLon;
				ds.setColumn(nRow , "CNTRCTR_NO" , tempLonNo);
				ds.setColumn(nRow , "LON_SN" , this.ds_outLon.getColumn(0 , "LON_SN"));
 				this.fn_transaction("selectLcntrctrLon");
				break;					
				
			// 파일 선택 파일 삭제		
			case "deleteFile" :		
				this.selectFileList();
				break;		
		}
	}
	else{
		
		this.gfn_callBackMsg(strSvcId, nErrorCode, strErrorMsg);
	}
}


/***********************************************************************
* 사용자 정의 함수
************************************************************************/




/*--------------------------------------------------------------------
 * 첨부파일 처리 관련
 --------------------------------------------------------------------*/
// 첨부파일 선택
this.btn_atchFile_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	this.fn_addAtchFile(false);//단건
}

// 첨부파일 보기(다운로드)
this.btn_downAtchFile_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	this.fn_downloadAtchFile();
}

// 첨부파일 선택 취소
this.btn_cancelAtchFile_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	this.fn_cancelAtchFile();
}


/*
 * 함수명  	: this.fn_save2
 * 설명 		: 첨부파일 저장
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_save2();
 */
this.fn_save2 = function()
{
	// 파일 첨부여부 확인
	var hasAttFile = this.FILE_MANAGER.hasFile();

	if(hasAttFile){
 		var attFileCount = this.FILE_MANAGER.getfileCount();
		var sController = "hsco/pms/sls/lad/ctr/SLS080201/atchLonCUD.do";
		var oInDatasets = "input1=ds_cond01:U";
		var sOutDatasets = "";
 		this.FILE_MANAGER.upload(sController, oInDatasets, sOutDatasets);
	}else{
		//this.fn_transaction("saveSlaryList2");		// 첨부파일저장
	}


	this.alert("저장되었습니다");
}

/**
 * 파일업로드 파일 업로드 성공 이벤트 핸들러
 * @param fileFullName 선택 전체 파일명
 * @param type 실행구분(ExtFileUpload/ExtFileDownload)
 * @param e 발생이벤트
 * @return void
 */
this.fn_onFileSuccess = function(type, e){
	if(type == this.FILE_MANAGER.TYPE_UPLOADER){		
		this.fn_transaction("selectLcntrctrLon");
	}
	if(type == this.FILE_MANAGER.TYPE_DOWNLOADER){
		this.gfn_message("success.파일.다운로드.성공");
		
	}
}

/*
 * 함수명  		: fn_addAtchFile
 * 설명 		: 업로드 파일선택
 * params  		: isMulti   true(다건), false(단건)
 * return Type 	: None
 * 사용법		: this.fn_addAtchFile();
 */
this.fn_addAtchFile = function(isMulti){
	var allowFile = null;//["txt"];	// 선택 허용 파일유형 - Confilg에서 설정이 가능하나 선택시에도 처리가능하게
	var useMultiSelect = isMulti;
	
	var fileSn = this.ds_lcntrctrLon.getColumn(this.ds_lcntrctrLon.rowposition,"LON_ATCHMNFL");	
	
	if(this.comUtils.isNullEmpty(fileSn)){	
		this.fn_getNewFileSn();		
	}
	else{		
		//alert("fileSn = " + fileSn );
		// fileManager.addFilesWithSn = function(fileSn, useMultiUpload, isSingle, useMultiSelect, allowTypes)
		this.FILE_MANAGER.addFilesWithSn(fileSn, false, true, false, null);
	}
}

/*
 * 함수명  	: this.selectFileList
 * 설명 		: 파일 리스트 조회
 * params  		: None
 * return Type 	: None
 * 사용법		: this.selectFileList();
 */
this.selectFileList = function(){
	this.ds_rpairs_file.clearData();
	this.ds_cond.clearData();
	var nRow = this.ds_cond.addRow();

	this.ds_cond.setColumn(nRow , "CNTRCTR_NO" , this.ds_lcntrctrLon.getColumn(this.ds_lcntrctrLon.rowposition , "CNTRCTR_NO"));
	this.ds_cond.setColumn(nRow , "FILE_SN" , this.ds_lcntrctrLon.getColumn(this.ds_lcntrctrLon.rowposition , "FILE_SN"));

 	this.fn_transaction("selectSlaryList2"); // 파일조회
}




/**
 * 파일 추가
 * @param 
 * @return void
 */
this.fn_addAtchFile2 = function(){
	//this.FILE_MANAGER.addFiles();
	if(this.ds_lcntrctrLon.getRowType(this.ds_lcntrctrLon.rowposition) == 2){
		alert("저장 후 파일첨부가 가능합니다.");
		return;
	}	
	this.FILE_MANAGER.addFiles(null, true);
}

/**
 * 파일 삭제
 * @param 
 * @return void
 */
this.fn_deleteAtchFile = function(){
	this.ds_file_delete.clearData();
	var checkListLeng = 0;
	var confirmMsg = "선택한 이미지를 삭제하시겠습니까?";
	if(confirm(confirmMsg)){
		this.ds_file_delete.clearData();
			
		// 선택자료 가져오기
		for(var i = 0 ; i < this.ds_rpairs_file.rowcount ; i++){
			if(this.ds_rpairs_file.getColumn( i , "CHK") == '1'){
				var nRow = this.ds_file_delete.addRow();

				this.ds_file_delete.setColumn( nRow , "FILE_SN" , this.ds_rpairs_file.getColumn( i , "FILE_SN"));
				this.ds_file_delete.setColumn( nRow , "FILE_ORDR" , this.ds_rpairs_file.getColumn( i , "FILE_ORDR"));	
				this.ds_file_delete.setColumn( nRow , "CNTRCTR_NO" , this.ds_lcntrctrLon.getColumn(this.ds_lcntrctrLon.rowposition , "CNTRCTR_NO"));
				this.ds_file_delete.setColumn( nRow , "LON_SN" , this.ds_lcntrctrLon.getColumn( 0 , "LON_SN"));
				checkListLeng += 1;
			}
		}

		// 선택자료 여부 체크
		if (checkListLeng == 0 ) {
			this.alert("선택된 자료가없습니다.");
			return;
		}

		this.fn_transaction("deleteFile");		// 첨부파일 삭제;
	}
}


/**
 * 함수명  		: fn_downloadAtchFile
 * 설명 		: 첨부파일 보기(다운로드)
 * params  		: null
 * return Type 	: None
 * 사용법		: this.fn_downloadAtchFile();
 */
this.fn_downloadAtchFile = function(){
	
	for(var i = 0 ; i < this.ds_rpairs_file.getRowCount() ; i++)
	{
		if(this.ds_rpairs_file.getColumn( i , "CHK") == 1){
			var fileSn = this.ds_rpairs_file.getColumn(i , "FILE_SN"); 	// 파일일련번호(파일경로)
			if(fileSn == undefined){
				this.alert("저장 후에 다운로드가 가능합니다.");
				return;
			}
			var fileOrder = this.ds_rpairs_file.getColumn(i , "FILE_ORDR");					// 임시 : 첨부파일은 공통으로 파일일련번호와 파일순차로 조회가능하나 현재(2015/10/21) 컬럼이 맞지않음
			var fileName = this.ds_rpairs_file.getColumn(i , "FILE_NM");	// 실제 파일명	
			this.FILE_MANAGER.download(fileSn, fileOrder, fileName);	
		}else{
			this.alert("다운로드 받으실 파일을 1개 선택해주세요");
		}
	}
}


this.fn_onFileError = function(type, e){
	if(type == this.FILE_MANAGER.TYPE_UPLOADER){
		trace("파일 업로드 오류");
	}
	if(type == this.FILE_MANAGER.TYPE_DOWNLOADER){
		if(e.errorcode == "404"){
			this.gfn_message("err.파일.없음", "파일이 존재하지 않아 다운로드 할 수 없습니다.");
		}
	}
}

/**
 * 함수명  		: fn_onFileSelected 이벤트 핸들러
 * 설명 		: 업로드 파일선택 첨부파일선택시 콜백 함수
 * params  		: fileFullName 선택 전체 파일명, type 실행구분(ExtFileUpload/ExtFileDownload)
 * return Type 	: None
 * 사용법		: this.fn_onFileSelected();
 */
this.fn_onFileSelected = function(type, fileFullName) {
	if(type == this.FILE_MANAGER.TYPE_UPLOADER){

		var isNmArray = this.pmsUtil.isArray(fileFullName);
		
		if(isNmArray){
			var selFileLeng = fileFullName.length;
			for(var i = 0; i < selFileLeng; i++){
				var nRow = this.ds_cond01.addRow();
				this.ds_cond01.setColumn(nRow , "CNTRCTR_NO" , this.ds_lcntrctrLon.getColumn(this.ds_lcntrctrLon.rowposition , "CNTRCTR_NO"));
				this.ds_cond01.setColumn(nRow , "LON_SN" , this.ds_lcntrctrLon.getColumn(this.ds_lcntrctrLon.rowposition , "LON_SN"));
				this.ds_cond01.setColumn(nRow , "FILE_SN" , this.ds_lcntrctrLon.getColumn(this.ds_lcntrctrLon.rowposition , "FILE_SN"));				
			}	
		}else{
			var nRow = this.ds_cond01.addRow();
			this.ds_cond01.setColumn(nRow , "CNTRCTR_NO" , this.ds_lcntrctrLon.getColumn(this.ds_lcntrctrLon.rowposition , "CNTRCTR_NO"));
			this.ds_cond01.setColumn(nRow , "LON_SN" , this.ds_lcntrctrLon.getColumn(this.ds_lcntrctrLon.rowposition , "LON_SN"));
			this.ds_cond01.setColumn(nRow , "FILE_SN" , this.ds_lcntrctrLon.getColumn(this.ds_lcntrctrLon.rowposition , "FILE_SN"));				
			
		}

		this.fn_save2();
	}
}



this.div_detail_btn_zipDmSearch_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
		var fn_cb = function(sPopupId, sReturn) {
		if(Eco.isEmpty(sReturn)) return;
		trace('OK\n'  + sReturn);

		var dsRet = new Dataset();
		nRowCnt = dsRet.loadXML(sReturn);
		if(nRowCnt < 1) return;
		
		var sCols = 
                   "BANK_ADRES=ROADADDRPART1,"
                   
		;		

		var ds = this.ds_lcntrctrLon;
		ds.copyRow(ds.rowposition, dsRet, 0, sCols);
	}
		
	var addr = this.edt_locplcZip02.value;

	this.gfn_popup('zipPopup', 500, 500, '', {arg_addr:addr}, "common::frmZipAddressPopup.xfdl", fn_cb);
}

]]></Script>
  </Form>
</FDL>
