<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\..\..\default_typedef.xml"/>
  <Form id="SLS000000_P04" classname="SLS000000_P04" left="0" top="0" width="1059" height="205" titletext="분납처리" oninit="SLS000000_P04_oninit" onload="SLS000000_P04_onload">
    <Layouts>
      <Layout>
        <Static id="sta_popTitle" taborder="0" text="분납처리" cssclass="sta_WF_PopupTitle" left="4" top="2" width="1049" height="34"/>
        <Static id="Static06" taborder="1" text="15" visible="false" left="4" top="36" width="1049" height="15" style="background:#dc143c3c;align:center middle;"/>
        <Static id="sta_title" taborder="2" text="납부등록" cssclass="sta_WF_Title01" left="12" top="53" width="205" height="21"/>
        <Static id="Static12" taborder="3" text="5" visible="false" left="4" top="76" width="1049" height="5" style="background:#dc143c3c;align:center middle;"/>
        <Div id="div_search" taborder="5" text="Div00" left="4" top="81" width="1049" height="33" style="background:#f9fbffff;" cssclass="div_WFSA_Box">
          <Layouts>
            <Layout>
              <Static id="sta_NM00" taborder="0" text="수납금액" cssclass="sta_WFSA_Label" left="18.62%" top="4" right="75.26%" height="24"/>
              <MaskEdit id="mse_rcivAmount" taborder="1" mask="###,###,###,###,##0" limitbymask="both" onchanged="Tab00_tabpage1_mse_rcivAmount_onchanged" left="24.83%" top="5" right="57.69%" height="21" onkeydown="div_search_mse_rcivAmount_onkeydown"/>
              <Button id="btn_calc" taborder="2" text="납부금액계산 및 적용" onclick="Tab00_tabpage1_btn_calc_onclick" cssclass="btn_WF_Process" left="42.88%" top="6" right="44.22%" height="19"/>
              <Static id="Static20" taborder="3" text="납부기한일" cssclass="sta_WFSA_Label" top="5" height="21" width="80" left="6"/>
              <Calendar id="Calendar00" taborder="4" dateformat="yyyy-MM-dd" top="5" height="21" width="100" left="89" enable="true" readonly="true" style="background:lightgrey; :disabled {color:darkgray;}"/>
            </Layout>
          </Layouts>
        </Div>
        <Button id="btn_xClose" taborder="6" onclick="btn_close_onclick" cssclass="btn_WF_PopupClose" left="1026" top="9" width="20" height="20"/>
        <Button id="btn_regist" taborder="8" text="확인" cssclass="btn_WF_CRUD" left="952" top="51" width="50" height="25" userdata="fn_search" onclick="btn_regist_onclick"/>
        <Static id="Static07" taborder="10" text="10" visible="false" left="4" top="114" width="1049" height="10" style="background:#dc143c3c;align:center middle;"/>
        <Button id="btn_close" taborder="11" text="취소" cssclass="btn_WF_CRUD" left="1004" top="51" width="50" height="25" userdata="fn_search" onclick="btn_close_onclick"/>
        <Static id="Static04" taborder="13" text="납부번호" cssclass="sta_WF_Label" top="122" height="27" style="align:center middle;" width="70" left="4"/>
        <Static id="Static08" taborder="15" cssclass="sta_WF_Labelbg" top="148" height="27" width="1049" left="4"/>
        <Static id="Static05" taborder="18" text="차수" cssclass="sta_WF_Label" top="122" height="27" width="40" left="192" style="align:center middle;"/>
        <Combo id="cmb_suplyCode" taborder="23" innerdataset="@ds_paySe" codecolumn="CODE" datacolumn="ALL_CODE_NM" top="151" height="21" width="82" left="233" style="background:lightgrey URL('theme://images/img_WF_Essential.png') left top;align:center middle; :disabled {color:darkgray;}" enable="true" readonly="true" value="null"/>
        <Static id="Static03" taborder="30" text="납부코드" cssclass="sta_WF_Label" top="122" height="27" style="align:center middle;" width="120" left="73"/>
        <Static id="Static10" taborder="31" text="납부구분" cssclass="sta_WF_Label" top="122" height="27" style="align:center middle;" width="85" left="231"/>
        <Static id="Static11" taborder="32" text="납부순번" cssclass="sta_WF_Label" top="122" height="27" style="align:center middle;" width="85" left="315"/>
        <Static id="Static13" taborder="33" text="변경기한일" cssclass="sta_WF_Label" top="122" height="27" style="align:center middle;" width="110" left="399"/>
        <Static id="Static14" taborder="34" text="납부금액" cssclass="sta_WF_Label" top="122" height="27" style="align:center middle;" width="100" left="508"/>
        <Static id="Static15" taborder="35" text="선납할인금" cssclass="sta_WF_Label" top="122" height="27" style="align:center middle;" width="100" left="607"/>
        <Static id="Static16" taborder="36" text="연체금액" cssclass="sta_WF_Label" top="122" height="27" style="align:center middle;" width="100" left="706"/>
        <Static id="Static17" taborder="37" text="감액금액" cssclass="sta_WF_Label" top="122" height="27" style="align:center middle;" width="100" left="805"/>
        <Edit id="edt_cntrctrIhidnum00" taborder="38" lengthunit="utf8" maxlength="32" top="151" height="21" width="66" left="7" style="background:lightgrey URL('theme://images/img_WF_Essential.png') left top;align:center middle; :disabled {color:darkgray;}" enable="true" readonly="true"/>
        <Edit id="edt_cntrctrIhidnum01" taborder="39" lengthunit="utf8" maxlength="32" top="151" height="21" width="37" left="194" style="background:lightgrey URL('theme://images/img_WF_Essential.png') left top;align:center middle; :disabled {color:darkgray;}" enable="true" readonly="true"/>
        <Combo id="cmb_suplyCode00" taborder="40" innerdataset="@ds_paySn" codecolumn="CODE" datacolumn="ALL_CODE_NM" top="151" height="21" style="background:lightgrey URL('theme://images/img_WF_Essential.png') left top;align:center middle; :disabled {color:darkgray;}" width="82" left="317" enable="true" readonly="true"/>
        <Calendar id="cal_cntrctDe" taborder="41" dateformat="yyyy-MM-dd" top="151" height="21" width="107" left="401" enable="true" value="null" readonly="true" style="background:lightgrey URL('theme://images/img_WF_Essential.png') left top; :disabled {color:darkgray;}"/>
        <Static id="Static00" taborder="42" text="합계" cssclass="sta_WF_Label" top="122" height="27" style="align:center middle;" width="100" left="904"/>
        <Static id="Static01" taborder="43" text="비고" cssclass="sta_WF_Label" top="122" height="27" style="align:center middle;" width="50" left="1003"/>
        <MaskEdit id="edt_lfsts_amount" taborder="44" mask="#,##0" autoselect="true" onchanged="edt_lfsts_amount_onchanged" top="151" height="21" style="background:lightgrey;color:#333333ff; :disabled {border:1 solid #bdbdbdff ;color:darkgray;}" width="97" left="510" enable="true" readonly="true"/>
        <MaskEdit id="edt_lfsts_amount00" taborder="45" mask="#,##0" autoselect="true" onchanged="edt_lfsts_amount_onchanged" top="151" height="21" style="background:lightgrey;color:#333333ff; :disabled {border:1 solid #bdbdbdff ;color:darkgray;}" width="97" left="609" enable="true" readonly="true"/>
        <MaskEdit id="edt_lfsts_amount01" taborder="46" mask="#,##0" autoselect="true" onchanged="edt_lfsts_amount_onchanged" top="151" height="21" style="background:lightgrey;color:#333333ff; :disabled {border:1 solid #bdbdbdff ;color:darkgray;}" width="97" left="708" enable="true" readonly="true"/>
        <MaskEdit id="edt_lfsts_amount02" taborder="47" mask="#,##0" autoselect="true" onchanged="edt_lfsts_amount_onchanged" top="151" height="21" style="background:lightgrey;color:#333333ff; :disabled {border:1 solid #bdbdbdff ;color:darkgray;}" width="97" left="807" enable="true" readonly="true"/>
        <MaskEdit id="edt_lfsts_amount03" taborder="48" mask="#,##0" autoselect="true" onchanged="edt_lfsts_amount_onchanged" top="151" height="21" style="background:lightgrey;color:#333333ff; :disabled {border:1 solid #bdbdbdff ;color:darkgray;}" width="97" left="906" enable="true" readonly="true"/>
        <Edit id="edt_cntrctrIhidnum02" taborder="49" lengthunit="utf8" maxlength="32" top="151" height="21" style="background:lightgrey URL('theme://images/img_WF_Essential.png') left top;align:center middle; :disabled {color:darkgray;}" width="45" left="1005" enable="true" readonly="true"/>
        <Static id="Static09" taborder="50" cssclass="sta_WF_Labelbg" top="174" height="27" width="1049" left="4"/>
        <Combo id="cmb_suplyCode01" taborder="52" innerdataset="@ds_paySe" codecolumn="CODE" datacolumn="ALL_CODE_NM" top="177" height="21" style="align:center middle;" cssclass="cmb_WF_Essential" width="82" left="233"/>
        <Combo id="cmb_suplyCode02" taborder="55" innerdataset="@ds_paySn" codecolumn="CODE" datacolumn="ALL_CODE_NM" top="177" height="21" style="align:center middle;" cssclass="cmb_WF_Essential" width="82" left="317"/>
        <Calendar id="cal_cntrctDe00" taborder="56" dateformat="yyyy-MM-dd" top="177" height="21" cssclass="cal_WF_Essential" width="107" left="401" value="null"/>
        <MaskEdit id="edt_lfsts_amount04" taborder="57" mask="#,##0" autoselect="true" onchanged="edt_lfsts_amount_onchanged" top="177" height="21" style="color:#333333ff;" width="97" left="510" oneditclick="edt_lfsts_amount04_oneditclick"/>
        <MaskEdit id="edt_lfsts_amount05" taborder="58" mask="#,##0" autoselect="true" onchanged="edt_lfsts_amount_onchanged" top="177" height="21" style="color:#333333ff;" width="97" left="609" readonly="true"/>
        <MaskEdit id="edt_lfsts_amount06" taborder="59" mask="#,##0" autoselect="true" onchanged="edt_lfsts_amount_onchanged" top="177" height="21" style="color:#333333ff;" width="97" readonly="true" left="906"/>
        <MaskEdit id="edt_lfsts_amount07" taborder="60" mask="#,##0" autoselect="true" onchanged="edt_lfsts_amount_onchanged" top="177" height="21" style="color:#333333ff;" width="97" left="807" readonly="true"/>
        <MaskEdit id="edt_lfsts_amount08" taborder="61" mask="#,##0" autoselect="true" onchanged="edt_lfsts_amount_onchanged" top="177" height="21" style="color:#333333ff;" width="97" readonly="true" left="708"/>
        <Edit id="edt_cntrctrIhidnum06" taborder="62" lengthunit="utf8" maxlength="32" cssclass="edt_WF_Essential" top="177" height="21" style="border:1 solid #bdbdbdff ;align:center middle;" width="45" left="1005"/>
        <Combo id="cmb_suplyCode03" taborder="63" innerdataset="@ds_payCode" codecolumn="CODE" datacolumn="ALL_CODE_NM" enable="true" top="151" height="21" style="background:lightgrey URL('theme://images/img_WF_Essential.png') left top;align:center middle; :disabled {color:darkgray;}" width="117" left="75" readonly="true"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_validation00" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="compId" type="STRING" size="256"/>
          <Column id="colId" type="STRING" size="256"/>
          <Column id="PK" type="STRING" size="256"/>
          <Column id="notNull" type="STRING" size="256"/>
          <Column id="type" type="STRING" size="256"/>
          <Column id="nlength" type="STRING" size="256"/>
          <Column id="from" type="STRING" size="256"/>
          <Column id="to" type="STRING" size="256"/>
          <Column id="lengthChkGb" type="STRING" size="256"/>
          <Column id="msgId" type="STRING" size="256"/>
          <Column id="expr" type="STRING" size="256"/>
          <Column id="func" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="compId">ds_lcntrctrPayPopList</Col>
            <Col id="colId">PAY_CODE</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">납부코드</Col>
          </Row>
          <Row>
            <Col id="compId">ds_lcntrctrPayPopList</Col>
            <Col id="colId">INSTLMT_SE</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">납부구분</Col>
          </Row>
          <Row>
            <Col id="compId">ds_lcntrctrPayPopList</Col>
            <Col id="colId">PAY_ODR</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">납부순서</Col>
          </Row>
          <Row>
            <Col id="compId">ds_lcntrctrPayPopList</Col>
            <Col id="colId">PAY_TMLMT</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">납부기한일</Col>
          </Row>
          <Row>
            <Col id="compId">ds_lcntrctrPayPopList</Col>
            <Col id="colId">PAYAMT</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">납부금액</Col>
            <Col id="from">1</Col>
            <Col id="to"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_payCode" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="GRP_CODE" type="STRING" size="256"/>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="CODE_NM" type="STRING" size="256"/>
          <Column id="ALL_CODE_NM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_paySe" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="GRP_CODE" type="STRING" size="256"/>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="CODE_NM" type="STRING" size="256"/>
          <Column id="ALL_CODE_NM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_paySn" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="GRP_CODE" type="STRING" size="256"/>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="CODE_NM" type="STRING" size="256"/>
          <Column id="ALL_CODE_NM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_bunap" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CHK" type="STRING" size="256"/>
          <Column id="CNTRCTR_NO" type="STRING" size="256"/>
          <Column id="PAY_NO" type="STRING" size="256"/>
          <Column id="RQEST_YM" type="STRING" size="256"/>
          <Column id="PAY_CODE" type="STRING" size="256"/>
          <Column id="PAY_ODR" type="STRING" size="256"/>
          <Column id="PAY_SE" type="STRING" size="256"/>
          <Column id="INSTLMT_SE" type="STRING" size="256"/>
          <Column id="PAYAMT" type="STRING" size="256"/>
          <Column id="PAY_SUPLY_AMOUNT" type="STRING" size="256"/>
          <Column id="PAY_VAT" type="STRING" size="256"/>
          <Column id="INSTLMT_INTR" type="STRING" size="256"/>
          <Column id="INSTLMT_INTR_SUPLY_AMOUNT" type="STRING" size="256"/>
          <Column id="INSTLMT_INTR_VAT" type="STRING" size="256"/>
          <Column id="ARRRG_AMOUNT" type="STRING" size="256"/>
          <Column id="PREPAY_DSCNT_AMOUNT" type="STRING" size="256"/>
          <Column id="PAY_TMLMT" type="STRING" size="256"/>
          <Column id="PAY_STDR_DE" type="STRING" size="256"/>
          <Column id="NHT_OUTPT_DE" type="STRING" size="256"/>
          <Column id="PAYMTHD" type="STRING" size="256"/>
          <Column id="BANK_CODE" type="STRING" size="256"/>
          <Column id="OCR_NO" type="STRING" size="256"/>
          <Column id="MDAT_DE" type="STRING" size="256"/>
          <Column id="OPETR_ID" type="STRING" size="256"/>
          <Column id="LEV_DECSN_NO" type="STRING" size="256"/>
          <Column id="RM" type="STRING" size="256"/>
          <Column id="USE_AT" type="STRING" size="256"/>
          <Column id="RCIV_DECSN_NO" type="STRING" size="256"/>
          <Column id="LTTOT_RENT_SE" type="STRING" size="256"/>
          <Column id="TMPR_RCIV_DE" type="STRING" size="256"/>
          <Column id="TMPR_RCIV_AMOUNT" type="STRING" size="256"/>
          <Column id="RDCAMT_AMOUNT" type="STRING" size="256"/>
          <Column id="ARRRG_DSCNT_SE" type="STRING" size="256"/>
          <Column id="ARRRG_DSCNT_AMOUNT" type="STRING" size="256"/>
          <Column id="ARRRG_DSCNT_SUPLY_AMOUNT" type="STRING" size="256"/>
          <Column id="ARRRG_DSCNT_VAT" type="STRING" size="256"/>
          <Column id="ARRRG_DSCNT_DAYCNT" type="STRING" size="256"/>
          <Column id="ARRRG_DSCNT_INTRT" type="STRING" size="256"/>
          <Column id="RCIV_DE" type="STRING" size="256"/>
          <Column id="PAYAMT_SM" type="STRING" size="256"/>
          <Column id="UNCLAMT" type="STRING" size="256"/>
          <Column id="R_RCIV_AMOUNT" type="STRING" size="256"/>
          <Column id="R_RCIV_DE" type="STRING" size="256"/>
          <Column id="R_RCIV_MTH" type="STRING" size="256"/>
          <Column id="R_BANK_CODE" type="STRING" size="256"/>
          <Column id="R_OCR_NO" type="STRING" size="256"/>
          <Column id="R_OPETR_ID" type="STRING" size="256"/>
          <Column id="INSTLMT_AT" type="STRING" size="256"/>
          <Column id="LAD_CODE" type="STRING" size="256"/>
          <Column id="PRPOS_SE" type="STRING" size="256"/>
          <Column id="PAY_GB" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_apay_cal" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="N_RESULT" type="BIGDECIMAL" size="256"/>
          <Column id="TOT_AMT" type="BIGDECIMAL" size="256"/>
          <Column id="CNT_DAY" type="BIGDECIMAL" size="256"/>
          <Column id="RATIO" type="BIGDECIMAL" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_apay_cal02" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="N_RESULT" type="BIGDECIMAL" size="256"/>
          <Column id="TOT_AMT" type="BIGDECIMAL" size="256"/>
          <Column id="CNT_DAY" type="BIGDECIMAL" size="256"/>
          <Column id="RATIO" type="BIGDECIMAL" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cond00" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="IN_SE" type="STRING" size="256"/>
          <Column id="IN_LAD_CODE" type="STRING" size="256"/>
          <Column id="IN_TO_DAY" type="STRING" size="256"/>
          <Column id="IN_PAY_TMLMT" type="STRING" size="256"/>
          <Column id="IN_PAYAMT" type="BIGDECIMAL" size="256"/>
          <Column id="CNTRCTR_NO" type="STRING" size="256"/>
          <Column id="PRPOS_SE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cond01" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="IN_SE" type="STRING" size="256"/>
          <Column id="IN_LAD_CODE" type="STRING" size="256"/>
          <Column id="IN_TO_DAY" type="STRING" size="256"/>
          <Column id="IN_PAY_TMLMT" type="STRING" size="256"/>
          <Column id="IN_PAYAMT" type="BIGDECIMAL" size="256"/>
          <Column id="CNTRCTR_NO" type="STRING" size="256"/>
          <Column id="PRPOS_SE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_payamt" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="N_RESULT" type="BIGDECIMAL" size="256"/>
          <Column id="TOT_AMT" type="BIGDECIMAL" size="256"/>
          <Column id="CNT_DAY" type="BIGDECIMAL" size="256"/>
          <Column id="RATIO" type="BIGDECIMAL" size="256"/>
          <Column id="PAYAMT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item21" compid="cmb_suplyCode" propid="value" datasetid="ds_bunap" columnid="PAY_SE"/>
      <BindItem id="item0" compid="edt_cntrctrIhidnum00" propid="value" datasetid="ds_bunap" columnid="PAY_NO"/>
      <BindItem id="item2" compid="cmb_suplyCode00" propid="value" datasetid="ds_bunap" columnid="PAY_ODR"/>
      <BindItem id="item34" compid="edt_lfsts_amount" propid="value" datasetid="ds_bunap" columnid="PAYAMT"/>
      <BindItem id="item3" compid="edt_lfsts_amount00" propid="value" datasetid="ds_bunap" columnid="PREPAY_DSCNT_AMOUNT"/>
      <BindItem id="item4" compid="edt_lfsts_amount01" propid="value" datasetid="ds_bunap" columnid="ARRRG_AMOUNT"/>
      <BindItem id="item5" compid="edt_lfsts_amount02" propid="value" datasetid="ds_bunap" columnid="RDCAMT_AMOUNT"/>
      <BindItem id="item7" compid="edt_cntrctrIhidnum02" propid="value" datasetid="ds_bunap" columnid="RM"/>
      <BindItem id="item8" compid="cmb_suplyCode03" propid="value" datasetid="ds_bunap" columnid="PAY_CODE"/>
      <BindItem id="item10" compid="div_search.Calendar00" propid="value" datasetid="ds_bunap" columnid="PAY_TMLMT"/>
      <BindItem id="item11" compid="cal_cntrctDe" propid="value" datasetid="ds_bunap" columnid="PAY_STDR_DE"/>
      <BindItem id="item1" compid="edt_cntrctrIhidnum01" propid="value" datasetid="ds_bunap" columnid="PAY_ODR"/>
    </Bind>
    <Script type="xscript5.0"><![CDATA[/***********************************************************************
 * 화면ID   : SLS000000_P04
 * 화면명   : 분납처리
 * 화면설명 : 분납처리 및 변경처리 한다.
 * 작성일   : 2016. 02. 25
 * 작성자   : 이광원
 * 수정이력 : 
 ***********************************************************************
 *     수정일     수정자   내용
 ***********************************************************************
 ***********************************************************************
 */
 /***********************************************************************
 * Script Include 
 ***********************************************************************/
// 시스템 공통 라이브러리 Include
include "pms_lib::pmsUtilInclude.xjs";
/***********************************************************************
 * 부모 Form에서 파라미터로 넘겨야 할 값
 * callback : function()
 ***********************************************************************/
this.fv_objForm;
var job_se; // 업무구분

this.SLS000000_P04_oninit = function(obj:Form, e:nexacro.InitEventInfo)
{
	this.fn_init();//공통 폼 초기화
	this.fn_init_form();//폼 초기화
	this.fn_init_dataset();//Dataset 초기화
}


this.SLS000000_P04_onload = function(obj:Form, e:nexacro.LoadEventInfo)
{
	this.fv_objForm = this.parent.arg_0;
	this.ds_bunap.copyData(this.parent.arg_1);
    this.payodr = 0;
    this.job_se = this.parent.arg_2;
    
    var ds ;
    if(this.ds_bunap.getColumn(0, "PAY_GB") == "2"){ //보증금
		ds = this.fv_objForm.ds_lcntrctrDepositPopList;		
    }else{ //분양금
		ds = this.fv_objForm.ds_lcntrctrPayPopList;		
    }

	var Payamt = this.comUtils.isNullThen(this.ds_bunap.getColumn( 0 , "PAYAMT") , 0);                           // 납부금액
	var Prepay_dscnt_amount = this.comUtils.isNullThen(this.ds_bunap.getColumn( 0 , "PREPAY_DSCNT_AMOUNT") , 0); // 선납할인
	var Arrrg_amount = this.comUtils.isNullThen(this.ds_bunap.getColumn( 0 , "ARRRG_AMOUNT") , 0);               // 연체이자
	var Rdcamt_amount = this.comUtils.isNullThen(this.ds_bunap.getColumn( 0 , "RDCAMT_AMOUNT") , 0);             //감액
	var Tot_amt = parseInt(Payamt) + parseInt(Prepay_dscnt_amount) + parseInt(Arrrg_amount) + parseInt(Rdcamt_amount);	// 합계
	this.edt_lfsts_amount03.set_value(Tot_amt);   
	
    for(var i = 0 ; i < ds.rowcount ; i++)  // 납부순번 계산 같은납부코드의 순번 max + 1 
    {
	   if(ds.getColumn( i , "PAY_CODE") == this.cmb_suplyCode03.value){ // 같은납부코드 중 가장큰 납부순서 + 1 한다.
		 if(this.payodr <= ds.getColumn( i , "PAY_ODR")){
			this.payodr = nexacro.toNumber(ds.getColumn( i , "PAY_ODR")) + 1;
			trace("payodr = " + this.payodr);
		 }	
	   }
    }	

	// 납부구분
	this.cmb_suplyCode01.set_value("2");
	
	// 납부순번
	this.cmb_suplyCode02.set_value(this.ds_bunap.getColumn( 0 , "PAY_ODR"));
	this.ds_bunap.setColumn( 0 , "PAY_ODR" , this.payodr);
	this.ds_bunap.setColumn( 0 , "PAY_SE" , '2');
	this.cal_cntrctDe00.set_value(this.dateUtils.today());


	// 콤보로드 
	this.fn_loadCombo();
}

/*
 * 함수명  	    : fn_init_form
 * 설명 		: Form을 초기화한다.
 * params  		: None
 * return Type 	: None
 * 사용법		: this.initForm();
 */
this.fn_init_form = function(){
	this.gfn_initForm(this);	// 시스템 공통으로 Form을 Initialize 한다.
}

/*
 * 함수명  	    : fn_init_dataset
 * 설명 		: Dataset을 초기화한다.
 *                주로, 조건 Dataset들(ds_cond, ds_cond_00, ds_cond_01, ...) 을 초기화한다.
 * params  		: None
 * return Type 	: None
 * 사용법		: this.initDataset();
 */
this.fn_init_dataset = function()
{
	this.gfn_initCondDs(this, this.div_search);		
}


 /***********************************************************************
 * 공통코드
 ***********************************************************************/
/*
 * 함수명  	    : fn_loadCombo
 * 설명 		: 화면의 Combo 에 데이터를 불러온다.
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_loadCombo();
 */
this.fn_loadCombo = function()
{
	// 공통코드 목록 조회
 	var comCodeParam = [
 		  {OUT_PUT:"ds_payCode", GRP_CODE:"LAD0A1", USE_AT:"1"} // 납부코드
 		, {OUT_PUT:"ds_paySe",   GRP_CODE:"LAD0A8", USE_AT:"1"} // 납부구분
 		, {OUT_PUT:"ds_paySn",   GRP_CODE:"LAD0A9", USE_AT:"1"} // 납부순번 	
 	];
 	this.pmsUtil.getCommonCode("selectCommonCode", comCodeParam);
 	
}
/**********************************************************************
 * CALL TRANSACTION 영역
 **********************************************************************/
/*
 * 함수명  	    : fn_transaction
 * 설명 		: Transaction 요청 처리 함수
 * params  		: strSvcId : 서비스요청 ID
 * return Type 	: None
 * 사용법		: this.fn_transaction("SELECT");
 */
this.fn_transaction = function(strSvcId)
{
	switch (strSvcId) {
		// 계산조회
		case "payamt" : 
			this.ds_payamt.clearData();
			var sController   	= "hsco/pms/sls/com/SLS000000/P09.do";
			var sInDatasets   	= "input1=ds_cond00";
			var sOutDatasets  	= "ds_payamt=output1";
			break;		
		
		case "apaycal" : 
		    this.ds_apay_cal.clearData();
			var sController   	= "hsco/pms/sls/com/SLS000000/P4.do";
			var sInDatasets   	= "input1=ds_cond00";
			var sOutDatasets  	= "ds_apay_cal=output1";
			break;
			
		// 계산조회
		case "apaycalByChk" : 
		    this.ds_apay_cal02.clearData();
			var sController   	= "hsco/pms/sls/com/SLS000000/P4.do";
			var sInDatasets   	= "input1=ds_cond01";
			var sOutDatasets  	= "ds_apay_cal02=output1";
			break;

		default :
			break;
	}
	
	Ex.core.tran(this, strSvcId, sController, sInDatasets, sOutDatasets);
}


/**********************************************************************
 * Transaction Callback 영역
 **********************************************************************/
/*
 * 함수명  	    : fn_callBack
 * 설명 		: Transaction Callback 처리
 * params  		: strSvcId    : 서비스요청 ID
 *                nErrorCode  : 오류 메시지 코드 ([예] 0 : Success, 그밖의 경우, error)
 *                strErrorMsg : 오류 메시지([예]  success.insert|정상적으로 등록되었습니다.)
 * return Type 	: None
 * 사용법		:
 */
this.fn_callBack = function (strSvcId, nErrorCode, strErrorMsg)
{
	this.fn_callback_message(strSvcId, nErrorCode, strErrorMsg);
	
	var bSuccess = nErrorCode == 0 ? true : false;
	if (bSuccess){

		var comboOption = null;
		var targetCombo = null;
		switch(strSvcId){
			// 분양약정 조회 by 납부금액계산 및 적용

			case "payamt" :
			
				this.ds_cond00.clearData();
				var nRow = this.ds_cond00.addRow();
				this.ds_cond00.setColumn( nRow , "IN_SE" ,  ' ');
				this.ds_cond00.setColumn( nRow , "IN_LAD_CODE" , this.ds_bunap.getColumn( 0 , "LAD_CODE"));
				this.ds_cond00.setColumn( nRow , "IN_TO_DAY" , this.cal_cntrctDe00.value);
				this.ds_cond00.setColumn( nRow , "IN_PAY_TMLMT" , this.ds_bunap.getColumn( 0 , "PAY_TMLMT"));
				this.ds_cond00.setColumn( nRow , "IN_PAYAMT" , this.ds_payamt.getColumn( 0 , "PAYAMT"));
				this.ds_cond00.setColumn( nRow , "CNTRCTR_NO" , this.ds_bunap.getColumn( 0 , "CNTRCTR_NO"));
				this.ds_cond00.setColumn( nRow , "PRPOS_SE" , this.ds_bunap.getColumn( 0 , "PRPOS_SE"));    
				this.fn_transaction("apaycal");					
			
			case "apaycal" :

			    this.edt_lfsts_amount04.set_value(0);    // 납부금액
			    this.edt_lfsts_amount05.set_value(0);    // 선납할인
			    this.edt_lfsts_amount08.set_value(0);    // 연체이자
			    this.edt_lfsts_amount07.set_value(0);    // 감액
				this.edt_lfsts_amount06.set_value(0);    // 합계
				this.ds_bunap.setColumn( 0 , "PAYAMT" , this.edt_lfsts_amount03.value);			
				
				
				if(this.ds_apay_cal.getColumn( 0 , "N_RESULT") < 0) // 선납할인
				{
					var tempPreAmt = this.ds_apay_cal.getColumn( 0 , "N_RESULT");
					var tempTotlAmt = this.ds_apay_cal.getColumn( 0 , "TOT_AMT");
					
					if(this.ds_bunap.getColumn(0, "PAY_GB") == "2"){ //보증금일 경우 선납할인금액은 없다
						tempTotlAmt = tempTotlAmt + tempPreAmt;
						tempPreAmt = 0;
					}
					this.edt_lfsts_amount05.set_value(tempPreAmt);
					this.edt_lfsts_amount04.set_value(tempTotlAmt);
				}else if(this.ds_apay_cal.getColumn( 0 , "N_RESULT") > 1) // 연체이자
				{
					this.edt_lfsts_amount08.set_value(this.ds_apay_cal.getColumn( 0 , "N_RESULT"));
					this.edt_lfsts_amount04.set_value(this.ds_apay_cal.getColumn( 0 , "TOT_AMT"));
				}else{
					this.edt_lfsts_amount04.set_value(this.ds_apay_cal.getColumn( 0 , "TOT_AMT"));
				}
			    var Payamt = this.comUtils.isNullThen(this.edt_lfsts_amount04.value , 0);               // 납부금액
			    var Prepay_dscnt_amount = this.comUtils.isNullThen(this.edt_lfsts_amount05.value , 0);  // 선납할인
			    var Arrrg_amount = this.comUtils.isNullThen(this.edt_lfsts_amount08.value , 0);         // 연체이자
			    var Rdcamt_amount = this.comUtils.isNullThen(this.edt_lfsts_amount07.value , 0);        //감액
			    
			    
			    
			    var Tot_amt = parseInt(Payamt) + parseInt(Prepay_dscnt_amount) + parseInt(Arrrg_amount) + parseInt(Rdcamt_amount);
				this.edt_lfsts_amount06.set_value(Tot_amt);
				this.ds_bunap.setColumn( 0 , "PAYAMT" , parseInt(this.ds_bunap.getColumn( 0 , "PAYAMT")) - parseInt(Payamt));  // 납부금액
				if(this.ds_apay_cal.getColumn( 0 , "N_RESULT") < 0)       // 금액이 - 인경우 선납
				{
					this.cmb_suplyCode01.set_value(1);
					this.dscnt_se = 'PP'  
				}
				if(this.ds_apay_cal.getColumn( 0 , "N_RESULT") > 0)      // 금액이 + 인경우 연체
				{
					this.cmb_suplyCode01.set_value(2);
					this.dscnt_se = 'PA'
				}				
				if(this.ds_apay_cal.getColumn( 0 , "N_RESULT") == 0)     // 0 인경우 정상
				{
					this.cmb_suplyCode01.set_value(2);
				}								
				break;
				
				
			// 분양약정 조회 by 확인버튼
			case "apaycalByChk" :
			
			    //this.edt_lfsts_amount04.set_value(0);    // 납부금액
			    this.edt_lfsts_amount05.set_value(0);    // 선납할인
			    this.edt_lfsts_amount08.set_value(0);    // 연체이자
			    this.edt_lfsts_amount07.set_value(0);    // 감액
				this.edt_lfsts_amount06.set_value(0);    // 합계
				this.ds_bunap.setColumn( 0 , "PAYAMT" , this.edt_lfsts_amount03.value);			
				
				//this.edt_lfsts_amount06.set_value(this.ds_apay_cal02.getColumn( 0 , "TOT_AMT"));
				if(this.ds_apay_cal02.getColumn( 0 , "N_RESULT") < 0) // 선납할인
				{
					var tempPreAmt = this.ds_apay_cal02.getColumn( 0 , "N_RESULT");
					
					if(this.ds_bunap.getColumn(0, "PAY_GB") == "2"){ //보증금일 경우 선납할인금액은 없다
						tempPreAmt = 0;
					}
					this.edt_lfsts_amount05.set_value(tempPreAmt);
				}
				if(this.ds_apay_cal02.getColumn( 0 , "N_RESULT") > 1) // 연체이자
				{
					this.edt_lfsts_amount08.set_value(this.ds_apay_cal02.getColumn( 0 , "N_RESULT"));
				}
			    var Payamt = this.comUtils.isNullThen(this.edt_lfsts_amount04.value , 0);               // 납부금액
			    var Prepay_dscnt_amount = this.comUtils.isNullThen(this.edt_lfsts_amount05.value , 0);  // 선납할인
			    var Arrrg_amount = this.comUtils.isNullThen(this.edt_lfsts_amount08.value , 0);         // 연체이자
			    var Rdcamt_amount = this.comUtils.isNullThen(this.edt_lfsts_amount07.value , 0);        // 감액
			    var Tot_amt = parseInt(Payamt) + parseInt(Prepay_dscnt_amount) + parseInt(Arrrg_amount) + parseInt(Rdcamt_amount);
				this.edt_lfsts_amount06.set_value(Tot_amt);
				this.ds_bunap.setColumn( 0 , "PAYAMT" , parseInt(this.ds_bunap.getColumn( 0 , "PAYAMT")) - parseInt(Payamt));  // 납부금액
				if(this.ds_apay_cal02.getColumn( 0 , "N_RESULT") < 0)       // 금액이 - 인경우 선납
				{
					this.cmb_suplyCode01.set_value(1);
					this.dscnt_se = 'PP'  
				}
				if(this.ds_apay_cal02.getColumn( 0 , "N_RESULT") > 0)      // 금액이 + 인경우 연체
				{
					this.cmb_suplyCode01.set_value(2);
					this.dscnt_se = 'PA'
				}				
				if(this.ds_apay_cal02.getColumn( 0 , "N_RESULT") == 0)     // 0 인경우 정상
				{
					this.cmb_suplyCode01.set_value(2);
				}	
						
				var payodr = 0;
				
			 	 var ds ;
			 	 var findrow ;
			 	 var nRow ;
			     if(this.ds_bunap.getColumn(0, "PAY_GB") == "2"){ //보증금
					ds = this.fv_objForm.ds_lcntrctrDepositPopList;		
					findrow = ds.findRow( "CHK" , 1);
					nRow = this.fv_objForm.ds_lcntrctrDepositPopList.insertRow(findrow);
				 }else{ //분양금
					ds = this.fv_objForm.ds_lcntrctrPayPopList;
					findrow = ds.findRow( "CHK" , 1);
					nRow = this.fv_objForm.ds_lcntrctrPayPopList.insertRow(findrow);
				 }
				
				 //var amt = this.ds_apay_cal02.getColumn( 0 , "N_RESULT");                   // 연체할인금액				 
				 var amt = parseInt(this.edt_lfsts_amount05.value)||0;                   // 연체할인금액
				 var s_amt = amt * 0.9; //연체할인공급금액
				 var v_amt = amt * 0.1; //연체할인부가세
				 var cnt_day = this.ds_apay_cal02.getColumn( 0 , "CNT_DAY");                //연체할인부가세
				 var ratio = this.ds_apay_cal02.getColumn( 0 , "RATIO");                    //이율
				 var rquest_ym = this.div_search.Calendar00.value.toString();
				 
				
				//확인버튼 처리
				for( var i = 0 ; i < ds.rowcount ; i++)
				{
					if(ds.getColumn( i , "CHK") == '1')
					{
						ds.setColumn( i , "INSTLMT_SE" , this.cmb_suplyCode.value);                 // 납부구분
						ds.setColumn( i , "PAY_SE" , this.cmb_suplyCode.value);                     // 납부구분
						//ds.setColumn( i , "INSTLMT_SE" , this.cmb_suplyCode.value);               // 납부구분
						ds.setColumn( i , "PAY_ODR" , this.ds_bunap.getColumn( 0 , "PAY_ODR"));     // 납부순번
						ds.setColumn( i , "PAY_SN" , this.ds_bunap.getColumn( 0 , "PAY_ODR"));     // 납부순번		
						ds.setColumn( i , "PAYAMT" , this.edt_lfsts_amount.value);                  // 납부금액
						ds.setColumn( i , "ARRRG_AMOUNT" , this.edt_lfsts_amount01.value);          // 연체금액
						if(this.job_se == 'LAD'){ // 토지
						  ds.setColumn( i , "PREPAY_DSCNT_AMOUNT" , this.edt_lfsts_amount00.value);   // 선납할인
						}else{ // 주택
	                      ds.setColumn( i , "ARRRG_DSCNT_AMOUNT" , this.edt_lfsts_amount00.value);   // 선납할인 					
						}
						ds.setColumn( i , "RDCAMT_AMOUNT" , this.edt_lfsts_amount02.value);         // 감액		
						ds.setColumn( i , "PAYAMT_SM" , this.edt_lfsts_amount.value);               // 납부합계
						ds.setColumn( i , "NPYAMOUNT" , this.edt_lfsts_amount.value);               // 납부합계
						ds.setColumn( i , "UNCLAMT" , this.edt_lfsts_amount.value);                 // 미수금액							
					}
				}	    
						ds.setColumn( nRow , "CHK" , 1); 
						ds.setColumn( nRow , "CNTRCTR_NO" , this.ds_bunap.getColumn( 0 , "CNTRCTR_NO")); // 고객번호
						ds.setColumn( nRow , "PAY_CODE" , this.cmb_suplyCode03.value);                   // 납부코드
						ds.setColumn( nRow , "PAY_SE" , this.cmb_suplyCode01.value);                     // 납부구분
						ds.setColumn( nRow , "INSTLMT_SE" , this.cmb_suplyCode01.value);                 // 납부구분
						ds.setColumn( nRow , "PAY_ODR" , this.cmb_suplyCode02.value);                    // 납부순번(ocr코드)
						ds.setColumn( nRow , "PAY_SN" , this.cmb_suplyCode02.value);                     // 납부순번(ocr코드)
						ds.setColumn( nRow , "PAY_TMLMT" , this.div_search.Calendar00.value);            // 납부기한일
					    ds.setColumn( nRow , "PAY_NO" , this.ds_bunap.getColumn( 0 , "PAY_NO"));
						if(this.ds_bunap.getColumn(0, "PAY_GB") == "2"){ //보증금
						    ds.setColumn( nRow , "LTTOT_RENT_SE" , 'R');                                     // 분양임화성분
						}else{
							ds.setColumn( nRow , "LTTOT_RENT_SE" , 'S');                                     // 분양임화성분
						}
						ds.setColumn( nRow , "PAY_STDR_DE" , this.cal_cntrctDe00.value);                 // 변경기한일			
						ds.setColumn( nRow , "PAYAMT" , this.edt_lfsts_amount04.value);                  // 납부금액						
						
						ds.setColumn( nRow , "ARRRG_AMOUNT" , this.edt_lfsts_amount08.value);            // 연체금액
						if(this.job_se == 'LAD'){ // 토지
						  ds.setColumn( nRow , "PREPAY_DSCNT_AMOUNT" , this.edt_lfsts_amount05.value);     // 선납할인
						}else{ // 주택
	                      ds.setColumn(nRow , "ARRRG_DSCNT_AMOUNT" , this.edt_lfsts_amount05.value);   // 선납할인 					
						}
						//ds.setColumn( nRow , "ARRRG_DSCNT_AMOUNT" , amt);                                // 연체할인금액	
						ds.setColumn( nRow , "ARRRG_DSCNT_SUPLY_AMOUNT" , s_amt);                        // 연체할인공급금액
						ds.setColumn( nRow , "ARRRG_DSCNT_VAT" , v_amt);                                 // 연체할인부가세											
						
						ds.setColumn( nRow , "PAYAMT_SM" , this.edt_lfsts_amount06.value);     			 // 납부합계
						ds.setColumn( nRow , "NPYAMOUNT" , this.edt_lfsts_amount06.value);     			 // 납부합계
						ds.setColumn( nRow , "UNCLAMT" , this.edt_lfsts_amount06.value);     			 // 미수금액
						ds.setColumn( nRow , "RDCAMT_AMOUNT" , this.edt_lfsts_amount07.value);           // 감액					
						ds.setColumn( nRow , "TMPR_RCIV_AMOUNT" , this.edt_lfsts_amount07.value);        // 임시수납금액
						ds.setColumn( nRow , "ARRRG_DSCNT_SE" , this.dscnt_se );                         // 연체할인구분

						ds.setColumn( nRow , "ARRRG_DSCNT_DAYCNT" ,  Math.abs(cnt_day));                 // 연체할인일수
						ds.setColumn( nRow , "ARRRG_DSCNT_INTRT" , ratio);                               // 연체할인이율
						ds.setColumn( nRow , "RQEST_YM" , rquest_ym.substr(0,6));                        // 청구년월	
						ds.setColumn( nRow , "MDAT_DE" , ds.getColumn( i , "MDAT_DE"));                  // 조정일자
						
						this.close();
							
			break;

				
		}
	}
}

/**********************************************************************
 * CALL TRANSACTION 영역
 **********************************************************************/
/* 확인버튼 시 부모창 데이터셋 변경값 입력 */
this.btn_regist_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{

	this.ds_cond01.clearData();
    var nRow = this.ds_cond01.addRow();
    this.ds_cond01.setColumn( nRow , "IN_SE" ,  ' ');
    this.ds_cond01.setColumn( nRow , "IN_LAD_CODE" , this.ds_bunap.getColumn( 0 , "LAD_CODE"));
    this.ds_cond01.setColumn( nRow , "IN_TO_DAY" , this.cal_cntrctDe00.value);
    this.ds_cond01.setColumn( nRow , "IN_PAY_TMLMT" , this.ds_bunap.getColumn( 0 , "PAY_TMLMT"));
    this.ds_cond01.setColumn( nRow , "IN_PAYAMT" , this.edt_lfsts_amount04.value);
    this.ds_cond01.setColumn( nRow , "CNTRCTR_NO" , this.ds_bunap.getColumn( 0 , "CNTRCTR_NO"));
    this.ds_cond01.setColumn( nRow , "PRPOS_SE" , this.ds_bunap.getColumn( 0 , "PRPOS_SE"));    
    this.fn_transaction("apaycalByChk");	
    

		
}

/* 납부금액계산 및 적용 */
this.Tab00_tabpage1_btn_calc_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{	
    this.ds_cond00.clearData();
    var nRow = this.ds_cond00.addRow();
    this.ds_cond00.setColumn( nRow , "IN_SE" ,  ' ');
    this.ds_cond00.setColumn( nRow , "IN_LAD_CODE" , this.ds_bunap.getColumn( 0 , "LAD_CODE"));
    this.ds_cond00.setColumn( nRow , "IN_TO_DAY" , this.cal_cntrctDe00.value);
    this.ds_cond00.setColumn( nRow , "IN_PAY_TMLMT" , this.ds_bunap.getColumn( 0 , "PAY_TMLMT"));
    this.ds_cond00.setColumn( nRow , "IN_PAYAMT" , this.div_search.mse_rcivAmount.value);
    this.ds_cond00.setColumn( nRow , "CNTRCTR_NO" , this.ds_bunap.getColumn( 0 , "CNTRCTR_NO"));
    this.ds_cond00.setColumn( nRow , "PRPOS_SE" , this.ds_bunap.getColumn( 0 , "PRPOS_SE"));    
    this.fn_transaction("payamt");	
}

/* 종료버튼 처리 */
this.btn_close_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	this.close();
}
/* Enter 시 납부금액계산 버튼 호출  */
this.div_search_mse_rcivAmount_onkeydown = function(obj:MaskEdit, e:nexacro.KeyEventInfo)
{
	if (e.keycode == 13) {
		this.Tab00_tabpage1_btn_calc_onclick();
	}
}]]></Script>
  </Form>
</FDL>
