<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\..\default_typedef.xml"/>
  <Form id="HPM050301" classname="HPM050301" left="0" top="0" width="1059" height="735" titletext="TOP배너관리" oninit="HPM050301_oninit" onload="HPM050301_onload">
    <Layouts>
      <Layout>
        <Static id="Static00" taborder="1" text="15" visible="false" left="1031" top="0" width="15" height="735" style="background:#1b3cd23c;align:center middle;"/>
        <Static id="Static01" taborder="2" text="스&#13;&#10;크&#13;&#10;롤&#13;&#10;13" visible="false" top="0" right="0" width="13" height="735" style="background:#d07b173c;align:center middle;"/>
        <Static id="Static08" taborder="4" text="10" visible="false" left="0" top="0" height="10" style="background:#dc143c3c;align:center middle;" right="28"/>
        <Static id="sta_title01" taborder="5" text="TOP배너정보" cssclass="sta_WF_Title02" left="0" top="10" width="14.35%" height="21"/>
        <Static id="Static04" taborder="6" text="5" onclick="Tab00_tabpage5_Static02_onclick" visible="false" left="0" top="31" height="5" style="background:#dc143c3c;align:center middle;" right="28"/>
        <Static id="Static02" taborder="7" text="5" onclick="Tab00_tabpage5_Static02_onclick" visible="false" left="0" top="400" height="5" style="background:#dc143c3c;align:center middle;" right="28"/>
        <Static id="sta_title02" taborder="8" text="TOP배너목록" cssclass="sta_WF_Title02" left="0" top="411" width="14.35%" height="21"/>
        <Static id="Static13" taborder="9" text="10" visible="false" left="0" top="432" height="10" style="background:#dc143c3c;align:center middle;" right="28"/>
        <Div id="div_info" taborder="10" left="0" top="36" height="364" style="border:1 solid #808080ff ;" right="28">
          <Layouts>
            <Layout width="1024" height="653">
              <Static id="Static06" taborder="30" cssclass="sta_WF_Labelbg" left="-1" top="134" width="665" height="202"/>
              <Static id="Static04" taborder="23" cssclass="sta_WF_Labelbg" left="-1" top="336" width="665" height="27"/>
              <Static id="Static03" taborder="0" cssclass="sta_WF_Labelbg" position="fixed" left="-1" top="-1" width="0.09%" height="3"/>
              <Static id="Static02" taborder="1" cssclass="sta_WF_Labelbg" left="-1" top="80" width="665" height="27"/>
              <Static id="Static01" taborder="2" cssclass="sta_WF_Labelbg" left="-1" top="53" width="665" height="27"/>
              <Static id="Static00" taborder="3" cssclass="sta_WF_Labelbg" left="-1" top="26" width="665" height="27"/>
              <Static id="Static11" taborder="4" cssclass="sta_WF_Labelbg" left="0" top="-1" width="665" height="27"/>
              <Static id="sta_NM001" taborder="5" text="시작일시" cssclass="sta_WF_Label" top="-1" height="27" left="0" width="113"/>
              <Static id="sta_NM003" taborder="6" text="가로사이즈" cssclass="sta_WF_Label" left="0" top="26" height="27" width="113"/>
              <Static id="sta_NM15" taborder="7" cssclass="sta_WF_Label" left="0" top="53" height="27" text="가로위치" width="113"/>
              <Static id="sta_NM16" taborder="8" text="제목" cssclass="sta_WF_Label" left="0" top="80" height="27" width="113"/>
              <Static id="sta_NM17" taborder="10" text="타이틀이미지" cssclass="sta_WF_Label" left="0" top="134" height="202" width="113"/>
              <Edit id="edt_bbsId00" taborder="16" readonly="false" left="118" top="83" height="21" width="207"/>
              <Grid id="grd_fileList" taborder="20" binddataset="ds_fileList" useinputpanel="false" autofittype="col" position="absolute" left="119" top="162" height="167" width="537" onheadclick="div_info_grd_fileList_onheadclick">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Column size="74"/>
                      <Column size="242"/>
                      <Column size="125"/>
                      <Column size="119"/>
                      <Column size="108"/>
                    </Columns>
                    <Rows>
                      <Row size="24" band="head"/>
                      <Row size="32"/>
                    </Rows>
                    <Band id="head">
                      <Cell displaytype="checkbox" edittype="checkbox" text="게시판목록"/>
                      <Cell col="1" text="파일명"/>
                      <Cell col="2" text="파일형식"/>
                      <Cell col="3" text="확장자"/>
                      <Cell col="4" text="사이즈"/>
                    </Band>
                    <Band id="body">
                      <Cell displaytype="checkbox" edittype="checkbox" style="align: ;" text="bind:CHK"/>
                      <Cell col="1" style="align:left;" text="bind:ORGINL_FILE_NM"/>
                      <Cell col="2" displaytype="image" text="bind:FILE_IMAGE"/>
                      <Cell col="3" text="bind:FILE_EXTSN"/>
                      <Cell col="4" text="bind:FILE_MG"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <Static id="sta_NM00" taborder="21" text="세로위치" cssclass="sta_WF_Label" left="331" top="53" height="27" width="114"/>
              <Edit id="edt_bbsId01" taborder="18" readonly="false" left="119" top="339" width="537" height="21"/>
              <Static id="sta_NM01" taborder="22" text="링크URL" cssclass="sta_WF_Label" left="0" top="336" height="27" width="113"/>
              <Static id="sta_NM02" taborder="24" text="내용" cssclass="sta_WF_Label" left="662" top="-1" width="114" height="364"/>
              <Static id="Static05" taborder="25" cssclass="sta_WF_Labelbg" left="775" top="-1" height="364" right="0"/>
              <Calendar id="Calendar00" taborder="26" left="0px" top="0px" width="0px" height="0px"/>
              <Static id="sta_NM002" taborder="27" text="종료일시" cssclass="sta_WF_Label" left="331" top="-1" height="27" width="114"/>
              <Calendar id="calEnd" taborder="11" left="451" top="2" height="21" width="145" dateformat="yyyy-MM-dd" value="null"/>
              <Edit id="edt_bbsId02" taborder="12" readonly="true" left="118" top="29" height="21" width="207"/>
              <Static id="sta_NM004" taborder="28" text="세로사이즈" cssclass="sta_WF_Label" left="331" top="26" height="27" width="114"/>
              <Edit id="edt_bbsId03" taborder="13" readonly="true" left="451" top="29" height="21" width="207"/>
              <Edit id="edt_bbsId04" taborder="14" readonly="false" left="118" top="56" height="21" width="207"/>
              <Edit id="edt_bbsId05" taborder="15" readonly="false" left="451" top="56" height="21" width="207"/>
              <Static id="sta_NM05" taborder="29" text="사용여부" cssclass="sta_WF_Label" left="331" top="80" height="27" width="114"/>
              <Radio id="rdo_USE_ENNC" taborder="17" index="0" innerdataset="@ds_use_ennc" codecolumn="CD" datacolumn="CD_NM" value="%" direction="vertical" onitemchanged="div_search_rdo_USE_ENNC_onitemchanged" left="451" top="83" width="206" height="21" style="align:left;"/>
              <Calendar id="calBgn" taborder="9" left="118" top="2" width="145" height="21" dateformat="yyyy-MM-dd" value="null" oneditclick="div_info_calBgn_oneditclick" editformat="yyyy-MM-dd"/>
              <TextArea id="txt_content" taborder="19" left="782" top="6" height="352" right="6"/>
              <Button id="btn_uploadFiles" taborder="32" text="파일업로드" onclick="btn_uploadFiles_onclick" cssclass="btn_WF_Process" left="499" top="139" width="69" height="19"/>
              <Button id="btn_downFiles" taborder="33" text="선택다운로드" onclick="btn_downFiles_onclick" cssclass="btn_WF_Process" left="570" top="139" width="86" height="19"/>
              <Edit id="shour" taborder="34" left="265" top="2" height="21" maxlength="4" inputtype="number" width="60" imemode="none"/>
              <Edit id="ehour" taborder="35" left="598" top="2" height="21" maxlength="4" inputtype="number" width="60"/>
              <Static id="Static07" taborder="36" cssclass="sta_WF_Labelbg" left="-1" top="107" width="663" height="27"/>
              <Static id="sta_NM06" taborder="37" text="순서" cssclass="sta_WF_Label" left="0" top="107" width="113" height="27"/>
              <Edit id="edt_bbsId06" taborder="38" left="118" top="110" width="207" height="21"/>
            </Layout>
          </Layouts>
          <InitValue/>
        </Div>
        <Grid id="grd_bannerList" taborder="11" binddataset="ds_bannerList" useinputpanel="false" autofittype="col" left="0" top="440" bottom="0" right="28" onheadclick="grd_bannerList_onheadclick">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="40" band="left"/>
                <Column size="251"/>
                <Column size="66"/>
                <Column size="66"/>
                <Column size="58"/>
                <Column size="67"/>
                <Column size="55"/>
                <Column size="62"/>
                <Column size="55"/>
                <Column size="64"/>
                <Column size="65"/>
                <Column size="249"/>
              </Columns>
              <Rows>
                <Row size="28" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell text="번호"/>
                <Cell col="1" text="제목"/>
                <Cell col="2" text="배너순서"/>
                <Cell col="3" text="사용여부"/>
                <Cell col="4" text="적용여부"/>
                <Cell col="5" text="시작일자"/>
                <Cell col="6" text="시작일시"/>
                <Cell col="7" text="종료일자"/>
                <Cell col="8" text="종료일시"/>
                <Cell col="9" text="등록일자"/>
                <Cell col="10" text="배너타입"/>
                <Cell col="11" text="이미지명"/>
              </Band>
              <Band id="body">
                <Cell expr="expr:currow + 1"/>
                <Cell col="1" displaytype="normal" edittype="none" style="align:left;" text="bind:BANNER_SJ"/>
                <Cell col="2" text="bind:ORDER_SEQ"/>
                <Cell col="3" displaytype="checkbox" text="bind:USE_AT"/>
                <Cell col="4" displaytype="checkbox" text="bind:APPLC_AT"/>
                <Cell col="5" displaytype="date" text="bind:APPLC_BGNDE" calendardisplaynulltype="none"/>
                <Cell col="6" text="bind:APPLC_BGNTM"/>
                <Cell col="7" displaytype="date" text="bind:APPLC_ENDDE" calendardisplaynulltype="none"/>
                <Cell col="8" text="bind:APPLC_ENDTM"/>
                <Cell col="9" displaytype="date" text="bind:REGIST_DT" calendardisplaynulltype="none"/>
                <Cell col="10" text="bind:BANNER_TYPE"/>
                <Cell col="11" text="bind:BANNER_IMG_URL"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
      </Layout>
    </Layouts>
    <Bind>
      <BindItem id="item0" compid="Div00.div_info.spn_acntYear" propid="value" datasetid="ds_hpmWebzin" columnid="PBLICTE_YEAR"/>
      <BindItem id="item5" compid="Div00.div_info.cmb_month" propid="value" datasetid="ds_hpmWebzin" columnid="PBLICTE_MONTH"/>
      <BindItem id="item1" compid="Div00.div_info.chk_inadqcEntrpsAt01" propid="value" datasetid="ds_hpmWebzin" columnid="USE_AT"/>
      <BindItem id="item2" compid="Div00.div_info.edt_bbsId" propid="value" datasetid="ds_hpmWebzin" columnid="WEBZIN_SJ"/>
      <BindItem id="item3" compid="Div00.div_info.edt_bbsId00" propid="value" datasetid="ds_hpmWebzin" columnid="PDF_URL"/>
      <BindItem id="item25" compid="div_info.rdo_USE_ENNC" propid="value" datasetid="ds_bannerList" columnid="USE_AT"/>
      <BindItem id="item4" compid="div_info.calBgn" propid="value" datasetid="ds_bannerList" columnid="APPLC_BGNDE"/>
      <BindItem id="item6" compid="div_info.calEnd" propid="value" datasetid="ds_bannerList" columnid="APPLC_ENDDE"/>
      <BindItem id="item7" compid="div_info.edt_bbsId02" propid="value" datasetid="ds_bannerList" columnid="WIDTH_SIZE"/>
      <BindItem id="item8" compid="div_info.edt_bbsId03" propid="value" datasetid="ds_bannerList" columnid="VRTICL_SIZE"/>
      <BindItem id="item9" compid="div_info.edt_bbsId04" propid="value" datasetid="ds_bannerList" columnid="WIDTH_LC"/>
      <BindItem id="item10" compid="div_info.edt_bbsId05" propid="value" datasetid="ds_bannerList" columnid="VRTICL_LC"/>
      <BindItem id="item11" compid="div_info.edt_bbsId00" propid="value" datasetid="ds_bannerList" columnid="BANNER_SJ"/>
      <BindItem id="item12" compid="div_info.edt_bbsId01" propid="value" datasetid="ds_bannerList" columnid="BANNER_URL"/>
      <BindItem id="item13" compid="div_info.txt_content" propid="value" datasetid="ds_bannerList" columnid="BANNER_CN"/>
      <BindItem id="item14" compid="div_info.shour" propid="value" datasetid="ds_bannerList" columnid="APPLC_BGNTM"/>
      <BindItem id="item15" compid="div_info.ehour" propid="value" datasetid="ds_bannerList" columnid="APPLC_ENDTM"/>
      <BindItem id="item16" compid="div_info.edt_bbsId06" propid="value" datasetid="ds_bannerList" columnid="ORDER_SEQ"/>
    </Bind>
    <Objects>
      <Dataset id="ds_cond" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="PBLANC_NO" type="STRING" size="256"/>
          <Column id="APPLC_BGNDE1" type="STRING" size="256"/>
          <Column id="APPLC_BGNDE2" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_validation" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="compId" type="STRING" size="256"/>
          <Column id="colId" type="STRING" size="256"/>
          <Column id="PK" type="STRING" size="256"/>
          <Column id="notNull" type="STRING" size="256"/>
          <Column id="type" type="STRING" size="256"/>
          <Column id="nlength" type="STRING" size="256"/>
          <Column id="from" type="STRING" size="256"/>
          <Column id="to" type="STRING" size="256"/>
          <Column id="lengthChkGb" type="STRING" size="256"/>
          <Column id="msgId" type="STRING" size="256"/>
          <Column id="expr" type="STRING" size="256"/>
          <Column id="func" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_condDtl" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="BANNER_ID" type="STRING" size="256"/>
          <Column id="BANNER_TYPE" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row/>
        </Rows>
      </Dataset>
      <Dataset id="ds_use_ennc" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CD" type="STRING" size="256"/>
          <Column id="CD_NM" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="CD">1</Col>
            <Col id="CD_NM">사용</Col>
          </Row>
          <Row>
            <Col id="CD">0</Col>
            <Col id="CD_NM">미사용</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_bannerList" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" onrowposchanged="ds_bannerList_onrowposchanged">
        <ColumnInfo>
          <Column id="BANNER_ID" type="STRING" size="256"/>
          <Column id="BANNER_SJ" type="STRING" size="256"/>
          <Column id="BANNER_CN" type="STRING" size="256"/>
          <Column id="BANNER_URL" type="STRING" size="256"/>
          <Column id="TMPLAT_ID" type="STRING" size="256"/>
          <Column id="FILE_SN" type="STRING" size="256"/>
          <Column id="WIDTH_SIZE" type="STRING" size="256"/>
          <Column id="VRTICL_SIZE" type="STRING" size="256"/>
          <Column id="WIDTH_LC" type="STRING" size="256"/>
          <Column id="VRTICL_LC" type="STRING" size="256"/>
          <Column id="APPLC_BGNDE" type="STRING" size="256"/>
          <Column id="APPLC_ENDDE" type="STRING" size="256"/>
          <Column id="USE_AT" type="STRING" size="256"/>
          <Column id="INNER_SANCTN_ID" type="STRING" size="256"/>
          <Column id="CONFM_AT" type="STRING" size="256"/>
          <Column id="APPLC_AT" type="STRING" size="256"/>
          <Column id="REGIST_DT" type="STRING" size="256"/>
          <Column id="BANNER_TYPE" type="STRING" size="256"/>
          <Column id="LAST_SANCTN_STTUS" type="STRING" size="256"/>
          <Column id="APPLC_BGNTM" type="STRING" size="256"/>
          <Column id="APPLC_ENDTM" type="STRING" size="256"/>
          <Column id="BANNER_IMG_URL" type="STRING" size="4000"/>
          <Column id="ORDER_SEQ" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_fileList" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CHK" type="STRING" size="256"/>
          <Column id="PROGRS" type="BIGDECIMAL" size="16"/>
          <Column id="ORGINL_FILE_NM" type="string" size="32"/>
          <Column id="FILE_EXTSN" type="string" size="32"/>
          <Column id="FILE_STRE_COURS" type="string" size="32"/>
          <Column id="FILE_ID" type="string" size="32"/>
          <Column id="SN" type="bigdecimal" size="16"/>
          <Column id="SYS_SE_CODE" type="string" size="32"/>
          <Column id="FILE_IMAGE" type="string" size="32"/>
          <Column id="FILE_TY" type="string" size="32"/>
          <Column id="JOB_SE" type="string" size="32"/>
          <Column id="DELETE_IMAGE" type="string" size="32"/>
          <Column id="STRE_FILE_NM" type="string" size="32"/>
          <Column id="FILE_MG" type="bigdecimal" size="16"/>
          <Column id="FILE_CN" type="string" size="32"/>
          <Column id="FILE_ORDR" type="bigdecimal" size="16"/>
          <Column id="TRNSMIS_FILE_SIZE" type="string" size="32"/>
          <Column id="USE_AT" type="string" size="32"/>
          <Column id="STTUS" type="string" size="32"/>
          <Column id="FILE_SN" type="bigdecimal" size="16"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cond_fileSn" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="FILE_SN" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_recomInfo" useclientlayout="true">
        <ColumnInfo>
          <Column id="INNER_SANCTN_ID" type="STRING" size="16"/>
          <Column id="INNER_SANCTN_MDL_ID" type="STRING" size="10"/>
          <Column id="SYS_SE_CODE" type="STRING" size="256"/>
          <Column id="JOB_SE" type="STRING" size="256"/>
          <Column id="LAST_SANCTN_STEP" type="STRING" size="256"/>
          <Column id="SANCTN_STEP" type="STRING" size="256"/>
          <Column id="LAST_SANCTNER_ID" type="STRING" size="256"/>
          <Column id="LAST_SANCTN_DT" type="STRING" size="256"/>
          <Column id="JOB_KEY" type="STRING" size="256"/>
          <Column id="LAST_SANCTN_STTUS" type="STRING" size="256"/>
          <Column id="BANNER_ID" type="STRING" size="256"/>
          <Column id="BANNER_TYPE" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row/>
        </Rows>
      </Dataset>
      <Dataset id="ds_cond02" useclientlayout="true">
        <ColumnInfo>
          <Column id="BANNER_ID" type="STRING" size="256"/>
          <Column id="BANNER_TYPE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_ubiDataset" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="BANNER_ID" type="STRING" size="256"/>
          <Column id="BANNER_SJ" type="STRING" size="256"/>
          <Column id="BANNER_CN" type="STRING" size="256"/>
          <Column id="BANNER_URL" type="STRING" size="256"/>
          <Column id="USE_AT" type="STRING" size="256"/>
          <Column id="INNER_SANCTN_ID" type="STRING" size="256"/>
          <Column id="SANCTN_STTUS" type="STRING" size="256"/>
          <Column id="REGISTER_ID" type="STRING" size="256"/>
          <Column id="REGIST_DT" type="STRING" size="256"/>
          <Column id="S1_SANCTNER_NM" type="STRING" size="256"/>
          <Column id="S2_SANCTNER_NM" type="STRING" size="256"/>
          <Column id="S3_SANCTNER_NM" type="STRING" size="256"/>
          <Column id="S4_SANCTNER_NM" type="STRING" size="256"/>
          <Column id="S5_SANCTNER_NM" type="STRING" size="256"/>
          <Column id="S6_SANCTNER_NM" type="STRING" size="256"/>
          <Column id="S1_SANCTN_DT" type="STRING" size="256"/>
          <Column id="S2_SANCTN_DT" type="STRING" size="256"/>
          <Column id="S3_SANCTN_DT" type="STRING" size="256"/>
          <Column id="S4_SANCTN_DT" type="STRING" size="256"/>
          <Column id="S5_SANCTN_DT" type="STRING" size="256"/>
          <Column id="S6_SANCTN_DT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_sanctnSttus">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="CODE_NM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="gds_apprline" useclientlayout="true">
        <ColumnInfo>
          <Column id="APPRLINE_COL1" type="STRING" size="256"/>
          <Column id="APPRLINE_COL2" type="STRING" size="256"/>
          <Column id="APPRLINE_COL3" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript5.0"><![CDATA[/***********************************************************************
 * 화면ID   : HPM050301
 * 화면명   : TOP배너관리
 * 화면설명 : 배너정보 등록/수정/삭제
 * 작성일   : 2016.04.26
 * 작성자   : 박병일
 * 수정이력 :
 ***********************************************************************
 *     수정일     수정자   내용
 ***********************************************************************
 * 2016/08/23 유동철 TOP배너관리는 내부결재를 처리하지 않음(이동근 과장님 확인사항)
 ***********************************************************************
 */

/***********************************************************************
 * Script Include
 ***********************************************************************/
include "lib::comInclude.xjs";
include "mis_lib::misUtil.xjs";
include "lib::comUpDownUtils.xjs";
include "lib::comInnerSanct.xjs";

/***********************************************************************
 * 화면 변수 선언부
 ***********************************************************************/
this.nRowPos = 0;  
this.File_UpDownManager = null;

 /***********************************************************************
 * 메뉴 변수 선언부
 ************************************************************************/

/***********************************************************************
 * onInit / onLoad 영역
 ***********************************************************************/
this.HPM050301_oninit = function(obj:Form, e:nexacro.InitEventInfo)
{
	this.fn_misFormInit(this);
	this.fn_init_form();
	this.fn_init_dataset();
}

this.HPM050301_onload = function(obj:Form, e:nexacro.LoadEventInfo)
{
}

//----------------------------------
// Form/Dataset 오브젝트 초기화
//----------------------------------
this.fn_init_form = function()
{
	this.gfn_initForm(this);
	//조회일자(기간) OBJ
	
}

//--------------------------
// Dataset을 초기화한다.
//--------------------------
this.fn_init_dataset = function()
{
	// 조건에 사용되는 Dataset 초기화
	//this.gfn_initCondDs(this, this.div_search);
	  
	// 파일 메니저 설정
	var fileConfig = {
		useMultiUpload : false,
		onChange: this.fn_onFileSelected,	// 파일 선택 이벤트 핸들러
		onSuccess : this.fn_onFileSuccess	// 전송 성공 이벤트 핸들러
	};
	this.File_UpDownManager = new this.fileUpDownManager(this, "HPM", "CTM");
	this.File_UpDownManager.init(fileConfig);		
}

//--------------------------------------------------------
// 화면의 Combo 에 데이터를 불러온다. (Non-공통코드)
//--------------------------------------------------------
this.fn_loadComboNonCodeTbl = function (strDs, obj)
{

}

this.fn_callbackAfter = function (svcId)
{

}

/***********************************************************************
* Transaction 영역 시작
************************************************************************/

/***********************************************************************
 * Transaction 관련 이벤트 핸들러
 **********************************************************************/

//-------
// 조회
//------- 
this.fn_search = function()
{
    this.ds_condDtl.clearData();
    this.ds_condDtl.addRow();
    this.ds_condDtl.setColumn(0,"BANNER_TYPE","TOP");//상단 배너      
	this.fn_transaction("selectBannerList");
}

//------- 
// 저장
//------- 
this.fn_save = function() 
{	         
	//if(Ex.util.isUpdated(this.ds_bannerList)){
		if(!this.gfn_checkValidation_NoUpdChk(this.ds_bannerList, this.ds_validation)) {
			return;
		}  
        //시작일시, 종료일시는 필수값.
		var stime = this.div_info.shour.value;
        var etime = this.div_info.ehour.value;
        
        //시작시간 체크
        if (stime != "" && typeof stime != "undefined"){
			if (!this.comUtils.isTime(stime)){
				this.gfn_message("comm.값.무효");
				return;
			}
		}
		//종료시간 체크
        if (etime != "" && typeof etime != "undefined"){
            if (!this.comUtils.isTime(etime)){
                this.gfn_message("comm.값.무효");  
                return; 
            }
        }
/*        
        //제목입력값 체크
        if (typeof this.div_info.edt_bbsId00.value == "undefined"){
			this.gfn_message("comm.항목.입력.을", "제목");  
			return;         
        }           
        //사용여부값 체크         
        if (typeof this.div_info.rdo_USE_ENNC.value == "undefined"){
			this.gfn_message("comm.항목.선택.요청", "사용여부");  
			return;         
        }
*/        
        //저장여부체크 
		if(this.gfn_message("confirm.저장.여부"))	{
		    nRowPos = this.ds_bannerList.rowposition;  
		    		  
			var sdate = this.ds_bannerList.getColumn(nRowPos,"APPLC_BGNDE");//시작일자
			var edate = this.ds_bannerList.getColumn(nRowPos,"APPLC_ENDDE");//종료일자 
			 
			if (sdate != "" && typeof sdate != "undefined") sdate = sdate + stime;
			if (edate != "" && typeof edate != "undefined") edate = edate + etime;
		    
		    var nRow = this.ds_fileList.rowposition;
	        var fileName  = this.ds_fileList.getColumn(nRow, "STRE_FILE_NM");//업로드한 파일명
//	        if (fileName == "" || typeof fileName == "undefined"){ this.gfn_message("info.파일.선택.요청"); return; }
	        
	        var fileExtsn  = this.ds_fileList.getColumn(nRow, "FILE_EXTSN");//업로드한 파일 확장자
            var bannerUrl = "/upload/HPM/CTM/"+fileName+"."+fileExtsn;//업로드할 파일 경로및 파일명
            if (typeof fileName == "undefined") bannerUrl = "";
            
            this.ds_bannerList.setColumn(nRowPos,"BANNER_IMG_URL",bannerUrl);//배너 이미지명    			    
		    this.ds_bannerList.setColumn(nRowPos,"APPLC_BGNDE",sdate);//시작일시
		    this.ds_bannerList.setColumn(nRowPos,"APPLC_ENDDE",edate);//종료일시		    
		    this.ds_bannerList.setColumn(nRowPos,"BANNER_TYPE","TOP");//상단 배너
		    this.ds_bannerList.setColumn(nRowPos,"WIDTH_SIZE","1020");//WIDTH값 1020으로 고정
		    this.ds_bannerList.setColumn(nRowPos,"VRTICL_SIZE","284");//HEIGHT값 284로 고정	
		    this.ds_bannerList.setColumn(nRowPos,"APPLC_AT","1");//
			this.fn_transaction("mainCUD");
		}  
	//} else { 
	//	this.gfn_message("comm.데이터.변경.없음");
	//	return;
	//} 
}   
    
//-----------------
// 첨부파일 조회 
//-----------------
this.fn_search_fileList = function()
{
	var cRow   = this.ds_bannerList.rowposition;
	var fileSn = this.ds_bannerList.getColumn(cRow, "FILE_SN");	
	this.ds_cond_fileSn.clearData();
	var nRow = this.ds_cond_fileSn.addRow();	
	this.ds_cond_fileSn.setColumn(nRow, "FILE_SN", fileSn);	

	this.ds_fileList.clearData();
	this.fn_transaction("selectAtchFile");
}

/**********************************************************************
 * CALL TRANSACTION 영역
 **********************************************************************/

/*
 * 함수명  	: fn_transaction
 * 설명 		: Transaction 요청 처리 함수
 * params  		: strSvcId : 서비스요청 ID
 * return Type 	: None
 * 사용법		: this.fn_transaction("SELECT");
 */
this.fn_transaction = function(strSvcId)
{
	switch (strSvcId) {
	 
		case "selectBannerList": // List 불러오기
			var sController   	= "hsco/hpm/ctm/HPM050301/selectBannerList.do";
			var sInDatasets   	= "input1=ds_condDtl";
			var sOutDatasets  	= "ds_bannerList=output1";
			break;	
			 
		case "mainCUD": // 저장
			var sController   	= "hsco/hpm/ctm/HPM050301/mainCUD.do";
			var sInDatasets   	= "input1=ds_bannerList:U";
			var sOutDatasets  	= "";
			break;
						
		case "selectAtchFile": //첨부파일조회
			var sController  = "/hsco/cmm/file/selectAtchmnFileList.do";
			var sInDatasets  = "input1=ds_cond_fileSn";
			var sOutDatasets = "ds_fileList=output1";
			break;	
								 
	   case "GetInnerSanctnId": // 내부결재id 조회   
			var sController   	= "hsco/com/sym/ism/SYM090200/InnerSanctionId.do";
			var sInDatasets   	= "input1=ds_recomInfo";
			var sOutDatasets  	= "ds_recomInfo=output1";
			break;		     		
     		
	   case "saveInnerSanctionId":  // 내부결재 번호 저장   
			var sController   	= "hsco/hpm/ctm/HPM050301/saveInnerSanctionId.do";
			var sInDatasets   	= "input1=ds_recomInfo:U";
			var sOutDatasets  	= ""; 
		    break;  		    								    							

       case "deleteFile":  // 오입력된 파일 정보 삭제
			var sController     = "hsco/cmm/file/deleteFile.do";
			var sInDatasets     = "input1=ds_fileList:U";
			var sOutDatasets    = "ds_fileList=output1";
	}

	Ex.core.tran(this, strSvcId, sController, sInDatasets, sOutDatasets);
}

 /**********************************************************************
 * Transaction Callback 영역
 ***********************************************************************/

 /*
 * 함수명  	: fn_callBack
 * 설명 		: Transaction Callback 처리
 * params  		: strSvcId    : 서비스요청 ID
 *                nErrorCode  : 오류 메시지 코드 ([예] 0 : Success, 그밖의 경우, error)
 *                strErrorMsg : 오류 메시지([예]  success.insert|정상적으로 등록되었습니다.)
 * return Type 	: None
 * 사용법		:
 */
this.fn_callBack = function (strSvcId, nErrorCode, strErrorMsg)
{
	if(nErrorCode != '0') {
		this.gfn_callback_message(strSvcId, nErrorCode, strErrorMsg);
	} else {
		switch (strSvcId) {
		
			case "selectBannerList": // List 불러오기			
				this.ds_bannerList.set_rowposition(nRowPos);
				nRowPos = 0;							
				break;		
		
			case "mainCUD": // 저장
				this.gfn_message("success.처리.성공");                	
				this.fn_search();	
					
			case "selectAtchFile":
			    this.fn_fileExtChk();// 파일 업로드 확장자 체크 추가
				break;								
				
			case "saveInnerSanctionId":  // 내부결재번호 저장
				break;										

		}
	}
}

/***********************************************************************
* Transaction 영역 끝
************************************************************************/

/***********************************************************************
 * non-Transaction 관련 컴포넌트 이벤트 처리 함수
 ***********************************************************************/ 
//---------
// 신규
//---------
this.fn_insert = function()
{	
	nRowPos = this.ds_bannerList.addRow();
	var today = this.comUtils.getClientDate("YYYYMMDD");
	
	this.ds_bannerList.setColumn(nRowPos, "APPLC_BGNDE", today);
	this.ds_bannerList.setColumn(nRowPos, "APPLC_BGNTM", "0000");
	this.ds_bannerList.setColumn(nRowPos, "APPLC_ENDDE", today);
	this.ds_bannerList.setColumn(nRowPos, "APPLC_ENDTM", "2359");	
	this.ds_bannerList.setColumn(nRowPos, "WIDTH_SIZE","1020");//WIDTH값 1020으로 고정
	this.ds_bannerList.setColumn(nRowPos, "VRTICL_SIZE","284");//HEIGHT값 284로 고정		    	
	this.ds_bannerList.setColumn(nRowPos, "VRTICL_LC", "0");	
	this.ds_bannerList.setColumn(nRowPos, "WIDTH_LC", "0");	
	this.ds_bannerList.setColumn(nRowPos, "WIDTH_LC", "0");	
	this.ds_bannerList.setColumn(nRowPos, "USE_AT", "1");		
}

//---------
// 취소
//---------
this.fn_cancel = function()
{
	if (this.gfn_message("confirm.취소여부")) {
		this.ds_bannerList.reset();			//DATASET ROLLBACK
		this.ds_bannerList.applyChange();	//DATASET COMMIT
	}
}

//---------
// 삭제
//---------
this.fn_delete = function()
{
	if (this.gfn_message("confirm.삭제여부")) {
		var nRow = this.ds_bannerList.rowposition;
		this.ds_bannerList.deleteRow(nRow);
		this.fn_search_fileList();
	}
}

//좌측 "0"패딩처리하는 함수
this.fn_prependZero = function(num, len)
{
	while(num.toString().length < len) {
		num = "0" + num;
	}
	return num;
}

//-------------
// 결재[내부]
//-------------
this.fn_sanction = function()
{
/* 내부결재 처리하지 않음.
	var id = this.ds_bannerList.getColumn(this.ds_bannerList.rowposition,"BANNER_ID");
	
	if(id == undefined || id == "" || id == null)
	{
	   this.gfn_message("info.처리불가","팝업정보 저장후 \n진행하시기바랍니다.");
	   return;
	}
			
	var sanValue = this.ds_bannerList.getColumn(this.ds_bannerList.rowposition, "LAST_SANCTN_STTUS");
				
	if(null != sanValue){
		if(!("S08" == sanValue || "S09" == sanValue)) {
			this.alert("fail.실행.불가", "결재 실행을");
			return;
		}
	}			

	var gridObj = this.ds_bannerList;			//그리드
	var gridSelectedRow = gridObj.rowposition;	//그리드 선택로우		

    this.ds_cond02.clearData();
    
	//보고서변환
	this.ds_cond02.addRow();
    this.ds_cond02.setColumn(0,"BANNER_TYPE", "TOP"); 
    this.ds_cond02.setColumn(0,"BANNER_ID", id );
    
	var sanctnId        = "";
	var strSvcId        = "innerSanctnUbiDataset";
	var reportTitle     = "BANNER등록내부결재";
	var reportUri       = "/hpm/ctm/HPM050301_R01.jrf";
	var saveFileName    = "BANNER등록내부결재";
	var sController   	= "/hsco/hpm/ctm/HPM050301/innerSanctnUbiDataset.do";
	var sInDatasets   	= "input1=ds_cond02"; 
	var sOutDatasets  	= "ds_ubiDataset=output1";
	
	this.gfn_makeReportTranInfo(sanctnId, strSvcId, sController, sInDatasets, sOutDatasets, reportTitle, reportUri, saveFileName);
	
	//내부결재요청 
	//업무키 조합한다. 
	var key = gridObj.getColumn(gridSelectedRow, "BANNER_TYPE") + "^" 
			+ this.fn_prependZero(gridObj.getColumn(gridSelectedRow, "BANNER_ID"),12);
							
	this.ds_recomInfo.clearData();		        
	this.ds_recomInfo.addRow();
	
	this.ds_recomInfo.setColumn(0, "INNER_SANCTN_MDL_ID", "HPM-100041");	//내부결재모형ID
	this.ds_recomInfo.setColumn(0, "SYS_SE_CODE", "SYS");				    //시스템구분 COM024
	this.ds_recomInfo.setColumn(0, "JOB_SE", "HPM");						//업무구분 COM025
	this.ds_recomInfo.setColumn(0, "JOB_KEY", key);						    //시스템 업무별 UNIQUE KEY
	this.ds_recomInfo.setColumn(0, "INNER_SANCTN_ID", key);					//내부결재키 UNIQUE KEY
		        
	var fn_cb = function(sPopupId, sReturn){
		var sanctnResult = sReturn.split("^"); //index 0: 응답코드, index 1 : 내부결재ID
		
		this.ds_recomInfo.clearData(); 
		var nRow = this.ds_recomInfo.addRow();
	
		//if("0000"==sanctnResult[0]){
		//	this.ds_recomInfo.setColumn(nRow, "LAST_SANCTN_STTUS" , sanctnResult[1]);						
		//}
		//else {
		//	this.ds_recomInfo.setColumn(nRow, "LAST_SANCTN_STTUS" , "");			
		//}  
		  
		this.ds_recomInfo.setColumn(nRow, "BANNER_ID"  , id);
		this.ds_recomInfo.setColumn(nRow, "INNER_SANCTN_ID" , key);
		this.ds_recomInfo.setColumn(nRow, "BANNER_TYPE" , gridObj.getColumn(gridSelectedRow, "BANNER_TYPE"));				
		this.fn_transaction("saveInnerSanctionId");	 
	}
	     
    this.fn_transaction("saveInnerSanctionId");			
	var result = this.gfn_openInnerSanctionPopup(this.ds_recomInfo, fn_cb);
				
// // 	break;
// // 	}
*/
} 

//----------------------------------------------------
// Grid Head 클릭 이벤트 처리(Grid 데이터 정렬) 
//----------------------------------------------------
this.grd_bannerList_onheadclick = function(obj:Grid, e:nexacro.GridClickEventInfo)
{
    this.gfn_gridSort(obj, e); // Grid 데이터 정렬
}

//----------------------------------------------
// 선택삭제 버튼 클릭시
//----------------------------------------------
this.btn_delFiles_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	var findRow = this.ds_fileList.findRow("CHK", "1");
	if(findRow < 0) {
		this.gfn_message("comm.데이터.선택.없음");
			return;
	}
	if(!this.gfn_message("confirm.선택파일.삭제여부", "들")){
		return false;
	}	
	for(var fRow = this.ds_fileList.getRowCount()-1; fRow >= 0; fRow--) {
		var chkVal = this.ds_fileList.getColumn(fRow, "CHK");
		if(chkVal == '1') {
			this.ds_fileList.deleteRow(fRow);
		}
	}
	var strSvcId   	 = "deleteFile";
	var sController  = "hsco/cmm/file/deleteFile.do";
	var sInDatasets  = "input1=ds_fileList:U";
	var sOutDatasets = "ds_fileList=output1";
	
	Ex.core.tran(this, strSvcId, sController, sInDatasets, sOutDatasets); 	
}

//----------------------------------------------
// 파일업로드 버튼 클릭시
//----------------------------------------------
this.btn_uploadFiles_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{

	// 첨부파일 업로드(fileSn 자동채번 / 첨부파일 Master에 ROW추가 / 파일 업로드 및 자동저장 / 테이블에 fileSn반영 / 데이터셋에 fileSn반영, 단 신규 ROW가 아닐경우 ROWTYPE은 유지)
	this.fn_autoFileSn(
		 "HPM"						// 대분류   (SYS_SE)
		,"CTM"						// 업무구분 (JOB_SE)
		, this.File_UpDownManager	// fileManager 오브젝트
		, this.ds_fileList		    // fileObject
		, this.ds_bannerList	    // fileSn을 불러오거나 반영해야 하는 컬럼
		, "TBHPM_BANNER_INFO"		// fileSn을 저장할 테이블
		, "FILE_SN"					// fileSn 컬럼명이 다를 경우를 대비
		, ["BANNER_ID"]				// fileSn을 저장할 테이블의 PK (FileSn 확인 및 자동반영목적)
	);	
}

//----------------------------------------------
// 선택다운로드 버튼 클릭시
//----------------------------------------------
this.btn_downFiles_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	var findRow = this.ds_fileList.findRow("CHK", "1");
	if(findRow < 0) {
		this.gfn_message("comm.데이터.선택.없음");
		return;
	}
	for(var fRow = 0; fRow < this.ds_fileList.getRowCount(); fRow++) {
		var fileSn    = this.ds_fileList.getColumn(fRow, "FILE_SN");
		var fileOrder = this.ds_fileList.getColumn(fRow, "FILE_ORDR");
		var fileName  = this.ds_fileList.getColumn(fRow, "ORGINL_FILE_NM");
		var chk       = this.ds_fileList.getColumn(fRow, "CHK");
		if(chk == '1') {
			this.File_UpDownManager.download(fileSn, fileOrder, fileName);
		}
	}	
}

//----------------------------------------------
// 첨부파일목록 그리드 HEAD 클릭시
//----------------------------------------------
this.div_info_grd_fileList_onheadclick = function(obj:Grid, e:nexacro.GridClickEventInfo)
{
	if(e.col == 0){	
		//모든 체크박스 선택
		this.gfn_setGridCheckAll(obj, e);
	}else {
		//선택한 헤드에 따른 정렬
		this.gfn_gridSort(obj, e); 
	} 
} 
//----------------------------- 
// 팝업목록 rowposchanged
//-----------------------------
this.ds_bannerList_onrowposchanged = function(obj:Dataset, e:nexacro.DSRowPosChangeEventInfo)
{
	this.fn_search_fileList();
}

/***********************************************************************
* 사용자 정의 함수
************************************************************************/
//파일 확장자 체크 
this.fn_fileExtChk  = function(){

	var nRow = this.ds_fileList.rowposition;//파일 데이터셋	
	var fileExtsn  = this.ds_fileList.getColumn(nRow, "FILE_EXTSN");//파일 업로드 확장자
	
	if (fileExtsn == "undefined") return;
	if (fileExtsn.toLowerCase() != "jpg"&&fileExtsn.toLowerCase() != "jpeg"&&fileExtsn.toLowerCase() != "gif"&&fileExtsn.toLowerCase() != "png"&&fileExtsn.toLowerCase() != "bmp"){//파일확장자가 pdf 가 아닌 경우 오류 메시지 출력하고, 등록된 이미지 삭제처리
	    this.gfn_message("info.파일.업로드.타입.불가","이미지가 아닌|이미지 파일만 업로드 가능합니다.");
	    this.ds_fileList.deleteRow(nRow);;//잘못 등록된 파일목록에서 삭제
	    this.fn_transaction("deleteFile");//오입력된 파일정보 삭제
	    return; 
	}
} 
]]></Script>
  </Form>
</FDL>
