<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\..\default_typedef.xml"/>
  <Form id="HRM070305" classname="SAL030106" left="0" top="0" width="1059" height="735" titletext="당직수당지급관리" oninit="SAL030106_oninit" onload="SAL030106_onload">
    <Layouts>
      <Layout>
        <Div id="div_search" taborder="8" left="0" top="0" right="28" height="33" cssclass="div_WFSA_Box" onclick="div_search_onclick">
          <Layouts>
            <Layout>
              <Static id="Static06" taborder="153" text="15" visible="false" left="0" top="2" right="1015" height="20" style="background:#00ffff66;"/>
              <Static id="Static00" taborder="154" text="5" visible="false" left="104" top="53" right="887" height="5" style="background:#fa794f66;align:center middle;"/>
              <Static id="Static16" taborder="155" text="지급년도" cssclass="sta_WFSA_Label" left="15" top="5" height="21" width="65"/>
              <Spin id="spn_excclcYear" taborder="160" value="2015" max="3000" min="2010" cssclass="spn_WF_Essential" left="85" top="5" height="21" width="72"/>
            </Layout>
          </Layouts>
        </Div>
        <Static id="Static31" taborder="10" text="당직수당지급상세정보" cssclass="sta_WF_Title02" left="353" top="45" width="170" height="19"/>
        <Static id="Static03" taborder="11" text="5" visible="false" left="0" top="64" right="28" height="5" style="background:#dc143c3c;align:center middle;"/>
        <Static id="Static00" taborder="12" text="15" visible="false" left="1031" top="0" right="13" height="735" style="background:#1b3cd23c;align:center middle;"/>
        <Static id="Static01" taborder="13" text="스&#13;&#10;크&#13;&#10;롤&#13;&#10;13" visible="false" left="1046" top="0" right="0" height="735" style="background:#d07b173c;align:center middle;"/>
        <Static id="Static04" taborder="14" text="10" visible="false" left="0" top="33" right="28" height="10" style="background:#dc143c3c;align:center middle;"/>
        <Button id="btn_pymntLong" taborder="68" text="장기근속수당" cssclass="btn_WF_Process" top="102" right="277" height="21" onclick="btn_pymntLong_onclick" width="92"/>
        <Static id="Static02" taborder="69" text="당직수당지급내역" cssclass="sta_WF_Title02" left="0" top="44" height="19" width="170"/>
        <Grid id="grd_pymnt_de" taborder="70" binddataset="ds_pymnt_de" useinputpanel="false" autofittype="col" left="0" top="69" width="341" autoenter="select" oncellclick="grd_pymnt_de_oncellclick" height="668">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="30"/>
                <Column size="60"/>
                <Column size="65"/>
                <Column size="75"/>
                <Column size="36"/>
                <Column size="36"/>
                <Column size="36"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell rowspan="2" text="순번"/>
                <Cell col="1" rowspan="2" text="지급년월"/>
                <Cell col="2" rowspan="2" text="지급구분"/>
                <Cell col="3" rowspan="2" text="지급일자"/>
                <Cell col="4" colspan="3" text="전자결재"/>
                <Cell row="1" col="4" text="기안"/>
                <Cell row="1" col="5" text="결재"/>
                <Cell row="1" col="6" text="상세"/>
              </Band>
              <Band id="body">
                <Cell text="expr:currow+1"/>
                <Cell col="1" text="bind:PYMNT_YM" mask="####-##"/>
                <Cell col="2" text="당직수당"/>
                <Cell col="3" displaytype="date" text="bind:PYMNT_DE" calendardisplaynulltype="none"/>
                <Cell col="4" displaytype="image" text="bind:DRFT_STS_IMG" tooltiptext="bind:DRFT_DT"/>
                <Cell col="5" displaytype="image" style="backgroundimage: ;" text="bind:SANCTN_STS_IMG" tooltiptext="bind:LAST_SANCTN_DT"/>
                <Cell col="6" displaytype="expr:DRFT_STS == '1' ? 'image' : 'none'" edittype="none" style="align:center;cursor:EXPR(DRFT_STS!= '1' ? 'arrow' : 'hand');controlbackground: ;" text="URL('theme://images/sanctn/ico_pop_dtl.png')"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Grid id="grd_bndtPymntList" taborder="71" binddataset="ds_bndtPymntList" useinputpanel="false" summarytype="top" left="352" top="69" right="28" onheadclick="grd_bndtPymntList_onheadclick" height="668">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="40" band="left"/>
                <Column size="62" band="left"/>
                <Column size="80" band="left"/>
                <Column size="110" band="left"/>
                <Column size="120" band="left"/>
                <Column size="58" band="left"/>
                <Column size="68" band="left"/>
                <Column size="63" band="left"/>
                <Column size="50" band="left"/>
                <Column size="50" band="left"/>
                <Column size="100"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="35" band="head"/>
                <Row size="24"/>
                <Row size="24" band="summ"/>
              </Rows>
              <Band id="head">
                <Cell colspan="10" text="기본사항"/>
                <Cell col="10" text="당직수당"/>
                <Cell row="1" text="순번"/>
                <Cell row="1" col="1" text="지급년월"/>
                <Cell row="1" col="2" text="당직구분"/>
                <Cell row="1" col="3" text="당직일자"/>
                <Cell row="1" col="4" text="부서명"/>
                <Cell row="1" col="5" text="사번"/>
                <Cell row="1" col="6" text="사원명"/>
                <Cell row="1" col="7" text="직종"/>
                <Cell row="1" col="8" text="직위"/>
                <Cell row="1" col="9" text="직급"/>
                <Cell row="1" col="10" text="지급액"/>
              </Band>
              <Band id="body">
                <Cell displaytype="number" text="expr:currow+1"/>
                <Cell col="1" text="bind:PYMNT_YM" mask="####-##"/>
                <Cell col="2" displaytype="combo" text="bind:BNDT_SE" combodataset="ds_bndtSe" combocodecol="CODE" combodatacol="CODE_NM"/>
                <Cell col="3" text="bind:BNDT_DE" mask="####-##-##"/>
                <Cell col="4" text="bind:DEPT_NM"/>
                <Cell col="5" text="bind:EMPNO"/>
                <Cell col="6" text="bind:EMPNM"/>
                <Cell col="7" displaytype="combo" text="bind:JSSFC_SE" combodataset="ds_jssfc" combocodecol="CODE" combodatacol="CODE_NM"/>
                <Cell col="8" displaytype="combo" text="bind:OFCPS" combodataset="ds_ofcps" combocodecol="CODE" combodatacol="CODE_NM"/>
                <Cell col="9" text="bind:CLSF_SE"/>
                <Cell col="10" displaytype="number" style="align:right;padding:0 5 0 0;" text="bind:BNDT_ALLWNC"/>
              </Band>
              <Band id="summary">
                <Cell colspan="9"/>
                <Cell col="9" displaytype="text" text="expr:dataset.getRowCount()+'명'"/>
                <Cell col="10" displaytype="number" style="align:right;padding:0 5 0 0;" text="expr:dataset.getSum('BNDT_ALLWNC')"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Div id="div_cre" taborder="72" top="43" right="119" width="225" height="146" style="background:#ffffffff;shadow:outer 5,5 10 gray;" visible="false">
          <Layouts>
            <Layout>
              <Static id="sta_title" taborder="76" text="당직수당생성" cssclass="sta_WF_PopupTitle" left="0" top="0" right="0" height="34" onmousemove="div_print_sta_title_onmousemove" onlbuttondown="div_print_sta_title_onlbuttondown"/>
              <Button id="btn_destroy" taborder="77" cssclass="btn_WF_PopupClose" top="7" right="14" width="20" height="20" onclick="div_cre_btn_destroy_onclick"/>
              <Static id="Static02" taborder="78" text="15" visible="false" top="32" right="0" bottom="0" width="15" style="background:#1b3cd23c;align:center middle;"/>
              <Static id="Static05" taborder="79" text="15" visible="false" left="0" top="32" bottom="-2" width="15" style="background:#1b3cd23c;align:center middle;"/>
              <Static id="Static00" taborder="80" text="10" visible="false" left="15" top="34" right="15" height="10" style="background:#dc143c3c;align:center middle;"/>
              <Static id="Static03" taborder="81" text="10" visible="false" left="15" top="96" right="15" height="10" style="background:#dc143c3c;align:center middle;"/>
              <Static id="Static10" taborder="82" text="15" visible="false" left="15" top="131" right="15" height="15" style="background:#1b3cd23c;align:center middle;"/>
              <Static id="Static08" taborder="83" text="지급일자" cssclass="sta_WFSA_Label" left="21" top="75" width="66" height="21"/>
              <Calendar id="cal_pymntDe" taborder="84" dateformat="yyyy-MM-dd" cssclass="cal_WF_Essential" left="87" top="75" width="123" height="21"/>
              <Button id="btn_cre" taborder="85" text="당직수당생성" cssclass="btn_WF_Process" left="15" top="106" width="195" height="25" onclick="div_cre_btn_cre_onclick"/>
              <Static id="Static01" taborder="86" text="15" visible="false" left="15" top="65" right="15" height="10" style="background:#1b3cd23c;align:center middle;"/>
              <Static id="sta_gnfdDe" taborder="87" text="기준년월" cssclass="sta_WFSA_Label" left="20" top="44" width="64" height="21"/>
              <Div id="div_monCal" taborder="88" url="common::frmMonCal.xfdl" left="87" top="44" width="84" height="21" async="false"/>
            </Layout>
          </Layouts>
        </Div>
        <Button id="btn_crePop" taborder="73" text="당직수당생성" cssclass="btn_WF_Process" top="43" right="28" width="87" height="19" onclick="btn_crePop_onclick"/>
      </Layout>
    </Layouts>
    <Bind>
      <BindItem id="item0" compid="div_search.spn_excclcYear" propid="value" datasetid="ds_cond00" columnid="PYMNT_YEAR"/>
    </Bind>
    <Objects>
      <Dataset id="ds_rspofc" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="CODE_NM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_ofcps" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="CODE_NM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_jssfc" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="CODE_NM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cond00" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="PYMNT_YEAR" type="STRING" size="256"/>
          <Column id="PYMNT_YEAR2" type="STRING" size="256"/>
          <Column id="EMPL_SE" type="STRING" size="256"/>
          <Column id="SALARY_SE" type="STRING" size="256"/>
          <Column id="HVOF_DE" type="STRING" size="256"/>
          <Column id="PYMNT_YM" type="STRING" size="256"/>
          <Column id="PYMNT_DE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_pymnt_se" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="CODE_NM" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="CODE_NM">복리후생비</Col>
            <Col id="CODE">1</Col>
          </Row>
          <Row>
            <Col id="CODE_NM">급여</Col>
            <Col id="CODE">2</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_validation" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="compId" type="STRING" size="256"/>
          <Column id="colId" type="STRING" size="256"/>
          <Column id="PK" type="STRING" size="256"/>
          <Column id="notNull" type="STRING" size="256"/>
          <Column id="type" type="STRING" size="256"/>
          <Column id="nlength" type="STRING" size="256"/>
          <Column id="from" type="STRING" size="256"/>
          <Column id="to" type="STRING" size="256"/>
          <Column id="lengthChkGb" type="STRING" size="256"/>
          <Column id="msgId" type="STRING" size="256"/>
          <Column id="expr" type="STRING" size="256"/>
          <Column id="func" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="compId">ds_cond00</Col>
            <Col id="colId">PYMNT_DE</Col>
            <Col id="PK"/>
            <Col id="notNull">Y</Col>
            <Col id="type"/>
            <Col id="nlength"/>
            <Col id="from"/>
            <Col id="to"/>
            <Col id="lengthChkGb"/>
            <Col id="msgId">지급일자</Col>
            <Col id="expr"/>
            <Col id="func"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_anslryse" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="CODE_NM" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="CODE_NM">호봉</Col>
          </Row>
          <Row>
            <Col id="CODE">Y</Col>
            <Col id="CODE_NM">연봉</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_pymnt_de" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" onrowposchanged="ds_pymnt_de_onrowposchanged">
        <ColumnInfo>
          <Column id="PYMNT_YM" type="STRING" size="256"/>
          <Column id="PYMNT_DE" type="STRING" size="256"/>
          <Column id="BNDT_ALLWNC_TOT" type="BIGDECIMAL" size="256"/>
          <Column id="SANCTN_NO" type="STRING" size="256"/>
          <Column id="DRFT_STS" type="STRING" size="256"/>
          <Column id="DRFT_STS_IMG" type="STRING" size="256"/>
          <Column id="DRFT_DT" type="STRING" size="256"/>
          <Column id="SANCTN_STS" type="STRING" size="256"/>
          <Column id="SANCTN_STS_IMG" type="STRING" size="256"/>
          <Column id="LAST_SANCTN_DT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cond01" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="PYMNT_YM" type="STRING" size="256"/>
          <Column id="PYMNT_DE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_bndtPymntList" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="PYMNT_YM" type="STRING" size="256"/>
          <Column id="PYMNT_DE" type="STRING" size="256"/>
          <Column id="EMPNO" type="STRING" size="256"/>
          <Column id="EMPNM" type="STRING" size="256"/>
          <Column id="BNDT_DE" type="STRING" size="256"/>
          <Column id="BNDT_SE" type="STRING" size="256"/>
          <Column id="JSSFC_SE" type="STRING" size="256"/>
          <Column id="DEPT_CODE" type="STRING" size="256"/>
          <Column id="DEPT_NM" type="STRING" size="256"/>
          <Column id="CLSF_SE" type="STRING" size="256"/>
          <Column id="OFCPS" type="STRING" size="256"/>
          <Column id="SALARY_BANK_NM" type="STRING" size="256"/>
          <Column id="SALARY_BANK_ACNUT" type="STRING" size="256"/>
          <Column id="ALLWNC_BANK_NM" type="STRING" size="256"/>
          <Column id="ALLWNC_BANK_ACNUT" type="STRING" size="256"/>
          <Column id="BNDT_ALLWNC" type="BIGDECIMAL" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cond02" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="PYMNT_YM" type="STRING" size="256"/>
          <Column id="PYMNT_SE" type="STRING" size="256"/>
          <Column id="PYMNT_DE" type="STRING" size="256"/>
          <Column id="SALARY_SE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_SalaryPymntExpndtr00" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="PYMNT_YM" type="STRING" size="256"/>
          <Column id="SALARY_SE" type="STRING" size="256"/>
          <Column id="PYMNT_SE" type="STRING" size="256"/>
          <Column id="PYMNT_DE" type="STRING" size="256"/>
          <Column id="CPTAL_ASIGN_REQST_DE" type="STRING" size="256"/>
          <Column id="CPTAL_ASIGN_CONFM_NO" type="STRING" size="256"/>
          <Column id="DRFT_DE" type="STRING" size="256"/>
          <Column id="INNER_SANCTN_ID" type="STRING" size="256"/>
          <Column id="EXPNDTR_DECSN_DE" type="STRING" size="256"/>
          <Column id="EXPNDTR_DECSN_NO" type="STRING" size="256"/>
          <Column id="PYMNT_AM_SM" type="BIGDECIMAL" size="256"/>
          <Column id="DDC_AM_SM" type="BIGDECIMAL" size="256"/>
          <Column id="PYMNT_NMPR" type="BIGDECIMAL" size="256"/>
          <Column id="BUDGET_ACNT_CODE" type="STRING" size="256"/>
          <Column id="BUDGET_ACNT_CODE_NM" type="STRING" size="256"/>
          <Column id="EXPNDTR_UNIT_NM" type="STRING" size="256"/>
          <Column id="EXPNDTR_UNIT_CODE" type="STRING" size="256"/>
          <Column id="CONFM_AT" type="STRING" size="256"/>
          <Column id="ATCH_FILE_1" type="STRING" size="256"/>
          <Column id="LAST_SANCTN_STTUS" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_approve" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="DATA_VALUE" type="STRING" size="1000"/>
          <Column id="DATA_TITLE" type="STRING" size="256"/>
          <Column id="O_URL" type="STRING" size="256"/>
          <Column id="I_KEY" type="STRING" size="256"/>
          <Column id="EMPNO" type="STRING" size="256"/>
          <Column id="SEQ" type="STRING" size="256"/>
          <Column id="DEPT_CD" type="STRING" size="256"/>
          <Column id="EMP_CD" type="STRING" size="256"/>
          <Column id="TITLE" type="STRING" size="256"/>
          <Column id="PYMNT_YM" type="STRING" size="256"/>
          <Column id="SE" type="STRING" size="256"/>
          <Column id="SANCTN_NO" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_ubiDataset" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="DAY" type="STRING" size="256"/>
          <Column id="PYMNT_YM" type="STRING" size="256"/>
          <Column id="PYMNT_DE" type="STRING" size="256"/>
          <Column id="TOT_PYMNTAMT" type="STRING" size="256"/>
          <Column id="TOT_PYMNTAMT_H" type="STRING" size="256"/>
          <Column id="DDC_TOTAMT" type="STRING" size="256"/>
          <Column id="RL_RECPT_AMOUNT" type="STRING" size="256"/>
          <Column id="EMPNM" type="STRING" size="256"/>
          <Column id="EMPNM2" type="STRING" size="256"/>
          <Column id="EMPNM3" type="STRING" size="256"/>
          <Column id="EMPNM4" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_ubiDataset2" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="TOT_PYMNTAMT" type="STRING" size="256"/>
          <Column id="TOT_PYMNTAMT_H" type="STRING" size="256"/>
          <Column id="DDC_TOTAMT" type="STRING" size="256"/>
          <Column id="RL_RECPT_AMOUNT" type="STRING" size="256"/>
          <Column id="DAY" type="STRING" size="256"/>
          <Column id="EMPNM" type="STRING" size="256"/>
          <Column id="CODE_NM" type="STRING" size="256"/>
          <Column id="SALARY_BANK_ACNUT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cond03" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="PYMNT_YM" type="STRING" size="256"/>
          <Column id="SANCTN_NO" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_bndtSe" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="CODE_NM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript5.0"><![CDATA[/***********************************************************************
 * 업무구분 : 당직수당지급관리
 * 화면ID   : HRM070305
 * 화면명   : 당직수당지급관리
 * 화면설명 : 당직수당지급정보를 관리한다.
 * 작성일   : 2016.10.31
 * 작성자   : 박세현
 * 수정이력 : 
 ***********************************************************************
 *     수정일     수정자   내용
 ***********************************************************************
 *    
 ***********************************************************************/
 

/***********************************************************************
 * Script Include 
 ***********************************************************************/
include "lib::comInclude.xjs";
include "mis_lib::misUtil.xjs";

/***********************************************************************
 * 화면 변수 선언부
 ***********************************************************************/
this.checkDs = [
	 this.ds_pymnt_de
];

/***********************************************************************
 * onInit 영역
 ***********************************************************************/
this.SAL030106_oninit = function(obj:Form, e:nexacro.InitEventInfo)
{
	this.fn_init_form();
	this.fn_init_dataset();
	
}

/***********************************************************************
 * onLoad 영역
 ***********************************************************************/
this.SAL030106_onload = function(obj:Form, e:nexacro.LoadEventInfo)
{
	this.div_cre.div_monCal.fn_setBind("ds_cond00","HVOF_DE");
	this.ds_cond00.setColumn(0, "HVOF_DE",this.gfn_today().substr(0,6));
	this.div_cre.div_monCal.msk_mon.set_cssclass("msk_WF_Essential");
	
	this.ds_cond00.clearData();
	this.ds_cond00.addRow();
	this.ds_cond00.setColumn(0,"EMPL_SE","1");
	this.ds_cond00.setColumn(0,"SALARY_SE","1");
	
	this.div_search.spn_excclcYear.set_value(this.dateUtils.format(this.gfn_today(),"yyyy"));
	this.div_search.spn_excclcYear.setFocus(true);
	this.fn_loadCombo();
	this.fn_search();
}

/***********************************************************************
 * Form 오브젝트 초기화
 ***********************************************************************/ 
this.fn_init_form = function()
{
	this.gfn_initForm(this);	
    
}

/**********************************************************************
 * 설명: 공통조회
 ************************************************************************/
this.fn_loadCombo = function ()
{
	var comboParams = [
					   ["ds_rspofc", "_HRM214", 1, ""],   // 직책
	                   ["ds_ofcps", "HRM003", 1, ""],    // 직위
	                   ["ds_bndtSe", "_HRM252", 1, ""],    // 당직구분
	                   ["ds_jssfc", "HRM001", 1, "전체"]
		              ];

	this.gfn_comboLoad(comboParams, this.fn_callbackAfter);
}



/***********************************************************************
 * Dataset 오브젝트 초기화
 ***********************************************************************/ 
this.fn_init_dataset = function()
{
	this.gfn_initCondDs(this, this.div_search);	
}

/***********************************************************************
* 조회처리
************************************************************************/
this.fn_search = function()
{
	this.ds_pymnt_de.clearData();
	this.ds_bndtPymntList.clearData();	
	
	this.fn_transaction("selectBndtPymntExpndtrList");
}


/**********************************************************************
 * CALL TRANSACTION 영역
 **********************************************************************/ 
this.fn_transaction = function(strSvcId)
{
	switch (strSvcId) {
	    case "selectBndtPymntExpndtrList": 
			var sController   	= "hsco/mis/hrm/HRM070305/selectBndtPymntExpndtrList.do";
			var sInDatasets   	= "input1=ds_cond00";
			var sOutDatasets  	= "ds_pymnt_de=output1";
			break;
			
		case "selectBndtPymntList": 
			var sController   	= "hsco/mis/hrm/HRM070305/selectBndtPymntList.do";
			var sInDatasets   	= "input1=ds_cond01";
			var sOutDatasets  	= "ds_bndtPymntList=output1";
			break;

		// 전자결재
		case "approve":    						
			var sController   	= "hsco/mis/hrm/HRM070305/approve.do";	
			var sInDatasets   	= "input1=ds_approve";
			var sOutDatasets  	= "ds_approve=output1";
			break;

		// 결재취소
		case "apprCancel":    					
			var sController   	= "hsco/mis/sal/SAL030106/apprCancel.do";	
			var sInDatasets   	= "input4=ds_cond03:U";
			var sOutDatasets  	= "";
			break;
		case "saveBndtPymnt":
			var sController   	= "hsco/mis/hrm/HRM070302/saveBndtPymnt.do";	
			var sInDatasets   	= "input1=ds_cond00";
			var sOutDatasets  	= "";
			break;			
	}

	Ex.core.tran(this, strSvcId, sController, sInDatasets, sOutDatasets); 
}

 /**********************************************************************
 * Transaction Callback 영역
 ***********************************************************************/ 
this.fn_callBack = function (strSvcId, nErrorCode, strErrorMsg)
{
	// 오류 및 성공 메시지를 화면에 보여준다.
	/*this.gfn_callback_message(strSvcId, nErrorCode, strErrorMsg);*/
	if (nErrorCode != 0){
		this.gfn_callback_message(strSvcId, nErrorCode, strErrorMsg);	
	} else {		
		switch (strSvcId) {
			case "selectBndtPymntExpndtrList":   
				break;
				
			case "selectBndtPymntList":    	     		      
				break;
					
			case "approve":							// 전자결재
				var oUrl = this.ds_approve.getColumn(0,"O_URL");
				//system.execBrowser(oUrl);
				this.gfn_exportExcel(this.grd_bndtPymntList, "bndtPymnt", oUrl);	
				break;
				
			case "apprCancel":						// 결재취소
				this.fn_search();
				this.gfn_message("success.처리.성공");
				break;
			case "saveBndtPymnt":
				this.fn_search();
				this.gfn_message("success.처리.성공");
				break;				
		}
	}
}

/***********************************************************************************
* 설명	: 적용내역 클릭(행변경)
***********************************************************************************/
this.ds_pymnt_de_onrowposchanged = function(obj:Dataset, e:nexacro.DSRowPosChangeEventInfo)
{
	if(e.newrow>-1){
		if(this.ds_pymnt_de.getColumn(this.ds_pymnt_de.rowposition,"PYMNT_DE")){
			
			this.ds_cond01.clearData();              // 조회 데이터셋 초기화
			var nRow = this.ds_cond01.addRow();      // 조회 데이터셋 행추가
			this.ds_cond01.setColumn(nRow,"PYMNT_YM",this.ds_pymnt_de.getColumn(this.ds_pymnt_de.rowposition,"PYMNT_YM")) 
			this.ds_cond01.setColumn(nRow,"PYMNT_DE",this.ds_pymnt_de.getColumn(this.ds_pymnt_de.rowposition,"PYMNT_DE")) 
			 
			this.fn_transaction("selectBndtPymntList");
		}
	}else{
		this.ds_bndtPymntList.clearData();
	}
}

this.popupSactionStts = function(sanctnNo, registDt){
    var parm = {
		arg_0 : this,  
		arg_1 : sanctnNo,  // 결재번호
		arg_2 : registDt
	};
	
	/**
	* 팝업 공통함수
	* @param {string} svcId
	* @param {number} Width
	* @param {number} Height
	* @param {string} Title
	* @param {string} form URL
	* @param {string} Callback Function
	* @return N/A
	* @example
	* @memberOf comLib
	*/
	this.gfn_popup("COM010400_P01", 710, 580, "전자결재진행 현황", parm, "com::COM010400_P01.xfdl", "fn_callback5");
}



/***********************************************************************************
* 설명	: 그리드의 내용을 엑셀파일로 다운로드
***********************************************************************************/
this.Excel_down_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
    this.gfn_exportExcel(this.grd_bndtPymntList, "bndtPymnt");	
}


/***********************************************************************************
* 설명	: 급여지급대장
***********************************************************************************/
this.btn_pymntList_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	if(this.ds_pymnt_de.getColumn(this.ds_pymnt_de.rowposition,"PYMNT_YM")){
		 var nLeft = system.clientToScreenX(this, 10);
		 var nTop  = system.clientToScreenY(this, 10);

		 var newChild = new ChildFrame;
		 newChild.init("Popup2", "absolute", nLeft, nTop, 1000, 700, null, null, "mis_sal::SAL030106_P02.xfdl");

		 newChild.set_openalign("center middle");
		 newChild.set_dragmovetype("all"); 
		 newChild.set_showtitlebar(true);
		 var pymnt_ym = this.ds_pymnt_de.getColumn(this.ds_pymnt_de.rowposition,"PYMNT_YM");
		 var pymnt_de = this.ds_pymnt_de.getColumn(this.ds_pymnt_de.rowposition,"PYMNT_DE");
		 var pymnt_se = this.ds_pymnt_de.getColumn(this.ds_pymnt_de.rowposition,"PYMNT_SE");
		 var salary_se = "1";
		 newChild.showModal(this.getOwnerFrame(), {PYMNTYM:pymnt_ym,PYMNTDE:pymnt_de,PYMNTSE:pymnt_se,SALARYSE:salary_se}, this, "fn_callback3");
	}	 
}

/***********************************************************************************
* 설명	: 급여지급대장 팝업 콜백
***********************************************************************************/
this.fn_callback3 = function(sPopupId, sReturn)
{
	if(sPopupId == "Popup2")
	{
		
	}
}

/***********************************************************************************
* 설명	: 소득세명세서 클릭
***********************************************************************************/
this.btn_incmtaxList_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	if(this.ds_pymnt_de.getColumn(this.ds_pymnt_de.rowposition,"PYMNT_YM")){
		 var nLeft = system.clientToScreenX(this, 10);
		 var nTop  = system.clientToScreenY(this, 10);

		 var newChild = new ChildFrame;
		 newChild.init("Popup2", "absolute", nLeft, nTop, 800, 700, null, null, "mis_sal::SAL030106_P03.xfdl");

		 newChild.set_openalign("center middle");
		 newChild.set_dragmovetype("all"); 
		 newChild.set_showtitlebar(true);
		 var pymnt_ym = this.ds_pymnt_de.getColumn(this.ds_pymnt_de.rowposition,"PYMNT_YM");
		 var pymnt_de = this.ds_pymnt_de.getColumn(this.ds_pymnt_de.rowposition,"PYMNT_DE");
		 var pymnt_se = this.ds_pymnt_de.getColumn(this.ds_pymnt_de.rowposition,"PYMNT_SE");
		 var salary_se = "1";
		 newChild.showModal(this.getOwnerFrame(), {PYMNTYM:pymnt_ym,PYMNTDE:pymnt_de,PYMNTSE:pymnt_se,SALARYSE:salary_se}, this, "fn_callback3");
	}	 
}

/***********************************************************************************
* 설명	: 장기근속수당 클릭
***********************************************************************************/
this.btn_pymntLong_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	if(this.ds_pymnt_de.getColumn(this.ds_pymnt_de.rowposition,"PYMNT_YM") && this.ds_pymnt_de.getColumn(this.ds_pymnt_de.rowposition,"PYMNT_SE") == "2"){
		 var nLeft = system.clientToScreenX(this, 10);
		 var nTop  = system.clientToScreenY(this, 10);

		 var newChild = new ChildFrame;
		 newChild.init("Popup2", "absolute", nLeft, nTop, 800, 700, null, null, "mis_sal::SAL030106_P04.xfdl");

		 newChild.set_openalign("center middle");
		 newChild.set_dragmovetype("all"); 
		 newChild.set_showtitlebar(true);
		 var pymnt_ym = this.ds_pymnt_de.getColumn(this.ds_pymnt_de.rowposition,"PYMNT_YM");
		 var pymnt_de = this.ds_pymnt_de.getColumn(this.ds_pymnt_de.rowposition,"PYMNT_DE");
		 var pymnt_se = this.ds_pymnt_de.getColumn(this.ds_pymnt_de.rowposition,"PYMNT_SE");
		 var salary_se = "1";
		 newChild.showModal(this.getOwnerFrame(), {PYMNTYM:pymnt_ym,PYMNTDE:pymnt_de,PYMNTSE:pymnt_se,SALARYSE:salary_se}, this, "fn_callback3");
	}	 
}

/***********************************************************************************
* 설명	: 직원구분클릭
***********************************************************************************/
this.div_search_rad_excclcSe_onitemchanged = function(obj:Radio, e:nexacro.ItemChangeEventInfo)
{
	if (obj.value == "4") {
		this.btn_mtSalaryDtstmn.set_visible(true);
		this.btn_pymntLong.set_visible(false);
	} else {
		this.btn_mtSalaryDtstmn.set_visible(false);
		this.btn_pymntLong.set_visible(true);
	}
	this.fn_search();
}

/***********************************************************************************
* 설명	: 결재
***********************************************************************************/
this.fn_sanction = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	
	// 전자결재 상태 체크 2016.7
	// 기안상태 COM022 (0:기안전 1:기안 9:기안오류)
	// 결재상태 COM023 (1: 진행 2:보류 4:대기 8:협조대기 32:삭제 256:완료 512:반송 4096:취소 1024:참조 NUL:상신전 DUP:결재중복)
	// 기안전인것 : 재상신 및 수정/삭제
	// 결재상태가 상신전 외는 신규로 다시 진행.
	var sanctnKnd = this.ds_pymnt_de.getColumn(this.ds_pymnt_de.rowposition, "SANCTN_STS");
	
	switch (sanctnKnd) {
		case "1": case "2": case "4": case "8": case "1024": case "DUP":
		this.gfn_message("comm.결재.진행");
		return false;
		
		case "32": case "256": case "512": case "4096": 
		this.gfn_message("comm.결재.완료");
		return false;
		
		default:
	}		

	this.ds_approve.clearData();	
	this.ds_approve.addRow();

	var bndtAllwncTot = this.ds_pymnt_de.getColumn(0,"BNDT_ALLWNC_TOT");
	 
	var ym = this.ds_pymnt_de.getColumn(this.ds_pymnt_de.rowposition, "PYMNT_YM");
	var de = this.ds_pymnt_de.getColumn(this.ds_pymnt_de.rowposition, "PYMNT_DE");
	var year   = ym.substr(0,4);
	var mm     = ym.substr(4,2);
	var year2  = de.substr(0,4);
	var mm2    = de.substr(4,2);
	var dd2    = de.substr(6,2);
	var title1  = "당직근무수당 지출(" + year + "년 " + mm + "월분)";
	var title2 = "보수규정 제 28조에 의거 " + year + "년 "+ mm + "월분 당직근무수당을 다음과 같이 지출코자 합니다.";
	var title3 = "금" + this.comUtils.formatComma(bndtAllwncTot)+"원(금" + this.trans_han(bndtAllwncTot) + ")정";//지출금액

	 
	var filds = new Array(7);

	filds[0] = title2;
	filds[1] = title3;
	filds[2] = "붙임 조서에 의함";
	filds[3] = "개인별 계좌입금";
	filds[4] = "사업비용,영업비용,판매비와관리비,753-2011,20-03-01-00";
	filds[5] = year + "년 " + mm + "월 당직근무수당 지급내역 1부. 끝.";
	
	var dataValue = filds.join("|");
	var dataTitle = title1;
	var title     = title1;

	var sanctn_no = this.ds_pymnt_de.getColumn(this.ds_pymnt_de.rowposition, "SANCTN_NO") ;
	this.ds_approve.setColumn(0, "SANCTN_NO", sanctn_no);	
	
	this.ds_approve.setColumn(0, "TITLE", 		title);
	this.ds_approve.setColumn(0, "DATA_TITLE", 	dataTitle);
	this.ds_approve.setColumn(0, "DATA_VALUE", 	dataValue);
	this.ds_approve.setColumn(0, "DEPT_CD", 	this.gfn_getDeptId());
	this.ds_approve.setColumn(0, "EMP_CD", 		this.fn_getEmpno());
	this.ds_approve.setColumn(0, "EMPNO", 		this.fn_getEmpno());		
	this.ds_approve.setColumn(0, "PYMNT_YM", 	this.ds_pymnt_de.getColumn(this.ds_pymnt_de.rowposition, "PYMNT_YM"));
	
	this.fn_transaction("approve");
}

/***********************************************************************************
* 설명	: 결재상태보기(월급여지급내역 행클릭)
***********************************************************************************/
this.grd_pymnt_de_oncellclick = function(obj:Grid, e:nexacro.GridClickEventInfo)
{
	if(e.cell == 0) {
		obj.setCellProperty("Head", e.cell, "text", "0");
	}

	// column index 확인. 전자결재
	if(e.col == 6) {
		var sanctnNo 	= this.ds_pymnt_de.getColumn(e.row, "SANCTN_NO");
		
		var registDt 	= this.ds_pymnt_de.getColumn(e.row, "PYMNT_DE");
		
		if(sanctnNo){
			this.popupSactionStts(sanctnNo, registDt);
		}			
	}
}

this.btn_apprCancel_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	var sanctnKnd 	= this.ds_pymnt_de.getColumn(this.ds_pymnt_de.rowposition, "SANCTN_STS");		// 결재상태

	if (sanctnKnd == "256") {
		if(this.confirm("결재취소 하시겠습니까?")) {
			this.ds_cond03.clearData();	
			this.ds_cond03.addRow();
			this.ds_cond03.setColumn(0, "PYMNT_YM",  this.ds_pymnt_de.getColumn(this.ds_pymnt_de.rowposition, "PYMNT_YM"));
			this.ds_cond03.setColumn(0, "PYMNT_SE",  this.ds_pymnt_de.getColumn(this.ds_pymnt_de.rowposition, "PYMNT_SE"));
			this.ds_cond03.setColumn(0, "PYMNT_DE",  this.ds_pymnt_de.getColumn(this.ds_pymnt_de.rowposition, "PYMNT_DE"));
			this.ds_cond03.setColumn(0, "SALARY_SE",  "1");
			this.ds_cond03.setColumn(0, "SANCTN_NO",  this.ds_pymnt_de.getColumn(this.ds_pymnt_de.rowposition, "SANCTN_NO"));	// 결재번호

			this.fn_transaction("apprCancel");
		}
	} else {
		this.alert("결재상태가 완료인 상태만 결재취소가 가능합니다.");
	}
}

 /**********************************************************************
 * 급여명세서 출력
 ***********************************************************************/ 
this.btn_mtSalaryDtstmn_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	if(this.ds_mtSalaryPymntList.getRowCount() > 0){
		var vOpts = new this.cf_Opts();
		
		vOpts.setToolbar(false);
		vOpts.setScale(100);
		vOpts.setReportPath("/mis/sal/SAL030106_R01.jrf");
		vOpts.setSaveFilename("급여명세서");
		vOpts.setLocalDs(["ds_mtSalaryPymntList", this.ds_mtSalaryPymntList]);
		
		var parm = {
			arg_0 : this,  //==> 필수, 팝업을 호출하는 form을 참조할 수 있도록 팝업에 Argument로 넘겨준다. (반드시 기술해야 함.)
			opts : vOpts
		};

		this.gfn_popup("Popup_Report", 884, 735, "급여명세서", parm, "common::frmReportPopup.xfdl", "report_callback");
	} else {
	    this.alert("조회후 출력하세요!");
	}	
}

this.grd_bndtPymntList_onheadclick = function(obj:Grid, e:nexacro.GridClickEventInfo)
{
	this.gfn_gridSort(obj, e); // Grid 데이터 정렬
}

//숫자 한글로 변환
this.trans_han = function(sour){ 
   var s = sour.toString(); 
 //alert(s); 
   if(s.length > 16){ 
       alert('숫자가 너무 큽니다'); 
       return; 
   } 
   else if(isNaN(s)){ 
       alert('숫자가 아닙니다'); 
       return; 
   } 
   var b1 = ' 일이삼사오육칠팔구'; 
   var b2 = '천백십조천백십억천백십만천백십원'; 
   tmp = ''; 
   cnt = 0; 
   while(s != ''){ 
       cnt++; 
       tmp1 = b1.substring(s.substring(s.length-1,s.length), Number(s.substring(s.length-1,s.length))+1); // 숫자 
       tmp2 = b2.substring(b2.length-1,b2.length); // 단위 
       
       if(tmp1 == ' '){ // 숫자가 0일때 
           if(cnt%4 == 1){ // 4자리로 끊어 조,억,만,원 단위일때만 붙여줌 
               tmp = tmp2 + tmp; 
           } 
       } 
       else{ 
           if(tmp1 == '일' && cnt%4 != 1){ // 단위가 조,억,만,원일때만 숫자가 일을 붙여주고 나머지는 생략 ex) 삼백일십만=> 삼백십만 
               tmp = tmp2 + tmp; 
           } 
           else{ 
               tmp = tmp1 + tmp2 + tmp; // 그외에는 단위와 숫자 모두 붙여줌 
           } 
       } 

       b2 = b2.substring(0, b2.length-1); 

       s = s.substring(0, s.length-1); 
   } 
   tmp = tmp.replace('억만','억').replace('조억','조'); // 조,억,만,원 단위는 모두 붙였기 때문에 필요없는 단위 제거 
   //alert(tmp);
   return tmp; 
} 


this.btn_crePop_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	this.div_cre.set_visible(true);	
}

this.div_cre_btn_destroy_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	this.div_cre.set_visible(false);
}


this.div_cre_btn_cre_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	if(!this.div_cre.div_monCal.getValue()){
		this.alert("기준년월을 입력하세요");
		return;
	}		

	if(!this.div_cre.cal_pymntDe.value){
		this.alert("지급일자를 입력하세요");
		return;
	}		
	
	if( this.div_cre.div_monCal.getValue() >= (this.div_cre.cal_pymntDe.value+"").substr(0,6) ){
		this.alert("지급일자는 기준년월보다 커야 합니다.");
		return;
	}
	
	if ( application.confirm( this.div_cre.div_monCal.getValue() + " 월 당직수당을 생성 하시겠습니까?\n(기존 생성자료는 삭제됩니다.)" ) ) {
		this.ds_cond00.setColumn(0,"PYMNT_YM",	this.div_cre.div_monCal.getValue());
		this.ds_cond00.setColumn(0,"PYMNT_DE",	this.div_cre.cal_pymntDe.value);
		this.fn_transaction("saveBndtPymnt");
	} else {
		return;
	}	
}
]]></Script>
  </Form>
</FDL>
