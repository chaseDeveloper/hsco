<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\..\default_typedef.xml"/>
  <Form id="HRM070118_P2" classname="HRM070118_P2" left="0" top="0" width="466" height="430" titletext="보상휴가신청" onload="HRM070118_P2_onload">
    <Layouts>
      <Layout>
        <Static id="sta_backgroundLabel02" taborder="74" cssclass="sta_WF_Labelbg" top="144" right="15" width="352" height="27"/>
        <Static id="sta_backgroundLabel00" taborder="63" cssclass="sta_WF_Labelbg" top="222" right="15" width="352" height="27"/>
        <Static id="Static06" taborder="6" text="15" visible="false" left="15" top="0" height="15" style="background:#dc143c3c;align:center middle;" right="15"/>
        <Static id="Static12" taborder="12" text="5" visible="false" left="15" top="61" height="5" style="background:#dc143c3c;align:center middle;" right="15"/>
        <Static id="Static03" taborder="19" text="15" visible="false" left="15" height="15" style="background:#dc143c3c;align:center middle;" right="15" bottom="0"/>
        <Static id="Static02" taborder="21" text="15" visible="false" top="0" style="background:#1b3cd23c;align:center middle;" bottom="0" left="0" width="15"/>
        <Static id="Static00" taborder="22" text="15" visible="false" top="0" style="background:#1b3cd23c;align:center middle;" width="15" bottom="0" right="0"/>
        <Static id="sta_REGIST_NM00" taborder="25" text="신청자" cssclass="sta_WF_Title02" left="17" top="46" height="21" style="font:bold 9 Gulim;" right="361"/>
        <Static id="sta_DETAIL00" taborder="23" text="상세내용" cssclass="sta_WF_Title02" left="17" top="124" height="21" style="align:left middle;font:bold 9 Gulim;" right="362"/>
        <Static id="Static01" taborder="24" text="10" visible="false" left="15" top="118" height="10" style="background:#dc143c3c;align:center middle;" right="15"/>
        <Static id="sta_WFDA_Label01" taborder="26" cssclass="sta_WF_Labelbg" top="65" height="27" width="352" right="15"/>
        <Edit id="edt_EMPNO" taborder="27" readonly="true" cssclass="edt_WF_Readonly" left="110" top="68" width="111" height="21"/>
        <Edit id="edt_EMPNM" taborder="28" readonly="true" cssclass="edt_WF_Readonly" left="223" top="68" width="137" height="21"/>
        <Button id="btn_Vrsc_man_search00" taborder="30" onclick="div_detail00_btn_Vrsc_man_search_onclick" top="72" height="13" style="background:URL('theme://images\btn_WF_Search.png');border:0 solid #8d8d8dff ;cursor:default;" left="345" width="13"/>
        <Static id="Static04" taborder="31" text="5" visible="false" left="15" top="139" height="5" style="background:#dc143c3c;align:center middle;" right="15"/>
        <Static id="sta_backgroundLabel03" taborder="33" cssclass="sta_WF_Labelbg" height="27" width="352" right="15" top="170"/>
        <Static id="sta_backgroundLabel08" taborder="34" cssclass="sta_WF_Labelbg" height="0px" width="0px" top="0px" left="0px"/>
        <Static id="sta_APYEXM_NO01" taborder="39" text="사유/용무" cssclass="sta_WF_Label" left="15" width="93" height="27" style="padding:0 4 0 12;align:right middle;font:9 Dotum;" top="222"/>
        <Edit id="edt_PRVONSH" taborder="40" lengthunit="ascii" maxlength="200" left="110" width="336" height="21" top="225"/>
        <Calendar id="cal_BGNDE" taborder="41" dateformat="yyyy-MM-dd" cssclass="cal_WF_Essential" left="110" width="117" height="21" style="align:center middle;" top="173"/>
        <Static id="sta_empTitle11" taborder="43" text="시작일" cssclass="sta_WF_Label" left="15" width="93" height="27" style="padding:0 4 0 12;align:right middle;font:9 Dotum;" top="170"/>
        <Static id="sta_empTitle10" taborder="44" text="시작시각" cssclass="sta_WF_Label" left="234" width="93" height="27" style="padding:0 4 0 12;align:right middle;font:9 Dotum;" top="170"/>
        <Static id="sta_backgroundLabel01" taborder="46" cssclass="sta_WF_Labelbg" height="27" width="352" right="15" top="196"/>
        <Static id="sta_empTitle00" taborder="47" text="종료시각" cssclass="sta_WF_Label" left="234" width="93" height="27" style="padding:0 4 0 12;align:right middle;font:9 Dotum;" top="196"/>
        <Static id="sta_empTitle06" taborder="48" text="종료일" cssclass="sta_WF_Label" left="15" width="93" height="27" style="padding:0 4 0 12;align:right middle;font:9 Dotum;" top="196"/>
        <Calendar id="cal_ENDDE" taborder="49" dateformat="yyyy-MM-dd" cssclass="cal_WF_Essential" left="110" width="117" height="21" style="align:center middle;" readonly="false" top="199"/>
        <MaskEdit id="msk_BEGIN_TM" taborder="50" type="string" mask="##:##" width="71" height="21" style="align:center middle;" left="329" cssclass="msk_WF_Essential" top="173"/>
        <MaskEdit id="msk_END_TM" taborder="51" type="string" mask="##:##" cssclass="msk_WF_Essential" width="71" height="21" style="align:center middle;" left="329" readonly="false" top="199"/>
        <Static id="Static10" taborder="54" text="10" visible="false" left="15" top="40" right="15" height="10" style="background:#dc143c3c;align:center middle;"/>
        <Button id="btn_Save" taborder="55" text="저장" onclick="fn_save" cssclass="btn_WF_CRUD" top="15" right="67" width="50" height="25" style="background:#4563a1ff;border:1 solid #2d4d8eff ;bordertype:round 2 2 ;font:bold 9 Gulim;" userdata="A:T;"/>
        <Button id="btn_Close" taborder="56" text="닫기" onclick="btn_Close_onclick" cssclass="btn_WF_CRUD" top="15" right="15" width="50" height="25" style="background:#4563a1ff;border:1 solid #2d4d8eff ;bordertype:round 2 2 ;font:bold 9 Gulim;gradation:linear 0,0 #f4f4f4ff 0,100 #e2e7edff;" userdata="A:T;"/>
        <Static id="sta_title" taborder="57" text="보상휴가신청" cssclass="sta_WF_Title01" left="17" top="17" width="197" height="21"/>
        <Static id="sta_WFDA_Label00" taborder="62" cssclass="sta_WF_Labelbg" top="91" right="15" width="352" height="27"/>
        <MaskEdit id="msk_OVTIME_REMNDR" taborder="64" readonly="true" type="string" mask="##:##" cssclass="rdo_WF_Essential" left="110" top="94" width="71" height="21" style="color:tomato;align:center middle;"/>
        <Static id="sta_EMP" taborder="29" text="신청자" cssclass="sta_WF_Label" top="65" right="358" width="93" height="27" style="font:9 Dotum;" positionstep="-1"/>
        <Static id="sta_OVTIME_REMNDR" taborder="60" text="시간외근무&#13;&#10;신청가능시간" cssclass="sta_WF_Label" top="91" right="358" width="93" height="27" positionstep="-1" style="font:9 Dotum;"/>
        <Static id="sta_OVTMWRK_TM" taborder="66" text="신청시간" cssclass="sta_WF_Label" top="91" right="139" width="93" height="27" positionstep="-1" style="font:9 Dotum;"/>
        <MaskEdit id="msk_OVTMWRK_TM" taborder="67" readonly="true" type="string" mask="##:##" cssclass="msk_WF_Readonly" left="329" top="94" width="71" height="21" style="align:center middle;"/>
        <Combo id="cmb_SANCTN_STS" taborder="68" readonly="true" innerdataset="ds_com022" codecolumn="CODE" datacolumn="CODE_NM" cssclass="cmb_WF_Readonly" visible="false" left="110" top="94" width="83" height="21"/>
        <Static id="sta_ACNT_LEVEL00" taborder="71" text="- 보상휴가 신청 규정 -&#13;&#10;① 초과근무 사후결재 완료 시간으로 사용.&#13;&#10;② 평일, 토요일, 법정공휴일 초과근무건으로 한정.&#13;&#10;③ 3시간, 8시간 초과근무건으로 한정.&#13;&#10;④ 전환(사용) 방법 :　&#13;&#10;　 (3시간) 4.5시간 오전반차(09:00~14:30) / 오후반차(13:30~18:00) &#13;&#10;　 (8시간) 12시간, 연차(전일14:00~당일18:00) / 연차(당일09:00~후일14:00)" wordwrap="char" onclick="sta_ACNT_LEVEL_onclick" left="22" top="254" width="433" height="154" style="linespace:8;background:transparent;padding:0 0 0 0;align:left middle;"/>
        <Combo id="cmb_ASORT_CODE" taborder="72" innerdataset="ds_hrm029" codecolumn="CODE" datacolumn="CODE_NM" cssclass="cmb_WF_Essential" left="110" top="147" width="117" height="21"/>
        <Static id="sta_empTitle03" taborder="73" text="보상휴가구분" cssclass="sta_WF_Label" left="15" top="144" width="93" height="27" style="padding:0 4 0 12;align:right middle;font:9 Dotum;"/>
      </Layout>
    </Layouts>
    <Bind>
      <BindItem id="item0" compid="edt_EMPNO" propid="value" datasetid="ds_wrkcp" columnid="EMPNO"/>
      <BindItem id="item1" compid="edt_EMPNM" propid="value" datasetid="ds_wrkcp" columnid="EMPNM"/>
      <BindItem id="item24" compid="edt_PRVONSH" propid="value" datasetid="ds_wrkcp" columnid="PRVONSH"/>
      <BindItem id="item15" compid="edt_PRVONSH" propid="tooltiptext" datasetid="ds_wrkcp" columnid="PRVONSH"/>
      <BindItem id="item33" compid="cal_BGNDE" propid="value" datasetid="ds_wrkcp" columnid="BGNDE"/>
      <BindItem id="item3" compid="cal_ENDDE" propid="value" datasetid="ds_wrkcp" columnid="ENDDE"/>
      <BindItem id="item9" compid="msk_BEGIN_TM" propid="value" datasetid="ds_wrkcp" columnid="BEGIN_TM"/>
      <BindItem id="item2" compid="msk_END_TM" propid="value" datasetid="ds_wrkcp" columnid="END_TM"/>
      <BindItem id="item5" compid="msk_OVTIME_REMNDR" propid="value" datasetid="ds_wrkcp" columnid="OVTIME_REMNDR"/>
      <BindItem id="item4" compid="msk_OVTMWRK_TM" propid="value" datasetid="ds_wrkcp" columnid="OVTMWRK_TM"/>
      <BindItem id="item6" compid="cmb_SANCTN_STS" propid="value" datasetid="ds_wrkcp" columnid="SANCTN_STS"/>
      <BindItem id="item29" compid="cmb_ASORT_CODE" propid="value" datasetid="ds_wrkcp" columnid="ASORT_CODE"/>
    </Bind>
    <Objects>
      <Dataset id="ds_wrkcp" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" cancolumnchange="ds_wrkcp_cancolumnchange" oncolumnchanged="ds_wrkcp_oncolumnchanged">
        <ColumnInfo>
          <Column id="EMPNO" type="STRING" size="256"/>
          <Column id="EMPNM" type="STRING" size="256"/>
          <Column id="SEQ" type="STRING" size="256"/>
          <Column id="DEPT_CODE" type="STRING" size="256"/>
          <Column id="DEPT_NM" type="STRING" size="256"/>
          <Column id="ASORT_CODE" type="STRING" size="256"/>
          <Column id="BGNDE" type="STRING" size="256"/>
          <Column id="BEGIN_TM" type="STRING" size="256"/>
          <Column id="ENDDE" type="STRING" size="256"/>
          <Column id="END_TM" type="STRING" size="256"/>
          <Column id="DAYCNT" type="STRING" size="256"/>
          <Column id="TIME" type="STRING" size="256"/>
          <Column id="PRVONSH" type="STRING" size="256"/>
          <Column id="FILE_SN" type="STRING" size="256"/>
          <Column id="CNFIRM_AT" type="STRING" size="256"/>
          <Column id="SANCTN_NO" type="STRING" size="256"/>
          <Column id="SANCTN_STS" type="STRING" size="256"/>
          <Column id="REGIST_DT" type="STRING" size="256"/>
          <Column id="OVTIME_REMNDR" type="STRING" size="256"/>
          <Column id="REWARD_SEQ" type="STRING" size="256"/>
          <Column id="WRKCP_SEQ" type="STRING" size="256"/>
          <Column id="OVTMWRK_YM" type="STRING" size="256"/>
          <Column id="OVTMWRK_TM" type="STRING" size="256"/>
          <Column id="TIME_SE" type="STRING" size="256"/>
          <Column id="REWARD_SE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_validation" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="compId" type="STRING" size="256"/>
          <Column id="colId" type="STRING" size="256"/>
          <Column id="PK" type="STRING" size="256"/>
          <Column id="notNull" type="STRING" size="256"/>
          <Column id="type" type="STRING" size="256"/>
          <Column id="nlength" type="STRING" size="256"/>
          <Column id="from" type="STRING" size="256"/>
          <Column id="to" type="STRING" size="256"/>
          <Column id="lengthChkGb" type="STRING" size="256"/>
          <Column id="msgId" type="STRING" size="256"/>
          <Column id="expr" type="STRING" size="256"/>
          <Column id="func" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="compId">ds_wrkcp</Col>
            <Col id="colId">ASORT_CODE</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">보상휴가구분</Col>
          </Row>
          <Row>
            <Col id="compId">ds_wrkcp</Col>
            <Col id="colId">BGNDE</Col>
            <Col id="from">BGNDE</Col>
            <Col id="to">ENDDE</Col>
            <Col id="expr">시작일^종료일</Col>
            <Col id="msgId">시작일^종료일</Col>
          </Row>
          <Row>
            <Col id="compId">ds_wrkcp</Col>
            <Col id="colId">BGNDE</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">시작일</Col>
            <Col id="to"/>
            <Col id="from"/>
            <Col id="expr"/>
          </Row>
          <Row>
            <Col id="compId">ds_wrkcp</Col>
            <Col id="colId">ENDDE</Col>
            <Col id="notNull">Y</Col>
          </Row>
          <Row>
            <Col id="compId">ds_wrkcp</Col>
            <Col id="colId">BEGIN_TM</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">시작시간</Col>
          </Row>
          <Row>
            <Col id="compId">ds_wrkcp</Col>
            <Col id="colId">END_TM</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">종료시간</Col>
          </Row>
          <Row>
            <Col id="compId">ds_wrkcp</Col>
            <Col id="colId">BEGIN_TM</Col>
            <Col id="PK"/>
            <Col id="notNull"/>
            <Col id="type"/>
            <Col id="nlength"/>
            <Col id="from">BEGIN_TM</Col>
            <Col id="to">2359</Col>
            <Col id="lengthChkGb"/>
            <Col id="msgId">시작시각^23:59</Col>
            <Col id="expr">시작시각^23:59</Col>
            <Col id="func"/>
          </Row>
          <Row>
            <Col id="compId">ds_wrkcp</Col>
            <Col id="colId">END_TM</Col>
            <Col id="PK"/>
            <Col id="notNull"/>
            <Col id="type"/>
            <Col id="nlength"/>
            <Col id="from">END_TM</Col>
            <Col id="to">2359</Col>
            <Col id="lengthChkGb"/>
            <Col id="msgId">종료시각^23:59</Col>
            <Col id="expr">종료시각^23:59</Col>
            <Col id="func"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_cond" useclientlayout="true">
        <ColumnInfo>
          <Column id="REWARD_SEQ" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_com022" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="GRP_CODE" type="STRING" size="256"/>
          <Column id="CODE_NM" type="STRING" size="256"/>
          <Column id="CODE_CN" type="STRING" size="256"/>
          <Column id="CODE_ORDR" type="STRING" size="256"/>
          <Column id="VAL0" type="STRING" size="256"/>
          <Column id="VAL1" type="STRING" size="256"/>
          <Column id="VAL2" type="STRING" size="256"/>
          <Column id="VAL3" type="STRING" size="256"/>
          <Column id="VAL4" type="STRING" size="256"/>
          <Column id="INT_VAL" type="STRING" size="256"/>
          <Column id="MSTK_VAL" type="STRING" size="256"/>
          <Column id="ETC1" type="STRING" size="256"/>
          <Column id="ETC2" type="STRING" size="256"/>
          <Column id="ETC3" type="STRING" size="256"/>
          <Column id="USE_YN" type="STRING" size="256"/>
          <Column id="ALL_CODE_NM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_hrm029" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="GRP_CODE" type="STRING" size="256"/>
          <Column id="CODE_NM" type="STRING" size="256"/>
          <Column id="CODE_CN" type="STRING" size="256"/>
          <Column id="CODE_ORDR" type="STRING" size="256"/>
          <Column id="VAL0" type="STRING" size="256"/>
          <Column id="VAL1" type="STRING" size="256"/>
          <Column id="VAL2" type="STRING" size="256"/>
          <Column id="VAL3" type="STRING" size="256"/>
          <Column id="VAL4" type="STRING" size="256"/>
          <Column id="INT_VAL" type="STRING" size="256"/>
          <Column id="MSTK_VAL" type="STRING" size="256"/>
          <Column id="ETC1" type="STRING" size="256"/>
          <Column id="ETC2" type="STRING" size="256"/>
          <Column id="ETC3" type="STRING" size="256"/>
          <Column id="USE_YN" type="STRING" size="256"/>
          <Column id="ALL_CODE_NM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_condHoly" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="false" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="BGNDE" type="STRING" size="256"/>
          <Column id="ENDDE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_holyCnt" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="WORK_DE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript5.0"><![CDATA[/***********************************************************************
 * 01. 업무구분 : 보상휴가신청
 * 02. 화면명   : HRM070118_P2.xfdl
 * 03. 화면설명 : 보상휴가신청
 * 04. 작성일   : 2017.05.18
 * 05. 작성자   : 이수지
 ***********************************************************************
 *     수정일     작성자   내용
 ***********************************************************************
 *    2017.05.17   이수지   최초
 ***********************************************************************
 */

/***********************************************************************
 * Script Include 
 ************************************************************************/
include "lib::comInclude.xjs";
include "mis_lib::misUtil.xjs";
this.fv_objForm;

this.ovtmwrkYm;
this.maxRegYm;


/***********************************************************************
* 폼로드 시 처리
************************************************************************/
this.HRM070118_P2_onload = function(obj:Form, e:nexacro.LoadEventInfo)
{

   // 공통코드
   /*******************************************************************************
    * params        : 1. param_1    : 반환받을 DATASET 명          (예: DS_AREA_NO_CODE)
                 2. param_2   : 그룹코드                  (예 : COM007)
                 3. param_3   : 사용여부                   (예 : A(전체), Y(사용), N(사용안함))
                 4. param_4   : 콤보박스INDEX(0) 표시      (예 : A(전체), S(선택), E(공백), D(첫번째데이터부터시작) )
                 5. param_5   : 코드+코드명               (예 : G(코드명), B(코드-코드명) )
    ******************************************************************************/
   var comboParams = [
      ["ds_com022", "COM022", "1", ""],   //전자결재상태
      ["ds_hrm029", "HRM029", "1", ""],   //보상휴가구분
   ];
   var callback = function (svcId, errorCode, errorMsg) {
      
      this.fv_objForm = this.parent.arg_0;
      this.ovtmwrkYm = this.parent.arg_6;
      this.maxRegYm = this.parent.arg_8;
      
      this.ds_wrkcp.clearData();
      this.ds_wrkcp.addRow();
      
      this.ds_wrkcp.setColumn(0,"DEPT_CODE" ,     this.parent.arg_1);
      this.ds_wrkcp.setColumn(0,"DEPT_NM" ,       this.parent.arg_2);
      this.ds_wrkcp.setColumn(0,"EMPNO" ,         this.parent.arg_3);
      this.ds_wrkcp.setColumn(0,"EMPNM" ,         this.parent.arg_4);
      this.ds_wrkcp.setColumn(0,"OVTIME_REMNDR" , this.parent.arg_5);
      this.ds_wrkcp.setColumn(0,"OVTMWRK_YM"    , this.parent.arg_6);
      this.ds_wrkcp.setColumn(0,"REWARD_SE" , 1);
      var rewardSeq = this.parent.arg_7;
      
      if(this.comUtils.isNotNull(rewardSeq)){
         this.ds_cond.clearData();
         this.ds_cond.addRow();
         this.ds_cond.setColumn(0, "REWARD_SEQ"    , rewardSeq);
         this.fn_transaction("selectRewordManage");
      }
      
   };
   this.gfn_comboLoad (comboParams, callback);
}

/***********************************************************************
 * 설명: 저장버튼 클릭시
 ************************************************************************/
this.fn_save= function()
{
   // validation 체크
   if(!this.gfn_checkValidation_NoUpdChk(this.ds_wrkcp, this.ds_validation)) {
      return;
   }
   
   //잔여시간, 신청시간
   var remndrTime = this.ds_wrkcp.getColumn(0, "OVTIME_REMNDR");
   var timeValue  = this.ds_wrkcp.getColumn(0, "OVTMWRK_TM");
   var begYm  = this.ds_wrkcp.getColumn(0, "BGNDE").substr(0, 6);

   if(this.ovtmwrkYm > begYm || this.maxRegYm < begYm){
		if(this.ovtmwrkYm < 201905) {
      			this.gfn_message("info.처리불가","근무년월 기준으로 2개월 내에서 등록가능합니다.");
		} else {
			this.gfn_message("info.처리불가","근무년월 기준으로 6개월 내에서 등록가능합니다.");
		}
      return false;
   }
   
   if(nexacro.toNumber(timeValue, 0, 0, 0) > nexacro.toNumber(remndrTime, 0, 0, 0)){
      this.gfn_message("errors.항목.입력값.이하", "신청시간|잔여시간");
      return;
   }
   
   if(this.gfn_message("comm.행위여부", "근무상황부와 보상휴가계획에 해당데이터를 저장합니다.\n계속")){
      this.fn_transaction("saveRewordManage");
   }
   
}

/***********************************************************************
 * 설명: 닫기
 ************************************************************************/
this.btn_Close_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
   this.close();
}


/**********************************************************************
 * CALL TRANSACTION 영역
 **********************************************************************/ 
/*
 * 함수명     : fn_transaction
 * 설명       : Transaction 요청 처리 함수
 * params        : strSvcId : 서비스요청 ID
 * return Type    : None
 * 사용법      : this.fn_transaction("SELECT");
 */
this.fn_transaction = function(strSvcId)
{
   switch (strSvcId) {
      case "selectRewordManage":
         var sController      = "hsco/mis/hrm/HRM070118/selectRewordManage.do";
         var sInDatasets      = "input1=ds_cond";
         var sOutDatasets     = "ds_wrkcp=output1";
         break;
      case "saveRewordManage":
         var sController      = "hsco/mis/hrm/HRM070118/saveRewordManage.do";
         var sInDatasets      = "input1=ds_wrkcp";
         var sOutDatasets     = "";
         break;
      case "chkHolyDe":      // 휴무일수 확인
         var sController      = "hsco/mis/hrm/HRM070118/chkHolyDe.do";
         var sInDatasets      = "input1=ds_condHoly";
         var sOutDatasets     = "ds_holyCnt=output1";
         break;
      case "chkHolyDe2":      // 휴무일수 확인
         var sController      = "hsco/mis/hrm/HRM070118/chkHolyDe.do";
         var sInDatasets      = "input1=ds_condHoly";
         var sOutDatasets     = "ds_holyCnt=output1";
         break;
   }

   Ex.core.tran(this, strSvcId, sController, sInDatasets, sOutDatasets);

}



/**********************************************************************
* Transaction Callback 영역
***********************************************************************/
 
 /*
 * 함수명     : fn_callBack
 * 설명       : Transaction Callback 처리
 * params        : strSvcId    : 서비스요청 ID
 *                nErrorCode  : 오류 메시지 코드 ([예] 0 : Success, 그밖의 경우, error)
 *                strErrorMsg : 오류 메시지([예]  success.insert|정상적으로 등록되었습니다.)
 * return Type    : None
 * 사용법      : 
 */
this.fn_callBack = function (strSvcId, nErrorCode, strErrorMsg)
{
   if(nErrorCode != '0') {
      this.gfn_callback_message(strSvcId, nErrorCode, strErrorMsg);
   }
   
   if (nErrorCode == '0'){
      switch (strSvcId) {
         case "selectRewordManage":
            this.sta_OVTIME_REMNDR.set_text("결재상태");
            this.cmb_SANCTN_STS.set_visible(true);
            this.edt_PRVONSH.set_readonly(true);
            this.cal_BGNDE.set_readonly(true);
            this.cal_ENDDE.set_readonly(true);
            this.msk_BEGIN_TM.set_readonly(true);
            this.msk_END_TM.set_readonly(true);
            this.cmb_ASORT_CODE.set_readonly(true);
            this.btn_Save.set_visible(false);
         break;
         case "saveRewordManage":
            this.gfn_message("success.처리.성공");
            this.btn_Save.set_visible(false);
         break;
         case "chkHolyDe":      // 휴무일수 확인
         break;
         case "chkHolyDe2":      // 휴무일수 확인
			var bd = this.ds_condHoly.getColumn(0, "BGNDE");
			var ed = this.ds_condHoly.getColumn(0, "ENDDE");

			if(this.ds_holyCnt.findRow("WORK_DE", bd) == -1) {
				this.ds_wrkcp.set_enableevent(false);
				this.ds_wrkcp.setColumn(0, "BGNDE", "");
				this.ds_wrkcp.set_enableevent(true);
				this.gfn_message("comm.항목.선택.요청", "평일");
				return;
			}
			
			if(this.ds_holyCnt.findRow("WORK_DE", ed) == -1) {
				this.ds_wrkcp.set_enableevent(false);
				this.ds_wrkcp.setColumn(0, "ENDDE", "");
				this.ds_wrkcp.set_enableevent(true);
				this.gfn_message("comm.항목.선택.요청", "평일");
				return;
			}
			 
         break;
      }
   }
}


/***********************************************************************
* Transaction 영역 끝
************************************************************************/

/**********************************************************************
* non-Transaction 관련 컴포넌트 이벤트 처리 함수
***********************************************************************
*
* 1. 공통함수 처리
* 2. Grid 관련 이벤트 처리
* 3. Object 관련 이벤트 처리
* 4. Dataset 관련 이벤트 처리
*
***********************************************************************/



/**********************************************************************
* 공통함수 처리
***********************************************************************/

/**********************************************************************
* Dataset 관련 이벤트 처리
***********************************************************************/

this.ds_wrkcp_cancolumnchange = function(obj:Dataset, e:nexacro.DSColChangeEventInfo)
{
   if(e.columnid == "BEGIN_TM" || e.columnid == "END_TM"){
      if(nexacro.toNumber(e.newvalue, 0, 0, 0) < 900){
         this.gfn_message("errors.항목.입력값.이상", "휴가시간|09시");
         //return false;
      }
      if(nexacro.toNumber(e.newvalue, 0, 0, 0) > 1800){
         this.gfn_message("errors.항목.입력값.이하", "휴가시간|18시");
         //return false;
      }
      if(!this.comUtils.isTime(e.newvalue)){
         this.gfn_message("errors.값확인.요청", "시간형식|09:00~18:00 사이인지");
         //return false;
      }
   }
   
//    if(e.columnid == "BGNDE" || e.columnid == "ENDDE"){
//       var week = this.dateUtils.format(e.newvalue, "E");
//       if(week == "토요일" || week == "일요일"){
//          this.gfn_message("comm.항목.선택.요청", "평일");
//          return false;
//       }
//    }
   
   if(e.columnid == "BGNDE"){
      if(this.comUtils.isNotNull(obj.getColumn(e.row, "ENDDE"))){
         if(this.dateUtils.between(e.newvalue , obj.getColumn(e.row, "ENDDE")) < 0){
            this.gfn_message("errors.항목.입력값.이하", "휴가시작일|휴가종료일");
            return false;
         }
      }
   }
   
   
   if(e.columnid == "ENDDE"){
      if(this.comUtils.isNotNull(obj.getColumn(e.row, "BGNDE"))){
         if(this.dateUtils.between(obj.getColumn(e.row, "BGNDE") , e.newvalue) < 0){
            this.gfn_message("errors.항목.입력값.이하", "휴가시작일|휴가종료일");
            return false;
         }
      }
   }
}

this.ds_wrkcp_oncolumnchanged = function(obj:Dataset, e:nexacro.DSColChangeEventInfo)
{
	if(e.columnid == "BGNDE"){
		if(this.comUtils.isNotNull(obj.getColumn(e.row, "ENDDE"))){
			 this.ds_condHoly.clearData();
			 this.ds_condHoly.addRow();
			 this.ds_condHoly.setColumn(0, "BGNDE", e.newvalue);
			 this.ds_condHoly.setColumn(0, "ENDDE", obj.getColumn(e.row, "ENDDE"));
			 this.fn_transaction("chkHolyDe2");
		}
	}
   
   	if(e.columnid == "ENDDE"){
		if(this.comUtils.isNotNull(obj.getColumn(e.row, "BGNDE"))){
			 this.ds_condHoly.clearData();
			 this.ds_condHoly.addRow();
			 this.ds_condHoly.setColumn(0, "ENDDE", e.newvalue);
			 this.ds_condHoly.setColumn(0, "BGNDE", obj.getColumn(e.row, "BGNDE"));
			 this.fn_transaction("chkHolyDe2");
		}
	}
	
   if(e.columnid == "BGNDE" || e.columnid == "ENDDE" || e.columnid == "BEGIN_TM" || e.columnid == "END_TM"){
      if(this.comUtils.isNotNull(obj.getColumn(e.row, "BGNDE")) && this.comUtils.isNotNull(obj.getColumn(e.row, "ENDDE")) && this.comUtils.isNotNull(obj.getColumn(e.row, "BEGIN_TM")) && this.comUtils.isNotNull(obj.getColumn(e.row, "END_TM"))){
         //시작일시, 종료일시, 잔여시간, 신청시간
         var sd      = this.ds_wrkcp.getColumn(0, "BGNDE");      // 시작일
         var ed      = this.ds_wrkcp.getColumn(0, "ENDDE");      // 종료일
         var dayCnt  = this.ds_wrkcp.getColumn(0, "DAYCNT");
         var stime   = this.ds_wrkcp.getColumn(0, "BEGIN_TM");
         var etime   = this.ds_wrkcp.getColumn(0, "END_TM");
         var lunchTm = 0;
         var calcValue;
         if(sd == ed){
            if(nexacro.toNumber(stime, 0,0,0) >= 1300){                                          // 같은날 오후만
               lunchTm = 0;
            }else if(nexacro.toNumber(etime, 0,0,0) <= 1200){                                    // 같은날 오전만
               lunchTm = 0;
            }else if(nexacro.toNumber(stime, 0,0,0) <= 1200 && nexacro.toNumber(etime, 0,0,0) >= 1300){      // 같은날 점심시간 포함
               lunchTm += 60;
            }else if(nexacro.toNumber(stime, 0,0,0) >= 1200 && nexacro.toNumber(etime, 0,0,0) <= 1300){      // 같은날 점심시간 이내
               lunchTm += (nexacro.toNumber(etime, 0,0,0) - nexacro.toNumber(stime, 0,0,0))
            }else if(nexacro.toNumber(stime, 0,0,0) <= 1200 && nexacro.toNumber(etime, 0,0,0) <= 1300){      // 시작시간 점심시간 전, 종료시간 점심시간중
               lunchTm += (nexacro.toNumber(etime, 0,0,0) - 1200);
            }else if(nexacro.toNumber(stime, 0,0,0) >= 1200 && nexacro.toNumber(etime, 0,0,0) >= 1300){      // 시작시간 점심시간 중, 종료시간 점심시간후
               lunchTm += (1260 - nexacro.toNumber(stime, 0,0,0));
            }
            var ovTm = this.fn_calTime(stime, etime, lunchTm);
            this.ds_wrkcp.setColumn(0, "TIME", ovTm);
            this.ds_wrkcp.setColumn(0, "OVTMWRK_TM", ovTm);
         }else{
            var sd = this.ds_wrkcp.getColumn(0, "BGNDE");      // 시작일
            var ed = this.ds_wrkcp.getColumn(0, "ENDDE");      // 종료일            
            
            this.ds_condHoly.clearData();
            this.ds_condHoly.addRow();
            this.ds_condHoly.setColumn(0, "BGNDE", sd);
            this.ds_condHoly.setColumn(0, "ENDDE", ed);
            
            // 휴무일자 확인
            this.fn_transaction("chkHolyDe");
            
            var ovTm1;   // 시작일
            var ovTm2;   // 종료일
            if(nexacro.toNumber(stime, 0,0,0) < 1300){   // 시작일 점심시간
               calcValue = (1260 - nexacro.toNumber(stime, 0,0,0));
               lunchTm = (calcValue <= 60 ? calcValue : 60);
            }else{
               lunchTm = 0;
            }
            ovTm1 = this.fn_calTime(stime, "1800", lunchTm);
            
            if(nexacro.toNumber(etime, 0,0,0) >= 1200){   // 종료일 점심시간
               calcValue = (nexacro.toNumber(etime, 0,0,0) - 1200);
               lunchTm  = (calcValue > 60 ? 60 : calcValue);
            }else{
               lunchTm = 0;
            }
            ovTm2 = this.fn_calTime("0900", etime, lunchTm);
            
            var ovTmHH = nexacro.toNumber(ovTm1.substr(0,2),0,0,0) + nexacro.toNumber(ovTm2.substr(0,2),0,0,0);
            var ovTmMM = nexacro.toNumber(ovTm1.substr(2,2),0,0,0) + nexacro.toNumber(ovTm2.substr(2,2),0,0,0);
            if(ovTmMM >= 60){
               // 시작일과 종료일을 합했을때 60분 이상이면 올림
               ovTmMM -= 60;
               ovTmHH++;
            }
            
            // TODO 서버에서 주말여부 체크하도록 수정
             for(var roopCnt = 2; roopCnt < this.ds_holyCnt.rowcount; roopCnt++){
               ovTmHH+=8;
             }
            
//             for(var roopCnt = 2; roopCnt < this.dateUtils.between(sd , ed); roopCnt++){
//                trace("roopCnt : " + roopCnt + "      this.dateUtils.between(sd , ed) : " + this.dateUtils.between(sd , ed));
//                // 시작일,종료일 외에 더 들어있는일이 있으면 주말이 아닌지 확인하여 8시간 추가
//                var week = this.dateUtils.format(this.dateUtils.addDate(sd, (roopCnt - 1), 's'), "E");
//                
//                // TODO 서버에서 주말여부 체크하도록 수정
//                
//                
//                 if(week != "토요일" && week != "일요일") {
//                    ovTmHH+=8;
//                 }
//             }
            this.ds_wrkcp.setColumn(0, "TIME", ovTmHH.toString().padLeft(2, "0") + ovTmMM.toString().padLeft(2, "0"));
            this.ds_wrkcp.setColumn(0, "OVTMWRK_TM", ovTmHH.toString().padLeft(2, "0") + ovTmMM.toString().padLeft(2, "0"));
         }
      }
   }
}


/*
 * 함수명     : fn_calTime
 * 설명       : 일수/시간 계산 함수
 * params        : 대상 그리드 행번호
 * return Type    : None
 * 사용법      : this.fn_calTime(rowposition)
 */
this.fn_calTime = function(st, et, lunchMM){
   var nRow = this.ds_wrkcp.rowposition;
   var sd        = this.ds_wrkcp.getColumn(nRow, "BGNDE");      // 시작일
   var ed        = this.ds_wrkcp.getColumn(nRow, "ENDDE");      // 종료일
//  st 시작시각  et 종료시각  lunchMM 점심시간
   
   if(!this.comUtils.isNull(sd) && !this.comUtils.isNull(ed) || !this.comUtils.isNull(st) || !this.comUtils.isNull(et)){      
         
      var dayCnt = ed - sd;
      if(dayCnt < 0){
         this.ds_wrkcp.setColumn(nRow, "DAYCNT", "");
         this.ds_wrkcp.setColumn(nRow, "TIME", "");
      }else {
         var startDate = new Date(sd.substr(0,4)+"/"+sd.substr(4,2)+"/"+sd.substr(6,2)+" "+st.substr(0,2)+":"+st.substr(2,2)+":"+"00");
         var endDate  = new Date(ed.substr(0,4)+"/"+ed.substr(4,2)+"/"+ed.substr(6,2)+" "+et.substr(0,2)+":"+et.substr(2,2)+":"+"00");
         var tmp = (endDate.getTime() - startDate.getTime()) / 60000; // 분 단위로 변경.
         tmp -= nexacro.toNumber(lunchMM,0,0,0);
         var tmp1 = parseInt(((tmp % 1440) / 60)).toString().padLeft(2, "0"); // 시 단위로 변경.
         var tmp2 = ((tmp % 1440) % 60).toString().padLeft(2, "0"); // 분 단위로 변경.
         
         var time = tmp1.concat(tmp2);
         return time;
      }
   }
}]]></Script>
  </Form>
</FDL>
