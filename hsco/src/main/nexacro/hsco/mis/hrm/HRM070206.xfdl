<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\..\default_typedef.xml"/>
  <Form id="HRM070206" classname="HRM070206" left="0" top="0" width="1059" height="735" titletext="출장비정산" oninit="HRM070206_oninit" onload="HRM070206_onload">
    <Layouts>
      <Layout>
        <Static id="Static36" taborder="5" text="10" visible="false" left="0" top="59" width="1031" height="10" style="background:#dc143c3c;align:center middle;"/>
        <Static id="sta_bsrpList" taborder="6" text="출장목록" cssclass="sta_WF_Title02" left="0" top="71" width="103" height="19"/>
        <Static id="Static01" taborder="7" text="5" visible="false" left="0" top="90" right="28" height="5" style="background:#dc143c3c;align:center middle;"/>
        <Static id="Static03" taborder="8" text="15" visible="false" left="1031" top="0" width="15" height="735" style="background:#1b3cd23c;align:center middle;"/>
        <Static id="Static04" taborder="9" text="스&#13;&#10;크&#13;&#10;롤&#13;&#10;13" visible="false" top="0" right="0" width="13" height="735" style="background:#d07b173c;align:center middle;"/>
        <Static id="Static20" taborder="10" text="10" visible="false" left="0" top="323" right="28" height="10" style="background:#dc143c3c;align:center middle;"/>
        <Static id="sta_btrpsExcclc" taborder="11" text="출장비 정산" cssclass="sta_WF_Title02" left="0" top="333" width="103" height="19"/>
        <Static id="Static00" taborder="12" text="5" visible="false" left="0" top="352" right="28" height="5" style="background:#dc143c3c;align:center middle;"/>
        <Static id="Static02" taborder="13" text="10" visible="false" left="0" top="444" right="28" height="10" style="background:#dc143c3c;align:center middle;"/>
        <Tab id="tab_btrpsExcclcDetail" taborder="4" preload="true" left="0" top="454" right="28" bottom="0" tabindex="0" scrollbars="autoboth" style="showextrabutton:false;">
          <Tabpages>
            <Tabpage id="tabpage1" text="법인카드사용내역" url="mis_hrm::HRM070206_T01.xfdl"/>
            <Tabpage id="tabpage2" text="영수증" url="mis_hrm::HRM070206_T02.xfdl"/>
            <Tabpage id="tabpage3" text="정액지급" url="mis_hrm::HRM070206_T03.xfdl"/>
          </Tabpages>
        </Tab>
        <Div id="div_search" taborder="0" left="0" top="0" right="28" height="59" cssclass="div_WFSA_Box">
          <Layouts>
            <Layout width="1031" height="59">
              <Static id="sta_searchPd" taborder="6" text="조회년월" cssclass="sta_WFSA_Label" left="15" top="5" width="64" height="19"/>
              <Static id="Static06" taborder="7" text="15" visible="false" left="0" top="0" width="15" height="57" style="background:#00ffff66;"/>
              <Edit id="edt_coursDstnNm" taborder="3" oneditclick="div_SearchArea_Edit00_oneditclick" left="639" top="5" width="321" height="19"/>
              <Static id="Static00" taborder="9" text="15" visible="false" left="301" top="0" width="15" height="57" style="background:#00ffff66;"/>
              <Static id="sta_dstnNm" taborder="10" text="목적지" cssclass="sta_WFSA_Label" left="588" top="5" width="51" height="19"/>
              <Static id="sta_bsrpPurps" taborder="11" text="출장목적" cssclass="sta_WFSA_Label" left="316" top="5" width="64" height="19"/>
              <Static id="sta_searchDept" taborder="12" text="조회부서" cssclass="sta_WFSA_Label" left="15" top="31" width="64" height="21"/>
              <Div id="div_DEPT" taborder="4" url="com::deptCode.xfdl" left="79" top="31" width="195" height="21" enable="false" async="false"/>
              <Static id="sta_triper" taborder="13" text="출장자" cssclass="sta_WFSA_Label" left="588" top="31" width="51" height="21"/>
              <Div id="div_EMP" taborder="5" url="com::empno.xfdl" left="639" top="31" width="166" height="21" enable="false" async="false">
                <Layouts>
                  <Layout/>
                </Layouts>
              </Div>
              <Static id="Static01" taborder="14" text="15" visible="false" left="573" top="0" width="15" height="57" style="background:#00ffff66;"/>
              <Edit id="edt_bsrpPurps" taborder="2" left="380" top="5" width="193" height="19"/>
              <Div id="div_monCal" taborder="15" url="common::frmMonCal.xfdl" left="79" top="5" width="84" height="21" async="false"/>
              <Static id="sta_bizplcList" taborder="16" text="사업소" cssclass="sta_WFSA_Label" left="316" top="31" width="51" height="21"/>
              <Combo id="cmb_bizplcList" taborder="17" innerdataset="@ds_bizplcList" codecolumn="BIZPLC_CODE" datacolumn="BIZPLC_NM" left="380" top="31" width="193" height="21"/>
              <CheckBox id="chk_UNSNCT_AT" taborder="18" text=" " left="906" top="31" width="22" height="21" truevalue="1" falsevalue="0"/>
              <Static id="sta_UNSNCT_AT" taborder="19" text="미정산 여부" cssclass="sta_WFSA_Label" left="820" top="31" width="86" height="21"/>
              <Static id="Static02" taborder="20" text="15" visible="false" left="805" top="31" width="15" height="21" style="background:#00ffff66;"/>
            </Layout>
          </Layouts>
        </Div>
        <Grid id="grd_bsrpList" taborder="2" binddataset="ds_bsrpList" useinputpanel="false" left="0" top="95" right="28" height="228">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="40"/>
                <Column size="150"/>
                <Column size="80"/>
                <Column size="120"/>
                <Column size="200"/>
                <Column size="40"/>
                <Column size="40"/>
                <Column size="120"/>
                <Column size="120"/>
                <Column size="120"/>
                <Column size="120"/>
                <Column size="120"/>
                <Column size="120"/>
                <Column size="40"/>
                <Column size="120"/>
                <Column size="150"/>
              </Columns>
              <Rows>
                <Row size="28" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell text="순번"/>
                <Cell col="1" text="부서명"/>
                <Cell col="2" text="성명"/>
                <Cell col="3" text="직종(직급)"/>
                <Cell col="4" text="출장목적"/>
                <Cell col="5" text="관내"/>
                <Cell col="6" text="공용&#13;&#10;차량"/>
                <Cell col="7" text="목적지"/>
                <Cell col="8" text="출장시작일시"/>
                <Cell col="9" text="출장종료일시"/>
                <Cell col="10" text="출장품의금액"/>
                <Cell col="11" text="정산금액"/>
                <Cell col="12" text="잔액"/>
                <Cell col="13" text="정산"/>
                <Cell col="14" text="결의번호"/>
                <Cell col="15" text="카드/영수증/정액(건수)"/>
              </Band>
              <Band id="body">
                <Cell text="expr:currow + 1"/>
                <Cell col="1" style="padding:0 0 0 5;" text="bind:DEPT_NM"/>
                <Cell col="2" style="padding:0 0 0 5;" text="bind:EMPNM"/>
                <Cell col="3" style="padding:0 0 0 5;" text="bind:JSSFC_CLSF_NM"/>
                <Cell col="4" style="align:left middle;padding:0 0 0 5;" text="bind:BSRP_PURPS"/>
                <Cell col="5" displaytype="checkbox" style="align: ;" text="bind:WHTHRC_AT"/>
                <Cell col="6" displaytype="checkbox" text="bind:TFCMN_001"/>
                <Cell col="7" style="align:left middle;padding:0 0 0 5;" text="bind:DSTN_NM"/>
                <Cell col="8" displaytype="normal" text="bind:BSRP_BEGIN_DT"/>
                <Cell col="9" displaytype="normal" text="bind:BSRP_END_DT"/>
                <Cell col="10" displaytype="number" style="align:right middle;padding:0 5 0 0;" text="bind:TRVCT_TOTAMT"/>
                <Cell col="11" displaytype="number" style="align:right middle;padding:0 5 0 0;" text="bind:EXCCLC_AMOUNT"/>
                <Cell col="12" displaytype="number" style="align:right middle;padding:0 5 0 0;" text="bind:BLCE"/>
                <Cell col="13" displaytype="checkbox" text="bind:EXCCLC_AT"/>
                <Cell col="14" style="align:left middle;padding:0 0 0 5;" text="bind:DECSN_NO_VIEW"/>
                <Cell col="15" text="bind:EXCCLC_SE_CNT"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Grid id="grd_btrpsExcclc" taborder="3" binddataset="ds_btrps" useinputpanel="false" left="0" top="357" right="28" height="87">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="120"/>
                <Column size="120"/>
                <Column size="120"/>
                <Column size="120"/>
                <Column size="120"/>
                <Column size="120"/>
                <Column size="120"/>
                <Column size="120"/>
                <Column size="120"/>
                <Column size="120"/>
                <Column size="120"/>
                <Column size="120"/>
                <Column size="120"/>
                <Column size="120"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell colspan="2" text="출장비계"/>
                <Cell col="2" colspan="2" text="일비"/>
                <Cell col="4" colspan="2" text="식비"/>
                <Cell col="6" colspan="2" text="교통비"/>
                <Cell col="8" colspan="2" text="숙박비"/>
                <Cell col="10" colspan="2" text="현지활동비"/>
                <Cell col="12" colspan="2" text="기타경비"/>
                <Cell row="1" text="품의"/>
                <Cell row="1" col="1" text="정산"/>
                <Cell row="1" col="2" text="품의"/>
                <Cell row="1" col="3" text="정산"/>
                <Cell row="1" col="4" text="품의"/>
                <Cell row="1" col="5" text="정산"/>
                <Cell row="1" col="6" text="품의"/>
                <Cell row="1" col="7" text="정산"/>
                <Cell row="1" col="8" text="품의"/>
                <Cell row="1" col="9" text="정산"/>
                <Cell row="1" col="10" text="품의"/>
                <Cell row="1" col="11" text="정산"/>
                <Cell row="1" col="12" text="품의"/>
                <Cell row="1" col="13" text="정산"/>
              </Band>
              <Band id="body">
                <Cell displaytype="number" style="align:right middle;padding:0 5 0 0;" text="bind:TRVCT_TOTAMT"/>
                <Cell col="1" displaytype="number" style="align:right middle;padding:0 5 0 0;" text="bind:EXCCLC_AMOUNT"/>
                <Cell col="2" displaytype="number" style="align:right middle;padding:0 5 0 0;" text="bind:DAIL_CT"/>
                <Cell col="3" displaytype="number" style="align:right middle;padding:0 5 0 0;" text="bind:SUM_DAIL"/>
                <Cell col="4" displaytype="number" style="align:right middle;padding:0 5 0 0;" text="bind:MEAL_CT"/>
                <Cell col="5" displaytype="number" style="align:right middle;padding:0 5 0 0;" text="bind:SUM_MAEL"/>
                <Cell col="6" displaytype="number" style="align:right middle;padding:0 5 0 0;" text="bind:TRNSPORT_CT"/>
                <Cell col="7" displaytype="number" style="align:right middle;padding:0 5 0 0;" text="bind:SUM_TRNSPORT"/>
                <Cell col="8" displaytype="number" style="align:right middle;padding:0 5 0 0;" text="bind:STAYNG_CT"/>
                <Cell col="9" displaytype="number" style="align:right middle;padding:0 5 0 0;" text="bind:SUM_STAYNG"/>
                <Cell col="10" displaytype="number" style="align:right middle;padding:0 5 0 0;" text="bind:ACPLC_ACT_CT"/>
                <Cell col="11" displaytype="number" style="align:right middle;padding:0 5 0 0;" text="bind:SUM_ACPLC_ACT"/>
                <Cell col="12" displaytype="number" style="align:right middle;padding:0 5 0 0;" text="bind:ETC_EXPENS"/>
                <Cell col="13" displaytype="number" style="align:right middle;padding:0 5 0 0;" text="bind:SUM_ETC_EXPENS"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Button id="btn_btrpsExcclc" taborder="1" text="출장비정산" cssclass="btn_WF_Process" top="68" height="23" width="79" right="28" onclick="btn_btrpsExcclc_onclick"/>
        <Button id="btn_decsn" taborder="14" text="지출결의서 확인" cssclass="btn_WF_Process" top="68" right="109" width="111" height="23" onclick="btn_decsn_onclick" visible="false"/>
      </Layout>
    </Layouts>
    <Bind>
      <BindItem id="item4" compid="div_search.edt_coursDstnNm" propid="value" datasetid="ds_cond" columnid="DSTN_NM"/>
      <BindItem id="item2" compid="div_search.edt_bsrpPurps" propid="value" datasetid="ds_cond" columnid="BSRP_PURPS"/>
      <BindItem id="item0" compid="btn_btrpsExcclc" propid="enable" datasetid="ds_bsrpList" columnid="ENABLE_AT"/>
      <BindItem id="item1" compid="btn_decsn" propid="visible" datasetid="ds_bsrpList" columnid="EXCCLC_AT"/>
      <BindItem id="item8" compid="div_search.cmb_bizplcList" propid="value" datasetid="ds_cond" columnid="BIZPLC_CODE"/>
      <BindItem id="item3" compid="div_search.chk_UNSNCT_AT" propid="value" datasetid="ds_cond" columnid="UNSNCT_AT"/>
    </Bind>
    <Objects>
      <Dataset id="ds_cond" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_cond_oncolumnchanged">
        <ColumnInfo>
          <Column id="BSRP_YM" type="STRING" size="256"/>
          <Column id="BGNDE" type="STRING" size="256"/>
          <Column id="ENDDE" type="STRING" size="256"/>
          <Column id="BSRP_PURPS" type="STRING" size="256"/>
          <Column id="DSTN_NM" type="STRING" size="256"/>
          <Column id="DEPT_CODE" type="STRING" size="256"/>
          <Column id="DEPT_NM" type="STRING" size="256"/>
          <Column id="EMPNO" type="STRING" size="256"/>
          <Column id="EMPNM" type="STRING" size="256"/>
          <Column id="AUTH_GRP" type="STRING" size="256"/>
          <Column id="BIZPLC_CODE" type="STRING" size="256"/>
          <Column id="USE_AT" type="STRING" size="256"/>
          <Column id="UNSNCT_AT" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row/>
        </Rows>
      </Dataset>
      <Dataset id="ds_condSub" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="EMPNO" type="STRING" size="8"/>
          <Column id="BSRP_SEQ" type="STRING" size="256"/>
          <Column id="EXCCLC_SE" type="STRING" size="3"/>
        </ColumnInfo>
        <Rows>
          <Row/>
        </Rows>
      </Dataset>
      <Dataset id="ds_bsrpList" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" onrowposchanged="ds_bsrpList_onrowposchanged" canrowposchange="ds_bsrpList_canrowposchange">
        <ColumnInfo>
          <Column id="EMPNO" type="STRING" size="8"/>
          <Column id="EMPNM" type="STRING" size="256"/>
          <Column id="JSSFC_SE" type="STRING" size="256"/>
          <Column id="JSSFC_NM" type="STRING" size="256"/>
          <Column id="CLSF_SE" type="STRING" size="256"/>
          <Column id="CLSF_NM" type="STRING" size="256"/>
          <Column id="JSSFC_CLSF_NM" type="STRING" size="256"/>
          <Column id="BSRP_SEQ" type="BIGDECIMAL" size="6"/>
          <Column id="DEPT_CODE" type="STRING" size="6"/>
          <Column id="DEPT_NM" type="STRING" size="256"/>
          <Column id="WHTHRC_AT" type="STRING" size="256"/>
          <Column id="BSRP_PURPS" type="STRING" size="256"/>
          <Column id="DSTN_NM" type="STRING" size="256"/>
          <Column id="BSRP_BGNDE" type="STRING" size="256"/>
          <Column id="BSRP_BEGIN_TM" type="STRING" size="256"/>
          <Column id="BSRP_BEGIN_DT" type="STRING" size="256"/>
          <Column id="BSRP_ENDDE" type="STRING" size="256"/>
          <Column id="BSRP_END_TM" type="STRING" size="256"/>
          <Column id="BSRP_END_DT" type="STRING" size="256"/>
          <Column id="CONFM_AT" type="STRING" size="1"/>
          <Column id="SANCTN_NO" type="STRING" size="16"/>
          <Column id="SANCTN_STS" type="STRING" size="256"/>
          <Column id="TRVCT_TOTAMT" type="BIGDECIMAL" size="15"/>
          <Column id="EXCCLC_AMOUNT" type="BIGDECIMAL" size="15"/>
          <Column id="BLCE" type="BIGDECIMAL" size="15"/>
          <Column id="ENABLE_AT" type="STRING" size="256"/>
          <Column id="EXCCLC_AT" type="STRING" size="256"/>
          <Column id="DECSN_NO_VIEW" type="STRING" size="256"/>
          <Column id="DECSN_YEAR" type="STRING" size="256"/>
          <Column id="DECSN_NO" type="STRING" size="256"/>
          <Column id="EXCCLC_SE_CNT" type="STRING" size="256"/>
          <Column id="TFCMN_001" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_btrps" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" onrowposchanged="ds_edcList_onrowposchanged">
        <ColumnInfo>
          <Column id="EMPNO" type="STRING" size="256"/>
          <Column id="BSRP_SEQ" type="BIGDECIMAL" size="6"/>
          <Column id="TRVCT_TOTAMT" type="BIGDECIMAL" size="15"/>
          <Column id="EXCCLC_AMOUNT" type="BIGDECIMAL" size="15"/>
          <Column id="ACPLC_ACT_CT" type="BIGDECIMAL" size="15"/>
          <Column id="ETC_EXPENS" type="BIGDECIMAL" size="15"/>
          <Column id="DAIL_CT" type="BIGDECIMAL" size="15"/>
          <Column id="MEAL_CT" type="BIGDECIMAL" size="15"/>
          <Column id="TRNSPORT_CT" type="BIGDECIMAL" size="15"/>
          <Column id="STAYNG_CT" type="BIGDECIMAL" size="15"/>
          <Column id="SUM_ACPLC_ACT" type="BIGDECIMAL" size="15"/>
          <Column id="SUM_ETC_EXPENS" type="BIGDECIMAL" size="15"/>
          <Column id="SUM_DAIL" type="BIGDECIMAL" size="15"/>
          <Column id="SUM_MAEL" type="BIGDECIMAL" size="15"/>
          <Column id="SUM_TRNSPORT" type="BIGDECIMAL" size="15"/>
          <Column id="SUM_STAYNG" type="BIGDECIMAL" size="15"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cprCardUseDtls" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="EMPNO" type="STRING" size="8"/>
          <Column id="EMPNM" type="STRING" size="256"/>
          <Column id="BSRP_SEQ" type="BIGDECIMAL" size="6"/>
          <Column id="EXCCLC_SN" type="BIGDECIMAL" size="6"/>
          <Column id="EXCCLC_SE" type="STRING" size="3"/>
          <Column id="BTRPS_SE" type="STRING" size="3"/>
          <Column id="USE_DE" type="STRING" size="8"/>
          <Column id="USE_AM" type="BIGDECIMAL" size="15"/>
          <Column id="FILE_SN" type="STRING" size="256"/>
          <Column id="FILE_CNT" type="STRING" size="256"/>
          <Column id="RM" type="STRING" size="300"/>
          <Column id="BANK_CD" type="STRING" size="256"/>
          <Column id="CARD_NO" type="STRING" size="256"/>
          <Column id="APPR_TIME" type="STRING" size="256"/>
          <Column id="APPR_NO" type="STRING" size="256"/>
          <Column id="CANCEL_YN" type="STRING" size="256"/>
          <Column id="CARD_NM" type="STRING" size="256"/>
          <Column id="CHAIN_NM" type="STRING" size="256"/>
          <Column id="BRANCHTYPE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_rcipt" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" onrowposchanged="ds_rcipt_onrowposchanged">
        <ColumnInfo>
          <Column id="EMPNO" type="STRING" size="8"/>
          <Column id="EMPNM" type="STRING" size="256"/>
          <Column id="BSRP_SEQ" type="BIGDECIMAL" size="6"/>
          <Column id="EXCCLC_SN" type="BIGDECIMAL" size="6"/>
          <Column id="EXCCLC_SE" type="STRING" size="3"/>
          <Column id="BTRPS_SE" type="STRING" size="3"/>
          <Column id="USE_DE" type="STRING" size="8"/>
          <Column id="USE_AM" type="BIGDECIMAL" size="15"/>
          <Column id="FILE_SN" type="STRING" size="256"/>
          <Column id="FILE_CNT" type="STRING" size="256"/>
          <Column id="RM" type="STRING" size="300"/>
          <Column id="BANK_CD" type="STRING" size="256"/>
          <Column id="CARD_NO" type="STRING" size="256"/>
          <Column id="APPR_TIME" type="STRING" size="256"/>
          <Column id="APPR_NO" type="STRING" size="256"/>
          <Column id="CANCEL_YN" type="STRING" size="256"/>
          <Column id="CARD_NM" type="STRING" size="256"/>
          <Column id="CHAIN_NM" type="STRING" size="256"/>
          <Column id="BRANCHTYPE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_fxamtPymnt" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="EMPNO" type="STRING" size="8"/>
          <Column id="EMPNM" type="STRING" size="256"/>
          <Column id="BSRP_SEQ" type="BIGDECIMAL" size="6"/>
          <Column id="EXCCLC_SN" type="BIGDECIMAL" size="6"/>
          <Column id="EXCCLC_SE" type="STRING" size="3"/>
          <Column id="BTRPS_SE" type="STRING" size="3"/>
          <Column id="USE_DE" type="STRING" size="8"/>
          <Column id="USE_AM" type="BIGDECIMAL" size="15"/>
          <Column id="FILE_SN" type="STRING" size="256"/>
          <Column id="FILE_CNT" type="STRING" size="256"/>
          <Column id="RM" type="STRING" size="300"/>
          <Column id="BANK_CD" type="STRING" size="256"/>
          <Column id="CARD_NO" type="STRING" size="256"/>
          <Column id="APPR_TIME" type="STRING" size="256"/>
          <Column id="APPR_NO" type="STRING" size="256"/>
          <Column id="CANCEL_YN" type="STRING" size="256"/>
          <Column id="CARD_NM" type="STRING" size="256"/>
          <Column id="CHAIN_NM" type="STRING" size="256"/>
          <Column id="BRANCHTYPE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_condFile" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="FILE_SN" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_fileList" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" onrowposchanged="ds_fileList_onrowposchanged">
        <ColumnInfo>
          <Column id="CHK" type="STRING" size="256"/>
          <Column id="PROGRS" type="BIGDECIMAL" size="16"/>
          <Column id="ORGINL_FILE_NM" type="string" size="32"/>
          <Column id="FILE_EXTSN" type="string" size="32"/>
          <Column id="FILE_STRE_COURS" type="string" size="32"/>
          <Column id="FILE_ID" type="string" size="32"/>
          <Column id="SN" type="bigdecimal" size="16"/>
          <Column id="SYS_SE_CODE" type="string" size="32"/>
          <Column id="FILE_IMAGE" type="string" size="32"/>
          <Column id="FILE_TY" type="string" size="32"/>
          <Column id="JOB_SE" type="string" size="32"/>
          <Column id="DELETE_IMAGE" type="string" size="32"/>
          <Column id="STRE_FILE_NM" type="string" size="32"/>
          <Column id="FILE_MG" type="bigdecimal" size="16"/>
          <Column id="FILE_CN" type="string" size="32"/>
          <Column id="FILE_ORDR" type="bigdecimal" size="16"/>
          <Column id="TRNSMIS_FILE_SIZE" type="string" size="32"/>
          <Column id="USE_AT" type="string" size="32"/>
          <Column id="STTUS" type="string" size="32"/>
          <Column id="FILE_SN" type="bigdecimal" size="16"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_hrm055" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="ETC1" type="string" size="32"/>
          <Column id="VAL2" type="string" size="32"/>
          <Column id="CODE_CN" type="string" size="32"/>
          <Column id="VAL1" type="string" size="32"/>
          <Column id="USE_YN" type="string" size="32"/>
          <Column id="ETC3" type="string" size="32"/>
          <Column id="VAL4" type="string" size="32"/>
          <Column id="ETC2" type="string" size="32"/>
          <Column id="VAL3" type="string" size="32"/>
          <Column id="CODE_ORDR" type="bigdecimal" size="16"/>
          <Column id="MSTK_VAL" type="string" size="32"/>
          <Column id="ALL_CODE_NM" type="string" size="32"/>
          <Column id="CODE_NM" type="string" size="32"/>
          <Column id="INT_VAL" type="string" size="32"/>
          <Column id="GRP_CODE" type="string" size="32"/>
          <Column id="CODE" type="string" size="32"/>
          <Column id="VAL0" type="string" size="32"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_hrm056" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="ETC1" type="string" size="32"/>
          <Column id="VAL2" type="string" size="32"/>
          <Column id="CODE_CN" type="string" size="32"/>
          <Column id="VAL1" type="string" size="32"/>
          <Column id="USE_YN" type="string" size="32"/>
          <Column id="ETC3" type="string" size="32"/>
          <Column id="VAL4" type="string" size="32"/>
          <Column id="ETC2" type="string" size="32"/>
          <Column id="VAL3" type="string" size="32"/>
          <Column id="CODE_ORDR" type="bigdecimal" size="16"/>
          <Column id="MSTK_VAL" type="string" size="32"/>
          <Column id="ALL_CODE_NM" type="string" size="32"/>
          <Column id="CODE_NM" type="string" size="32"/>
          <Column id="INT_VAL" type="string" size="32"/>
          <Column id="GRP_CODE" type="string" size="32"/>
          <Column id="CODE" type="string" size="32"/>
          <Column id="VAL0" type="string" size="32"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_validation" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="compId" type="STRING" size="256"/>
          <Column id="colId" type="STRING" size="256"/>
          <Column id="PK" type="STRING" size="256"/>
          <Column id="notNull" type="STRING" size="256"/>
          <Column id="type" type="STRING" size="256"/>
          <Column id="nlength" type="STRING" size="256"/>
          <Column id="from" type="STRING" size="256"/>
          <Column id="to" type="STRING" size="256"/>
          <Column id="lengthChkGb" type="STRING" size="256"/>
          <Column id="msgId" type="STRING" size="256"/>
          <Column id="expr" type="STRING" size="256"/>
          <Column id="func" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="compId">ds_cond</Col>
            <Col id="colId">BSRP_YM</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">조회년월</Col>
          </Row>
          <Row>
            <Col id="compId">ds_cprCardUseDtls</Col>
            <Col id="colId">EDCCT_SE</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">여비구분</Col>
          </Row>
          <Row>
            <Col id="compId">ds_cprCardUseDtls</Col>
            <Col id="colId">BANK_CD</Col>
            <Col id="PK">Y</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">금융기관코드</Col>
          </Row>
          <Row>
            <Col id="compId">ds_cprCardUseDtls</Col>
            <Col id="colId">CARD_NO</Col>
            <Col id="PK">Y</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">카드번호</Col>
          </Row>
          <Row>
            <Col id="compId">ds_cprCardUseDtls</Col>
            <Col id="colId">USE_DE</Col>
            <Col id="PK">Y</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">사용일자</Col>
          </Row>
          <Row>
            <Col id="compId">ds_cprCardUseDtls</Col>
            <Col id="colId">APPR_TIME</Col>
            <Col id="PK">Y</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">사용시간</Col>
          </Row>
          <Row>
            <Col id="compId">ds_cprCardUseDtls</Col>
            <Col id="colId">APPR_NO</Col>
            <Col id="PK">Y</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">승인번호</Col>
          </Row>
          <Row>
            <Col id="compId">ds_cprCardUseDtls</Col>
            <Col id="colId">USE_AM</Col>
            <Col id="PK">Y</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">사용금액</Col>
          </Row>
          <Row>
            <Col id="compId">ds_cprCardUseDtls</Col>
            <Col id="colId">CANCEL_YN</Col>
            <Col id="PK">Y</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">승인취소여부</Col>
          </Row>
          <Row>
            <Col id="compId">ds_rcipt</Col>
            <Col id="colId">BTRPS_SE</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">여비구분</Col>
          </Row>
          <Row>
            <Col id="compId">ds_rcipt</Col>
            <Col id="colId">USE_DE</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">사용일자</Col>
          </Row>
          <Row>
            <Col id="compId">ds_rcipt</Col>
            <Col id="colId">USE_AM</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">사용금액</Col>
          </Row>
          <Row>
            <Col id="compId">ds_fxamtPymnt</Col>
            <Col id="colId">BTRPS_SE</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">여비구분</Col>
          </Row>
          <Row>
            <Col id="compId">ds_fxamtPymnt</Col>
            <Col id="colId">USE_DE</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">사용일자</Col>
          </Row>
          <Row>
            <Col id="compId">ds_fxamtPymnt</Col>
            <Col id="colId">USE_AM</Col>
            <Col id="notNull">Y</Col>
            <Col id="msgId">사용금액</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_bizplcList" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CHK" type="STRING" size="256"/>
          <Column id="BIZPLC_CODE" type="STRING" size="256"/>
          <Column id="BIZPLC_NM" type="STRING" size="256"/>
          <Column id="BIZPLC_TY" type="STRING" size="256"/>
          <Column id="BIZPLC_PLACE" type="STRING" size="256"/>
          <Column id="MANAGE_DEPT_CODE" type="STRING" size="256"/>
          <Column id="MANAGE_DEPT_NM" type="STRING" size="256"/>
          <Column id="TELNO" type="STRING" size="256"/>
          <Column id="USE_AT" type="STRING" size="256"/>
          <Column id="OUTPT_ORDR" type="STRING" size="256"/>
          <Column id="RM" type="STRING" size="256"/>
          <Column id="GW_BIZPLC_ID" type="STRING" size="256"/>
          <Column id="REGISTER_ID" type="STRING" size="256"/>
          <Column id="REGIST_DT" type="STRING" size="256"/>
          <Column id="UPDUSR_ID" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_useAmOverChk" useclientlayout="true">
        <ColumnInfo>
          <Column id="OVER_AT" type="STRING" size="256"/>
          <Column id="OVER_AM" type="STRING" size="256"/>
          <Column id="SUM_AM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_conduseAmOverChk" useclientlayout="true">
        <ColumnInfo>
          <Column id="EMPNO" type="STRING" size="256"/>
          <Column id="BSRP_SEQ" type="STRING" size="256"/>
          <Column id="USE_YM" type="STRING" size="256"/>
          <Column id="USE_AM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript5.0"><![CDATA[/***********************************************************************
 * 업무구분 : MIS > 인사관리 > 복무관리 > 출장/연수관리
 * 화면ID   : HRM070206
 * 화면명   : 출장비정산
 * 화면설명 : 출장비를 정산한다.
 * 작성일   : 2017.07.03
 * 작성자   : 김형태
 * 수정이력 : 
 ***********************************************************************
 *     수정일     수정자   내용
 ***********************************************************************
 *    
 *   
 ***********************************************************************
 */

/***********************************************************************
 * Script Include 
 ***********************************************************************/
// 시스템 공통 라이브러리 Include
include "lib::comInclude.xjs";
include "mis_lib::misUtil.xjs";
include "lib::comUpDownUtils.xjs";

/***********************************************************************
 * 화면 변수 선언부
 ***********************************************************************/
this.checkDs = [
  this.ds_bsrpList
  ,this.ds_btrps
  ,this.ds_cprCardUseDtls
  ,this.ds_rcipt
  ,this.ds_fxamtPymnt
];

var saveRow = -1;
this.chargerAt = false;
this.File_UpDownManager = null;

/***********************************************************************
 * onInit / onLoad 영역
 ***********************************************************************/
this.HRM070206_oninit = function(obj:Form, e:nexacro.InitEventInfo)
{

}
this.HRM070206_onload = function(obj:Form, e:nexacro.LoadEventInfo)
{
	// form 초기화
	this.fn_init_form();

	// dataset 초기화
	this.fn_init_dataset();
}

/***********************************************************************
 * Form 오브젝트 초기화
 ***********************************************************************/ 
this.fn_init_form = function()
{
	this.gfn_initForm(this);
	this.fn_misFormInit(this);
	
	// 오브젝트 등에 대한 처리
	this.div_search.div_monCal.fn_setBind("ds_cond","BSRP_YM");
	this.div_search.div_monCal.set_essential(true);
	this.div_search.div_DEPT.fn_setBind("ds_cond","DEPT_CODE","DEPT_NM");
	this.div_search.div_EMP.fn_setBind("ds_cond","EMPNO","EMPNM");
	this.div_search.div_DEPT.authorCtrlAt = true;	// 부서 권한제어처리(선택가능 범위의 부서)
	
	this.ds_cond.clearData();
	this.ds_cond.addRow();
	
	// 공통코드
	var comboParams = [
		["ds_hrm055", "HRM055", "Y", "D", "B"]	// ds_hrm055 : 정산지급구분
	   ,["ds_hrm056", "HRM056", "Y", "D", "B"]	// ds_hrm056 : 정산구분
	];
	var callback = function (svcId, errorCode, errorMsg) {		
		// 수정가능여부를 판별하기위해 권한그룹 체크
		// 인사결재자, 보수결재자, 회계결재자, 비서, 인사복무담당자
		if(this.gfn_authGrpId("HRM_ADMIN") != -1 || this.gfn_authGrpId("SAL_ADMIN") != -1
		   || this.gfn_authGrpId("ACC_ADMIN") != -1 || this.gfn_authGrpId("SECRTRY") != -1 || this.gfn_authGrpId("HRM_SRVIC") != -1) {
			this.chargerAt = true;
		}
		
		// 수정가능한 경우 부서, 사원정보 변경 가능
		if(this.chargerAt){
			this.div_search.div_DEPT.set_enable(true);
			this.div_search.div_EMP.set_enable(true);
			this.ds_cond.setColumn(0, "DEPT_CODE", "000000"        );		// 부서코드
			this.div_search.div_DEPT.SetDeptCode("000000");
			this.ds_cond.setColumn(0, "DEPT_NM",   "화성도시공사");		// 부서명
			this.ds_cond.setColumn(0, "AUTH_GRP", "ADMIN");
		} else{
			// 본인의 부서, 사원정보 고정
			//해당 부서만
			this.ds_cond.setColumn(0, "DEPT_CODE", this.gfn_getDeptId()  );	// 부서코드
			this.div_search.div_DEPT.SetDeptCode(this.gfn_getDeptId());
			this.ds_cond.setColumn(0, "DEPT_NM",   this.gfn_getDeptName());	// 부서명
			this.ds_cond.setColumn(0, "EMPNO",     this.gfn_getEmpNo()   );	// 사원코드
			this.ds_cond.setColumn(0, "EMPNM",     this.gfn_getUserName());	// 사원명
			this.ds_cond.setColumn(0, "AUTH_GRP", "USER");
			
			if(this.gfn_authGrpId("GRFRS") != -1) {			// 서무
				this.div_search.div_DEPT.set_enable(true);
				this.div_search.div_EMP.set_enable(true);
				this.ds_cond.setColumn(0, "EMPNO", "");	// 사원코드
				this.ds_cond.setColumn(0, "EMPNM", "");	// 사원명
				this.ds_cond.setColumn(0, "AUTH_GRP", "GRFRS");
			}
		}
		
		// 초기 검색조건
		var ym  = this.comUtils.getClientDate("YYYYMM");
		this.ds_cond.setColumn(0, "BSRP_YM", ym);	// 조회년월
		
		this.fn_search();	// 초기조회
	};
	this.gfn_comboLoad(comboParams, callback);
}

/***********************************************************************
 * Dataset 오브젝트 초기화
 ***********************************************************************/ 
this.fn_init_dataset = function()
{
	this.gfn_initCondDs(this, this.div_search);
	
	// 파일 메니저 설정
	var fileConfig = {
		useMultiUpload : true,
		onChange: this.fn_onFileSelected,	// 파일 선택 이벤트 핸들러
		onSuccess : this.fn_onFileSuccess	// 전송 성공 이벤트 핸들러
		//responseGrid : this.div_multiFile.grd_fileList,
		//responseArea : this.div_multiFile.sta_helpMessage
	};
	this.File_UpDownManager = new this.fileUpDownManager(this, "MIS", "HRM");
	this.File_UpDownManager.init(fileConfig);
}


/**********************************************************************
* Transaction 영역 시작
***********************************************************************
*
* 1. Transaction 관련 이벤트 핸들러
* 2. call Transaction 영역
* 3. callback 영역(Transaction, Popup)
* 
***********************************************************************/


/**********************************************************************
* Transaction 관련 이벤트 핸들러 
***********************************************************************/


/*
 * 함수명  	: fn_search
 * 설명 		: 조회 이벤트 처리(수요조사의견)
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_search();
 */
this.fn_search = function()
{
	if(!this.gfn_checkValidation_NoUpdChk(this.ds_cond, this.ds_validation)) {
		return false;
	}
	
	this.ds_bsrpList.clearData();
	this.ds_btrps.clearData();
	this.ds_cprCardUseDtls.clearData();
	this.ds_rcipt.clearData();
	this.ds_fxamtPymnt.clearData();
	this.fn_transaction("selectBsrpList");
}


/*
 * 함수명  	: fn_search_sub
 * 설명 		: 조회 이벤트 처리(출장비정산)
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_search_sub();
 */
this.fn_search_sub = function()
{
	this.ds_btrps.clearData();
	this.ds_cprCardUseDtls.clearData();
	this.ds_rcipt.clearData();
	this.ds_fxamtPymnt.clearData();
	this.fn_transaction("selectBtrpsExcclc");
}


/*
 * 함수명  	: fn_save
 * 설명 		: 저장 이벤트 처리
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_save();
 */
this.fn_save = function()
{	
	//정산금액 초과여부 체크
	this.fn_overChk();
}

/**********************************************************************
 * CALL TRANSACTION 영역
 **********************************************************************/
this.fn_transaction = function(strSvcId)
{
	switch (strSvcId) {
		case "selectBsrpList":			// 출장목록 조회
			var sController   	= "hsco/mis/hrm/HRM070206/selectBsrpList.do";
			var sInDatasets   	= "input1=ds_cond";
			var sOutDatasets  	= "ds_bsrpList=output1";
			break;
		case "selectBtrpsExcclc":		// 출장비 정산(법인카드사용내역, 영수증, 정액지급) 조회
			var sController   	= "hsco/mis/hrm/HRM070206/selectBtrpsExcclc.do";
			var sInDatasets   	= "input1=ds_condSub";
			var sOutDatasets  	= "ds_btrps=output1 ds_cprCardUseDtls=output2 ds_rcipt=output3 ds_fxamtPymnt=output4";
			break;
		case "selectFileList":			// 첨부파일 조회
			this.ds_fileList.clearData();
			var sController   	= "hsco/mis/hrm/HRM070206/selectFileList.do";
			var sInDatasets   	= "input1=ds_condFile";
			var sOutDatasets  	= "ds_fileList=output1";
			break;
		case "save":					// 저장
			var sController   	= "hsco/mis/hrm/HRM070206/save.do";
			var sInDatasets   	= "input1=ds_cprCardUseDtls:U input2=ds_rcipt:U input3=ds_fxamtPymnt:U input4=ds_condSub";
			var sOutDatasets  	= "";
			break;
		//  사업소 조회
        case "selectBizplcCode":
			var sController   	= "hsco/mis/hrm/HRM010102/bizplcSearchList.do";
			var sInDatasets   	= "input1=ds_cond";
			var sOutDatasets  	= "ds_bizplcList=output1";
			break;
									//  사업소 조회
        case "overChk":
			var sController   	= "hsco/mis/hrm/HRM070206/selectUseAmTotOverAt.do";
			var sInDatasets   	= "input1=ds_conduseAmOverChk";
			var sOutDatasets  	= "ds_useAmOverChk=output1";
			break;
	}

	Ex.core.tran(this, strSvcId, sController, sInDatasets, sOutDatasets); 
}

 /**********************************************************************
 * Transaction Callback 영역
 ***********************************************************************/
this.fn_callBack = function (strSvcId, nErrorCode, strErrorMsg)
{
	// 오류 및 성공 메시지를 화면에 보여준다.
	if(nErrorCode != 0) {
	  this.gfn_callback_message(strSvcId, nErrorCode, strErrorMsg);
	}
	if (nErrorCode != 0){
	} else {
		switch (strSvcId) {
			case "selectBsrpList":	// 출장목록 조회
				if(saveRow > -1){
					this.ds_bsrpList.set_rowposition(saveRow);
					saveRow = -1;
				}
				break;
			case "selectBtrpsExcclc":	// 출장비 정산(법인카드사용내역, 영수증, 정액지급) 조회
				break;
			case "selectFileList":		// 첨부파일 조회
				break;
			case "deleteFile":
				this.fn_transaction("selectFileList");
				break;
			case "save":				// 저장
				this.gfn_message("success.처리.성공");
				this.fn_search();
				break;
			//  사업소 조회
			case "selectBizplcCode":			
				var nRow1 = this.ds_bizplcList.insertRow(0);
				this.ds_bizplcList.setColumn(nRow1, "BIZPLC_CODE", "NULL");
				this.ds_bizplcList.setColumn(nRow1, "BIZPLC_NM"  , "해당없음");
				
				var nRow2 = this.ds_bizplcList.insertRow(0);
				this.ds_bizplcList.setColumn(nRow2, "BIZPLC_CODE", "9999");
				this.ds_bizplcList.setColumn(nRow2, "BIZPLC_NM"  , "전체");
				
				var deptCode = this.ds_cond.getColumn(0, "DEPT_CODE");
				this.fn_setBizplc(deptCode);
				break;
			//  정산금액 초과 여부 체크
			case "overChk":			
				var overAt = this.ds_useAmOverChk.getColumn(0, "OVER_AT");
				
				if(overAt == "1") {
					var overAm = this.ds_useAmOverChk.getColumn(0, "OVER_AM");
					var sumAm  = this.ds_useAmOverChk.getColumn(0, "SUM_AM");
					var errMsg = "관내출장 총 정산금액이 200,000원을 초과합니다. 정산금액을 확인 후 다시 저장해주십시오.";
					errMsg += "\n(기등록 된 정산금액 : "+sumAm+"원)";
					this.gfn_message("info.처리불가",errMsg);
					return false;
				}else {
					// 저장
					this.save();
				}
				
				break;
		}
	}
}


/*
 * 함수명  	: fn_popupCallBack
 * 설명 		: Popup Callback 처리
 * params  		: sPopupId    : 팝업 ID
 *                sReturn  : 팝업 처리 결과(dataset.saveXML())
 * return Type 	: None
 * 사용법		: 
 */
this.fn_popupCallBack = function(sPopupId, sReturn)
{
	// 출장비정산 팝업에서 저장이 일어나므로, 팝업 종료시 강제 재조회
	if(sPopupId == "expDsnPopup") {
		this.fn_search();
	}
}


/***********************************************************************
* Transaction 영역 끝
************************************************************************/



/**********************************************************************
* non-Transaction 관련 컴포넌트 이벤트 처리 함수
***********************************************************************
*
* 1. 공통버튼 관련 이벤트 처리
* 2. Dataset 관련 이벤트 처리
* 3. 첨부파일 관련 함수 처리
* 4. 사용자정의 함수 처리
* 
***********************************************************************/



/**********************************************************************
* 공통버튼 관련 이벤트 처리
***********************************************************************/

/*
 * 함수명  	: fn_cancel
 * 설명 		: 취소 버튼 이벤트 처리(Dataset 변경 내역 Reset)
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_cancel();
 */
this.fn_cancel= function()
{
	if(   Ex.util.isUpdated(this.ds_cprCardUseDtls)
	   || Ex.util.isUpdated(this.ds_rcipt)
	   || Ex.util.isUpdated(this.ds_fxamtPymnt)) {
		if(!this.gfn_message("confirm.변경.취소.여부")) {
			return false;	// 아니오
		}
		this.ds_cprCardUseDtls.reset();
		this.ds_rcipt.reset();
		this.ds_fxamtPymnt.reset();
	}
}



/**********************************************************************
* Dataset 관련 이벤트 처리
***********************************************************************/

/*
 * 함수명  	: ds_bsrpList_canrowposchange
 * 설명 		: 출장목록 행 변경 전 이벤트 처리
 * params  		: none
 * return Type 	: none
 * 사용법		: this.ds_bsrpList_canrowposchange(obj, e)
 */
this.ds_bsrpList_canrowposchange = function(obj:Dataset, e:nexacro.DSRowPosChangeEventInfo)
{
	if(   Ex.util.isUpdated(this.ds_cprCardUseDtls)
	   || Ex.util.isUpdated(this.ds_rcipt)
	   || Ex.util.isUpdated(this.ds_fxamtPymnt)) {
		if(!this.gfn_message("confirm.변경.취소.여부")) {
			return false;	// 아니오
		}
	}
}


/*
 * 함수명  	: ds_bsrpList_onrowposchanged
 * 설명 		: 출장목록 행 변경 후 이벤트 처리
 * params  		: none
 * return Type 	: none
 * 사용법		: this.ds_bsrpList_onrowposchanged(obj, e)
 */
this.ds_bsrpList_onrowposchanged = function(obj:Dataset, e:nexacro.DSRowPosChangeEventInfo)
{
	if(e.newrow > -1) {
		this.ds_condSub.clearData();
		var nRow = this.ds_condSub.addRow();
		var empno   = obj.getColumn(e.newrow, "EMPNO");
		var bsrpSeq = obj.getColumn(e.newrow, "BSRP_SEQ");
		
		this.ds_condSub.setColumn(nRow, "EMPNO"   , empno);
		this.ds_condSub.setColumn(nRow, "BSRP_SEQ", bsrpSeq);
		
		this.fn_search_sub();
	} else {
		this.ds_btrps.clearData();
		this.ds_cprCardUseDtls.clearData();
		this.ds_rcipt.clearData();
		this.ds_fxamtPymnt.clearData();
	}
	
	if(obj.getRowCount() == 0) {
		this.btn_decsn.set_visible(false);
	}
}

/*
 * 함수명  	: ds_rcipt_onrowposchanged
 * 설명 		: (현금)영수증 사용내역 행 변경시 이벤트 처리
 * params  		: none
 * return Type 	: none
 * 사용법		: this.ds_rcipt_onrowposchanged(obj, e)
 */
this.ds_rcipt_onrowposchanged = function(obj:Dataset, e:nexacro.DSRowPosChangeEventInfo)
{
	this.ds_fileList.clearData();
	
	if(e.newrow > -1) {
		var fileSn = obj.getColumn(e.newrow, "FILE_SN");
		
		if(!this.comUtils.isNull(fileSn)) {
			this.ds_condFile.setColumn(0, "FILE_SN", fileSn);
			this.fn_transaction("selectFileList");  // 첨부파일 조회
		}
	}
}


/**********************************************************************
* 첨부파일 관련 함수 처리
***********************************************************************/


/*
 * 함수명  	: fn_uploadFile
 * 설명 		: 파일 업로드
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_uploadFile();
 */
this.fn_uploadFile= function()
{
	// 첨부파일 업로드(fileSn 자동채번 / 첨부파일 Master에 ROW추가 / 파일 업로드 및 자동저장 / 테이블에 fileSn반영 / 데이터셋에 fileSn반영, 단 신규 ROW가 아닐경우 ROWTYPE은 유지)
	this.fn_autoFileSn(
		 "MIS"												// 대분류   (SYS_SE)
		,"HRM"												// 업무구분 (JOB_SE)
		, this.File_UpDownManager							// fileManager 오브젝트
		, this.ds_fileList									// fileObject
		, this.ds_rcipt										// fileSn을 불러오거나 반영해야 하는 컬럼
		, "TBHRM_BTRPS_EXCCLC_MANAGE"						// fileSn을 저장할 테이블
		, "FILE_SN"											// fileSn 컬럼명이 다를 경우를 대비
		, ["EMPNO", "BSRP_SEQ", "EXCCLC_SN"]				// fileSn을 저장할 테이블의 PK (FileSn 확인 및 자동반영목적)
	);
}


/*
 * 함수명  	: fn_deleteFile
 * 설명 		: 파일 삭제
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_deleteFile();
 */
this.fn_deleteFile= function()
{
	this.ds_fileList.deleteAll();
		
	var strSvcId   	 = "deleteFile";
	var sController  = "hsco/cmm/file/deleteFile.do";
	var sInDatasets  = "input1=ds_fileList:U";
	var sOutDatasets = "ds_fileList=output1";
	
	Ex.core.tran(this, strSvcId, sController, sInDatasets, sOutDatasets);
}
this.ds_fileList_onrowposchanged = function(obj:Dataset, e:nexacro.DSRowPosChangeEventInfo)
{
	var nRow = this.ds_rcipt.rowposition;
	this.ds_fileList.filter("USE_AT == '1'");
	
	var fileCnt = this.ds_fileList.getRowCount();
	
	this.ds_rcipt.set_enableevent(false);
	this.ds_rcipt.set_updatecontrol(false);
	this.ds_rcipt.setColumn(nRow, "FILE_CNT", fileCnt);
	this.ds_rcipt.set_updatecontrol(true);
	this.ds_rcipt.set_enableevent(true);
}


/**********************************************************************
* 사용자정의 함수 처리
***********************************************************************/


/*
 * 함수명  	: btn_btrpsExcclc_onclick
 * 설명 		: 출장비정산 버튼 클릭시 이벤트 처리
 * params  		: none
 * return Type 	: none
 * 사용법		: this.btn_btrpsExcclc_onclick(obj, e)
 */
this.btn_btrpsExcclc_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	if(this.gfn_authGrpId("GRFRS") == -1 && this.gfn_authGrpId("SAL_ADMIN") == -1 && this.gfn_authGrpId("DEV_GRP") == -1) {			// 서무, 보수결재자
		this.gfn_message("info.처리불가", "[서무][급여] 권한을 가진 사용자에게만 허용된 기능입니다.");
		return false;
	}
	
	var bsrpYm   = this.ds_cond.getColumn(0, "BSRP_YM");
	var deptCode = this.ds_cond.getColumn(0, "DEPT_CODE");
	var deptCode = this.ds_cond.getColumn(0, "DEPT_NM");
	if(this.comUtils.isNull(bsrpYm) || bsrpYm.indexOf(' ') > -1) {
		var errMsg = "[조회년월] 을 입력해 주시기 바랍니다.";
		alert(errMsg); 
		return false;
	}
	
	if(this.comUtils.isNull(deptCode)) {
		var errMsg = "[조회부서] 를 입력해 주시기 바랍니다.";
		alert(errMsg);
		return false;
	}
	
	if(deptCode == "000000") {
		var errMsg = "팀 단위의 정산만 가능합니다";
		alert(errMsg);
		return false;
	}
	
	var bsrpPurps  = this.ds_cond.getColumn(0, "BSRP_PURPS");
	var dstnNm     = this.ds_cond.getColumn(0, "DSTN_NM");
	var empno      = this.ds_cond.getColumn(0, "EMPNO");
	var empnm      = this.ds_cond.getColumn(0, "EMPNM");
	if ( !this.comUtils.isNull(bsrpPurps) || !this.comUtils.isNull(dstnNm) || !this.comUtils.isNull(empno) || !this.comUtils.isNull(empnm) ) {
		
		var deptCode      = this.ds_cond.getColumn(0, "DEPT_CODE");
		if(deptCode == "060000" && !this.comUtils.isNull(empno)){
		} else {
			var errMsg = "정산에 불필요한 조회조건이 존재합니다." + "\n" + "\n";
			errMsg    += "[조회년월]과 [조회부서]를 제외한 검색조건의 초기화를 진행합니다." + "\n";
			errMsg    += "(자동 재조회됩니다. )";
			alert(errMsg);
			
			this.ds_cond.setColumn(0, "BSRP_PURPS", "");
			this.ds_cond.setColumn(0, "DSTN_NM",    "");
			this.ds_cond.setColumn(0, "EMPNO",      "");
			this.ds_cond.setColumn(0, "EMPNM",      "");
			
			this.fn_search();
			return false;
		}
	}
	
	if ( this.comUtils.isDatasetUpdated(this.ds_cond) ) {
		var errMsg = "수정된 검색조건이 존재합니다." + "\n";
		errMsg    += "(자동 재조회됩니다. )";
		alert(errMsg);
		
		this.fn_search();
		return false;
	}
	/*
	var caseCount = this.ds_bsrpList.getCaseCount("EXCCLC_AT == '1'");
	if(caseCount > 0) {
		var errMsg = "이미 해당 조건의 출장비 정산이 완료되었습니다" + "\n";
		errMsg    += "(" + caseCount + "건)" + "\n" + "\n";
		errMsg    += "(여비지출결의서를 삭제하신 후 다시 진행하셔야 합니다)"
		alert(errMsg);
		return false;
	}
	*/
	var bizRow = this.ds_bizplcList.findRow("BIZPLC_CODE" , this.ds_cond.getColumn(0, "BIZPLC_CODE"));
	
	var year = this.ds_cond.getColumn(0, "BSRP_YM").substr(0,4);
	var args = {
		 arg_0				: this
		,trgFormId			: "HRM070206"
		,trgFormId2			: "MIS"
		,anactKnd			: '03'				// 여비지출결의서
		,decsnYear			: year
		,bsrpYm             : this.ds_cond.getColumn(0, "BSRP_YM")
		,deptCode           : this.ds_cond.getColumn(0, "DEPT_CODE")
		,deptNm             : this.ds_cond.getColumn(0, "DEPT_NM")
		,bizplc             : this.ds_cond.getColumn(0, "BIZPLC_CODE")
		,bizplcNm           : this.ds_bizplcList.getColumn(bizRow, "BIZPLC_NM")
		,empno              : this.ds_cond.getColumn(0, "EMPNO")
    };
	this.gfn_popup("expDsnPopup", 903, 842, "결의서", args, "mis_hrm::HRM070206_P1.xfdl", "fn_popupCallBack", true);
}


/*
 * 함수명  	: btn_decsn_onclick
 * 설명 		: 지출결의서 확인 버튼 클릭시 이벤트 처리
 * params  		: none
 * return Type 	: none
 * 사용법		: this.btn_decsn_onclick(obj, e)
 */
this.btn_decsn_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	var mRow = this.ds_bsrpList.rowposition;
	var decsnYear = this.ds_bsrpList.getColumn(mRow, "DECSN_YEAR");
	var decsnNo   = this.ds_bsrpList.getColumn(mRow, "DECSN_NO");
	
	var args = {
		  arg_0     : this
		, trgFormId	: "HRM070206"												// 팝업을 호출하는 화면의 ID
		, anactKnd	: '01'
		, decsnYear	: decsnYear
		, decsnNo	: decsnNo
	};
	this.gfn_popup("expDsnPopup", 903, 842, "결의서", args, "mis_acc::ACC020203_P03.xfdl", "fn_popupCallBack", true);
}

/*
 * 함수명  	: ds_cond_oncolumnchanged
 * 설명 		: 검색조건 oncolumnchanged 이벤트 처리
 * params  		: none
 * return Type 	: none
 * 사용법		: this.ds_cond_oncolumnchanged(obj, e)
 */
this.ds_cond_oncolumnchanged = function(obj:Dataset, e:nexacro.DSColChangeEventInfo)
{
	if(e.columnid == "DEPT_CODE") {
		// 사업소 코드 조회
		this.ds_cond.setColumn(0, "USE_AT"       , "1");
		this.fn_transaction("selectBizplcCode");
	}
}


this.fn_setBizplc = function(deptCode) {

	var deptCode = deptCode;
	
	if(!this.comUtils.isNull(deptCode)) {
		this.ds_bizplcList.set_filterstr("");
		var cnt = this.ds_bizplcList.getCaseCount("MANAGE_DEPT_CODE == '"+deptCode+"'");
		
		if(cnt > 0) {
			this.ds_bizplcList.set_filterstr("MANAGE_DEPT_CODE == '"+deptCode+"'");	
			var nRow1 = this.ds_bizplcList.insertRow(0);
			this.ds_bizplcList.setColumn(nRow1, "BIZPLC_CODE", "NULL");
			this.ds_bizplcList.setColumn(nRow1, "BIZPLC_NM"  , "해당없음");
			
			var nRow2 = this.ds_bizplcList.insertRow(0);
			this.ds_bizplcList.setColumn(nRow2, "BIZPLC_CODE", "9999");
			this.ds_bizplcList.setColumn(nRow2, "BIZPLC_NM"  , "전체");
			this.div_search.cmb_bizplcList.set_index(0);
		}else {
			this.ds_bizplcList.set_filterstr("BIZPLC_CODE == '9999'");
			this.ds_cond.setColumn(0, "BIZPLC_CODE", "9999");
		}
		
	}else {
		this.ds_bizplcList.set_filterstr("BIZPLC_CODE == '9999'");
		this.ds_cond.setColumn(0, "BIZPLC_CODE", "9999");
	}
}



this.fn_overChk = function() {
	
	var nRow = this.ds_bsrpList.rowposition;
	var empno = this.ds_bsrpList.getColumn(nRow, "EMPNO");
	var bsrpSeq = this.ds_bsrpList.getColumn(nRow, "BSRP_SEQ");
	var bsrpBgnde = this.ds_bsrpList.getColumn(nRow, "BSRP_BGNDE");
    var useYm = bsrpBgnde.substring(0, 6);
    
    this.ds_conduseAmOverChk.clearData();
    this.ds_conduseAmOverChk.addRow();
	this.ds_conduseAmOverChk.setColumn(0, "EMPNO", empno);
	this.ds_conduseAmOverChk.setColumn(0, "BSRP_SEQ", bsrpSeq);
	this.ds_conduseAmOverChk.setColumn(0, "USE_YM", useYm);

	var lastDay  = this.dateUtils.getLastDay(this.gfn_today()).getDate();	//마지막날짜 구하기
	
	var bMonth = this.dateUtils.format(this.gfn_today(),"yyyymm") + "01";
	var eMonth = this.dateUtils.format(this.gfn_today(),"yyyymm")+ lastDay;
	
	var am1 = this.ds_cprCardUseDtls.getCaseSum("USE_DE >= "+bMonth+" && USE_DE <= "+eMonth, "USE_AM");
	var am2 = this.ds_rcipt.getCaseSum("USE_DE >= "+bMonth+" && USE_DE <= "+eMonth, "USE_AM");
	var am3 = this.ds_fxamtPymnt.getCaseSum("USE_DE >= "+bMonth+" && USE_DE <= "+eMonth, "USE_AM");
	
	var useAm = am1 + am2 + am3;
	
	this.ds_conduseAmOverChk.setColumn(0, "USE_AM", useAm);
	
	this.fn_transaction("overChk");
	//return result;
// 	trace("am1 : "+am1+", am2 : "+am2+", am3 : "+am3);
// 	trace("useAm : "+useAm);
}



this.save = function() {
	try{	

		// update check
		if (   !this.comUtils.isDatasetUpdated(this.ds_cprCardUseDtls)	// 법인카드사용내역
		    && !this.comUtils.isDatasetUpdated(this.ds_rcipt)			// 영수증
		    && !this.comUtils.isDatasetUpdated(this.ds_fxamtPymnt)		// 정액지급
		   ) {
			this.gfn_message("comm.데이터.변경.없음");
			return false;
		}
		
		// validation check
		if(!this.gfn_checkValidation_NoUpdChk(this.ds_cprCardUseDtls, this.ds_validation)) {	// 탭1 : 법인카드사용내역
			this.tab_btrpsExcclcDetail.set_tabindex(0);
			return false;
		}
		else if(!this.gfn_checkValidation_NoUpdChk(this.ds_rcipt, this.ds_validation)) {		// 탭2 : 영수증
			this.tab_btrpsExcclcDetail.set_tabindex(1);
			return false;
		}
		else if(!this.gfn_checkValidation_NoUpdChk(this.ds_fxamtPymnt, this.ds_validation)) {	// 탭3 : 정액지급
			this.tab_btrpsExcclcDetail.set_tabindex(2);
			return false;
		}
	}catch(e) {
		alert(e.message);
	}
	
	if(this.gfn_message("confirm.저장.여부"))	{
		saveRow = this.ds_bsrpList.rowposition;
		this.fn_transaction("save");
	}
}
]]></Script>
  </Form>
</FDL>
