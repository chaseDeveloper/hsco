<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\..\default_typedef.xml"/>
  <Form id="HRM070302" classname="HRM070302" left="0" top="0" width="1059" height="735" titletext="월별당직관리" onload="HRM070302_onload" oninit="HRM070302_oninit">
    <Layouts>
      <Layout>
        <Div id="div_search" taborder="0" left="0" top="0" right="28" height="33" cssclass="div_WFSA_Box">
          <Layouts>
            <Layout>
              <Static id="Static06" taborder="73" text="15" visible="false" left="0" top="0" width="15" height="33" style="background:#00ffff66;"/>
              <Static id="sta_gnfdDe" taborder="0" text="기준년월" cssclass="sta_WFSA_Label" left="15" top="5" width="64" height="21"/>
              <Div id="div_monCal" taborder="1" url="common::frmMonCal.xfdl" left="79" top="5" width="84" height="21" async="false"/>
            </Layout>
          </Layouts>
        </Div>
        <Static id="Static36" taborder="2" text="10" visible="false" left="0" top="33" width="1031" height="10" style="background:#dc143c3c;align:center middle;"/>
        <Static id="Static03" taborder="3" text="15" visible="false" left="1031" top="0" width="15" height="735" style="background:#1b3cd23c;align:center middle;"/>
        <Static id="Static04" taborder="4" text="스&#13;&#10;크&#13;&#10;롤&#13;&#10;13" visible="false" top="0" right="0" width="13" height="735" style="background:#d07b173c;align:center middle;"/>
        <Div id="div_work" taborder="1" left="0" top="43" right="28" height="692">
          <Layouts>
            <Layout>
              <Static id="sta_gnfdList" taborder="0" text="월별 당직목록" cssclass="sta_WF_Title02" left="0" top="0" width="98" height="19" style="align:left middle;"/>
              <Static id="Static01" taborder="6" text="5" visible="false" left="0" top="19" width="1031" height="5" style="background:#dc143c3c;align:center middle;"/>
              <Grid id="grd_output" cssclass="grd_WF_calendar" taborder="3" binddataset="ds_grdCalendar" useinputpanel="false" selecttype="area" autofittype="col" left="0" top="24" right="416" height="668" autosizingtype="col" oncellclick="div_work_grd_output_oncellclick">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Column size="147"/>
                      <Column size="147"/>
                      <Column size="147"/>
                      <Column size="147"/>
                      <Column size="147"/>
                      <Column size="147"/>
                      <Column size="147"/>
                    </Columns>
                    <Rows>
                      <Row size="30" band="head"/>
                      <Row size="24"/>
                      <Row size="24"/>
                      <Row size="72"/>
                    </Rows>
                    <Band id="head">
                      <Cell cssclass="cellgrd_WF_headsun" text="일"/>
                      <Cell col="1" text="월"/>
                      <Cell col="2" text="화"/>
                      <Cell col="3" text="수"/>
                      <Cell col="4" text="목"/>
                      <Cell col="5" text="금"/>
                      <Cell col="6" cssclass="cellgrd_WF_headsat" text="토"/>
                    </Band>
                    <Band id="body">
                      <Cell rowspan="3">
                        <Cell style="color:#fa794fff;color2:#fa794fff;font:bold 9 arial;selectfont:bold 9 arial;" cssclass="cellgrd_WF_trailingday" text="bind:DAY0"/>
                        <Cell row="1" style="color:#fa794fff;color2:#fa794fff;font:bold 9 arial;selectfont:bold 9 arial;" cssclass="cellgrd_WF_trailingday" text="bind:DS02"/>
                        <Cell row="2" style="color2: ;" cssclass="cellgrd_WF_trailingday" text="bind:ST02"/>
                      </Cell>
                      <Cell col="1" rowspan="3">
                        <Cell style="font:bold 9 arial;selectfont:bold 9 arial;" cssclass="cellgrd_WF_trailingday" text="bind:DAY1"/>
                        <Cell row="1" style="font:bold 9 arial;selectfont:bold 9 arial;" cssclass="cellgrd_WF_trailingday" text="bind:DS12"/>
                        <Cell row="2" cssclass="cellgrd_WF_trailingday" text="bind:ST12"/>
                      </Cell>
                      <Cell col="2" rowspan="3">
                        <Cell style="font:bold 9 arial;selectfont:bold 9 arial;" cssclass="cellgrd_WF_trailingday" text="bind:DAY2"/>
                        <Cell row="1" style="font:bold 9 arial;selectfont:bold 9 arial;" cssclass="cellgrd_WF_trailingday" text="bind:DS22"/>
                        <Cell row="2" cssclass="cellgrd_WF_trailingday" text="bind:ST22"/>
                      </Cell>
                      <Cell col="3" rowspan="3">
                        <Cell style="font:bold 9 arial;selectfont:bold 9 arial;" cssclass="cellgrd_WF_trailingday" text="bind:DAY3"/>
                        <Cell row="1" style="font:bold 9 arial;selectfont:bold 9 arial;" cssclass="cellgrd_WF_trailingday" text="bind:DS32"/>
                        <Cell row="2" cssclass="cellgrd_WF_trailingday" text="bind:ST32"/>
                      </Cell>
                      <Cell col="4" rowspan="3">
                        <Cell style="font:bold 9 arial;selectfont:bold 9 arial;" cssclass="cellgrd_WF_trailingday" text="bind:DAY4"/>
                        <Cell row="1" style="font:bold 9 arial;selectfont:bold 9 arial;" cssclass="cellgrd_WF_trailingday" text="bind:DS42"/>
                        <Cell row="2" cssclass="cellgrd_WF_trailingday" text="bind:ST42"/>
                      </Cell>
                      <Cell col="5" rowspan="3">
                        <Cell style="font:bold 9 arial;selectfont:bold 9 arial;" cssclass="cellgrd_WF_trailingday" text="bind:DAY5"/>
                        <Cell row="1" style="font:bold 9 arial;selectfont:bold 9 arial;" cssclass="cellgrd_WF_trailingday" text="bind:DS52"/>
                        <Cell row="2" cssclass="cellgrd_WF_trailingday" text="bind:ST52"/>
                      </Cell>
                      <Cell col="6" rowspan="3">
                        <Cell style="color:#34b5eeff;color2:#34b5eeff;font:bold 9 arial;selectfont:bold 9 arial;" cssclass="cellgrd_WF_trailingday" text="bind:DAY6"/>
                        <Cell row="1" style="color:#34b5eeff;color2:#34b5eeff;font:bold 9 arial;selectfont:bold 9 arial;" cssclass="cellgrd_WF_trailingday" text="bind:DS62"/>
                        <Cell row="2" style="color: ;" cssclass="cellgrd_WF_trailingday" text="bind:ST62"/>
                      </Cell>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <Grid id="grd" taborder="7" useinputpanel="false" top="24" width="406" height="668" right="0" binddataset="ds_dt" oncelldblclick="div_work_grd_oncelldblclick" oncellclick="div_work_grd_oncellclick">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Column size="30" band="left"/>
                      <Column size="75" band="left"/>
                      <Column size="0"/>
                      <Column size="65"/>
                      <Column size="30"/>
                      <Column size="70"/>
                      <Column size="80"/>
                      <Column size="60"/>
                      <Column size="50"/>
                      <Column size="50"/>
                      <Column size="50"/>
                    </Columns>
                    <Rows>
                      <Row size="30" band="head"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="선택"/>
                      <Cell col="1" text="날짜"/>
                      <Cell col="2" text="순번"/>
                      <Cell col="3" colspan="3" text="사원"/>
                      <Cell col="6" text="휴일&#13;&#10;구분"/>
                      <Cell col="7" text="당직&#13;&#10;구분"/>
                      <Cell col="8" text="기안"/>
                      <Cell col="9" text="결재"/>
                      <Cell col="10" text="상세"/>
                    </Band>
                    <Band id="body">
                      <Cell displaytype="checkbox" edittype="checkbox" text="bind:CHK"/>
                      <Cell col="1" displaytype="date" style="color:EXPR(HVOF_SE=='000'?'':'red');color2:EXPR(HVOF_SE=='000'?'':'red');selectbackground:#ffffffff;selectcolor:EXPR(HVOF_SE=='000'?'':'red');" text="bind:DT" suppress="1" calendardisplaynulltype="none"/>
                      <Cell col="2" style="color:EXPR(HVOF_SE=='000'?'':'red');color2:EXPR(HVOF_SE=='000'?'':'red');selectcolor:EXPR(HVOF_SE=='000'?'':'red');" text="bind:SEQ"/>
                      <Cell col="3" style="color:EXPR(HVOF_SE=='000'?'':'red');color2:EXPR(HVOF_SE=='000'?'':'red');selectcolor:EXPR(HVOF_SE=='000'?'':'red');" text="bind:EMPNO"/>
                      <Cell col="4" displaytype="combo" style="color:EXPR(HVOF_SE=='000'?'':'red');color2:EXPR(HVOF_SE=='000'?'':'red');selectcolor:EXPR(HVOF_SE=='000'?'':'red');" text="bind:SEXDSTN" combodataset="ds_sexdstn" combocodecol="CODE" combodatacol="CODE_NM"/>
                      <Cell col="5" style="color:EXPR(HVOF_SE=='000'?'':'red');color2:EXPR(HVOF_SE=='000'?'':'red');selectcolor:EXPR(HVOF_SE=='000'?'':'red');" text="bind:EMPNM2"/>
                      <Cell col="6" style="color:EXPR(HVOF_SE=='000'?'':'red');color2:EXPR(HVOF_SE=='000'?'':'red');selectcolor:EXPR(HVOF_SE=='000'?'':'red');" text="bind:HVOF_NM"/>
                      <Cell col="7" displaytype="combo" style="color:EXPR(HVOF_SE=='000'?'':'red');color2:EXPR(HVOF_SE=='000'?'':'red');selectcolor:EXPR(HVOF_SE=='000'?'':'red');" text="bind:BNDT_SE" combodataset="ds_hrm252" combocodecol="CODE" combodatacol="CODE_NM"/>
                      <Cell col="8" displaytype="image" text="bind:DRFT_STS_IMG" tooltiptext="bind:DRFT_DT"/>
                      <Cell col="9" displaytype="image" style="backgroundimage: ;" text="bind:SANCTN_STS_IMG" tooltiptext="bind:LAST_SANCTN_DT"/>
                      <Cell col="10" displaytype="expr:SANCTN_STS &gt;= '1' &amp;&amp; SANCTN_STS != 'NUL' ? 'image' : 'none'" edittype="none" style="align:center;cursor:EXPR(SANCTN_STS &gt;= '1' &amp;&amp; SANCTN_STS != 'NUL' ? 'hand' : 'arrow');" text="URL('theme://images/sanctn/ico_pop_dtl.png')"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <Static id="Static42" taborder="8" text="10" visible="false" left="615" top="24" bottom="0" width="10" style="background:#1b3cd23c;align:center middle;"/>
              <Static id="sta_gnfdList00" taborder="9" text="월별 당직목록" cssclass="sta_WF_Title02" top="0" width="98" height="19" style="align:left middle;" right="307"/>
              <Button id="btn_crePop" taborder="12" text="수당생성" cssclass="btn_WF_Process" top="0" right="0" width="64" height="19" onclick="div_work_btn_crePop_onclick" visible="false"/>
              <Div id="div_cre" taborder="13" top="24" height="114" style="background:#ffffffff;shadow:outer 5,5 10 gray;" visible="false" width="225" right="57">
                <Layouts>
                  <Layout>
                    <Static id="sta_title" taborder="62" text="당직수당생성" cssclass="sta_WF_PopupTitle" left="0" top="0" right="0" height="34" onmousemove="div_print_sta_title_onmousemove" onlbuttondown="div_print_sta_title_onlbuttondown"/>
                    <Button id="btn_destroy" taborder="63" cssclass="btn_WF_PopupClose" top="7" right="14" width="20" height="20" onclick="div_work_div_cre_btn_destroy_onclick"/>
                    <Static id="Static02" taborder="64" text="15" visible="false" top="32" right="0" bottom="-2" width="15" style="background:#1b3cd23c;align:center middle;"/>
                    <Static id="Static05" taborder="65" text="15" visible="false" left="0" top="32" bottom="-2" width="15" style="background:#1b3cd23c;align:center middle;"/>
                    <Static id="Static00" taborder="66" text="10" visible="false" left="15" top="34" right="15" height="10" style="background:#dc143c3c;align:center middle;"/>
                    <Static id="Static03" taborder="67" text="5" visible="false" left="15" top="69" right="15" height="5" style="background:#dc143c3c;align:center middle;"/>
                    <Static id="Static10" taborder="68" text="15" visible="false" left="15" top="99" right="15" height="15" style="background:#1b3cd23c;align:center middle;"/>
                    <Static id="Static08" taborder="73" text="지급일자" cssclass="sta_WFSA_Label" left="21" top="46" width="66" height="21"/>
                    <Calendar id="cal_pymntDe" taborder="74" dateformat="yyyy-MM-dd" cssclass="cal_WF_Essential" left="87" top="46" width="123" height="21"/>
                    <Button id="btn_cre" taborder="75" text="당직수당생성" cssclass="btn_WF_Process" left="15" top="74" width="195" height="25" onclick="div_work_div_cre_btn_cre_onclick"/>
                  </Layout>
                </Layouts>
              </Div>
              <Button id="btn_calendarCancel" taborder="2" text="초기화" onclick="fn_gnfdProcessCancel" cssclass="btn_WF_Process" top="0" right="0" width="53" height="19"/>
              <Button id="btn_autoAdd" taborder="1" text="자동생성" onclick="fn_auto" cssclass="btn_WF_Process" top="0" right="123" width="64" height="19"/>
              <Button id="btn_excel" taborder="10" onclick="btn_excel_onclick" cssclass="btn_WF_Gridexceldn" top="0" right="190" width="25" height="19"/>
              <Button id="btn_dtChg" taborder="11" text="당직변경" cssclass="btn_WF_Process" top="0" right="56" width="64" height="19" onclick="div_work_btn_dtChg_onclick"/>
            </Layout>
          </Layouts>
        </Div>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_tbhrmHvofInfo" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="HVOF_DE" type="STRING" size="256"/>
          <Column id="HVOF_SE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cond00" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="HVOF_DE" type="STRING" size="256"/>
          <Column id="PYMNT_YM" type="STRING" size="256"/>
          <Column id="PYMNT_DE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_data" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="DT00" type="STRING" size="256"/>
          <Column id="DT01" type="STRING" size="256"/>
          <Column id="DT02" type="STRING" size="256"/>
          <Column id="DT10" type="STRING" size="256"/>
          <Column id="DT11" type="STRING" size="256"/>
          <Column id="DT12" type="STRING" size="256"/>
          <Column id="DT20" type="STRING" size="256"/>
          <Column id="DT21" type="STRING" size="256"/>
          <Column id="DT22" type="STRING" size="256"/>
          <Column id="DT30" type="STRING" size="256"/>
          <Column id="DT31" type="STRING" size="256"/>
          <Column id="DT32" type="STRING" size="256"/>
          <Column id="DT40" type="STRING" size="256"/>
          <Column id="DT41" type="STRING" size="256"/>
          <Column id="DT42" type="STRING" size="256"/>
          <Column id="DT50" type="STRING" size="256"/>
          <Column id="DT51" type="STRING" size="256"/>
          <Column id="DT52" type="STRING" size="256"/>
          <Column id="DT60" type="STRING" size="256"/>
          <Column id="DT61" type="STRING" size="256"/>
          <Column id="DT62" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_tbhrmHvofInfoList" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="HVOF_DE" type="STRING" size="256"/>
          <Column id="HVOF_SE" type="STRING" size="256"/>
          <Column id="HVOF_DAY" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_autoBndtSnList" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="EMPNO" type="STRING" size="256"/>
          <Column id="BNDT_SE" type="STRING" size="256"/>
          <Column id="EMPNM" type="STRING" size="256"/>
          <Column id="SEXDSTN" type="STRING" size="256"/>
          <Column id="LAST_BNDT_DE" type="STRING" size="256"/>
          <Column id="SET_CHK" type="STRING" size="256"/>
          <Column id="DT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_dt" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_dt_oncolumnchanged">
        <ColumnInfo>
          <Column id="CHK" type="STRING" size="256"/>
          <Column id="DT" type="STRING" size="256"/>
          <Column id="HVOF_SE" type="STRING" size="256"/>
          <Column id="EMPNO" type="STRING" size="256"/>
          <Column id="BNDT_SE" type="STRING" size="256"/>
          <Column id="EMPNM" type="STRING" size="256"/>
          <Column id="EMPNM2" type="STRING" size="256"/>
          <Column id="SEXDSTN" type="STRING" size="256"/>
          <Column id="HVOF_NM" type="STRING" size="256"/>
          <Column id="SEQ" type="STRING" size="256"/>
          <Column id="DEPT_CODE" type="STRING" size="256"/>
          <Column id="DEPT_NM" type="STRING" size="256"/>
          <Column id="SANCTN_NO" type="STRING" size="256"/>
          <Column id="DRFT_STS" type="STRING" size="256"/>
          <Column id="DRFT_STS_IMG" type="STRING" size="256"/>
          <Column id="DRFT_DT" type="STRING" size="256"/>
          <Column id="SANCTN_STS" type="STRING" size="256"/>
          <Column id="SANCTN_STS_IMG" type="STRING" size="256"/>
          <Column id="LAST_SANCTN_DT" type="STRING" size="256"/>
          <Column id="SANCTN_KND" type="STRING" size="256"/>
          <Column id="REGIST_DT" type="STRING" size="256"/>
          <Column id="WEEK_NM" type="STRING" size="256"/>
          <Column id="TYPE_NM" type="STRING" size="256"/>
          <Column id="MON" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_grdCalendar" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="DAY0" type="STRING" size="256"/>
          <Column id="DAY1" type="STRING" size="256"/>
          <Column id="DAY2" type="STRING" size="256"/>
          <Column id="DAY3" type="STRING" size="256"/>
          <Column id="DAY4" type="STRING" size="256"/>
          <Column id="DAY5" type="STRING" size="256"/>
          <Column id="DAY6" type="STRING" size="256"/>
          <Column id="DS02" type="STRING" size="256"/>
          <Column id="DS12" type="STRING" size="256"/>
          <Column id="DS22" type="STRING" size="256"/>
          <Column id="DS32" type="STRING" size="256"/>
          <Column id="DS42" type="STRING" size="256"/>
          <Column id="DS52" type="STRING" size="256"/>
          <Column id="DS62" type="STRING" size="256"/>
          <Column id="ST02" type="STRING" size="256"/>
          <Column id="ST12" type="STRING" size="256"/>
          <Column id="ST22" type="STRING" size="256"/>
          <Column id="ST32" type="STRING" size="256"/>
          <Column id="ST42" type="STRING" size="256"/>
          <Column id="ST52" type="STRING" size="256"/>
          <Column id="ST62" type="STRING" size="256"/>
          <Column id="SE02" type="STRING" size="256"/>
          <Column id="SE12" type="STRING" size="256"/>
          <Column id="SE22" type="STRING" size="256"/>
          <Column id="SE32" type="STRING" size="256"/>
          <Column id="SE42" type="STRING" size="256"/>
          <Column id="SE52" type="STRING" size="256"/>
          <Column id="SE62" type="STRING" size="256"/>
          <Column id="SN02" type="STRING" size="256"/>
          <Column id="SN12" type="STRING" size="256"/>
          <Column id="SN22" type="STRING" size="256"/>
          <Column id="SN32" type="STRING" size="256"/>
          <Column id="SN42" type="STRING" size="256"/>
          <Column id="SN52" type="STRING" size="256"/>
          <Column id="SN62" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_tmpData" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="DT" type="STRING" size="256"/>
          <Column id="NM" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="DT">20150201</Col>
            <Col id="NM">가나다</Col>
          </Row>
          <Row>
            <Col id="DT">20150202</Col>
            <Col id="NM">라마사</Col>
          </Row>
          <Row>
            <Col id="DT">20150205</Col>
            <Col id="NM">아자차</Col>
          </Row>
          <Row>
            <Col id="DT">20150215</Col>
            <Col id="NM">뷁뛝쀍</Col>
          </Row>
          <Row/>
        </Rows>
      </Dataset>
      <Dataset id="ds_hrm252" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="ETC1" type="string" size="32"/>
          <Column id="VAL2" type="string" size="32"/>
          <Column id="CODE_CN" type="string" size="32"/>
          <Column id="VAL1" type="string" size="32"/>
          <Column id="USE_YN" type="string" size="32"/>
          <Column id="ETC3" type="string" size="32"/>
          <Column id="VAL4" type="string" size="32"/>
          <Column id="ETC2" type="string" size="32"/>
          <Column id="VAL3" type="string" size="32"/>
          <Column id="CODE_ORDR" type="bigdecimal" size="16"/>
          <Column id="MSTK_VAL" type="string" size="32"/>
          <Column id="ALL_CODE_NM" type="string" size="32"/>
          <Column id="CODE_NM" type="string" size="32"/>
          <Column id="INT_VAL" type="string" size="32"/>
          <Column id="GRP_CODE" type="string" size="32"/>
          <Column id="CODE" type="string" size="32"/>
          <Column id="VAL0" type="string" size="32"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_sal008" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="ETC1" type="string" size="32"/>
          <Column id="VAL2" type="string" size="32"/>
          <Column id="CODE_CN" type="string" size="32"/>
          <Column id="VAL1" type="string" size="32"/>
          <Column id="USE_YN" type="string" size="32"/>
          <Column id="ETC3" type="string" size="32"/>
          <Column id="VAL4" type="string" size="32"/>
          <Column id="ETC2" type="string" size="32"/>
          <Column id="VAL3" type="string" size="32"/>
          <Column id="CODE_ORDR" type="bigdecimal" size="16"/>
          <Column id="MSTK_VAL" type="string" size="32"/>
          <Column id="ALL_CODE_NM" type="string" size="32"/>
          <Column id="CODE_NM" type="string" size="32"/>
          <Column id="INT_VAL" type="string" size="32"/>
          <Column id="GRP_CODE" type="string" size="32"/>
          <Column id="CODE" type="string" size="32"/>
          <Column id="VAL0" type="string" size="32"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_approve" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="DATA_VALUE" type="STRING" size="1000"/>
          <Column id="DATA_TITLE" type="STRING" size="256"/>
          <Column id="O_URL" type="STRING" size="256"/>
          <Column id="I_KEY" type="STRING" size="256"/>
          <Column id="KEY" type="STRING" size="256"/>
          <Column id="DEPT_CD" type="STRING" size="256"/>
          <Column id="EMP_CD" type="STRING" size="256"/>
          <Column id="TITLE" type="STRING" size="256"/>
          <Column id="DT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_sexdstn" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="CODE_NM" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="CODE"/>
            <Col id="CODE_NM">전체</Col>
          </Row>
          <Row>
            <Col id="CODE">1</Col>
            <Col id="CODE_NM">남자</Col>
          </Row>
          <Row>
            <Col id="CODE">2</Col>
            <Col id="CODE_NM">여자</Col>
          </Row>
        </Rows>
      </Dataset>
    </Objects>
    <Script type="xscript5.0"><![CDATA[/***********************************************************************
 * 업무구분 : MIS > 인사관리 > 월별당직관리
 * 화면ID   : HRM070302
 * 화면명   : 월별당직관리
 * 화면설명 : 월별당직을 관리한다.
 * 작성일   : 2015.10.20
 * 작성자   : 이혜선
 * 수정이력 : 
 ***********************************************************************
 *     수정일     수정자   내용
 ***********************************************************************
 *    
 *   
 ***********************************************************************
 */
 

/***********************************************************************
 * Script Include 
 ***********************************************************************/
// 시스템 공통 라이브러리 Include
include "lib::comInclude.xjs";
include "mis_lib::misUtil.xjs";


/***********************************************************************
 * 화면 변수 선언부
 ***********************************************************************/
this.fv_CurYear = 0;
this.fv_CurMonth = "";
var vCol ="";
var bndtSe="";
var bndtDe="";
var empno="";

this.checkDs = [
  this.ds_dt
];



/***********************************************************************
 * onInit / onLoad 영역
 ***********************************************************************/

this.HRM070302_oninit = function(obj:Form, e:nexacro.InitEventInfo)
{
	this.fn_init_form();
	this.fn_init_dataset();
}


this.HRM070302_onload = function(obj:Form, e:nexacro.LoadEventInfo)
{
	this.div_search.div_monCal.fn_setBind("ds_cond00","HVOF_DE");
	
	this.ds_cond00.setColumn(0, "HVOF_DE",this.gfn_today().substr(0,6));
	this.div_search.div_monCal.msk_mon.set_cssclass("msk_WF_Essential");
	
	// 공통코드
	var comboParams = [
	    ["ds_hrm252", "_HRM252", "Y", "D", "B"]	// ds_hrm252 : 당직구분
	];
	
	this.div_work.div_cre.cal_pymntDe.set_value(this.dateUtils.format(this.gfn_today(),"yyyymm") + "01");	
	
	var callback = function (svcId, errorCode, errorMsg) {
		
		this.fn_search();	//  최초조회
	};
	this.gfn_comboLoad (comboParams, callback);
	
	
}



/***********************************************************************
 * Form 오브젝트 초기화
 ***********************************************************************/ 

this.fn_init_form = function()
{
	this.gfn_initForm(this);
	this.fn_misFormInit(this);
}



/***********************************************************************
 * Dataset 오브젝트 초기화
 ***********************************************************************/ 

this.fn_init_dataset = function()
{
	this.gfn_initCondDs(this, this.div_search);
}



/***********************************************************************
* Transaction 영역 시작
************************************************************************/

/***********************************************************************
 * Transaction 관련 이벤트 핸들러 
 **********************************************************************/

/*
 * 함수명  	: fn_search
 * 설명 		: 월별당직관리 캘린더조회 이벤트 처리              
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_search();
 */
this.fn_search = function()
{
 	this.ds_tbhrmHvofInfo.clearData();
    this.ds_dt.clearData();
    this.ds_autoBndtSnList.clearData();
    this.fn_transaction("selectDalyBndtList");
}

/*
 * 함수명  	: fn_sanction
 * 설명 		: 결재 버튼 이벤트 처리
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_sanction();
 */
this.fn_sanction = function(obj:Button,  e:nexacro.ClickEventInfo)
{	
	// 전자결재 상태 체크 2016.7
	// 기안상태 COM022 (0:기안전 1:기안 9:기안오류)
	// 결재상태 COM023 (1: 진행 2:보류 4:대기 8:협조대기 32:삭제 256:완료 512:반송 4096:취소 1024:참조 NUL:상신전 DUP:결재중복)
	// 기안전인것 : 재상신 및 수정/삭제
	// 결재상태가 상신전 외는 신규로 다시 진행.
	var SANCTN_STS = this.ds_dt.getColumn(0, "SANCTN_STS");
	//alert("SANCTN_STS = " + SANCTN_STS)
	switch (SANCTN_STS) {
		case "1": case "2": case "4": case "8": case "1024": case "DUP":
		this.gfn_message("comm.결재.진행");
		return false;
		
		case "32": case "256": case "512": case "4096": 
		this.gfn_message("comm.결재.완료");
		return false;
		
		default:
	}
	
	if(Ex.util.isUpdated(this.ds_tbhrmHvofInfo)){
		this.gfn_message("comm.정보.저장.요청", "수정된");
		return false;
	}
	
	var stdrYM = this.ds_dt.getColumn(0, "DT");
	var dataTitle = stdrYM.substr(0, 4) + '년 ' + stdrYM.substr(4, 2) + '월 당직근무명령';
	var title     = stdrYM.substr(0, 4) + '년 ' + stdrYM.substr(4, 2) + '월 당직근무명령';
	
	this.ds_approve.clearData();
	var nRow = this.ds_approve.addRow();
	this.ds_approve.setColumn(nRow, "TITLE"         , title);
	this.ds_approve.setColumn(nRow, "DATA_TITLE"    , dataTitle);
	this.ds_approve.setColumn(nRow, "DATA_VALUE"    , "");
	this.ds_approve.setColumn(nRow, "DEPT_CD"       , this.gfn_getDeptId());
	this.ds_approve.setColumn(nRow, "EMP_CD"        , this.fn_getEmpno());
	this.ds_approve.setColumn(nRow, "DT", this.ds_dt.getColumn(0, "DT"));
	
	if(this.gfn_message("comm.행위여부", "결재를 상신"))	{
		this.fn_transaction("approve");
	}
}

/*********************************************************************
 * CALL TRANSACTION 영역
**********************************************************************/

this.fn_transaction = function(strSvcId)
{
	switch (strSvcId) {
		case "selectDalyBndtList": //조회
			var sController   	= "hsco/mis/hrm/HRM070302/selectDalyBndtList.do";
			var sInDatasets   	= "input1=ds_cond00";
			var sOutDatasets  	= "ds_dt=output1";
			break;
		case "selectAutoBndtSnList": //자동생성
			var sController   	= "hsco/mis/hrm/HRM070302/autoBndtSnList.do";
			var sInDatasets   	= "input1=ds_cond00";
			var sOutDatasets  	= "ds_autoBndtSnList=output1 ds_dt=output2";
			break;
		case "saveAutoBndtSnList": //저장
			var sController   	= "hsco/mis/hrm/HRM070302/saveAutoBndtSnCUD.do";
			var sInDatasets   	= "input1=ds_dt:U";
			var sOutDatasets  	= "";
			break;
		case "approve":					// 전자결재
			var sController   	= "hsco/mis/hrm/HRM070302/approve.do";	
			var sInDatasets   	= "input1=ds_approve";
			var sOutDatasets  	= "ds_approve=output1";
			break;	
		case "saveBndtPymnt":
			var sController   	= "hsco/mis/hrm/HRM070302/saveBndtPymnt.do";	
			var sInDatasets   	= "input1=ds_cond00";
			var sOutDatasets  	= "";
			break;				
	}
	Ex.core.tran(this, strSvcId, sController, sInDatasets, sOutDatasets); 
}



/**********************************************************************
 * Transaction Callback 영역
***********************************************************************/

this.fn_callBack = function (strSvcId, nErrorCode, strErrorMsg)
{
	// 오류 및 성공 메시지를 화면에 보여준다.
	if(nErrorCode != 0) {
	  this.gfn_callback_message(strSvcId, nErrorCode, strErrorMsg);
	}
	if(nErrorCode == 0) {
		switch (strSvcId) {	
		 	case "selectDalyBndtList": //조회
				this.fn_drawCalendar(); //캘린더그리기
				break;
 			case "selectAutoBndtSnList": // 자동생성
				this.fn_setDalyBndtList();
 				break;	
 			 case "saveAutoBndtSnList": // 저장
				//this.gfn_message("success.처리.성공");
				this.fn_search(); 
 				break;	
 			case "approve":					// 전자결재
				var sanctnNO = this.ds_approve.getColumn(0, "SANCTN_NO");				
				var oUrl = this.ds_approve.getColumn(0, "O_URL");
				system.execBrowser(oUrl);
				this.fn_search(); 
				break;
			case "saveBndtPymnt":
				this.gfn_message("success.처리.성공");
				break;
		}
	}
}


 /*
 * 함수명  	: fn_callback1
 * 설명 		: 팝업 콜백           
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_callback1();
 */
 this.fn_callback1 = function(sPopupId, sReturn)
{
	if(sPopupId == "Popup1") {	
		var dsEmpno = new Dataset();
		nRowCnt = dsEmpno.loadXML(sReturn);
        if(nRowCnt){
			var aRow = this.ds_dt.addRow();
			this.ds_dt.setColumn(aRow,"DT",bndtDe);
			this.ds_dt.setColumn(aRow,"BNDT_SE",dsEmpno.getColumn(0, "BNDT_SE"));
			this.ds_dt.setColumn(aRow,"EMPNO",dsEmpno.getColumn(0, "EMPNO"));
		}
    }
	this.fn_transaction("saveAutoBndtSnList"); //저장
}



 /***********************************************************************
* 사용자 정의 함수
************************************************************************/

/*
 * 함수명  	: fn_auto
 * 설명 		: 자동생성 버튼       
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_auto();
 */
this.fn_auto = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	// 전자결재 상태 체크 2016.7
	// 기안상태 COM022 (0:기안전 1:기안 9:기안오류)
	// 결재상태 COM023 (1: 진행 2:보류 4:대기 8:협조대기 32:삭제 256:완료 512:반송 4096:취소 1024:참조 NUL:상신전 DUP:결재중복)
	// 기안전인것 : 재상신 및 수정/삭제
	// 결재상태가 상신전 외는 신규로 다시 진행.
	var SANCTN_STS = this.ds_dt.getColumn(0, "SANCTN_STS");
	//alert("SANCTN_STS = " + SANCTN_STS)
	switch (SANCTN_STS) {
		case "1": case "2": case "4": case "8": case "1024": case "DUP":
		this.gfn_message("comm.결재.진행");
		return false;
		
		case "32": case "256": case "512": case "4096": 
		this.gfn_message("comm.결재.완료");
		return false;
		
		default:
	}
	
	this.ds_dt.deleteAll();
	this.fn_transaction("selectAutoBndtSnList");
}


/*
 * 함수명  	: fn_gnfdProcessCancel
 * 설명 		: 초기화 버튼       
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_gnfdProcessCancel();
 */
this.fn_gnfdProcessCancel = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	// 전자결재 상태 체크 2016.7
	// 기안상태 COM022 (0:기안전 1:기안 9:기안오류)
	// 결재상태 COM023 (1: 진행 2:보류 4:대기 8:협조대기 32:삭제 256:완료 512:반송 4096:취소 1024:참조 NUL:상신전 DUP:결재중복)
	// 기안전인것 : 재상신 및 수정/삭제
	// 결재상태가 상신전 외는 신규로 다시 진행.
	var SANCTN_STS = this.ds_dt.getColumn(0, "SANCTN_STS");
	//alert("SANCTN_STS = " + SANCTN_STS)
	switch (SANCTN_STS) {
		case "1": case "2": case "4": case "8": case "1024": case "DUP":
		this.gfn_message("comm.결재.진행");
		return false;
		
		case "32": case "256": case "512": case "4096": 
		this.gfn_message("comm.결재.완료");
		return false;
		
		default:
	}
	
	this.ds_dt.deleteAll();
	this.fn_transaction("saveAutoBndtSnList");
}


/*
 * 함수명  	: fn_drawCalendar
 * 설명 		: 달력그리기 함수           
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_drawCalendar();
 */
this.fn_drawCalendar = function()
{
	var i, nCellPos, nNewRow, colid;
	// 그리드 내부 데이터셋 비움
	this.ds_grdCalendar.clearData();
	var strYearMonth = this.div_search.div_monCal.getValue("YYYYMM");						// 년월 201510
	var objDate = new Date(this.div_search.div_monCal.getValue("YYYY")+"-"+this.div_search.div_monCal.getValue("MM")+"-01");							// value 말고 text
    var nStartDay = objDate.getDay();					// 요일
	var nLastDay     = this.dateUtils.getLastDay(objDate).getDate();	// 해당 연월의 마지막일 체크
	
	// 1행부터 시작
	nNewRow = this.ds_grdCalendar.addRow();
	
	for (var i = 1, nCellPos = nStartDay ; i <= nLastDay ; i++) {
		// 날짜 세팅
		this.ds_grdCalendar.setColumn(nNewRow, "DAY" + nCellPos, i);
		
		if(this.ds_dt.getRowCount!=0){
		
			var dt=strYearMonth + (i+"").padLeft(2,"0");
			var cnt=0;
			var emp ="";
			for(var j=0; j<this.ds_dt.rowcount;j++){
				if(this.ds_dt.getColumn(j,"DT")==dt){
					var nm = this.ds_dt.getColumn(j, "HVOF_NM");
					this.ds_grdCalendar.setColumn(nNewRow, "DS" + nCellPos + "2", nm);
					this.ds_grdCalendar.setColumn(nNewRow, "SE" + nCellPos + "2", this.ds_dt.getColumn(j, "BNDT_SE"))
					emp = emp + this.ds_dt.getColumn(j, "EMPNM")+"\n";
					this.ds_grdCalendar.setColumn(nNewRow, "ST" + nCellPos + "2", emp);
					var empno = this.ds_dt.getColumn(j, "EMPNO");
					this.ds_grdCalendar.setColumn(nNewRow, "SN" + nCellPos + "2", empno);
					;
				}
			}
		}
		// 셀 위치 선정(주 단위로 나누어 위치 확인)
		nCellPos = (nCellPos + 1) % 7;
		
		// 요일이 끝나는날이, 마지막 날짜가 아닌 경우
		if (nCellPos == 0 && i != nLastDay) {
			nNewRow = this.ds_grdCalendar.addRow();	// 행 추가(아직 1달이 지나지 않았으므로)
		}
	}
}


/*
 * 함수명  	: fn_setDalyBndtList
 * 설명 		: 리스트만들기        
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_setDalyBndtList();
 */
this.fn_setDalyBndtList = function()
{
	this.ds_grdCalendar.clearData();
	var empNoArray = new Array();

	for(var iRow=0; iRow<this.ds_dt.getRowCount(); iRow++){
		var iDt     = this.ds_dt.getColumn(iRow,"DT");		// 당직근무일자
		var iHvofSe = this.ds_dt.getColumn(iRow,"HVOF_SE");	// 휴무구분(ex:유급휴일,법정공휴일,근로자의날 등)
		var iHvofNm = this.ds_dt.getColumn(iRow,"HVOF_NM");	// 휴무구분명
		var bCnt1 = 0;
		var bCnt2 = 0;
		var bCnt3 = 0;

		for(var jRow=0; jRow<this.ds_autoBndtSnList.getRowCount(); jRow++) {

			var bndtSe  = this.ds_autoBndtSnList.getColumn(jRow,"BNDT_SE"); //당직구분
			var sexdstn = this.ds_autoBndtSnList.getColumn(jRow,"SEXDSTN"); //성별구분 (1:남자 , 2:여자)
			var setChk  = this.ds_autoBndtSnList.getColumn(jRow,"SET_CHK");
			
			var jEmpno  = this.ds_autoBndtSnList.getColumn(jRow,"EMPNO");
			var jEmpnm  = this.ds_autoBndtSnList.getColumn(jRow,"EMPNM");
			
			//한달에 중복으로 2번 당직 또는 일직 담당이 안되게 중복 체크
			var isDuplicate = false;		
			for(var k=0; k<=empNoArray.length; k++){
				if(empNoArray[k] == jEmpno){
					isDuplicate = true;
				}
			}
			//201701월 명절 일직자들 제외
			if(this.ds_cond00.getColumn(0, "HVOF_DE") == '201701'){
				if(jEmpno == "19910106" || jEmpno == "19910089" || jEmpno == "19890056" || jEmpno == "19900068" || jEmpno == "19910095" || jEmpno == "19940153" || jEmpno == "19910105" || jEmpno == "19880020"){
					isDuplicate = true;
				}
			}
			
			if(isDuplicate){
				continue;
			}

			// 001유급휴일 002법정공휴일 020창립기념일 030근로자의날
			if(bCnt1 < 2 && (iHvofSe == "001" || iHvofSe == "002" || iHvofSe == "020" || iHvofSe == "030" || (this.ds_cond00.getColumn(0, "HVOF_DE") == '201701' && iHvofSe == "040") )){
			
				// 000일직 && 남자 && 남Row이상인 경우
				if(bndtSe=="000" && sexdstn=="1" && setChk!="1" ){
					var sRow = iRow;
					if(bCnt1 ==1){
						sRow = this.ds_dt.insertRow(iRow+1);
						this.ds_dt.setColumn(sRow,"DT",      iDt    );
						this.ds_dt.setColumn(sRow,"HVOF_SE", iHvofSe);
						this.ds_dt.setColumn(sRow,"HVOF_NM", iHvofNm);
						this.ds_autoBndtSnList.setColumn(jRow,"SET_CHK","1");
						iRow++;
					}
					this.ds_dt.setColumn(sRow,"EMPNO",   jEmpno);
					this.ds_dt.setColumn(sRow,"EMPNM",   jEmpnm);
					this.ds_dt.setColumn(sRow,"SEXDSTN", sexdstn);
					this.ds_dt.setColumn(sRow,"BNDT_SE", bndtSe);
					this.ds_autoBndtSnList.setColumn(jRow, "SET_CHK", "1");
					empNoArray.push(jEmpno);
					bCnt1++;
				}
				
				// 000일직 && 여자 && 여Row이상인 경우
				else if(bndtSe=="000" && sexdstn=="2" && setChk!="1" && bCnt1 != 1) {
					var sRow = iRow;
					if(bCnt1 ==1) {
						sRow = this.ds_dt.insertRow(iRow+1);
						this.ds_dt.setColumn(sRow,"DT",      iDt    );
						this.ds_dt.setColumn(sRow,"HVOF_SE", iHvofSe);
						this.ds_dt.setColumn(sRow,"HVOF_NM", iHvofNm);
						this.ds_autoBndtSnList.setColumn(jRow, "SET_CHK", "1");
						iRow++;
					}
						
					this.ds_dt.setColumn(sRow, "EMPNO",   jEmpno);
					this.ds_dt.setColumn(sRow, "EMPNM",   jEmpnm);
					this.ds_dt.setColumn(sRow, "SEXDSTN", sexdstn);
					this.ds_dt.setColumn(sRow, "BNDT_SE", bndtSe);
						
					this.ds_autoBndtSnList.setColumn(jRow, "SET_CHK", "1");
					empNoArray.push(jEmpno);
					bCnt1++;
				}
			}
			// 040명절
			else if(bCnt2 < 4 && iHvofSe == "040" && this.ds_cond00.getColumn(0, "HVOF_DE") != '201701') {
				// 000일직 && 남자 && 남Row이상인 경우
				if(bndtSe=="000" && sexdstn=="1" && setChk!="1"){
					var sRow = iRow;
					if(bCnt2 ==1 || bCnt2 ==2 || bCnt2 ==3){
						sRow = this.ds_dt.insertRow(iRow+1);
						this.ds_dt.setColumn(sRow,"DT",      iDt    );
						this.ds_dt.setColumn(sRow,"HVOF_SE", iHvofSe);
						this.ds_dt.setColumn(sRow,"HVOF_NM", iHvofNm);
						this.ds_autoBndtSnList.setColumn(jRow, "SET_CHK", "1");
						iRow++;
					}
					this.ds_dt.setColumn(sRow,"EMPNO",   jEmpno);
					this.ds_dt.setColumn(sRow,"EMPNM",   jEmpnm);
					this.ds_dt.setColumn(sRow,"SEXDSTN", sexdstn);
					this.ds_dt.setColumn(sRow,"BNDT_SE", bndtSe);
					
					this.ds_autoBndtSnList.setColumn(jRow, "SET_CHK", "1");
					empNoArray.push(jEmpno);
					bCnt2++;
				}
				//000일직 && 여자 && 여Row이상인 경우
				else if(bndtSe=="000" && sexdstn=="2" && setChk!="1"){
					var sRow = iRow;
					if(bCnt2 ==1 || bCnt2 ==2 || bCnt2 ==3){
						sRow = this.ds_dt.insertRow(iRow+1);
						this.ds_dt.setColumn(sRow,"DT",      iDt    );
						this.ds_dt.setColumn(sRow,"HVOF_SE", iHvofSe);
						this.ds_dt.setColumn(sRow,"HVOF_NM", iHvofNm);
						this.ds_autoBndtSnList.setColumn(jRow, "SET_CHK", "1");
						iRow++;
					}
					this.ds_dt.setColumn(sRow, "EMPNO",   jEmpno);
					this.ds_dt.setColumn(sRow, "EMPNM",   jEmpnm);
					this.ds_dt.setColumn(sRow, "SEXDSTN", sexdstn);
					this.ds_dt.setColumn(sRow, "BNDT_SE", bndtSe);
					
					this.ds_autoBndtSnList.setColumn(jRow, "SET_CHK", "1");
					empNoArray.push(jEmpno);
					bCnt2 ++;
				}
			}
			// 000 정상근무
			else if(bCnt3 < 1 && iHvofSe == "000") {
				// 001당직 && 남자 && 남Row이상인 경우
				if(bndtSe=="001" && sexdstn=="1" && setChk!="1"){
					this.ds_dt.setColumn(iRow, "EMPNO",   jEmpno);
					this.ds_dt.setColumn(iRow, "EMPNM",   jEmpnm);
					this.ds_dt.setColumn(sRow,"SEXDSTN", sexdstn);
					this.ds_dt.setColumn(iRow, "BNDT_SE", bndtSe);
					this.ds_autoBndtSnList.setColumn(jRow, "SET_CHK", "1");
					empNoArray.push(jEmpno);
					bCnt3 ++;
				}
			}
		}
	}
	
	// 자동생성은 무조건 신규행으로 추가되어야 함
	this.ds_dt.set_updatecontrol(false);
	for(var fRow = 0; fRow < this.ds_dt.getRowCount(); fRow++) {
		this.ds_dt.setRowType(fRow, Dataset.ROWTYPE_INSERT);
	}
	this.ds_dt.set_updatecontrol(true);
	
	//this.fn_drawCalendar();
	this.fn_transaction("saveAutoBndtSnList"); //저장
}


/*
 * 함수명  	: div_work_grd_output_oncellclick
 * 설명 		: 그리드 셀클릭시 팝업호출         
 * params  		: None
 * return Type 	: None
 * 사용법		: this.div_work_grd_output_oncellclick();
 */
 this.div_work_grd_output_oncellclick = function(obj:Grid, e:nexacro.GridClickEventInfo)
{
	var strYearMonth = this.div_search.div_monCal.getValue("YYYYMM")
	bndtSe = this.ds_grdCalendar.getColumn(this.ds_grdCalendar.rowposition,"SE"+e.col+"2");
	empno = this.ds_grdCalendar.getColumn(this.ds_grdCalendar.rowposition,"SN"+e.col+"2");
	var day = this.ds_grdCalendar.getColumn(this.ds_grdCalendar.rowposition,"DAY"+e.col);
	var cnt =0;
	var dt = strYearMonth + (day+"").padLeft(2,"0");
	bndtDe = dt;
	
	for(var i=0; i<this.ds_dt.rowcount; i++){
		if(this.ds_dt.getColumn(i,"DT")==dt){
			cnt = cnt+1;
		}
	}
	if(!day){ //캘린더에서 날짜가 없는날은 아무동작안함
		return false;
	}
	if(!bndtSe){
		for(var i=0; i<this.ds_dt.rowcount; i++){
			if(this.ds_dt.getColumn(i,"DT")==dt){
				if(this.ds_dt.getColumn(i,"HVOF_SE") != "000"){ //휴무구분이 000(정상근무)이 아니면 당직구분 다000(일직) 으로
					bndtSe = "000";
				}
				else{
					bndtSe = "001";
				}
			}
		}
	}
	if(bndtSe=="000"){//일직
		if(cnt>=2){ //2명이상 등록할수없어
			this.gfn_message("info.처리불가","등록할 수 없습니다.");
			return false;
		}
	}
	else if(bndtSe=="001"){//당직
		if(empno!=" "){ //비어있을때 1개만 등록가능
			this.gfn_message("info.처리불가","등록할 수 없습니다.");
			return false;
		}
	}
	
	var parm = {
		arg_0 : this,  //==> 필수, 팝업을 호출하는 form을 참조할 수 있도록 팝업에 Argument로 넘겨준다. (반드시 기술해야 함.)
		arg_1 : null,
		arg_2 : bndtSe,
		arg_3 : null
	};
	this.gfn_popup("Popup1", 500,500, "당직자 선택", parm, "mis_hrm::HRM070301_P1.xfdl", "fn_callback1");
}

/*
 * 함수명  	: div_work_btn_excel_onclick
 * 설명 		: 엑셀 다운로드 이벤트 처리
 * params  		: None
 * return Type 	: None
 * 사용법		: this.div_work_btn_excel_onclick();
 */
this.btn_excel_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	this.gfn_exportExcel(this.div_work.grd, "exportExl");
}

this.ds_dt_oncolumnchanged = function(obj:Dataset, e:nexacro.DSColChangeEventInfo)
{
	
	if(e.columnid == "CHK") {
		if(e.newvalue == "1") {
			for(var i=0;i<this.ds_dt.rowcount;i++) {
				if(i!=e.row) this.ds_dt.setColumn(i,"CHK","0");
			}
		}
	}
}

this.div_work_btn_dtChg_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	this.fn_dtChg();
}

this.fn_dtChg = function()
{
	var _selRow = -1;
	
	for(var i=0;i<this.ds_dt.rowcount;i++) {
		if(this.ds_dt.getColumn(i,"CHK") == "1") {
			_selRow = i;
			break;
		}
	}
	
	if(_selRow == -1) {
		this.gfn_message("info.처리불가","당직변경 대상자을 선택해주세요.");
		return;
	}
	
	if(this.ds_dt.getColumn(_selRow,"EMPNO") == "") {
		this.gfn_message("info.처리불가","현 당지자가 지정되어 있지 않습니다. 당직변경할 수 없습니다.");
		return;
	}
	
	var parm = {
		arg_0 : this,  //==> 필수, 팝업을 호출하는 form을 참조할 수 있도록 팝업에 Argument로 넘겨준다. (반드시 기술해야 함.)
		arg_1 : null,
		arg_2 : this.ds_dt.getColumn(_selRow,"BNDT_SE"),
		arg_3 : null
	};
	this.gfn_popup("PopupdtChg", 500,500, "당직자 변경 선택", parm, "mis_hrm::HRM070301_P1.xfdl", "fn_callbackdtChg");
}

 /*
 * 함수명  	: fn_callback1
 * 설명 		: 팝업 콜백           
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_callback1();
 */
 this.fn_callbackdtChg = function(sPopupId, sReturn)
{
	if(sPopupId == "PopupdtChg") {	
		var dsEmpno = new Dataset();
		nRowCnt = dsEmpno.loadXML(sReturn);
		var _selRow = -1;
		
		for(var i=0;i<this.ds_dt.rowcount;i++) {
			if(this.ds_dt.getColumn(i,"CHK") == "1") {
				_selRow = i;
				break;
			}
		}
        if(nRowCnt){
	
			if(_selRow == -1) {
				this.gfn_message("info.처리불가","당직변경 대상자을 선택해주세요.");
				return;
			}
			
			var aRow = this.ds_dt.addRow();
			this.ds_dt.setColumn(aRow,"DT", this.ds_dt.getColumn(_selRow,"DT"));
			this.ds_dt.setColumn(aRow,"BNDT_SE", dsEmpno.getColumn(0, "BNDT_SE"));
			this.ds_dt.setColumn(aRow,"EMPNO", dsEmpno.getColumn(0, "EMPNO"));
			this.ds_dt.deleteRow(_selRow);
			
			this.fn_transaction("saveAutoBndtSnList"); // 저장
		} else {
			this.ds_dt.setColumn(_selRow,"CHK","0");
		}
    }
}

this.div_work_grd_oncelldblclick = function(obj:Grid, e:nexacro.GridClickEventInfo)
{
	/*
	// 당직변경
	this.ds_dt.getColumn(e.row,"CHK")
	this.ds_dt.setColumn(e.row,"CHK","1");

	this.fn_dtChg();
	*/
}

/*
 * 함수명  	: fn_print
 * 설명 		: 발행대장 출력
 * params  		: None
 * return Type 	: None
 * 사용법		: this.fn_print();
 */
this.fn_print = function()
{
	var vOpts = new this.cf_Opts();
	vOpts.setToolbar(false);
	vOpts.setScale(100);
	//vOpts.setReportPath("/mis/hrm/HRM030502_R1.jrf");
	vOpts.setReportPath("/mis/hrm/HRM070302_R1.jrf");
	vOpts.setSaveFilename("월별 당직목록");
	vOpts.setArgs("HVOF_DE", this.ds_cond00.getColumn(0, "HVOF_DE"));
	vOpts.setLocalDs(["ds_crtfList", this.ds_dt]);
	
	var parm = {
		arg_0 : this,
		opts : vOpts
	};
	this.gfn_popup("Popup_Report", 884, 735, "월별 당직목록", parm, "common::frmReportPopup.xfdl", "report_callback");
}



this.div_work_grd_oncellclick = function(obj:Grid, e:nexacro.GridClickEventInfo)
{
	//전자결재 진행현황 보기 버튼 이벤트 2016.08.26
	if(e.col == 10){
 	    
 	    var SANCTN_NO = this.ds_dt.getColumn(this.ds_dt.rowposition, "SANCTN_NO");
		var SANCTN_STS = this.ds_dt.getColumn(this.ds_dt.rowposition, "SANCTN_STS");
		//공통요청 2016.08.30
		var REGIST_DT = this.ds_dt.getColumn(this.ds_dt.rowposition, "REGIST_DT");
		//if( this.comUtils.isNullEmpty(SANCTN_NO) || SANCTN_STS < 1 || SANCTN_STS == 'NUL' ){
		if( SANCTN_STS < 1 || SANCTN_STS == 'NUL' ){
			return;
		}
		
		this.popupSactionStts(SANCTN_NO,REGIST_DT);
 	    
	}
}

//전자결재정보 조회 팝업 2016.08.26
this.popupSactionStts = function(sanctnNo,REGIST_DT){
    var parm = {
		arg_0 : this,  
		arg_1 : sanctnNo,
		arg_2 : REGIST_DT	//공통요청 2016.08.30
	};

	this.gfn_popup("COM010400_P01", 710, 580, "전자결재진행 현황", parm, "com::COM010400_P01.xfdl", "fn_callback2");
}



this.div_work_btn_crePop_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	this.div_work.div_cre.set_visible(true);		
}

this.div_work_div_cre_btn_destroy_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	this.div_work.div_cre.set_visible(false);
}

this.div_work_div_cre_btn_cre_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
			
	if(!this.div_work.div_cre.cal_pymntDe.value){
		this.alert("지급일자를 입력하세요");
		return;
	}		
	
	if ( application.confirm( this.div_search.div_monCal.getValue() + " 월 당직수당을 생성 하시겠습니까?\n(기존 생성자료는 삭제됩니다.)" ) ) {
		this.ds_cond00.setColumn(0,"PYMNT_YM",	this.div_search.div_monCal.getValue());
		this.ds_cond00.setColumn(0,"PYMNT_DE",	this.div_work.div_cre.cal_pymntDe.value);
		this.fn_transaction("saveBndtPymnt");
	} else {
		return;
	}
}
]]></Script>
  </Form>
</FDL>
