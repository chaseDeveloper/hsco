(function(){return function(){if(!this._is_form){return;}this.on_create=function(){var _a=null;if(Form==this.constructor){this.set_name("prjFiles");this.set_classname("prjFiles");this.set_titletext("첨부 목록");this._setFormPosition(0,0,300,400);}_a=new Dataset("ds_files",this);_a.set_useclientlayout("1");_a._setContents("<ColumnInfo><Column id=\"FILE_SN\" type=\"BIGDECIMAL\" size=\"21\"/><Column id=\"FILE_ORDR\" type=\"BIGDECIMAL\" size=\"4\"/><Column id=\"FILE_NM\" type=\"STRING\" size=\"255\"/><Column id=\"EXT\" type=\"STRING\" size=\"20\"/><Column id=\"VAL0\" type=\"STRING\" size=\"100\"/><Column id=\"VAL1\" type=\"STRING\" size=\"100\"/><Column id=\"OTHBC_YN\" type=\"STRING\" size=\"1\"/></ColumnInfo>");this.addChild(_a.name,_a);_a=new Dataset("ds_validation",this);_a._setContents("<ColumnInfo><Column id=\"compId\" type=\"STRING\" size=\"256\"/><Column id=\"colId\" type=\"STRING\" size=\"256\"/><Column id=\"PK\" type=\"STRING\" size=\"256\"/><Column id=\"notNull\" type=\"STRING\" size=\"256\"/><Column id=\"type\" type=\"STRING\" size=\"256\"/><Column id=\"nlength\" type=\"STRING\" size=\"256\"/><Column id=\"from\" type=\"STRING\" size=\"256\"/><Column id=\"to\" type=\"STRING\" size=\"256\"/><Column id=\"lengthChkGb\" type=\"STRING\" size=\"256\"/><Column id=\"msgId\" type=\"STRING\" size=\"256\"/><Column id=\"expr\" type=\"STRING\" size=\"256\"/><Column id=\"func\" type=\"STRING\" size=\"256\"/></ColumnInfo><Rows><Row><Col id=\"compId\"/><Col id=\"colId\"/><Col id=\"notNull\"/><Col id=\"msgId\"/></Row></Rows>");this.addChild(_a.name,_a);_a=new Dataset("ds_cond1",this);_a._setContents("<ColumnInfo><Column id=\"FILE_SN\" type=\"BIGDECIMAL\" size=\"21\"/><Column id=\"FILE_ORDR\" type=\"BIGDECIMAL\" size=\"4\"/></ColumnInfo>");this.addChild(_a.name,_a);_a=new Dataset("ds_fileSn",this);_a._setContents("");this.addChild(_a.name,_a);_a=new Dataset("ds_PRJ010",this);_a._setContents("");this.addChild(_a.name,_a);_a=new Static("sta_gud_v01","absolute","0","0","10",null,null,"0",this);_a.style.set_background("#1b3cd23c");_a.style.set_align("center middle");_a.set_text("10");_a.set_visible("0");this.addChild(_a.name,_a);_a=new Grid("grd_Files","absolute","10","29",null,null,"0","0",this);_a.set_taborder("1");_a.set_binddataset("ds_files");_a.getSetter("autofittype2").set("col");_a._setContents("<Formats><Format id=\"default\"><Columns><Column size=\"20\"/><Column size=\"30\"/><Column size=\"80\"/><Column size=\"0\"/><Column size=\"120\"/><Column size=\"40\"/></Columns><Rows><Row size=\"24\" band=\"head\"/><Row size=\"24\"/></Rows><Band id=\"head\"><Cell displaytype=\"checkbox\" edittype=\"checkbox\"/><Cell col=\"1\" text=\"순번\"/><Cell col=\"2\" text=\"공개일자\"/><Cell col=\"3\" text=\"기타\"/><Cell col=\"4\" text=\"파일명\"/><Cell col=\"5\" text=\"첨부\"/></Band><Band id=\"body\"><Cell displaytype=\"checkbox\" edittype=\"checkbox\" text=\"bind:CHK\"/><Cell col=\"1\" expr=\"currow+1\" bind2=\"OTHBC_YN\"/><Cell col=\"2\" displaytype=\"date\" edittype=\"date\" calendardisplaynulltype=\"none\" text=\"bind:VAL0\"/><Cell col=\"3\" text=\"bind:EXT\"/><Cell col=\"4\" style=\"align:left middle;cursor:hand;\" style2=\"cursor:expr:OTHBC_YN==1?'hand':'';\" text=\"bind:FILE_NM\"/><Cell col=\"5\" displaytype=\"button\" style=\"cursor:hand;\" text=\"bind:BTN\"/></Band></Format></Formats>");this.addChild(_a.name,_a);_a=new Button("btn_00","absolute",null,"5","38","19","82",null,this);_a.set_taborder("8");_a.set_text("첨부");_a.set_cssclass("btn_WF_Process");_a.set_visible("true");this.addChild(_a.name,_a);_a=new Button("btn_del00","absolute",null,"5","38","19","0",null,this);_a.set_taborder("9");_a.set_text("삭제");_a.set_cssclass("btn_WF_Process");_a.set_visible("true");this.addChild(_a.name,_a);_a=new Static("sta_gud_h00","absolute","8","0",null,"5","8",null,this);_a.set_taborder("10");_a.set_text("5");_a.set_visible("false");_a.style.set_background("#dc143c3c");this.addChild(_a.name,_a);_a=new Static("sta_gud_h03","absolute","7","24",null,"5","9",null,this);_a.set_taborder("11");_a.set_text("5");_a.set_visible("false");_a.style.set_background("#dc143c3c");this.addChild(_a.name,_a);_a=new Button("btn_del01","absolute",null,"5","38","19","41",null,this);_a.set_taborder("12");_a.set_text("받기");_a.set_cssclass("btn_WF_Process");_a.set_visible("true");this.addChild(_a.name,_a);_a=new Layout("default","",300,400,this,function(_b){_b.set_classname("prjFiles");_b.set_titletext("첨부 목록");});this.addLayout(_a.name,_a);_a=null;};this.addIncludeScript("prjFiles.xfdl","pms_lib::pmsUtilInclude.xjs");this.registerScript("prjFiles.xfdl",function(){this.FileMgr;this.prjFiles_oninit=function(_a,_b){this.fn_init();this.fn_init_form();};this.fn_postInit=function(_a){if(!this.FILE_MANAGER){this.FILE_MANAGER=new this.fileManager(this,_a.sysSe?_a.sysSe:"PMS",_a.jobSe?_a.jobSe:"PRJ");this.FileMgr=this.FILE_MANAGER;}this.FileMgr.pForm=_a.pForm;this.FileMgr.ds_M=_a.ds_M;this.FileMgr.ds_files=this.ds_files;this.FileMgr.onSuccess=_a.onSuccess;this.grd_Files.set_autofittype(_a.autofittype);this.fn_setCols(_a.col_sizes);if(_a.fn_save){this.btn_add.set_visible(1);this.btn_del.set_visible(1);}var _b={onChange:_a.onChange?_a.onChange:this.fn_onFileSelected,onSuccess:this.fn_onFileSuccess,responseArea:_a.responseArea?_a.responseArea:this.grd_Files,useMultiSelect:_a.useMultiSelect?_a.useMultiSelect:true,useMultiUpload:_a.useMultiUpload?_a.useMultiUpload:true};this.FILE_MANAGER.init(_b);return this.ds_files;};this.fn_onFileSuccess=function(_a,_b){if(_a==this.FILE_MANAGER.TYPE_UPLOADER){if(this.FileMgr.onSuccess){var _c=this.FileMgr.onSuccess;return _c.call(this.FileMgr.pForm,_a,_b);}this.fn_transaction("fileList");}if(_a==this.FILE_MANAGER.TYPE_DOWNLOADER){}};this.fn_setCols=function(_a){this.debug('fn_setCols:'+_a.length);var _b=this.grd_Files;for(var _c=0;_c<_a.length;_c++ ){_b.setFormatColProperty(_c,"size",''+_a[_c]);}};this.prjFiles_onload=function(_a,_b){this.fn_init_dataset();};this.set_FileSN=function(_a){this.g_fileSn=_a;this.debug('COND:FILE_SN = '+_a);};this.set_BSNS_KIND=function(_a){this.ds_cond1.setColumn(0,'BSNS_KIND',_a);};this.fn_init_form=function(){};this.fn_init_dataset=function(){this.gfn_initCondDs(this,this.div_search);};this.fn_loadCombo=function(){var _a=[['ds_PRJ010','PRJ010',1,'']];var _b=function(_c,_d,_e){};};this.fn_search=function(){this.fn_transaction("fileList");};this.fn_fileList=function(_a){this.set_FileSN(_a);return this.fn_search(_a);};this.fn_transaction=function(_a){var _b=this.ds_cond1;var _c;var _d;var _e="hsco/pms/prj/"+_a+".do";var _f="";var _g="";switch(_a){case "fileList":_e="hsco/pms/prj/fileList.do";_f="inputF=ds_cond1";_g="ds_files=outputF";this.ds_files.clearData();break;case "getFileSn":_e="hsco/cmm/file/getFileSn.do";_g="ds_fileSn=output_fsn";break;}this.debug('COND:'+_b.rowcount+'\n'+_b.saveCSV());Ex.core.tran(this,_a,_e,_f,_g);};this.fn_upload=function(_a,_b){var _c=this.FileMgr.getfileCount();if(_c){this.FileMgr.upload(_a,_b,'');}return _c;};this.fn_callBack=function(_a,_b,_c){this.debug("F:fn_callBack() - "+_a+','+_b+','+_c);if(_b!=0){return this.gfn_callback_message(_a,_b,_c);}switch(_a){case "fileList":break;case "getFileSn":var _d=this.ds_fileSn;if(_d.rowcount<1){return;}var _e=_d.getColumn(0,"FILE_SN");this.g_fileSn=_e;var _f=this.FileMgr.ds_M;_f.setColumn(_f.rowposition,"FILE_SN",_e);this.fn_upFile(_e);break;case "fileUpload":break;}};this.fn_onFileSelected=function(_a,_b){if(_a!=this.FILE_MANAGER.TYPE_UPLOADER){return;}var _c=this.pmsUtil.isArray(_b);if(!_c){_b=[_b];}var _d=this.FILE_MANAGER.ds_files;for(var _g=0;_g<_b.length;_g++ ){var _e=_d.addRow();_d.setColumn(_e,"FILE_SN",this.FILE_MANAGER._fileSn);_d.setColumn(_e,"FILE_ORDR",_g+1);_d.setColumn(_e,"FILE_NM",_b[_g]);}var _f=this.FileMgr.pForm.fn_save;return _f.call(this.FileMgr.pForm);};this.grd_Files_oncellclick=function(_a,_b){var _c=this.objects[_a.binddataset];if(_b.cell==_a.getBindCellIndex("body","FILE_NM")){if(1!=_c.getColumn(_b.row,'OTHBC_YN')){return;}var _d=_c.getColumn(_b.row,"FILE_SN");var _e=_c.getColumn(_b.row,"FILE_ORDR");var _f=_c.getColumn(_b.row,"FILE_NM");this.fn_downFile(_d,_e,_f);}else if(_b.cell==_a.getBindCellIndex("body","BTN")){var _c=this.ds_cond1;var _d=_c.getColumn(0,'FILE_SN');this.debug('Up:'+_b.cell+'/'+_c.getColumn(_b.row,"FILE_NM"));this.fn_upFile(_d);}};this.fn_downFile=function(_a,_b,_c){this.debug('F_DOWN:'+_a+','+_b+','+_c);if(!_a||!_b){return;}this.FileMgr.download(_a,_b,_c);};this.fn_upFile=function(_a){this.debug('F_UP:'+_a);if(!_a){this.fn_transaction("getFileSn");}else{this.FileMgr.addFilesWithSn(_a,1,0,1,null);}};this.btn_del_onclick=function(_a,_b){var _c=this.ds_files;_c.deleteRow(_c.rowposition);};this.btn_add_onclick=function(_a,_b){this.fn_upFile(this.g_fileSn);};this.getCode=function(_a){return this.getData('BSNS_CODE');};this.getLabel=function(_a){return this.getData('BSNS_NM');};this.getData=function(_a,_b){var _c=this.ds_files;if(!_b){_b=_c.rowposition;}return _c.getColumn(_b,_a);};this.getDataset=function(){return this.ds_files;};});this.on_initEvent=function(){this.ds_files.addEventHandler("onrowposchanged",this.ds_onrowposchanged,this);this.addEventHandler("onload",this.prjFiles_onload,this);this.addEventHandler("oninit",this.prjFiles_oninit,this);this.grd_Files.addEventHandler("oncellclick",this.grd_Files_oncellclick,this);};this.loadIncludeScript("prjFiles.xfdl");};})();