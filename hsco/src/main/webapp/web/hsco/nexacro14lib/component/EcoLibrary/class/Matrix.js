if(!JsNamespace.exist("Eco.Matrix")){JsNamespace.declareClass("Eco.Matrix",{initialize:function(_a){var _b=arguments.length,_c=true;if(_b==6){this.setProperties(arguments);}else if(_b==1){if(_a instanceof Eco.Matrix){this.set(_a._a,_a._c,_a._b,_a._d,_a._tx,_a._ty);}else if(Eco.isArray(_a)){this.setProperties(_a);}else{_c=false;}}else if(_b==0){this.reset();}else{_c=false;}if(!_c){Eco.Logger.error('Unsupported matrix parameters');}},properties:{scaleX:{memberName:"_a",value:1},shearY:{memberName:"_c",value:0},shearX:{memberName:"_b",value:0},scaleY:{memberName:"_d",value:1},translateX:{memberName:"_tx",value:0},translateY:{memberName:"_ty",value:0}},statics:{DEGTORAD:Math.PI/180,RADTODEG:180/Math.PI},"set":function(_a,_b,_c,_d,_e,_f){this._a=_a;this._b=_c;this._c=_b;this._d=_d;this._tx=_e;this._ty=_f;return this;},"clone":function(){return new Eco.Matrix(this._a,this._c,this._b,this._d,this._tx,this._ty);},"equals":function(_a){return _a===this||_a&&this._a==_a._a&&this._b==_a._b&&this._c==_a._c&&this._d==_a._d&&this._tx==_a._tx&&this._ty==_a._ty||false;},"toString":function(){var _a=[Eco.ClassUtils.fmtNumber(this._a),Eco.ClassUtils.fmtNumber(this._b),Eco.ClassUtils.fmtNumber(this._tx)];var _b=[Eco.ClassUtils.fmtNumber(this._c),Eco.ClassUtils.fmtNumber(this._d),Eco.ClassUtils.fmtNumber(this._ty)];return '[['+_a.join(', ')+'], ['+_b.join(', ')+']]';},"reset":function(){this._a=this._d=1;this._c=this._b=this._tx=this._ty=0;return this;},"scale":function(_a,_b){_a=new Eco.Point(arguments[0],arguments[1]);var _c=_a.__readArgs;if(arguments[_c]!=null){_b=new Eco.Point(arguments[_c],arguments[_c+1]);}else{_b=null;}if(_b){this.translate(_b);}this._a*=_a.x;this._c*=_a.x;this._b*=_a.y;this._d*=_a.y;if(_b){this.translate(_b.negate());}return this;},"translate":function(_a){if(!(_a instanceof Eco.Point)){_a=new Eco.Point(arguments[0],arguments[1]);}var _b=_a.x,_c=_a.y;this._tx+=_b*this._a+_c*this._b;this._ty+=_b*this._c+_c*this._d;return this;},"rotate":function(_a,_b){if(!(_b instanceof Eco.Point)){var _c=arguments.length;if(_c==3){_b=new Eco.Point(arguments[1],arguments[2]);}else{_b=new Eco.Point();}}_a=_a*Eco.Matrix.DEGTORAD;var _d=_b.x,_e=_b.y,_f=Math.cos(_a),_g=Math.sin(_a),_h=_d-_d*_f+_e*_g,_i=_e-_d*_g-_e*_f,_j=this._a,_k=this._b,_l=this._c,_m=this._d;this._a=_f*_j+_g*_k;this._b= -_g*_j+_f*_k;this._c=_f*_l+_g*_m;this._d= -_g*_l+_f*_m;this._tx+=_h*_j+_i*_k;this._ty+=_h*_l+_i*_m;return this;},"shear":function(_a,_b){_a=new Eco.Point(arguments[0],arguments[1]);var _c=_a.__readArgs;if(arguments[_c]!=null){_b=new Eco.Point(arguments[_c],arguments[_c+1]);}else{_b=null;}if(_b){this.translate(_b);}var _d=this._a,_e=this._c;this._a+=_a.y*this._b;this._c+=_a.y*this._d;this._b+=_a.x*_d;this._d+=_a.x*_e;if(_b){this.translate(_b.negate());}return this;},"skew":function(_a,_b,_c,_d){_a=_a*Eco.Matrix.DEGTORAD;_b=_b*Eco.Matrix.DEGTORAD;var _e=_c-_c*Math.cos(_a)+_d*Math.sin(_a),_f=_d-_c*Math.sin(_b)-_d*Math.cos(_b),_g=this._a,_h=this._b,_i=this._c,_j=this._d;_e=_e*_g+_f*_h;_f=_e*_i+_f*_j;this.concatenate(new Eco.Matrix(Math.cos(_b), -Math.sin(_a),Math.sin(_b),Math.cos(_a),_e,_f));},"isIdentity":function(){return this._a==1&&this._c==0&&this._b==0&&this._d==1&&this._tx==0&&this._ty==0;},"isInvertible":function(){return !!this._getDeterminant();},"isSingular":function(){return !this._getDeterminant();},"concatenate":function(_a){var _b=this._a,_c=this._b,_d=this._c,_e=this._d;this._a=_a._a*_b+_a._c*_c;this._b=_a._b*_b+_a._d*_c;this._c=_a._a*_d+_a._c*_e;this._d=_a._b*_d+_a._d*_e;this._tx+=_a._tx*_b+_a._ty*_c;this._ty+=_a._tx*_d+_a._ty*_e;return this;},"preConcatenate":function(_a){var _b=this._a,_c=this._b,_d=this._c,_e=this._d,_f=this._tx,_g=this._ty;this._a=_a._a*_b+_a._b*_d;this._b=_a._a*_c+_a._b*_e;this._c=_a._c*_b+_a._d*_d;this._d=_a._c*_c+_a._d*_e;this._tx=_a._a*_f+_a._b*_g+_a._tx;this._ty=_a._c*_f+_a._d*_g+_a._ty;return this;},"transform":function(_a,_b,_c,_d,_e){if(arguments.length<5){if(!(_a instanceof Eco.Point)){_a=new Eco.Point(arguments[0],arguments[1]);var _f=_a.__readArgs;return this._transformPoint(_a,arguments[_f]);}else{return this._transformPoint(_a,_b);}}else{return this._transformCoordinates(_a,_b,_c,_d,_e);}},"_transformPoint":function(_a,_b){var _c=_a.x,_d=_a.y;if(!_b){_b=new Eco.Point();}return _b.set(_c*this._a+_d*this._b+this._tx,_c*this._c+_d*this._d+this._ty);},"_transformCoordinates":function(_a,_b,_c,_d,_e,_f){var _g=_b,_h=_d,_i=_b+2*_e,_j,_k,_l=this._a,_m=this._b,_n=this._c,_o=this._d;if(_f){while(_g<_i){_j=_a[_g++ ];_k=_a[_g++ ];_c[_h++ ]=_j*_l+_k*_m;_c[_h++ ]=_j*_n+_k*_o;}}else{var _p=this._tx,_q=this._ty;while(_g<_i){_j=_a[_g++ ];_k=_a[_g++ ];_c[_h++ ]=_j*_l+_k*_m+_p;_c[_h++ ]=_j*_n+_k*_o+_q;}}return _c;},"_transformCorners":function(_a){var _b=_a.x,_c=_a.y,_d=_b+_a.width,_e=_c+_a.height,_f=[_b,_c,_d,_c,_d,_e,_b,_e];return this._transformCoordinates(_f,0,_f,0,4);},"_transformBounds":function(_a,_b){var _c=this._transformCorners(_a),_d=_c.slice(0,2),_e=_c.slice(0),_f,_g;for(var _h=2;_h<8;_h++ ){_f=_c[_h];_g=_h&1;_d[_g]=Math.min(_f,_d[_g]);if(_f!=_d[_g]){_e[_g]=Math.max(_f,_e[_g]);}}if(!_b){_b=new Eco.Rectangle();}return _b.set(_d[0],_d[1],_e[0]-_d[0],_e[1]-_d[1]);},"inverseTransform":function(){if(!(pt instanceof Eco.Point)){pt=new Eco.Point(arguments[0],arguments[1]);var _a=pt.__readArgs;return this._inverseTransform(pt,arguments[_a]);}else{return this._inverseTransform(pt,arguments[1]);}},"_getDeterminant":function(){var _a=this._a*this._d-this._b*this._c;return isFinite(_a)&&!MathUtil.isZero(_a)&&isFinite(this._tx)&&isFinite(this._ty)?_a:null;},"_inverseTransform":function(_a,_b){var _c=this._getDeterminant();if(!_c){return null;}var _d=_a.x-this._tx,_e=_a.y-this._ty;if(!_b){_b=new Eco.Point();}return _b.set((_d*this._d-_e*this._b)/_c,(_e*this._a-_d*this._c)/_c);},"decompose":function(){var _a=this._a,_b=this._b,_c=this._c,_d=this._d;if(MathUtil.isZero(_a*_d-_b*_c)){return null;}var _e=Math.sqrt(_a*_a+_b*_b);_a/=_e;_b/=_e;var _f=_a*_c+_b*_d;_c-=_a*_f;_d-=_b*_f;var _g=Math.sqrt(_c*_c+_d*_d);_c/=_g;_d/=_g;_f/=_g;if(_a*_d<_b*_c){_a= -_a;_b= -_b;_f= -_f;_e= -_e;}var _h={"translation":this.getTranslation(),"scaling":new Eco.Point(_e,_g),"rotation": -Math.atan2(_b,_a),"shearing":_f,"xpSkew":null,"xpScale":null,"xpRotate":null};var _i=Math.atan(_f)*Eco.Matrix.RADTODEG,_j=_i-Math.atan2(this._b,this._a)*Eco.Matrix.RADTODEG,_k=_i+Math.atan2( -this._c,this._d)*Eco.Matrix.RADTODEG;if(Math.round(_k)!=( -Math.round(_j))){_h.xpSkew=new Eco.Point(_k,_j);_h.xpScale=new Eco.Point(this._a,this._d);}else{_h.xpScale=_h.scaling;_h.xpRotate=_h.rotation*Eco.Matrix.RADTODEG;}return _h;},"getValues":function(){return [this._a,this._c,this._b,this._d,this._tx,this._ty];},"getTranslation":function(){return new Eco.Point(this._tx,this._ty);},"getScaling":function(){return (this.decompose()||{}).scaling;},"getRotation":function(){return (this.decompose()||{}).rotation;},"inverted":function(){var _a=this._getDeterminant();return _a&&new Eco.Matrix(this._d/_a, -this._c/_a, -this._b/_a,this._a/_a,(this._b*this._ty-this._d*this._tx)/_a,(this._c*this._tx-this._a*this._ty)/_a);},"shiftless":function(){return new Eco.Matrix(this._a,this._c,this._b,this._d,0,0);},"getStyleString":function(_a){var _b="";if(!this.isIdentity()){var _c=this.decompose();if(!_c){return _b;}var _d=XpCompFactory.getRect(_a),_e=_d.width,_f=_d.height,_g=_d.x,_h=_d.y;_b="0,0 ";var _i=_c.translation,_j=_c.xpScale,_k=_c.xpRotate,_l=_c.xpSkew;if(_j&&(_j.x!=1||_j.y!=1)){var _m=_j.x,_n=_j.y;if(_m!=1){if(_m<0){_i.x+= -_g+_g*_m;_e=( -1*_m*_e);}else{_i.x+= -_g+_g*_m;_e=(_m*_e);}}if(_n!=1){if(_n<0){_i.y+= -_h+_h*_n;_f=( -1*_n*_f);}else{_i.y+= -_h+_h*_n;_f=(_n*_f);}}_b+="[scale "+_m+","+_n+"]";}if(_l){var _o=Math.tan(Math.atan2(this._c,this._a)),_p=Math.tan(Math.atan2(this._b,this._d));_i.x-=_f*_p*0.5;_i.y-=_e*_o*0.5;_b+="[skew "+_l.x+","+_l.y+"]";}if(_k){_k=_k;if(Math.abs(_k)!=360||Math.abs(_k)!=180){var _g=_d.x,_h=_d.y;var _q=new Eco.Point(_g,_h);_q=_q.rotate(_k,0,0);_i.x+=(_q.x-_g);_i.y+=(_q.y-_h);_b+="[rotate "+(_k)+"]";}}var _r=_i.x,_s=_i.y;if(_r!=0||_s!=0){_b+="[translate "+_r+","+_s+"]";}_b="transformation: "+_b+";";}return _b;}});}