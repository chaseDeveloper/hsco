if(!window.RichTextEditor){window.RichTextEditor={};}if(!RichTextEditor.Lib){RichTextEditor.Lib={_toString:(Object.prototype.toString),isString:function(_a){return typeof _a==='string';},isArray:Array.isArray?function(_a){return Array.isArray(_a);}:function(_a){return RichTextEditor.Lib._toString.call(_a)==='[object Array]';},isObject:function(_a){if(_a===null||_a===undefined){return false;}return typeof _a=="object"&&'constructor' in _a&&_a.constructor===Object;},isEmpty:function(_a){if(_a==null){return true;}if(RichTextEditor.Lib.isString(_a)||RichTextEditor.Lib.isArray(_a)){return _a.length==0?true:false;}else if(RichTextEditor.Lib.isObject(_a)){for(var _b in _a){if(_a.hasOwnProperty(_b)){return false;}}return true;}return false;},isFunction:function(_a){return RichTextEditor.Lib._toString._toString.call(_a)==='[object Function]';},string:{camelize:function(_a){return _a.replace(/-(.)/g,function(_b,_c){return _c.toUpperCase();});},capitalize:function(_a){if(!_a){alert("[capitalize] str is null!");}return _a.replace(/\b[a-z]/g,function(_b){return _b.toUpperCase();});}},array:{indexOf:function(_a,_b,_c,_d){var _e=_a.length;if(_c==null){_c=0;};_d==!!_d;_c=(_c<0)?Math.ceil(_c):Math.floor(_c);if(_c<0){_c+=_e;}if(_d){for(;_c<_e;_c++ ){if(_a[_c]===_b){return _c;}}}else{for(;_c<_e;_c++ ){if(_a[_c]==_b){return _c;}}}return  -1;},contains:function(_a,_b,_c){if(RichTextEditor.Lib.array.indexOf(_a,_b,null,_c)=== -1){return false;}else{return true;}},Each:function(_a,_b,_c,_d){var _e,_f=_a.length;if(_d!==true){for(_e=0;_e<_f;_e++ ){if(_b.call(_c||_a[_e],_a[_e],_e,_a)===false){return _e;}}}else{for(_e=_f-1;_e> -1;_e-- ){if(_b.call(_c||_a[_e],_a[_e],_e,_a)===false){return _e;}}}return true;},forEach:function(_a,_b,_c){var _d,_e=_a.length;for(_d=0;_d<_e;_d++ ){_b.call(_c,_a[_d],_d,_a);}},min:function(_a){return Math.min.apply(Math,_a);},clone:function(_a){return _a.slice(0);},removeAt:function(_a,_b){_a.splice(_b,1);},difference:function(_a,_b){var _c=RichTextEditor.Lib.array.clone(_a),_d=_c.length,_e,_f,_g;for(_e=0,_g=_b.length;_e<_g;_e++ ){for(_f=0;_f<_d;_f++ ){if(_c[_f]===_b[_e]){RichTextEditor.Lib.array.removeAt(_c,_f);_f-- ;_d-- ;}}}return _c;},clean:function(_a){var _b=[],_c=0,_d=_a.length,_e;for(;_c<_d;_c++ ){_e=_a[_c];if(!RichTextEditor.Lib.isEmpty(_e)){_b.push(_e);}}return _b;}},object:{copyProperties:function(_a,_b){if(_a&&_b){var _c,_d;for(_c in _b){if(_b.hasOwnProperty(_c)){_d=_b[_c];_a[_c]=_d;}}}}}};}if(!RichTextEditor.Util){RichTextEditor.Util={createEle:function(_a,_b,_c,_d,_e){if(typeof (_b)=="string"){var _a=_a||document,_b=_a.createElement(_b);if(_c){this.setAttributes(_b,_c);}if(_d){this.setStyle(_b,_d);}if(_e){this.addClassName(_b,_e);}}return _b;},setAttributes:function(_a,_b){for(var _c in _b){_a[_c]=_b[_c];}return _a;},classNames:function(_a){return _a.className.split(' ');},hasClassName:function(_a,_b){return _a.className.match(new RegExp('(\\s|^)'+_b+'(\\s|$)'));},addClassName:function(_a,_b){if(!this.hasClassName(_a,_b)){if(_a.className){_a.className+=" ";}_a.className+=_b;}return _a;},removeClassName:function(_a,_b){var _c=_a.className.split(/\s+/);var _d=RichTextEditor.Lib.array.difference(_c,_b.split());_d=RichTextEditor.Lib.array.clean(_d);_a.className=_d.join(' ');},show:function(_a){this.elementById(_a).style.display='block';return _a;},hide:function(_a){this.elementById(_a).style.display='none';return _a;},elementByEvent:function(_a){var _b=_a.target||_a.srcElement;return _b;},elementById:function(_a,_b){var _b=_b||document;if(typeof _a=='string'){_a=_b.getElementById(_a);}return _a;},cumulativeOffset:function(_a){var _b=0,_c=0;do{_b+=_a.offsetTop||0;_c+=_a.offsetLeft||0;_a=_a.offsetParent;}while(_a)return [_c,_b];},positionedOffset:function(_a){var _b=0,_c=0;do{_b+=_a.offsetTop||0;_c+=_a.offsetLeft||0;_a=_a.offsetParent;if(_a){if(_a.tagName=='BODY'){break;}var _d=this.getStyle(_a,'position');if(_d=='relative'||_d=='absolute'){break;}}}while(_a)return [_c,_b];},toPx:function(_a){var _b;if(!RichTextEditor.Lib.isString(_a)){_b=_a.toString();}else{_b=_a;}if(_b.indexOf("px")> -1){return _b+"";}else{return _b+"px";}},isPx:function(_a){if(this.trim(_a)==""){return false;}else if(_a.indexOf("px")!= -1){_a=this.parsePx(_a);}return !isNaN(_a);},parsePx:function(_a){if(_a==null||_a.length==0){return 0;}else if(_a.indexOf("px")> -1){return _a.substring(0,_a.indexOf("px")).toNumber();}else{return _a.toNumber();}},trim:function(_a){return _a.replace(/(^\s*)|(\s*$)/g,"");},getStyle:function(_a,_b){_a=this.elementById(_a);_b=(_b=='float'||_b=='cssFloat')?'styleFloat':RichTextEditor.Lib.string.camelize(_b);var _c=_a.style[_b];if(!_c&&_a.currentStyle){_c=_a.currentStyle[_b];}if(_b=='opacity'){if(_c=(this.getStyle(_a,'filter')||'').match(/alpha\(opacity=(.*)\)/)){if(_c[1]){return parseFloat(_c[1])/100;}}return 1.0;}if(_c=='auto'){if((_b=='width'||_b=='height')&&(this.getStyle(_a,'display')!='none')){return _a['offset'+RichTextEditor.Lib.string.capitalize(_b)]+'px';}return null;}return _c;},setStyle:function(_a,_b,_c){_a=this.elementById(_a);var _d=_a.style;for(var _e in _b){if(_b.hasOwnProperty(_e)){if(_e==='opacity'){this.setOpacity(_a,_b[_e]);}else{_d[(_e==='float'||_e==='cssFloat')?(_d.styleFloat===undefined?'cssFloat':'styleFloat'):(_c?_e:RichTextEditor.Lib.string.camelize(_e))]=_b[_e];}}}return _a;},setOpacity:function(_a,_b){_a=this.elementById(_a);var _c=this.getStyle(_a,'filter'),_d=_a.style;_d.opacity=(_b==1||_b==='')?'':(_b<0.00001)?0:_b;if(_b==1||_b===''){_d.filter=_c.replace(/alpha\([^\)]*\)/gi,'');return _a;}else if(_b<0.00001){_b=0;}_d.filter=_c.replace(/alpha\([^\)]*\)/gi,'')+'alpha(opacity='+(_b*100)+')';return _a;},applyCSSText:function(_a,_b){var _c=_a.createElement("style");_c.setAttribute("type","text/css");if(_c.styleSheet){_c.styleSheet.cssText=_b;}else{_c.textContent=_b;}var _d;if(RichTextEditor.Browser=="IE"&&RichTextEditor.BrowserVersion<9){_d=_a.getElementsByTagName('head')[0];}else{_d=_a.head;}_d.appendChild(_c);},addLinkStyle:function(_a,_b){var _b=_b||document,_c=_b.createElement('link');_c.rel='stylesheet';_c.type='text/css';_c.href=_a;_b.getElementsByTagName('head')[0].appendChild(_c);},getCoords:function(_a,_b){var _c=_b||false;var _d=_a.offsetWidth;var _e=_a.offsetHeight;var _f={"left":0,"top":0,"right":0,"bottom":0};var _g;while(_a){_f.left+=_a.offsetLeft||0;_f.top+=_a.offsetTop||0;_a=_a.offsetParent;if(_c){if(_a){if(_a.tagName=="BODY"){break;}_g=this.getStyle(_a,"position");if(_g!=="static"){break;}}}}_f.right=_f.left+_d;_f.bottom=_f.top+_e;return _f;},getCoordsTarget:function(_a){return this.getCoords(_a,true);},addEvent:function(_a,_b,_c,_d){_a=this.elementById(_a);if(_a.addEventListener){_a.addEventListener(_b,_c,_d||false);}else{_a.attachEvent("on"+_b,_c);}return _a;},removeEvent:function(_a,_b,_c,_d){_a=this.elementById(_a);if(_a.removeEventListener){_a.removeEventListener(_b,_c,_d||false);}else{_a.detachEvent("on"+_b,_c);}return _a;},stop:function(_a){if(_a.preventDefault){_a.preventDefault();_a.stopPropagation();}else{_a.returnValue=false;_a.cancelBubble=true;}}};}if(!RichTextEditor.Selection){RichTextEditor.Selection=function(){var _a=arguments[0];this.editorWin=_a.contentWindow||window;this.editorDoc=(_a.contentDocument||this.editorWin.document)||document;this.editorBody=this.editorDoc.body||document.body;};var proto=RichTextEditor.Selection.prototype;proto.getSelection=function(){if(this.editorWin.getSelection){return this.editorWin.getSelection();}else{return this.editorDoc.selection;}};proto.createRange=function(){if(this.editorWin.getSelection){return this.editorDoc.createRange();}else{return this.getSelection().createRange();}};proto.createTextRange=function(){if(this.editorWin.getSelection){return this.editorDoc.createRange();}else{return this.editorBody.createTextRange();}};proto.getRange=function(_a){if(this.editorWin.getSelection){var _b=this.getSelection();if(_b&&_b.rangeCount>0){if(RichTextEditor.Lib.isEmpty(_a)){if(_b.rangeCount==1){return _b.getRangeAt(0);}else{return this.mergeRange(_b);}}else{var _c=_b.getRangeAt(0);_c.collapse(_a);return _c;}}else{return this.editorDoc.createRange();}}else{var _b=this.getSelection(),_c,_d=_b.type.toLowerCase();if(_d=="none"){return _b.createRange()?_b.createRange():function(){_c=this.editorBody.createTextRange();_c.collapse(true);_c.select();return _c;}();}if(RichTextEditor.Lib.isEmpty(_a)){return _b.createRange();}else{if(_d==="text"){_c=_b.createRange();_c.collapse(_a);_c.select();return _b.createRange();}else{if(_d==="control"){_b.empty();}return _b.createRange();}}}};proto.getNode=function(){if(this.editorWin.getSelection){var _a=this.getRange();if(_a){var _b=_a.startContainer;if(_b.nodeType==1){if(RichTextEditor.DomUtil.isBody(_b)){return _b;}else{if(_b.childElementCount==_a.startOffset){return _b.childNodes[_a.startOffset-1];}else{return _b.childNodes[_a.startOffset];}}}else{return _b.parentNode;}}else{return null;}}else{var _c=this.getSelection(),_d=_c.type.toLowerCase(),_a;if(_d==="control"){return _c.createRange().item(0);}else{return _c.createRange().parentElement();}}};proto.mergeRange=function(_a){try{var _b=[];for(var _f=0,_g=_a.rangeCount;_f<_g;_f++ ){_b.push(_a.getRangeAt(_f));}_a.removeAllRanges();var _c=_b[0].startContainer.childNodes[_b[0].startOffset];var _d=_b[_g-1].endContainer.childNodes[_b[_g-1].endOffset-1];var _e=this.editorDoc.createRange();try{_e.setStart(_c,0);}catch(e){_e.collapse(true);}try{_e.setEnd(_d,_d.childNodes.length);}catch(e){}_a.addRange(_e);return _a.getRangeAt(0);}catch(e){return _a.getRangeAt(0);}};proto.hasControl=function(){if(this.editorWin.getSelection){return (this.getControl()!=null);}else{var _a=this.getSelection(),_b=_a.type.toLowerCase();if(_b==="control"){return true;}else{return false;}}};proto.getControl=function(){if(this.editorWin.getSelection){var _a=this.getSelection(),_b;if(_a.isCollapsed){return null;}if(RichTextEditor.Util.isElement(_a.anchorNode)){_b=_a.anchorNode.childNodes[_a.anchorOffset];return _b;}return null;}else{var _a=this.getSelection(),_c=_a.type.toLowerCase();if(_c==="control"){var _b=_a.createRange().item(0);return _b;}else{return null;}}};proto.selectControl=function(_a,_b){if(this.editorWin.getSelection){var _c=this.createRange();_c.selectNode(_a);if(!RichTextEditor.Lib.isEmpty(_b)){_c.collapse(_b);}var _d=this.getSelection();_d.removeAllRanges();_d.addRange(_c);}else{var _c=this.editorBody.createControlRange();_c.add(_a);if(!RichTextEditor.Lib.isEmpty(_b)){_c.collapse(_b);}_c.select();}};proto.selectControlContents=function(_a){if(this.editorWin.getSelection){var _b=this.createRange();_b.selectNodeContents(_a);var _c=this.getSelection();_c.removeAllRanges();_c.addRange(_b);}else{var _b=this.editorBody.createTextRange();_b.moveToElementText(_a);_b.select();}};proto.collapse=function(_a){if(this.editorWin.getSelection){var _b=this.getSelection();if(_b&&_b.rangeCount>0){var _c=_b.getRangeAt(0);_c.collapse(_a);}}else{var _b=this.getSelection(),_d=_b.type.toLowerCase();if(_d==="text"){var _c=_b.createRange();_c.collapse(_a);_c.select();return _b.createRange();}else{if(_d==="control"){_b.empty();}return _b.createRange();}}};proto.isCollapsed=function(){if(this.editorWin.getSelection){var _a=this.getSelection();return (_a&&_a.isCollapsed);}else{var _a=this.getSelection(),_b=_a.type.toLowerCase();if(_b==="none"){return true;}else if(_b==="control"){return true;}else if(_b==="text"){var _c=_a.createRange();return _c.compareEndPoints('StartToEnd',_c)==0;}else{return true;}}};proto.transTextRange=function(_a,_b,_c,_d){var _e=this.createTextRange();var _f=util.createEle(document,"span");RichTextEditor.DomUtil.insertAt(_f,_b);_e.moveToElementText(_f);RichTextEditor.DomUtil.remove(_f);_e.collapse(true);_e.moveStart('character',_c);if(_d){_a.setEndPoint('StartToStart',_e);}else{_a.setEndPoint('EndToEnd',_e);}return _a;};proto.setStart=function(_a,_b,_c){if(this.editorWin.getSelection){try{_a.setStart(_b,_c);}catch(e){_a.collapse(true);_a.setStart(_b,_c);}}else{try{this.transTextRange(_a,_b,_c,true);}catch(e){console.log(e);}return _a;}};proto.setEnd=function(_a,_b,_c){if(this.editorWin.getSelection){try{_a.setEnd(_b,_c);}catch(e){_a.collapse(false);_a.setEnd(_b,_c);}}else{try{this.transTextRange(_a,_b,_c,false);}catch(e){console.log(e);}return _a;}};proto.selectRange=function(_a){if(this.editorWin.getSelection){var _b=this.getSelection();_b.removeAllRanges();_b.addRange(_a);}else{_a.select();}};proto.removeSelection=function(){if(this.editorWin.getSelection){var _a=this.getSelection();_a.removeAllRanges();}else{if(editorDoc.selection.createRange){var _b=this.editorDoc.selection.createRange();this.editorDoc.selection.empty();}}};proto.getSelectionText=function(){var _a="",_b=this.getSelection();if(this.editorWin.getSelection){if(_b.rangeCount){if(RichTextEditor.Browser=="IE"){var _c=_b.getRangeAt(0),_d=_c.cloneContents();_a=this.getChildNodesText(_d);}else{_a=_b.toString();}}}else{if(_b.type=="Text"){_a=_b.createRange().text;}}return _a;};proto.getChildNodesText=function(_a){var _b,_c="";for(var _d=0,_e=_a.childNodes.length;_d<_e;_d++ ){_b=_a.childNodes[_d];if(_b.nodeType==3){_c+=_b.data;}else if(_b.nodeType==1){if(RichTextEditor.DomUtil.isBR(_b)){_c+="\r\n";}else if(RichTextEditor.DomUtil.isPre(_b)&&_b.id==RichTextEditor.Highlight.syntaxHighlightId){if(RichTextEditor.BrowserVersion>9){_c+=_b.innerText;}else{_c+=this.getChildNodesText(_b);}}else if(RichTextEditor.DomUtil.isParagraph(_b)){_c+=_b.innerText;_c+="\r\n";_c+="\r\n";}else{_c+=_b.textContent;}}}return _c;};proto=null;}if(!RichTextEditor.DomUtil){RichTextEditor.DomUtil={search:function(_a,_b,_c){var _d=(_a.length==1)?document:_a[0];var _e=_a[_a.length-1];var _f=(!_e||!_d||!_d.nodeType||typeof _e!="string");if(_f){return _c;}var _g=this.translate(_e);return _b(_d,_g.getExpression());},find:function(){return this.search(arguments,dFindy,null);},collect:function(){return this.search(arguments,dGetty,null);},collectAll:function(){return this.search(arguments,dGetties,[]);},__TRANSLATOR_CACHES:{},translate:function(_a){if(!this.__TRANSLATOR_CACHES[_a]){this.__TRANSLATOR_CACHES[_a]=new RichTextEditor.Translator(_a);}return this.__TRANSLATOR_CACHES[_a];},getPosition:function(_a,_b){if(!_a){return {x:0,y:0,width:0,height:0};}_b=!!_b;_a=RichTextEditor.Util.elementById(_a);var _c=(_b)?RichTextEditor.Util.cumulativeOffset(_a):RichTextEditor.Util.positionedOffset(_a);var _d;var _e=_a.style.display;if(_e!='none'&&_e!=null){_d={width:_a.offsetWidth,height:_a.offsetHeight};}else{var _f=_a.style;var _g=_f.visibility;var _h=_f.position;var _i=_f.display;_f.visibility='hidden';_f.position='absolute';_f.display='block';var _j=_a.clientWidth;var _k=_a.clientHeight;_f.display=_i;_f.position=_h;_f.visibility=_g;_d={width:_j,height:_k};}return {x:_c[0],y:_c[1],width:_d.width,height:_d.height};},getWidth:function(_a){var _b=_a.style["width"];if(RichTextEditor.Util.isPx(_b)){return RichTextEditor.Util.parsePx(_b);}return _a.offsetWidth;},setWidth:function(_a,_b){RichTextEditor.Util.setStyle(_a,{'width':_b});},getHeight:function(_a){var _b=_a.style["height"];if(RichTextEditor.Util.isPx(_b)){return RichTextEditor.Util.parsePx(_b);}return _a.offsetHeight;},setHeight:function(_a,_b){RichTextEditor.Util.setStyle(_a,{'height':_b});},isElement:function(_a){return _a&&_a.nodeType==1;},isBody:function(_a){return this.isElement(_a)&&_a.tagName=="BODY";},isBR:function(_a){var _b=_a.nodeName;return _b=="BR"||_b=="br";},isPre:function(_a){var _b=_a.nodeName;return _b=="PRE"||_b=="pre";},isParagraph:function(_a){var _b=_a.nodeName;return _b=="P"||_b=="p";},isSpan:function(_a){var _b=_a.nodeName;return _b=="SPAN"||_b=="span";},getBody:function(_a){if(!_a||!_a.parentNode){return null;}var _b=_a.parentNode;while(_b){if(this.isBody(_b)){return _b;}_b=_b.parentNode;}return null;},hasContent:function(_a,_b){if(!_a||_a.nodeType!=3){return true;}var _c=this.removeMeaninglessSpace(_a.nodeValue);if(_b){_c=_c.replace(/\ufeff/g,"");}return (_c!="");},removeMeaninglessSpace:function(_a){return _a.replace(/(^[\f\n\r\t\v\u2028\u2029]*)|([\f\n\r\t\v\u2028\u2029]*$)/g,"");},insertFirst:function(_a,_b){if(!_a||!_b){return;}if(_a.firstChild){_a.insertBefore(_b,_a.firstChild);}else{_a.appendChild(_b);}return _b;},insertAt:function(_a,_b){if(!_a||!_b){return;}_b.parentNode.insertBefore(_a,_b);return _a;},insertNext:function(_a,_b){if(!_a||!_b){return;}var _c=_b.nextSibling;if(_c){_c.parentNode.insertBefore(_a,_c);}else{_b.parentNode.appendChild(_a);}return _a;},append:function(_a,_b){if(!_a||!_b){return;}_a.appendChild(_b);return _b;},remove:function(_a){if(!_a){return;}if(_a.parentNode){_a.parentNode.removeChild(_a);}_a=null;},next:function(_a,_b){if(!_a||!_a.nextSibling){return null;}var _c=this.findNodePattern(_b);var _d=_a.nextSibling;while(_d){if(this.hasContent(_d)){if(_c.test(_d)){break;}}_d=_d.nextSibling;}return _d;},parent:function(_a){if(!_a||!_a.parentNode){return null;}return _a.parentNode;},nodePatternCache:{},findNodePattern:function(_a){_a=_a||"#element,#text";if(this.nodePatternCache[_a]){return this.nodePatternCache[_a];}var _b=new RichTextEditor.NodePattern(_a);this.nodePatternCache[_a]=_b;return _b;},getScrollTop:function(_a){if(!_a){return 0;}return (_a.documentElement.scrollTop||_a.body.scrollTop);},setScrollTop:function(_a,_b){if(!_a){return;}if(_a.documentElement.scrollTop){_a.documentElement.scrollTop=_b;}else{_a.body.scrollTop=_b;}},getScrollLeft:function(_a){if(!_a){return 0;}return (_a.documentElement.scrollLeft||_a.body.scrollLeft);},setScrollLeft:function(_a,_b){if(!_a){return;}if(_a.documentElement.scrollLeft){_a.documentElement.scrollLeft=_b;}else{_a.body.scrollLeft=_b;}},isAncestor:function(_a,_b){while(_b=_b.parentNode){if(_a==_b){return true;}}return false;}};}(function(){var _a={'%body':['body'],'%text':['#text','br'],'%element':['#element'],'%control':['img','object','hr','table','button','iframe'],'%inline':['span','font','u','i','b','em','strong','big','small','a','sub','sup','span'],'%block':['p','div','ul','ol','h1','h2','h3','h4','h5','h6','pre','dl','hr','table','button'],'%paragraph':['p','li','dd','dt','h1','h2','h3','h4','h5','h6','td','th','div','caption'],'%wrapper':['div','ul','ol','dl','pre','xmp','table','button'],'%innergroup':['li','dd','dt','td','th'],'%outergroup':['ul','ol','dl','tr','tbody','thead','tfoot','table'],'%tablegroup':['td','th','tr','tbody','thead','tfoot','table'],'%listgroup':['li','ul','ol'],'%datagroup':['dd','dt','dl'],'%listhead':['ul','ol']};var _b={};for(var _d in _a){_b[_d]={};if(_a[_d]){RichTextEditor.Lib.array.Each(_a[_d],function(_e){_b[_d][_e]=true;});}}function createMap(_e){var _f={};var _g=_e.split(",");RichTextEditor.Lib.array.Each(_g,function(_h){if(_b[_h]){for(var _i in _b[_h]){_f[_i]=true;}}else{_f[_h]=true;}});return _f;}if(!RichTextEditor.Translator){RichTextEditor.Translator=function(){this.patterns=arguments[0];this.map=createMap(arguments[0]);};var _c=RichTextEditor.Translator.prototype;_c.hasParts=function(){return (this.patterns.length>0);};_c.include=function(_e){var _f=createMap(_e);for(var _g in _f){if(this.map[_g]){return true;}}return false;};_c.memberOf=function(_e){var _f=createMap(_e);for(var _g in this.map){if(_f[_g]){return true;}}return false;};_c.extract=function(_e){var _f=createMap(_e);var _g=[];for(var _h in this.map){if(_f[_h]){_g.push(_h);}}return RichTextEditor.DomUtil.translate(_g.join(","));};_c.getExpression=function(){if(!this.exprs){var _e=[];for(var _f in this.map){_e.push(_f);}this.exprs=_e.join(",");}return this.exprs;};_c=null;}})();if(!RichTextEditor.NodePattern){RichTextEditor.NodePattern=function(){this.pattern=arguments[0];this.translator=RichTextEditor.DomUtil.translate(this.pattern);this.hasClassPattern=this.pattern.indexOf(".")>=0;this.hasIdPattern=this.pattern.indexOf("#")>=0;this.matchesText=this.translator.include("#text");this.matchesElement=this.translator.include("#element");};var proto=RichTextEditor.NodePattern.prototype;proto.test=function(_a){var _b=_a.nodeType;var _c=this.translator.map;if(_b==1){if(this.matchesElement){return true;}var _d=_a.tagName.toLowerCase();if(_c[_d]){return true;}var _e=[];if(this.hasClassPattern&&_a.className){_a.className.split(/\s/).each(function(_g){_e.push("."+_g);_e.push(_d+"."+_g);});}if(this.hasIdPattern&&_a.id){var _f=_a.id;_e.push("#"+_f);_e.push(_d+"#"+_f);}for(var _g=0;_g<_e.length;_g++ ){if(_c[_e[_g]]){return true;}}return false;}else if(_b==3){return this.matchesText;}};proto=null;}(function(){var _a,_b,_c;var _d={'#':function(_h,_i){if((_a=/(\S*)#(\S+)/.exec(_i))!==null){var _j=_a[1];var _k=_a[2];if(!_h.getElementById){_h=_h.ownerDocument;}if(_b=_h.getElementById(_k)){if(_j.length<1||_b.nodeName.toLowerCase()==_j){return [_b];}}}return [];},'.':function(_h,_i){if((_a=/(\S*)\.(\S+)/.exec(_i))!==null){var _j=((_a[1]==="")?"*":_a[1]);var _k=_a[2];if((_c=_h.getElementsByTagName(_j)).length>0){var _l=[];for(var _m=0;_m<_c.length;_m++ ){var _b=_c[_m];if((new RegExp("(^| )"+_k+"($| )")).test(_b.className)){_l.push(_b);}}return _l;}}return [];},'*':function(_h,_i){if((_c=_h.getElementsByTagName(_i)).length>0){var _j=[];for(var _k=0;_k<_c.length;_k++ ){_j.push(_c[_k]);}return _j;}return [];}};var _e=function(_h,_i){if(_h.length<1){return [];}var _j;if((f=/(\.|#)/.exec(_i))!==null){if(_d[f[1]]){_j=f[1];}}_j=_j||"*";var _k=[];for(var _l=0;_l<_h.length;_l++ ){_k=_k.concat(_d[_j](_h[_l],_i));}return _k;};var _f=function(_h,_i){var _c=[_h];var _j=_i.split(" ");for(var _k=0;_k<_j.length;_k++ ){_c=_e(_c,_j[_k]);}return _c;};var _g=function(_h,_i,_j){_j=!!_j;if(_h.nodeType!==1&&_h.nodeType!==9){return (_j?[]:null);}if(!_i||typeof _i!=="string"){return (_j?[]:null);}var _c;var _k=[];var _l=_i.split(",");for(var _m=0;_m<_l.length;_m++ ){_c=_f(_h,_l[_m]);if(_c&&_c.length>0){_k=_k.concat(_c);if(!_j){break;}}}if(_j){return _k;}else{return _k[0];}};window.dGetty=function(){var _h=arguments;if(_h.length==1){if(typeof (_h[0])==="string"){return _g(document,_h[0]);}}else if(_h.length==2){if(_h[0].nodeType&&typeof (_h[1])==="string"){return _g(_h[0],_h[1]);}}return null;};window.dGetties=function(){var _h=arguments;if(_h.length==1){if(typeof (_h[0])==="string"){return _g(document,_h[0],true);}}else if(_h.length==2){if(_h[0].nodeType&&typeof (_h[1])==="string"){return _g(_h[0],_h[1],true);}}return [];};})();(function(){var _a,_b,_c;var _d={'#':function(_g,_h){if((_a=/(\S*)#(\S+)/.exec(_h))!==null){var _i=((_a[1]==="")?"*":_a[1]);var _j=_a[2];var _k=_g;while(_k){if(_k.nodeName.toLowerCase()=="body"){break;}if(_i=="*"||_k.nodeName.toLowerCase()==_i){if(_k.id==_j){return _k;}}_k=_k.parentNode;}}return null;},'.':function(_g,_h){if((_a=/(\S*)\.(\S+)/.exec(_h))!==null){var _i=((_a[1]==="")?"*":_a[1]);var _j=_a[2];var _k=_g;while(_k){if(_k.nodeName.toLowerCase()=="body"){break;}if(_i=="*"||_k.nodeName.toLowerCase()==_i){if(_k.className&&_k.className.indexOf(_j)> -1){return _k;}}_k=_k.parentNode;}}return null;},'*':function(_g,_h){var _i=_g;var _j={};var _k=_h.split(",");for(var _l=0,_m=_k.length;_l<_m;_l++ ){_j[_k[_l]]=true;}while(_i){if(_i.nodeName.toLowerCase()=="body"){break;}if(_j[_i.nodeName.toLowerCase()]){return _i;}_i=_i.parentNode;}return null;}};var _e=function(_g,_h){var _i;if((f=/(\.|#|:\w+)/.exec(_h))!==null){if(_d[f[1]]){_i=f[1];}}_i=_i||"*";var _j=null;if((_j=_d[_i](_g,_h))!=null){return _j;}return null;};var _f=function(_g,_h){if(!_h||typeof _h!=="string"){return null;}var _c=_g;var _i=_h.split(" ");for(var _j=0,_k=_i.length;_j<_k;_j++ ){if((_c=_e(_c,_i[_j]))==null){return null;}}return _c;};window.dFindy=function(){var _g=arguments;if(_g.length==1){throw new Error("need more arguments");}else if(_g.length==2){if(_g[0].nodeType&&typeof (_g[1])==="string"){return _f(_g[0],_g[1]);}}return null;};})();if(!RichTextEditor.TableUtil){RichTextEditor.TableUtil={getClosestByTagNames:function(_a,_b){var _c;if(_b&&typeof _b.tagName==="string"){_c=_b.tagName.toLowerCase();if(_c!=="body"){if(RichTextEditor.Lib.array.contains(_a,_c)){return _b;}else{return arguments.callee(_a,_b.parentNode);}}}return null;},splitWidthByColSpan:function(_a){var _b;if(1<_a.colSpan&&_a.style.width){_b=parseInt(_a.style.width,10);RichTextEditor.Util.setStyle(_a,{'width':Math.floor(_b/_a.colSpan)+"px"});}},splitHeightByRowSpan:function(_a){var _b;if(1<_a.rowSpan&&_a.style.height){_b=parseInt(_a.style.height,10);RichTextEditor.Util.setStyle(_a,{'height':Math.floor(_b/_a.rowSpan)+"px"});}},cloneNodeForEmptyTd:function(_a){var _b;_b=_a.cloneNode(false);this.emptyTd(_b);return _b;},emptyTd:function(_a){_a.innerHTML=RichTextEditor.EMPTY_PARAGRAPH_HTML;},getTableIndexerFromTd:function(_a){var _b;_b=this.getClosestByTagNames(["table"],_a);return new RichTextEditor.TableUtil.Indexer(_b);}};}if(!RichTextEditor.TableUtil.Boundary){RichTextEditor.TableUtil.Boundary=function(){this.top= -1;this.left= -1;this.bottom= -1;this.right= -1;if(arguments[0]){this.set(arguments[0]);}};var proto=RichTextEditor.TableUtil.Boundary.prototype;proto.set=function(_a){if("top" in _a){this.setTop(_a.top);}if("left" in _a){this.setLeft(_a.left);}if("bottom" in _a){this.setBottom(_a.bottom);}if("right" in _a){this.setRight(_a.right);}};proto.setTop=function(_a){this.top=_a;};proto.setLeft=function(_a){this.left=_a;};proto.setBottom=function(_a){this.bottom=_a;};proto.setRight=function(_a){this.right=_a;};proto.isValid=function(){if(this.top=== -1){return false;}if(this.left=== -1){return false;}if(this.bottom=== -1){return false;}if(this.right=== -1){return false;}return true;};proto.addBoundary=function(_a,_b){var _c,_d;_c=this.addStartBoundary(_a,_b);_d=this.addEndBoundary(_a,_b);return _c||_d;};proto.merge=function(_a){var _b,_c;_b=this.addStartBoundary(_a.top,_a.left);_c=this.addEndBoundary(_a.bottom,_a.right);return _b||_c;};proto.addStartBoundary=function(_a,_b){var _c;_c=false;if(this.top=== -1||_a<this.top){this.top=_a;_c=true;}if(this.left=== -1||_b<this.left){this.left=_b;_c=true;}return _c;};proto.addEndBoundary=function(_a,_b){var _c;_c=false;if(this.bottom=== -1||this.bottom<_a){this.bottom=_a;_c=true;}if(this.right=== -1||this.right<_b){this.right=_b;_c=true;}return _c;};proto=null;}if(!RichTextEditor.TableUtil.Indexer){RichTextEditor.TableUtil.Indexer=function(){this.indexData=null;this.table=null;this.resetIndex();this.setTable(arguments[0]);this.makeIndex();};var proto=RichTextEditor.TableUtil.Indexer.prototype;proto.resetIndex=function(){this.indexData=[];};proto.setTable=function(_a){this.table=_a;};proto.makeIndex=function(){var _a,_b,_c,_d,_e,_f,_g,_h;_a=this.table.rows;_b=_a.length;for(_c=0;_c<_b;_c+=1){_d=_a[_c];_e=_d.cells;_f=_e.length;for(_g=0;_g<_f;_g+=1){_h=_e[_g];this.addCellIndex(_c,_h);}}};proto.addCellIndex=function(_a,_b){var _c,_d,_e,_f,_g,_h;_c=this.getNextCellIndex(this.indexData[_a]);_e=_b.rowSpan;for(_d=0;_d<_e;_d+=1){_f=_a+_d;if(!this.indexData[_f]){this.indexData[_f]=[];}_h=_b.colSpan;for(_g=0;_g<_h;_g+=1){this.indexData[_f][_c+_g]=_b;}}};proto.getNextCellIndex=function(_a){var _b,_c;if(!_a){return 0;}_c=_a.length;for(_b=0;_b<_c;_b+=1){if(!_a[_b]){break;}}return _b;};proto.getBoundary=function(_a){var _b,_c,_d,_e,_f,_g,_h;_b=new RichTextEditor.TableUtil.Boundary();_c=this.indexData;_d=_c.length;for(_e=0;_e<_d;_e+=1){_f=_c[_e];if(_f){_g=_f.length;for(_h=0;_h<_g;_h+=1){if(_f[_h]===_a){_b.addBoundary(_e,_h);}}}}return _b;};proto.addBoundary=function(_a,_b){var _c,_d;_c=this.addStartBoundary(_a,_b);_d=this.addEndBoundary(_a,_b);return _c||_d;};proto.merge=function(_a){var _b,_c;_b=this.addStartBoundary(_a.top,_a.left);_c=this.addEndBoundary(_a.bottom,_a.right);return _b||_c;};proto.addStartBoundary=function(_a,_b){var _c;_c=false;if(this.top=== -1||_a<this.top){this.top=_a;_c=true;}if(this.left=== -1||_b<this.left){this.left=_b;_c=true;}return _c;};proto.addEndBoundary=function(_a,_b){var _c;_c=false;if(this.bottom=== -1||this.bottom<_a){this.bottom=_a;_c=true;}if(this.right=== -1||this.right<_b){this.right=_b;_c=true;}return _c;};proto.getTdArr=function(_a){var _b,_c,_d,_e;_b=[];_c=_a.top;while(_c<=_a.bottom){_d=this.indexData[_c];_e=_a.left;while(_e<=_a.right){if(RichTextEditor.Lib.array.contains(_b,_d[_e])===false){_b.push(_d[_e]);}_e+=1;}_c+=1;}return _b;};proto.reload=function(){this.resetIndex();this.makeIndex();};proto.getRowSize=function(){return this.indexData.length;};proto.getColSize=function(){if(0<this.indexData.length){return this.indexData[0].length;}return 0;};proto.getTd=function(_a,_b){if(this.indexData[_a]){if(this.indexData[_a][_b]){return this.indexData[_a][_b];}}return null;};proto.getTdArrHasTop=function(_a){var _b,_c,_d,_e,_f;_b=[];_e=this.getColSize();for(_f=0;_f<_e;_f+=1){_c=this.getTd(_a,_f);_d=this.getTd(_a-1,_f);this.uniquePushWhenDifferent(_b,_c,_d);}return _b;};proto.getTdArrHasBottom=function(_a){var _b,_c,_d,_e,_f;_b=[];_e=this.getColSize();for(_f=0;_f<_e;_f+=1){_c=this.getTd(_a,_f);_d=this.getTd(_a+1,_f);this.uniquePushWhenDifferent(_b,_c,_d);}return _b;};proto.getTdArrHasLeft=function(_a){var _b,_c,_d,_e,_f;_b=[];_e=this.getRowSize();for(_f=0;_f<_e;_f+=1){_c=this.getTd(_f,_a);_d=this.getTd(_f,_a-1);this.uniquePushWhenDifferent(_b,_c,_d);}return _b;};proto.getTdArrHasRight=function(_a){var _b,_c,_d,_e,_f;_b=[];_e=this.getRowSize();for(_f=0;_f<_e;_f+=1){_c=this.getTd(_f,_a);_d=this.getTd(_f,_a+1);this.uniquePushWhenDifferent(_b,_c,_d);}return _b;};proto.uniquePushWhenDifferent=function(_a,_b,_c){if(_b!==_c){if(RichTextEditor.Lib.array.contains(_a,_b)===false){_a.push(_b);}}};proto=null;}