if(!window.RichTextEditor){window.RichTextEditor={};}if(!RichTextEditor.Table){RichTextEditor.Table=function(){this.doc=arguments[0];this.container=arguments[1];this.editor=arguments[2];this.selection=arguments[3];var _a=arguments[4];this.config={selectedColor:"#ceefff",borderRange:"all",borderColor:"#2462af",borderHeight:1,borderType:"solid"};RichTextEditor.Lib.object.copyProperties(this.config,_a);this.editorWin=this.editor.contentWindow;this.editorDoc=this.editor.contentDocument||this.editorWin.document;this.editorBody=this.editorDoc.body;this.colDragger;this.rowDragger;this.isDragging;this.minWidth=20;this.w3cBoxModelWorks;this.currentTable;this.currentTD;this.currentLeftTD;this.currentRightTD;this.currentLeftTDWidth;this.currentRightTDWidth;this.currentTDHeight;this.currentTableWidth;this.currentPointX;this.currentPointY;this.currentNode;this.currentDragger;this.movingX;this.movingY;this.leftTdArray;this.rightTdArray;this.topTdArray;this.leftWidthArr;this.rightWidthArr;this.topHeightArr;this.posiX;this.posiY;this.firedEvent;this.edgeType={top:"EDGE_TOP",bottom:"EDGE_BOTTOM",left:"EDGE_LEFT",right:"EDGE_RIGHT",none:"NONE"};this.currentEdgeType=this.edgeType.none;this.borderProperty={range:this.config.borderRange,color:this.config.borderColor,height:this.config.borderHeight,type:this.config.borderType};this.tableSelector=new RichTextEditor.Table.Selector(this.editor,this.config,this.selection);this.tableMerge=new RichTextEditor.Table.Merge(this.editor,this.config);this.tableInsert=new RichTextEditor.Table.Insert(this.editor,this.config);this.tableDelete=new RichTextEditor.Table.Delete(this.editor,this.config);this.tableBorder=new RichTextEditor.Table.Border(this.editor,this.config);this.checkW3cBoxModel();this.initDragger();};var proto=RichTextEditor.Table.prototype;proto.checkW3cBoxModel=function(){var _a=this.editorDoc.createElement("div");this.editorBody.appendChild(_a);_a.style.width=_a.style.paddingLeft="1px";this.w3cBoxModelWorks=_a.offsetWidth===2;this.editorBody.removeChild(_a);};proto.initDragger=function(){var _a='<div class="tx-table-col-resize-dragger" style="position:absolute; overflow:hidden; top: 0px; left: 0px; width: 3px; height: 100%; cursor:col-resize;"></div>',_b='<div class="tx-table-row-resize-dragger" style="position:absolute; overflow:hidden; top: 0px; left: 0px; width: 100%; height: 3px; cursor:row-resize;"></div>',_c=this.container,_d,_e=this;_d=this.doc.createElement('div');_d.innerHTML=_a;this.colDragger=_d.firstChild;RichTextEditor.DomUtil.insertFirst(_c,this.colDragger);RichTextEditor.Util.hide(this.colDragger);_d=this.doc.createElement('div');_d.innerHTML=_b;this.rowDragger=_d.firstChild;RichTextEditor.DomUtil.insertFirst(_c,this.rowDragger);RichTextEditor.Util.hide(this.rowDragger);this.resetDragger();RichTextEditor.Util.addEvent(this.doc.body,"mouseup",function(_f){_e.initElement(_f);_e.mouseUpHandler();});RichTextEditor.Util.addEvent(this.editorBody,"mousemove",function(_f){_e.initElement(_f);_e.mouseMoveHandler();});RichTextEditor.Util.addEvent(this.editorBody,"mouseup",function(_f){_e.initElement(_f);_e.mouseUpHandler();});RichTextEditor.Util.addEvent(this.colDragger,"mousedown",function(_f){_e.initElement(_f);_e.mouseDownHandler();});RichTextEditor.Util.addEvent(this.rowDragger,"mousedown",function(_f){_e.initElement(_f);_e.mouseDownHandler();});};proto.resetDragger=function(){this.isDragging=false;this.currentNode=null;this.currentDragger=null;this.currentTable=this.currentTD=null;this.currentLeftTD=this.currentRightTD=null;this.rightTdArray=this.leftTdArray=this.topTdArray=null;this.leftWidthArr=this.rightWidthArr=this.topHeightArr=null;this.movingX=this.movingY=0;this.currentTableWidth=this.currentPointX=this.currentPointY=0;this.currentLeftTDWidth=this.currentRightTDWidth=this.currentTDHeight=0;};proto.initElement=function(_a){this.firedEvent=_a;this.posiX=this.posX(_a);this.posiY=this.posY(_a);};proto.posX=function(_a){var _b=0;_a=_a||this.editorWin.event;if(_a.pageX){_b=_a.pageX;}else if(_a.clientX){_b=_a.clientX+this.editorBody.scrollLeft+this.editorDoc.documentElement.scrollLeft;}return _b;};proto.posY=function(_a){var _b=0;_a=_a||this.editorWin.event;if(_a.pageY){_b=_a.pageY;}else if(_a.clientY){_b=_a.clientY+this.editorBody.scrollTop+this.editorDoc.documentElement.scrollTop;}return _b;};proto.mouseDownHandler=function(){this.currentTable=RichTextEditor.DomUtil.find(this.currentNode,"table");if(this.currentTable==null){return null;}this.isDragging=true;this.currentTableWidth=this.currentTable.offsetWidth;if(this.currentEdgeType!=this.edgeType.none){RichTextEditor.Util.stop(this.firedEvent);this.showDragger();}switch(this.currentEdgeType){case this.edgeType.left:this.makeTDArrForLeftEdge();this.startResizeCol();break;case this.edgeType.right:this.makeTDArrForRightEdge();this.startResizeCol();break;case this.edgeType.top:this.makeTDArrForTopEdge();this.startResizeRow();break;case this.edgeType.bottom:this.makeTDArrForBottomEdge();this.startResizeRow();break;}};proto.mouseUpHandler=function(){switch(this.currentEdgeType){case this.edgeType.left:case this.edgeType.right:this.stopResizeCol();break;case this.edgeType.top:case this.edgeType.bottom:this.stopResizeRow();break;}};proto.mouseMoveHandler=function(){if(this.isDragging){this.currentDragger=this.getDragger();this.moveDraggingAction();}else{this.moveUnDraggingAction();}};proto.makeTDArrForLeftEdge=function(){var _a=new RichTextEditor.TableUtil.Indexer(this.currentTable);var _b=_a.getBoundary(this.currentNode);if(_b.left>0){this.leftTdArray=_a.getTdArrHasRight(_b.left-1);this.rightTdArray=_a.getTdArrHasLeft(_b.left);}};proto.makeTDArrForRightEdge=function(){var _a=new RichTextEditor.TableUtil.Indexer(this.currentTable);var _b=_a.getBoundary(this.currentNode);var _c=_a.getColSize();this.leftTdArray=_a.getTdArrHasRight(_b.right);if(_b.right<_c-1){this.rightTdArray=_a.getTdArrHasLeft(_b.right+1);}};proto.makeTDArrForTopEdge=function(){var _a=new RichTextEditor.TableUtil.Indexer(this.currentTable);var _b=_a.getBoundary(this.currentNode);this.topTdArray=_a.getTdArrHasBottom(_b.top-1);};proto.makeTDArrForBottomEdge=function(){var _a=new RichTextEditor.TableUtil.Indexer(this.currentTable);var _b=_a.getBoundary(this.currentNode);this.topTdArray=_a.getTdArrHasTop(_b.bottom);};proto.startResizeCol=function(){this.isDragging=true;this.leftWidthArr=[];this.rightWidthArr=[];var _a=0;if(this.leftTdArray){for(_a=0;_a<this.leftTdArray.length;_a++ ){this.leftWidthArr.push(this.leftTdArray[_a].offsetWidth);}this.currentLeftTDWidth=RichTextEditor.Lib.array.min(this.leftWidthArr);for(_a=0;_a<this.leftTdArray.length;_a++ ){if(this.currentLeftTDWidth==this.leftWidthArr[_a]){this.currentLeftTD=this.leftTdArray[_a];break;}}}if(this.rightTdArray){for(_a=0;_a<this.rightTdArray.length;_a++ ){this.rightWidthArr.push(this.rightTdArray[_a].offsetWidth);}this.currentRightTDWidth=RichTextEditor.Lib.array.min(this.rightWidthArr);for(_a=0;_a<this.rightTdArray.length;_a++ ){if(this.currentRightTDWidth==this.rightWidthArr[_a]){this.currentRightTD=this.rightTdArray[_a];break;}}}this.currentPointX=RichTextEditor.Util.getCoordsTarget(this.currentDragger).left;};proto.startResizeRow=function(){this.isDragging=true;this.currentTDHeight=this.currentNode.offsetHeight;this.topHeightArr=[];if(this.topTdArray){var _a;for(_a=0;_a<this.topTdArray.length;_a++ ){this.topHeightArr.push(parseInt(this.topTdArray[_a].offsetHeight));}this.currentTDHeight=RichTextEditor.Lib.array.min(this.topHeightArr);for(_a=0;_a<this.topTdArray.length;_a++ ){if(this.currentTDHeight==this.topHeightArr[_a]){this.currentTD=this.topTdArray[_a];}}}this.currentPointY=RichTextEditor.Util.getCoordsTarget(this.currentDragger).top;};proto.showDragger=function(){if(this.tableSelector.isDuringSelection()){this.currentEdgeType=this.edgeType.none;}switch(this.currentEdgeType){case this.edgeType.left:case this.edgeType.right:RichTextEditor.Util.hide(this.rowDragger);RichTextEditor.Util.show(this.colDragger);this.makeColDragger(this.colDragger);this.currentDragger=this.colDragger;break;case this.edgeType.top:case this.edgeType.bottom:RichTextEditor.Util.hide(this.colDragger);RichTextEditor.Util.show(this.rowDragger);this.makeRowDragger(this.rowDragger);this.currentDragger=this.rowDragger;break;case this.edgeType.none:RichTextEditor.Util.hide(this.colDragger);RichTextEditor.Util.hide(this.rowDragger);break;}};proto.makeColDragger=function(_a){if(_a==null){return;}var _b;if(this.isDragging){_b=RichTextEditor.Util.getCoordsTarget(_a).left;RichTextEditor.Util.setStyle(_a,{"width":"4px","top":RichTextEditor.Util.toPx(this.editor.offsetTop),"height":RichTextEditor.Util.toPx(this.editor.offsetHeight),"border":"1px dotted #81aFFC","background":"","left":RichTextEditor.Util.toPx(_b)});RichTextEditor.Util.setOpacity(_a,1);}else{_b=Math.round(this.posiX)+this.editor.offsetLeft-RichTextEditor.DomUtil.getScrollLeft(this.editorDoc);RichTextEditor.Util.setStyle(_a,{"width":"4px","top":RichTextEditor.Util.toPx(this.editor.offsetTop),"height":RichTextEditor.Util.toPx(this.editor.offsetHeight),"border":"","background":"blue","left":RichTextEditor.Util.toPx(_b)});RichTextEditor.Util.setOpacity(_a,0);}};proto.makeRowDragger=function(_a){if(_a==null){return;}var _b=null;if(this.isDragging){_b=RichTextEditor.Util.getCoordsTarget(_a).top;RichTextEditor.Util.setStyle(_a,{"left":RichTextEditor.Util.toPx(this.editor.offsetLeft),"width":RichTextEditor.Util.toPx(this.editor.offsetWidth),"height":"4px","border":"1px dotted #81aFFC","background":"","top":RichTextEditor.Util.toPx(_b)});RichTextEditor.Util.setOpacity(_a,1);}else{_b=Math.round(this.posiY)+this.editor.offsetTop-RichTextEditor.DomUtil.getScrollTop(this.editorDoc);RichTextEditor.Util.setStyle(_a,{"left":RichTextEditor.Util.toPx(this.editor.offsetLeft),"width":RichTextEditor.Util.toPx(this.editor.offsetWidth),"height":"4px","border":"","background":"blue","top":RichTextEditor.Util.toPx(_b)});RichTextEditor.Util.setOpacity(_a,0);}};proto.getDragger=function(){var _a=null;switch(this.currentEdgeType){case this.edgeType.left:case this.edgeType.right:_a=this.colDragger;break;case this.edgeType.top:case this.edgeType.bottom:_a=this.rowDragger;break;}return _a;};proto.moveDraggingAction=function(){switch(this.currentEdgeType){case this.edgeType.left:case this.edgeType.right:this.moveCalcResizeCol();break;case this.edgeType.top:case this.edgeType.bottom:this.moveCalcResizeRow();break;}};proto.moveUnDraggingAction=function(){var _a=RichTextEditor.DomUtil.find(RichTextEditor.Util.elementByEvent(this.firedEvent),"td");if(_a){this.currentNode=_a;this.currentEdgeType=this.getEdgeType(this.currentNode);this.showDragger();}else{this.currentEdgeType=this.edgeType.none;this.showDragger();}};proto.getEdgeType=function(_a){var _b,_c=this.edgeType.none;if("getBoundingClientRect" in document.documentElement){try{var _d=_a.ownerDocument,_e=_d.documentElement,_f=_d.body;var _g=_a.getBoundingClientRect(),_h=_d.defaultView||_d.parentWindow,_i=_e.clientTop||_f.clientTop||0,_j=_e.clientLeft||_f.clientLeft||0,_k=_h.pageYOffset||this.w3cBoxModelWorks&&_e.scrollTop||_f.scrollTop,_l=_h.pageXOffset||this.w3cBoxModelWorks&&_e.scrollLeft||_f.scrollLeft,_m=_g.top+_k-_i,_n=_g.left+_l-_j;_b={top:_m,left:_n,bottom:_m+_a.offsetHeight,right:_n+_a.offsetWidth};}catch(e){_b=null;}}if(!_b){_b=RichTextEditor.Util.getCoordsTarget(_a);}if((this.posiX-_b.left)<5&&_a.cellIndex!=0){_c=this.edgeType.left;}else if((_b.right-5)<this.posiX){_c=this.edgeType.right;}else if((this.posiY-_b.top)<5&&_a.parentNode.rowIndex!=0){_c=this.edgeType.top;}else if((_b.bottom-5)<this.posiY){_c=this.edgeType.bottom;}return _c;};proto.moveCalcResizeCol=function(){if(this.isDragging){var _a=parseInt(this.posiX-RichTextEditor.DomUtil.getScrollLeft(this.editorDoc)-this.currentPointX),_b;if(this.currentLeftTD&&this.currentRightTD){_b=this.calcMiddleCol(this.currentLeftTD,_a);}if(this.currentLeftTD&&this.currentRightTD==null){_b=this.calcLeft(this.currentLeftTD,_a);}if(this.currentLeftTD==null&&this.currentRightTD){_b=this.calcRight(this.currentRightTD,_a);}if(_b){RichTextEditor.Util.setStyle(this.currentDragger,{"left":RichTextEditor.Util.toPx(Math.round(_b))});}}};proto.calcMiddleCol=function(_a,_b){var _c=this.currentLeftTDWidth+this.currentRightTDWidth,_d=this.currentLeftTDWidth+_b,_e=this.currentRightTDWidth-_b,_f=RichTextEditor.Util.getCoordsTarget(_a),_g;if(_d>=this.minWidth&&_e>=this.minWidth){_g=this.posiX+this.editor.offsetLeft-RichTextEditor.DomUtil.getScrollLeft(this.editorDoc);}else if(_d<=this.minWidth){_d=this.minWidth;_e=_c-_d;_g=_f.left+this.editor.offsetLeft-RichTextEditor.DomUtil.getScrollLeft(this.editorDoc)+_d;}else if(_e<=this.minWidth){_e=this.minWidth;_d=_c-_e;_g=_f.left+this.editor.offsetLeft-RichTextEditor.DomUtil.getScrollLeft(this.editorDoc)+_d;}this.movingX=_d-this.currentLeftTDWidth+this.editor.offsetLeft;return _g;};proto.calcLeft=function(_a,_b){var _c=this.currentLeftTDWidth+_b,_d=RichTextEditor.Util.getCoordsTarget(_a),_e;if(_c<this.minWidth){_c=this.minWidth;}_e=_d.left+this.editor.offsetLeft-RichTextEditor.DomUtil.getScrollLeft(this.editorDoc)+_c;this.movingX=_c-this.currentLeftTDWidth+this.editor.offsetLeft;return _e;};proto.calcRight=function(_a,_b){var _c=this.currentRightTDWidth-_b,_d=RichTextEditor.Util.getCoordsTarget(_a),_e;if(_c<this.minWidth){_c=this.minWidth;}_e=_d.left-this.editor.offsetLeft+_c;this.movingX=this.currentRightTDWidth-_c-this.editor.offsetLeft;return _e;};proto.moveCalcResizeRow=function(){if(this.isDragging){var _a=this.posiY-RichTextEditor.DomUtil.getScrollTop(this.editorDoc)-this.currentPointY,_b=this.currentTDHeight+parseInt(_a)+this.editor.offsetTop,_c=RichTextEditor.Util.getCoordsTarget(this.currentTD),_d=null;if(_b<0){_b=0;_d=_c.top+_b-RichTextEditor.DomUtil.getScrollTop(this.editorDoc);}else{_d=this.posiY-RichTextEditor.DomUtil.getScrollTop(this.editorDoc);}if(_d){RichTextEditor.Util.setStyle(this.currentDragger,{"top":RichTextEditor.Util.toPx(Math.round(_d))});}this.movingY=_b-this.currentTDHeight;}};proto.stopResizeCol=function(){this.resizeWidth();this.resetDragger();this.moveUnDraggingAction();this._editor.history.saveHistory();};proto.resizeWidth=function(){var _a;if(this.leftTdArray){for(_a=0;_a<this.leftTdArray.length;_a++ ){this.leftTdArray[_a].style.width=this.leftWidthArr[_a]+this.movingX;}}if(this.rightTdArray){for(_a=0;_a<this.rightTdArray.length;_a++ ){this.rightTdArray[_a].style.width=this.rightWidthArr[_a]-this.movingX;}}if(this.leftTdArray&&this.rightTdArray==null){this.resizeTableWidth();}};proto.resizeTableWidth=function(){var _a=0;if(this.currentTableWidth){_a=parseInt(this.currentTableWidth)+this.movingX;this.currentTable.width=_a;this.currentTable.style.width=RichTextEditor.Util.toPx(_a);}};proto.stopResizeRow=function(){this.resizeHeight();this.resetDragger();this.moveUnDraggingAction();this._editor.history.saveHistory();};proto.resizeHeight=function(){if(this.topTdArray){for(var _b=0;_b<this.topTdArray.length;_b++ ){var _a=this.topHeightArr[_b]+this.movingY;if(_a<0){_a=20;}if(RichTextEditor.Browser=="IE"&&RichTextEditor.BrowserVersion<11){}this.topTdArray[_b].style.height=RichTextEditor.Util.toPx(_a);}}};proto.setBackgroundColor=function(){var _a=this,_b=arguments[0];this.execute(function(){var _c,_d,_e,_f;_c={"backgroundColor":_b};_d=_a.getTdArr();_f=_d.length;for(_e=0;_e<_f;_e+=1){RichTextEditor.Util.setStyle(_d[_e],_c);}_a.tableSelector.reset();});};proto.setVerticalAlign=function(){var _a=this,_b=arguments[0];this.execute(function(){var _c,_d,_e,_f;_c={"verticalAlign":_b};_d=_a.getTdArr();_f=_d.length;for(_e=0;_e<_f;_e+=1){RichTextEditor.Util.setStyle(_d[_e],_c);}_a.tableSelector.reset();});};proto.isSelectedTd=function(){return this.tableSelector.getSelected().isValid();};proto.getTdArr=function(){return this.tableSelector.getSelectedTdArr();};proto.merge=function(){var _a=this;this.execute(function(){_a.tableMerge.merge(_a.tableSelector);},true);};proto.resetMerge=function(){var _a=this;this.execute(function(){_a.tableMerge.resetMerge(_a.tableSelector);});};proto.insertRowAbove=function(){var _a=this;this.execute(function(){_a.tableInsert.insertRowAbove(_a.tableSelector);});};proto.insertRowBelow=function(){var _a=this;this.execute(function(){_a.tableInsert.insertRowBelow(_a.tableSelector);});};proto.insertColLeft=function(){var _a=this;this.execute(function(){_a.tableInsert.insertColLeft(_a.tableSelector);});};proto.insertColRight=function(){var _a=this;this.execute(function(){_a.tableInsert.insertColRight(_a.tableSelector);});};proto.deleteRow=function(){var _a=this;this.execute(function(){_a.tableDelete.deleteRow(_a.tableSelector);});};proto.deleteCol=function(){var _a=this;this.execute(function(){_a.tableDelete.deleteCol(_a.tableSelector);});};proto.setBorderColor=function(){var _a=arguments[0];this.borderProperty.color=_a;if(this.borderProperty.range=='none'){this.setNoBorder();}else{this.applyBorder();}};proto.setBorderHeight=function(){var _a=arguments[0];this.borderProperty.height=_a;if(this.borderProperty.range=='none'){this.setNoBorder();}else{this.applyBorder();}};proto.setBorderType=function(_a){this.borderProperty.type=_a;};proto.setBorderRange=function(){var _a=arguments[0].split(","),_b=_a[0],_c=_a[1];this.borderProperty.range=_b;this.borderProperty.type=_c;if(_b=='none'){this.setNoBorder();}else{this.applyBorder();}};proto.setNoBorder=function(){var _a=this;return this.execute(function(){_a.tableBorder.setTableSelect(_a.tableSelector);_a.tableBorder.setBorderRange("all");_a.tableBorder.changeBorderColor(_a.getTdArr(),"");_a.tableBorder.changeBorderHeight(_a.getTdArr(),"0");_a.tableBorder.changeBorderType(_a.getTdArr(),"none");});};proto.applyBorder=function(){var _a=this;return this.execute(function(){_a.tableBorder.setTableSelect(_a.tableSelector);_a.tableBorder.setBorderRange(_a.borderProperty.range);_a.tableBorder.changeBorderColor(_a.getTdArr(),_a.borderProperty.color);_a.tableBorder.changeBorderHeight(_a.getTdArr(),_a.borderProperty.height);_a.tableBorder.changeBorderType(_a.getTdArr(),_a.borderProperty.type);});};proto.execute=function(_a,_b){if(!_b){this.selectCellByCaret();}if(this.isSelectedTd()){_a();this._editor.history.saveHistory();}else{alert("테이블을 선택하신 후 사용가능합니다.");return false;}};proto.selectCellByCaret=function(){var _a,_b;if(this.isSelectedTd()===false){_a=this.selection.getNode();_b=RichTextEditor.TableUtil.getClosestByTagNames(["td","th"],_a);if(_b){this.tableSelector.selectByTd(_b,_b);}}};proto=null;}if(!RichTextEditor.Table.Border){RichTextEditor.Table.Border=function(){this.editor=arguments[0];this.config=arguments[1];this.editorWin=this.editor.contentWindow;this.editorDoc=this.editor.contentDocument||this.editorWin.document;this.editorBody=this.editorDoc.body;this.borderRange=this.config.borderRange;this.borderColor=this.config.borderColor;this.tableSelect=null;this.selectedBoundary=null;};var proto=RichTextEditor.Table.Border.prototype;proto.setBorderRange=function(_a){this.borderRange=_a;};proto.setTableSelect=function(_a){this.tableSelect=_a;this.selectedBoundary=_a.getSelected();};proto.changeTopBorderStyle=function(_a,_b,_c){var _d={};var _e=this.selectedBoundary;var _f,_g;var _h=this.tableSelect.getIndexer();var _i;if(_e.top==0){_f="borderTop"+_b;_i=new RichTextEditor.TableUtil.Boundary({"top":_e.top,"bottom":_e.top,"left":_e.left,"right":_e.right});}else{_f="borderBottom"+_b;_i=new RichTextEditor.TableUtil.Boundary({"top":_e.top-1,"bottom":_e.top-1,"left":_e.left,"right":_e.right});}_g=_h.getTdArr(_i);_d[_f]=_c;for(var _j=0;_j<_g.length;_j++ ){RichTextEditor.Util.setStyle(_g[_j],_d);}};proto.changeBottomBorderStyle=function(_a,_b,_c){var _d={};var _e=this.selectedBoundary;var _f,_g,_h;var _i=this.tableSelect.getIndexer();_f="borderBottom"+_b;_h=new RichTextEditor.TableUtil.Boundary({"top":_e.bottom,"bottom":_e.bottom,"left":_e.left,"right":_e.right});_g=_i.getTdArr(_h);_d[_f]=_c;for(var _j=0;_j<_g.length;_j++ ){RichTextEditor.Util.setStyle(_g[_j],_d);}};proto.changeLeftBorderStyle=function(_a,_b,_c){var _d={};var _e=this.selectedBoundary;var _f,_g;var _h=this.tableSelect.getIndexer();var _i;if(_e.left==0){_f="borderLeft"+_b;_i=new RichTextEditor.TableUtil.Boundary({"top":_e.top,"bottom":_e.bottom,"left":_e.left,"right":_e.left});}else{_f="borderRight"+_b;_i=new RichTextEditor.TableUtil.Boundary({"top":_e.top,"bottom":_e.bottom,"left":_e.left-1,"right":_e.left-1});}_g=_h.getTdArr(_i);_d[_f]=_c;for(var _j=0;_j<_g.length;_j++ ){RichTextEditor.Util.setStyle(_g[_j],_d);}};proto.changeRightBorderStyle=function(_a,_b,_c){var _d={};var _e=this.selectedBoundary;var _f,_g;var _h=this.tableSelect.getIndexer();var _i;_f="borderRight"+_b;_i=new RichTextEditor.TableUtil.Boundary({"top":_e.top,"bottom":_e.bottom,"left":_e.right,"right":_e.right});_g=_h.getTdArr(_i);_d[_f]=_c;for(var _j=0;_j<_g.length;_j++ ){RichTextEditor.Util.setStyle(_g[_j],_d);}};proto.changeInBorderStyle=function(_a,_b,_c){var _d={};var _e={};var _f=this.selectedBoundary;var _g,_h,_i,_j;var _k,_l;var _m=this.tableSelect.getIndexer();_i="borderBottom"+_b;_k=new RichTextEditor.TableUtil.Boundary({"top":_f.top,"bottom":_f.bottom-1,"left":_f.left,"right":_f.right});_g=_m.getTdArr(_k);_d[_i]=_c;for(var _n=0;_n<_g.length;_n++ ){RichTextEditor.Util.setStyle(_g[_n],_d);}_j="borderRight"+_b;_l=new RichTextEditor.TableUtil.Boundary({"top":_f.top,"bottom":_f.bottom,"left":_f.left,"right":_f.right-1});_h=_m.getTdArr(_l);_e[_j]=_c;for(var _n=0;_n<_h.length;_n++ ){RichTextEditor.Util.setStyle(_h[_n],_e);}};proto.changeOutBorderStyle=function(_a,_b,_c){this.changeTopBorderStyle(_a,_b,_c);this.changeBottomBorderStyle(_a,_b,_c);this.changeLeftBorderStyle(_a,_b,_c);this.changeRightBorderStyle(_a,_b,_c);};proto.changeBorderStyle=function(_a,_b,_c){var _d=this.borderRange;switch(_d){case "top":this.changeTopBorderStyle(_a,_b,_c);break;case "bottom":this.changeBottomBorderStyle(_a,_b,_c);break;case "left":this.changeLeftBorderStyle(_a,_b,_c);break;case "right":this.changeRightBorderStyle(_a,_b,_c);break;case "in":this.changeInBorderStyle(_a,_b,_c);break;case "out":this.changeOutBorderStyle(_a,_b,_c);break;case "all":this.changeInBorderStyle(_a,_b,_c);this.changeOutBorderStyle(_a,_b,_c);break;case "none":this.changeInBorderStyle(_a,_b,_c);this.changeOutBorderStyle(_a,_b,_c);break;default:break;}};proto.changeBorderColor=function(_a,_b){if(_b!=null){this.borderColor=_b;}this.changeBorderStyle(_a,"Color",this.borderColor);};proto.changeBorderType=function(_a,_b){this.changeBorderStyle(_a,"Style",_b);this.changeBorderColor(_a);};proto.changeBorderHeight=function(_a,_b){var _c=RichTextEditor.Util.toPx(_b);this.changeBorderStyle(_a,"Width",_c);this.changeBorderColor(_a);};proto=null;}if(!RichTextEditor.Table.Delete){RichTextEditor.Table.Delete=function(){this.editor=arguments[0];this.config=arguments[1];this.editorWin=this.editor.contentWindow;this.editorDoc=this.editor.contentDocument||this.editorWin.document;this.editorBody=this.editorDoc.body;};var proto=RichTextEditor.Table.Delete.prototype;proto.deleteRow=function(_a){var _b;_b=_a.getSelected();if(_b.isValid()){this.deleteRowOneByOne(_a);_a.reset();this.deleteEmptyTableByTableSelector(_a);}};proto.deleteRowOneByOne=function(_a){var _b,_c,_d,_e;_d=_a.getSelected();_b=_d.top;_c=_d.bottom-_d.top+1;while(0<_c){_a.reloadIndexer();_e=_a.getIndexer();this.deleteRowByIndex(_e,_b);_c-=1;}if(_b===0){this.drawTopBorder(_a);}if(RichTextEditor.Browser=="IE"){window.focus();}};proto.drawTopBorder=function(_a){var _b,_c,_d,_e,_f;_a.reloadIndexer();_b=_a.getIndexer();_c=_b.getTdArrHasTop(0);_d=_c.length;for(_e=0;_e<_d;_e+=1){_f=_c[_e];if(_f.style.borderTop===""&&_f.style.borderBottom!==""){_f.style.borderTop=_f.style.borderBottom;}}};proto.deleteRowByIndex=function(_a,_b){var _c,_d,_e,_f;_c=this.getTdArrByRowIndex(_a,_b);_d=this.getTdArrByHasTop(_a,_b);_e=_c.length;if(0<_e){_f=RichTextEditor.DomUtil.parent(_c[0]);this.deleteTdInDeleteRow(_c,_d,_f,_a);RichTextEditor.DomUtil.remove(_f);}};proto.getTdArrByRowIndex=function(_a,_b){return _a.getTdArr(new RichTextEditor.TableUtil.Boundary({top:_b,right:_a.getColSize()-1,bottom:_b,left:0}));};proto.getTdArrByHasTop=function(_a,_b){return _a.getTdArrHasTop(_b);};proto.deleteTdInDeleteRow=function(_a,_b,_c,_d){var _e,_f,_g;_e=_a.length;for(_f=0;_f<_e;_f+=1){_g=_a[_f];if(1<_g.rowSpan){_g.rowSpan-=1;this.reduceHeightAsRow(_g,_c);if(RichTextEditor.Lib.array.contains(_b,_g)){this.shiftRowOfTd(_g,_d);}}else{RichTextEditor.DomUtil.remove(_g);}}};proto.reduceHeightAsRow=function(_a,_b){var _c,_d;if(_a.style.height){_c=parseInt(_a.style.height,10);_d=_c-_b.offsetHeight;if(0<_d){RichTextEditor.Util.setStyle(_a,{'height':_d+"px"});}}};proto.shiftRowOfTd=function(_a,_b){var _c,_d,_e;_c=RichTextEditor.DomUtil.parent(_a);_d=RichTextEditor.DomUtil.next(_c,"tr");_e=this.getTdForInsert(_a,_d,_b);if(_e){RichTextEditor.DomUtil.insertAt(_a,_e);}else{RichTextEditor.DomUtil.append(_d,_a);}};proto.getTdForInsert=function(_a,_b,_c){var _d,_e,_f,_g,_h,_i,_j;_d=_c.getBoundary(_a);_e=_d.left;_f=_b.cells;_g=_f.length;for(_h=0;_h<_g;_h+=1){_i=_f[_h];_j=_c.getBoundary(_i);if(_e<=_j.left){return _i;}}return null;};proto.deleteEmptyTableByTableSelector=function(_a){var _b,_c,_d,_e;_b=_a.getIndexer();_c=_b.table;_d=_b.getRowSize();_e=_b.getColSize();if(_d===0||_e===0){RichTextEditor.DomUtil.remove(_c);}};proto.deleteCol=function(_a){var _b;_b=_a.getSelected();if(_b.isValid()){this.deleteColOneByOne(_a);_a.reset();this.deleteEmptyTableByTableSelector(_a);}};proto.deleteColOneByOne=function(_a){var _b,_c,_d,_e;_d=_a.getSelected();_b=_d.left;_c=_d.right-_d.left+1;while(0<_c){_a.reloadIndexer();_e=_a.getIndexer();this.deleteColByIndex(_e,_b);_c-=1;}if(_b===0){this.drawLeftBorder(_a);}if(RichTextEditor.Browser=="IE"){window.focus();}};proto.drawLeftBorder=function(_a){var _b,_c,_d,_e,_f;_a.reloadIndexer();_b=_a.getIndexer();_c=_b.getTdArrHasLeft(0);_d=_c.length;for(_e=0;_e<_d;_e+=1){_f=_c[_e];if(_f.style.borderLeft===""&&_f.style.borderRight!==""){_f.style.borderLeft=_f.style.borderRight;}}};proto.deleteColByIndex=function(_a,_b){var _c,_d,_e,_f;_c=this.getTdArrByColIndex(_a,_b);_d=_c.length;for(_e=0;_e<_d;_e+=1){_f=_c[_e];if(1<_f.colSpan){_f.colSpan-=1;}else{RichTextEditor.DomUtil.remove(_f);}}};proto.getTdArrByColIndex=function(_a,_b){return _a.getTdArr(new RichTextEditor.TableUtil.Boundary({top:0,right:_b,bottom:_a.getRowSize()-1,left:_b}));};proto=null;}if(!RichTextEditor.Table.Insert){RichTextEditor.Table.Insert=function(){this.editor=arguments[0];this.config=arguments[1];this.editorWin=this.editor.contentWindow;this.editorDoc=this.editor.contentDocument||this.editorWin.document;this.editorBody=this.editorDoc.body;this.colDirection={left:"left",right:"right"};};var proto=RichTextEditor.Table.Insert.prototype;proto.insertRowAbove=function(_a){var _b,_c;_a.reloadIndexer();_b=_a.getSelected();if(_b.isValid()){_c=_a.getIndexer();this.insertRowAboveByBoundary(_b,_c);_a.reset();}};proto.insertRowAboveByBoundary=function(_a,_b){var _c,_d,_e,_f,_g;_c=_b.table;_d=_a.bottom-_a.top+1;_e=_a.top;var _h=new RichTextEditor.TableUtil.Boundary({top:_a.top,right:_b.getColSize()-1,bottom:_a.top,left:0});_f=_b.getTdArr(new RichTextEditor.TableUtil.Boundary({top:_a.top,right:_b.getColSize()-1,bottom:_a.top,left:0}));_g=_b.getTdArrHasTop(_a.top);this.addRow(_c,_d,_e,_f,_g);};proto.addRow=function(_a,_b,_c,_d,_e){var _f,_g,_h;_f=function(_i){var _j;if(RichTextEditor.Lib.array.contains(_e,_i)){_j=RichTextEditor.TableUtil.cloneNodeForEmptyTd(_i);RichTextEditor.TableUtil.splitHeightByRowSpan(_j);_j.rowSpan=1;_h.appendChild(_j);}else{_i.rowSpan+=1;}};for(_g=0;_g<_b;_g+=1){_h=_a.insertRow(_c);RichTextEditor.Lib.array.Each(_d,_f);}};proto.insertRowBelow=function(_a){var _b,_c;_a.reloadIndexer();_b=_a.getSelected();if(_b.isValid()){_c=_a.getIndexer();this.insertRowBelowByBoundary(_b,_c);_a.reset();}};proto.insertRowBelowByBoundary=function(_a,_b){var _c,_d,_e,_f,_g;_c=_b.table;_d=_a.bottom-_a.top+1;_e=_a.bottom+1;_f=_b.getTdArr(new RichTextEditor.TableUtil.Boundary({top:_a.bottom,right:_b.getColSize()-1,bottom:_a.bottom,left:0}));_g=_b.getTdArrHasBottom(_a.bottom);this.addRow(_c,_d,_e,_f,_g);};proto.insertColLeft=function(_a){var _b,_c;_a.reloadIndexer();_b=_a.getSelected();if(_b.isValid()){_c=_a.getIndexer();this.insertColLeftByBoundary(_b,_c);_a.reset();}};proto.insertColLeftByBoundary=function(_a,_b){var _c,_d,_e;_c=_a.right-_a.left+1;_d=_b.getTdArr(new RichTextEditor.TableUtil.Boundary({top:0,right:_a.left,bottom:_b.getRowSize()-1,left:_a.left}));_e=_b.getTdArrHasLeft(_a.left);this.addCol(_c,_d,_e,this.colDirection.left);};proto.addCol=function(_a,_b,_c,_d){var _e,_f,_g;_e=this;_f=function(_h){var _i;if(RichTextEditor.Lib.array.contains(_c,_h)){_i=RichTextEditor.TableUtil.cloneNodeForEmptyTd(_h);RichTextEditor.TableUtil.splitWidthByColSpan(_i);_i.colSpan=1;if(_d===_e.colDirection.left){RichTextEditor.DomUtil.insertAt(_i,_h);}else{RichTextEditor.DomUtil.insertNext(_i,_h);}}else{_h.colSpan+=1;}};for(_g=0;_g<_a;_g+=1){RichTextEditor.Lib.array.Each(_b,_f);}};proto.insertColRight=function(_a){var _b,_c;_a.reloadIndexer();_b=_a.getSelected();if(_b.isValid()){_c=_a.getIndexer();this.insertColRightByBoundary(_b,_c);_a.reset();}};proto.insertColRightByBoundary=function(_a,_b){var _c,_d,_e;_c=_a.right-_a.left+1;_d=_b.getTdArr(new RichTextEditor.TableUtil.Boundary({top:0,right:_a.right,bottom:_b.getRowSize()-1,left:_a.right}));_e=_b.getTdArrHasRight(_a.right);this.addCol(_c,_d,_e,this.colDirection.right);};proto=null;}if(!RichTextEditor.Table.Merge){RichTextEditor.Table.Merge=function(){this.editor=arguments[0];this.config=arguments[1];this.editorWin=this.editor.contentWindow;this.editorDoc=this.editor.contentDocument||this.editorWin.document;this.editorBody=this.editorDoc.body;};var proto=RichTextEditor.Table.Merge.prototype;proto.merge=function(_a){var _b,_c,_d;_a.reloadIndexer();_b=_a.getSelectedTdArr();if(1<_b.length){_d=_a.getSizeOfSelected();_c=_b[0];this.deleteCellForMerge(_b);this.extendCellForMerge(_c,_a,_d);_a.reset();_a.selectByTd(_c,_c);}else{alert("두개 이상의 셀을 선택해주세요.");}};proto.deleteCellForMerge=function(_a){var _b,_c,_d,_e;_b=_a[0].innerHTML;_e=_a.length;for(_d=1;_d<_e;_d+=1){_c=RichTextEditor.Util.trim(_b.replace(/\ufeff/g,""));if(_c===""||_c==="&nbsp;"){_b=_a[_d].innerHTML;}RichTextEditor.DomUtil.remove(_a[_d]);}_a[0].innerHTML=_b;};proto.extendCellForMerge=function(_a,_b,_c){var _d;_d=_b.getSelected();_a.colSpan=_d.right-_d.left+1;_a.rowSpan=_d.bottom-_d.top+1;if(_a.style.width){RichTextEditor.DomUtil.setWidth(_a,_c.width+"px");}if(_a.style.height){RichTextEditor.DomUtil.setHeight(_a,_c.height+"px");}};proto.resetMerge=function(_a){var _b,_c;_a.reloadIndexer();_b=this.splitCol(_a);_a.reloadIndexer();_c=this.splitRow(_a);if(_b===false&&_c===false){alert("이미 합쳐진 셀만 분할 가능합니다.");}else{_a.reloadIndexer();}};proto.splitCol=function(_a){var _b,_c,_d,_e,_f,_g;_b=false;_c=_a.getSelectedTdArr();_f=_c.length;if(0<_f){for(_e=0;_e<_f;_e+=1){_d=_c[_e];_g=this.splitTdByColSpan(_d);_b=_b||_g;}}return _b;};proto.splitRow=function(_a){var _b,_c,_d,_e,_f,_g;_b=false;_c=_a.getSelectedTdArr();_f=_c.length;if(0<_f){for(_e=0;_e<_f;_e+=1){_d=_c[_e];_g=this.splitTdByRowSpan(_d);_b=_b||_g;}}return _b;};proto.splitTdByColSpan=function(_a){var _b,_c,_d;_b=_a.colSpan-1;_d=0<_b;RichTextEditor.TableUtil.splitWidthByColSpan(_a);_a.colSpan=1;while(0<_b){_c=RichTextEditor.TableUtil.cloneNodeForEmptyTd(_a);RichTextEditor.DomUtil.insertNext(_c,_a);_b-=1;}return _d;};proto.splitTdByRowSpan=function(_a){var _b,_c;_c=_a.rowSpan-1;_b=0<_c;RichTextEditor.TableUtil.splitHeightByRowSpan(_a);while(0<_c){this.splitTdOneByOne(_a);_c-=1;}return _b;};proto.splitTdOneByOne=function(_a){var _b,_c,_d;_b=this.getTrForInsert(_a);_c=this.getTdForInsert(_a,_b);_d=RichTextEditor.TableUtil.cloneNodeForEmptyTd(_a);_d.rowSpan=1;_a.rowSpan-=1;if(_c){RichTextEditor.DomUtil.insertAt(_d,_c);}else{RichTextEditor.DomUtil.append(_b,_d);}};proto.getTrForInsert=function(_a){var _b,_c,_d;_d=RichTextEditor.DomUtil.parent(_a);_c=_a.rowSpan-1;for(_b=0;_b<_c;_b+=1){_d=RichTextEditor.DomUtil.next(_d,"tr");}return _d;};proto.getTdForInsert=function(_a,_b){var _c,_d,_e,_f,_g,_h,_i,_j;_c=RichTextEditor.TableUtil.getTableIndexerFromTd(_a);_d=_c.getBoundary(_a);_e=_d.left;_f=_b.cells;_g=_f.length;for(_h=0;_h<_g;_h+=1){_i=_f[_h];_j=_c.getBoundary(_i);if(_e<=_j.left){return _i;}}return null;};proto=null;}if(!RichTextEditor.Table.Selector){RichTextEditor.Table.Selector=function(){this.editor=arguments[0];this.config=arguments[1];this.selection=arguments[2];this.editorWin=this.editor.contentWindow;this.editorDoc=this.editor.contentDocument||this.editorWin.document;this.editorBody=this.editorDoc.body;this.selectedClassName="tx_table_selected_cell";this.selectedCssText="{background:"+this.config.selectedColor+" !important}";this.isDragging=false;this.currentTable=null;this.currentTd=null;this.paintedTdArr=[];this.startCellBoundary=new RichTextEditor.TableUtil.Boundary();this.endCellBoundary=this.startCellBoundary;this.selectedBoundary=new RichTextEditor.TableUtil.Boundary();this.tableIndexer=null;this.createdRange=null;this.applyCss();this.bindEvents();};var proto=RichTextEditor.Table.Selector.prototype;proto.applyCss=function(){RichTextEditor.Util.applyCSSText(this.editorDoc,"."+this.selectedClassName+this.selectedCssText);};proto.bindEvents=function(){var _a=this;RichTextEditor.Util.addEvent(this.editorDoc,"mousedown",function(_b){_a.onMouseDown(_b);});RichTextEditor.Util.addEvent(this.editorDoc,"mousemove",function(_b){_a.onMouseMove(_b);});RichTextEditor.Util.addEvent(this.editorWin,"mouseup",function(_b){_a.onMouseUp(_b);});RichTextEditor.Util.addEvent(this.editorBody,"keydown",function(_b){if(_a.isDragging){RichTextEditor.Util.stop(_b);_a.reset();}else{_a.onKeyDown(_b);}});RichTextEditor.Util.addEvent(this.editorBody,"keyup",function(_b){if(_a.isDragging){RichTextEditor.Util.stop(_b);_a.reset();}});};proto.onMouseDown=function(_a){var _b=RichTextEditor.Util.elementByEvent(_a);var _c,_d;this.reset();_c=RichTextEditor.TableUtil.getClosestByTagNames(["td","th"],_b);if(_c){this.selectStart(_c);this.turnOnDragging();}};proto.onMouseMove=function(_a){var _b=RichTextEditor.Util.elementByEvent(_a);var _c,_d,_e;if(this.isDragging){_c=RichTextEditor.TableUtil.getClosestByTagNames(["td","th"],_b);if(_c){_d=RichTextEditor.TableUtil.getClosestByTagNames(["table"],_c);if(_d===this.currentTable&&_c!==this.currentTd){this.selectEnd(_c);this.applySelected();this.selection.removeSelection();}}else{_e=(this.endCellBoundary===this.startCellBoundary);if(this.currentTd&&_e){this.selectEnd(this.currentTd);this.applySelected();this.selection.removeSelection();}}}};proto.onMouseUp=function(_a){if(this.isDragging){this.turnOffDragging();}};proto.onKeyDown=function(_a){var _b=_a.ctrlKey,_c=_a.keyCode,_d,_e,_f;if(_b===false){if(_c===46){_d=this.getSelectedTdArr();_e=_d.length;for(_f=0;_f<_e;_f+=1){RichTextEditor.TableUtil.emptyTd(_d[_f]);}}this.reset();}};proto.reset=function(){this.clearSelected();this.resetBoundary();this.resetDragging();this.reloadIndexer();};proto.clearSelected=function(){var _a;_a=RichTextEditor.DomUtil.collectAll(this.editorDoc,"."+this.selectedClassName);this.removeClassName(_a);this.paintedTdArr=[];};proto.resetBoundary=function(){this.startCellBoundary=new RichTextEditor.TableUtil.Boundary();this.endCellBoundary=this.startCellBoundary;this.selectedBoundary=new RichTextEditor.TableUtil.Boundary();};proto.resetDragging=function(){this.isDragging=false;this.currentTable=null;this.currentTd=null;};proto.reloadIndexer=function(){if(this.tableIndexer){this.tableIndexer.reload();}};proto.selectStart=function(_a){this.currentTable=RichTextEditor.TableUtil.getClosestByTagNames(["table"],_a);this.tableIndexer=new RichTextEditor.TableUtil.Indexer(this.currentTable);this.startCellBoundary=this.tableIndexer.getBoundary(_a);this.endCellBoundary=this.startCellBoundary;this.currentTd=_a;};proto.selectEnd=function(_a){this.endCellBoundary=this.tableIndexer.getBoundary(_a);this.currentTd=_a;};proto.applySelected=function(){this.calculateSelectedBoundary();this.extendSelectedBoundary();this.paint();};proto.calculateSelectedBoundary=function(){this.selectedBoundary=new RichTextEditor.TableUtil.Boundary();this.selectedBoundary.merge(this.startCellBoundary);this.selectedBoundary.merge(this.endCellBoundary);};proto.extendSelectedBoundary=function(){var _a;_a=this.selectedBoundary.isValid();while(_a){_a=this.oneTimeExtendBoundary();}};proto.oneTimeExtendBoundary=function(){var _a,_b,_c,_d,_e;_a=this.tableIndexer.getTdArr(this.selectedBoundary);_c=_a.length;for(_b=0;_b<_c;_b+=1){_d=this.tableIndexer.getBoundary(_a[_b]);_e=this.selectedBoundary.merge(_d);if(_e){return true;}}return false;};proto.paint=function(){var _a,_b;_a=this.tableIndexer.getTdArr(this.selectedBoundary);_b=RichTextEditor.Lib.array.difference(this.paintedTdArr,_a);this.paintSelected(_a);this.eraseSelected(_b);};proto.paintSelected=function(_a){var _b=this;this.paintedTdArr=[];RichTextEditor.Lib.array.Each(_a,function(_c){RichTextEditor.Util.addClassName(_c,_b.selectedClassName);_b.paintedTdArr.push(_c);});};proto.eraseSelected=function(_a){this.removeClassName(_a);this.paintedTdArr=RichTextEditor.Lib.array.difference(this.paintedTdArr,_a);};proto.removeClassName=function(_a){var _b=this;RichTextEditor.Lib.array.Each(_a,function(_c){var _d;RichTextEditor.Util.removeClassName(_c,_b.selectedClassName);if(_c.className===""){_d=_c.removeAttribute("class");if(_d===false){_c.removeAttribute("className");}}});};proto.turnOnDragging=function(){this.isDragging=true;};proto.turnOffDragging=function(){this.isDragging=false;};proto.getSelectedTdArr=function(){if(this.selectedBoundary.isValid()){return this.tableIndexer.getTdArr(this.selectedBoundary);}return [];};proto.getSizeOfSelected=function(){var _a,_b,_c,_d,_e;_a=this.getSelectedTdArr();if(0<_a.length){_b=_a[0];_c=_a[_a.length-1];_d=RichTextEditor.DomUtil.getPosition(_b);_e=RichTextEditor.DomUtil.getPosition(_c);return {width:_e.x+_e.width-_d.x,height:_e.y+_e.height-_d.y};}return {width:0,height:0};};proto.selectByTd=function(_a,_b){this.selectStart(_a);this.selectEnd(_b);this.applySelected();};proto.getSelected=function(){return this.selectedBoundary;};proto.getIndexer=function(){return this.tableIndexer;};proto.isDuringSelection=function(){return this.isDragging;};proto=null;}