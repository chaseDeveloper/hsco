if(!window.RichTextEditor){window.RichTextEditor={};}if(!RichTextEditor.Editor){RichTextEditor.Editor=function(){this.doc=document;this.docBody=this.doc.body;var _a=arguments[0]||{};this.config={container:"__rich_text_editor_div__",iframe:"__rich_text_editor_frame__"};RichTextEditor.Lib.object.copyProperties(this.config,_a);this.notifier=arguments[1]||function(){};this.history=new RichTextEditor.History(this);this.container=null;this.editor=null;this.editorWin=null;this.editorDoc=null;this.editorBody=null;this.createNodes();};var proto=RichTextEditor.Editor.prototype;proto.createNodes=function(){var _a=this.config,_b,_c=this,_d=this.docBody;this.container=RichTextEditor.Util.createEle(this.doc,"div",{"id":_a.container},{"display":"block","width":"100%","height":"100%","border":"0px none #b5b5b5"});RichTextEditor.DomUtil.append(_d,this.container);this.editor=RichTextEditor.Util.createEle(this.doc,"iframe",{"id":_a.iframe,"name":_a.iframe},{"width":"100%","height":"100%","margin":"0px","border":"0px"});this.editor.setAttribute("allowtransparency","true");this.editor.setAttribute("frameBorder","0");RichTextEditor.Util.addEvent(this.editor,"load",function(_e){_c.onLoad(_e);});RichTextEditor.DomUtil.append(this.container,this.editor);};proto.onLoad=function(_a){this.editorWin=this.editor.contentWindow;this.editorDoc=this.editor.contentDocument||this.editorWin.document;this.editorBody=this.editorDoc.body;this.selection=new RichTextEditor.Selection(this.editor);this.editable=false;this.setEditable();RichTextEditor.Util.applyCSSText(this.editorDoc,this.config.decoStyle);var _b=this.config.linkStyle;for(var _e=0,_f=_b.length;_e<_f;_e++ ){RichTextEditor.Util.addLinkStyle(_b[_e],this.editorDoc);}var _c=this.config.linkStyle;this.checkMousedown=false;this.exceptionConfig();this.bindEvents();this.selectedContents="";this.setContent("");var _d=this;window.setTimeout(function(){_d.notifier.call(_d,"onLoad");},0);};proto.exceptionConfig=function(){if(this.editorBody.spellcheck){this.editorBody.spellcheck=false;}if(RichTextEditor.Browser=="Gecko"){this.editorDoc.execCommand("enableInlineTableEditing",false,false);}};proto.notifyEvent=function(_a){this.notifier.call(this,"notifyEvent",_a);};proto.bindEvents=function(){var _a=this;RichTextEditor.Util.addEvent(this.editorDoc,"mousedown",function(_b){_a.onMouseDown(_b);});RichTextEditor.Util.addEvent(this.editorDoc,"mouseup",function(_b){_a.onMouseUp(_b);});RichTextEditor.Util.addEvent(this.editorBody,"keydown",function(_b){_a.onKeyDown(_b);});RichTextEditor.Util.addEvent(this.editorBody,"keyup",function(_b){_a.onKeyUp(_b);});};proto.onMouseDown=function(_a){if(RichTextEditor.Browser=="Safari"){this.checkMousedown=true;}var _b=RichTextEditor.Util.elementByEvent(_a);this.notifyEvent(_a);this.history.saveHistoryIfEdited();};proto.onMouseUp=function(_a){if(RichTextEditor.Browser=="Safari"&&this.checkMousedown==false){return;}this.checkMousedown=false;var _b=RichTextEditor.Util.elementByEvent(_a),_c=RichTextEditor.DomUtil.find(_b,"a");if(!RichTextEditor.Lib.isEmpty(_c)){_a._ahref=_c;}else{_a._ahref=null;}this.notifyEvent(_a);};proto.onKeyDown=function(_a){this.notifyEvent(_a);if(this.history){var _b=_a.ctrlKey||(_a.keyCode===17);if(_b){if(_a.keyCode==90){RichTextEditor.Util.stop(_a);this.history.undoHandler();}else if(_a.keyCode==89){RichTextEditor.Util.stop(_a);this.history.redoHandler();}}}};proto.onKeyUp=function(_a){if(RichTextEditor.Browser=="Safari"&&_a.keyCode==229){return;}this.notifyEvent(_a);this.history.saveHistoryByKeyEvent(_a);};proto.setEditable=function(){if('contentEditable' in this.editorBody){this.editorBody.contentEditable=true;this.toggleEditable();}else if('designMode' in this.editorDoc){this.editorDoc.designMode="On";this.toggleEditable();}};proto.toggleEditable=function(){this.editable=(this.editable===true)?false:true;};proto.setBodyStyle=function(_a,_b){if(RichTextEditor.Lib.isEmpty(_a)){_a=this.config.style;}RichTextEditor.Util.setStyle(_b||this.editorBody,_a);};proto.setContent=function(_a){this.editorBody.innerHTML=_a;};proto.getContent=function(){return this.editorBody.innerHTML;};proto.getTextContent=function(){var _a;if("textContent" in this.editorBody){_a=this.editorBody.textContent;}else{_a=this.editorBody.innerText;}return _a;};proto.focusEditor=function(){this.editorBody.focus();};proto.blurEditor=function(){this.editorBody.blur();};proto.setCaretToTop=function(){this.editorBody.focus();var _a=this.selection.getSelection();if(this.editorBody.firstChild){_a.collapse(this.editorBody.firstChild,0);this.editorBody.scrollTop=0;}};proto.saveSelection=function(){this.selectedContents="";var _a=this.selection.getSelection();if(this.editorWin.getSelection){if(_a.getRangeAt&&_a.rangeCount){this.selectedContents=_a.getRangeAt(0);}}else{if(_a.createRange){this.selectedContents=_a.createRange();}}};proto.restoreSelection=function(){if(this.selectedContents){if(this.editorWin.getSelection){var _a=this.selection.getSelection();_a.removeAllRanges();_a.addRange(this.selectedContents);}else{if(this.selectedContents.select){this.selectedContents.select();}}}};proto.queryCommandValue=function(_a){if(this.editorDoc&&this.editable&&this.queryCommandEnabled(_a)){return this.editorDoc.queryCommandValue(_a);}};proto.queryCommandState=function(_a){if(this.editorDoc&&this.editable&&this.queryCommandEnabled(_a)){return this.editorDoc.queryCommandState(_a);}return false;};proto.queryCommandEnabled=function(_a){if(this.editorDoc&&this.editable){return this.editorDoc.queryCommandEnabled(_a);}return false;};proto.pasteHtmlAtCaret=function(_a,_b){if(RichTextEditor.Lib.isEmpty(_a)){return;}var _c=this.selection.getSelection(),_d;if(this.editorWin.getSelection){if(_c.getRangeAt&&_c.rangeCount){_d=_c.getRangeAt(0);_d.deleteContents();var _e=RichTextEditor.Util.createEle(this.editorDoc,"div"),_f=this.editorDoc.createDocumentFragment(),_g,_h,_i;_e.innerHTML=_a;while(_g=_e.firstChild){_i=_f.appendChild(_g);}_h=_f.firstChild;_d.insertNode(_f);if(_i){_d=_d.cloneRange();_d.setStartAfter(_i);if(_b){_d.setStartBefore(_h);}else{_d.collapse(true);}_c.removeAllRanges();_c.addRange(_d);}}}else{var _j,_k=_c.type.toLowerCase();if(_k==="control"){var _g=this.selection.getControl();if(_g){if(_g&&_g.tagName&&_g.tagName.toLowerCase()=="img"){RichTextEditor.DomUtil.remove(_g);}}}else{_j=_c.createRange();_j.collapse(true);}_c.createRange().pasteHTML(_a);if(_b&&!RichTextEditor.Lib.isEmpty(_j)){_d=_c.createRange();_d.setEndPoint("StartToStart",_j);_d.select();}}this.history.saveHistory();};proto=null;var urlParams={};(function(){var _a,_b=/\+/g,_c=/([^&=]+)=?([^&]*)/g,_d=function(_f){return decodeURIComponent(_f.replace(_b," "));},_e=window.location.search.substring(1);while(_a=_c.exec(_e)){urlParams[_d(_a[1])]=_d(_a[2]);}})();var browser=urlParams["Browser"];var browserVersion=urlParams["BrowserVersion"];var browserType=urlParams["BrowserType"];if(browser=="Runtime"){if(navigator.appVersion.indexOf('MSIE')> -1){browser="IE";if(document.documentMode){browserVersion=document.documentMode;browserType=browser+browserVersion;}else{var compatMode=document.compatMode;if(compatMode&&compatMode.toLowerCase()=="backcompat"){if(/MSIE\s+7(.+)[;]/.test(navigator.appVersion)){browserVersion=7;browserType="IE7";}else if(/MSIE\s+6(.+)[;]/.test(navigator.appVersion)){browserVersion=6;browserType="IE6";}else if(/MSIE\s+5(.+)[;]/.test(navigator.appVersion)){browserVersion=5;browserType="IE6";}}}}else if(navigator.userAgent.match(/Trident\/.*rv\:(.+?)[\);]/)){browser="IE";if(document.documentMode){browserVersion=document.documentMode;browserType=browser+browserVersion;}else{browserVersion=parseInt(RegExp.$1)|0;}}}RichTextEditor.Browser=browser;RichTextEditor.BrowserVersion=browserVersion;RichTextEditor.BrowserType=browserType;RichTextEditor.EMPTY_PARAGRAPH_HTML="<p>"+(browser=="IE"&&browserVersion<11?"&nbsp;":"<br>")+"</p>";}