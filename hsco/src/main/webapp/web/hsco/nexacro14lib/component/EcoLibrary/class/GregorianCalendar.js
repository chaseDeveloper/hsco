if(!JsNamespace.exist("Eco.TimeUnit")){JsNamespace.declareClass("Eco.TimeUnit",{initialize:function(_a,_b){this.name=_a;this.milliseconds=_b;},properties:{name:{},milliseconds:{}},toString:function(){return this.name;}});TimeUnit.MILLISECOND=new TimeUnit("millisecond",1);TimeUnit.SECOND=new TimeUnit("second",1000);TimeUnit.MINUTE=new TimeUnit("minute",60*1000);TimeUnit.HOUR=new TimeUnit("hour (elapsed)",60*TimeUnit.MINUTE.milliseconds);TimeUnit.DAY=new TimeUnit("day",24*TimeUnit.HOUR.milliseconds);TimeUnit.YEAR=new TimeUnit("year",366*TimeUnit.DAY.milliseconds);TimeUnit.WEEK=new TimeUnit("week",7*TimeUnit.DAY.milliseconds);TimeUnit.MONTH=new TimeUnit("month",31*TimeUnit.DAY.milliseconds);TimeUnit.QUARTER=new TimeUnit("quarter",(2*31+30)*TimeUnit.DAY.milliseconds);TimeUnit.HALFYEAR=new TimeUnit("half-year",(4*31+2*30)*TimeUnit.DAY.milliseconds);TimeUnit.DECADE=new TimeUnit("decade",(8*366+2*365)*TimeUnit.DAY.milliseconds);TimeUnit.HOUR_CALENDAR=new TimeUnit("hour (calendar)",60*TimeUnit.MINUTE.milliseconds);}if(!JsNamespace.exist("Eco.GregorianCalendar")){JsNamespace.declareClass("Eco.GregorianCalendar",{statics:{DAYS_IN_MONTH:[31,28,31,30,31,30,31,31,30,31,30,31],getDefaultRefDt:function(){if(this._defaultRefDt==null||this._defaultRefDt.getTimezoneOffset()!=this._oldTimezoneRef){var _a=new Date();_a.setFullYear(2000,0,1);_a.setHours(0,0,0,0);this._oldTimezoneRef=_a.getTimezoneOffset();this._defaultRefDt=_a;}return this._defaultRefDt;}},properties:{minimalDaysInFirstWeek:{value:1},firstDayOfWeek:{value:0}},floor:function(_a,_b,_c,_d){switch(_b){case TimeUnit.MILLISECOND:return this._floorToMillisecond(_a,_c,_d);case TimeUnit.SECOND:return this._floorToSecond(_a,_c,_d);case TimeUnit.MINUTE:return this._floorToMinute(_a,_c,_d);case TimeUnit.HOUR:return this._floorToHour(_a,_c,_d);case TimeUnit.HOUR_CALENDAR:return this._floorToHourCalendar(_a,_c,_d);case TimeUnit.DAY:return this._floorToDay(_a,_c,_d);case TimeUnit.WEEK:return this._floorToWeek(_a,_c,_d);case TimeUnit.MONTH:return this._floorToMonth(_a,_c,_d);case TimeUnit.QUARTER:return this._floorToMonth(_a,_c*3,_d);case TimeUnit.HALFYEAR:return this._floorToMonth(_a,_c*6,_d);case TimeUnit.YEAR:return this._floorToYear(_a,_c,_d);case TimeUnit.DECADE:return this._floorToYear(_a,_c*10,_d);default:Eco.Logger.error("unknown.timeunit("+_b.toString()+")");break;}},round:function(_a,_b,_c,_d){return this.floor(new Date(_a.getTime()+_a.getMilliseconds()*_c/2),_b,_c,_d);},_floorToMillisecond:function(_a,_b,_c){if(_c==null){_c=GregorianCalendar.getDefaultRefDt();}var _d=this.getElapsedMilliseconds(_c,_a),_e;if(_c.getTime()<_a.getTime()){_e=_b*Math.floor(_d/_b);}else if(_c.getTime()==_a.getTime()){_e=0;}else{_e=( -_b)*(1+Math.floor(( -_d)/_b));}return new Date(_c.getTime()+_e);},_floorToSecond:function(_a,_b,_c){if(_c==null){_c=GregorianCalendar.getDefaultRefDt();}var _d=this.getElapsedSeconds(_c,_a),_e;if(_c.getTime()<_a.getTime()){_e=_b*Math.floor(_d/_b);}else if(_c.getMilliseconds()==_a.getMilliseconds()){_e=_b*Math.floor(_d/_b);}else{_e=( -_b)*(1+Math.floor(( -_d)/_b));}return new Date(_c.getTime()+_e*TimeUnit.SECOND.milliseconds);},_floorToMinute:function(_a,_b,_c){if(_c==null){_c=GregorianCalendar.getDefaultRefDt();}var _d=this.getElapsedMinutes(_c,_a),_e;if(_c.getTime()<_a.getTime()){_e=_b*Math.floor(_d/_b);}else if(_c.getSeconds()==_a.getSeconds()&&_c.getMilliseconds()==_a.getMilliseconds()){_e=_b*Math.floor(_d/_b);}else{_e=( -_b)*(1+Math.floor(( -_d)/_b));}return new Date(_c.getTime()+_e*TimeUnit.MINUTE.milliseconds);},_floorToHour:function(_a,_b,_c){if(_c==null){_c=GregorianCalendar.getDefaultRefDt();}var _d=this.getElapsedHours(_c,_a),_e;if(_c.getTime()<_a.getTime()){_e=_c.getHours()+(_b*Math.floor(_d/_b));}else if(_c.getMinutes()==_a.getMinutes()&&_c.getSeconds()==_a.getSeconds()&&_c.getMilliseconds()==_a.getMilliseconds()){_e=_c.getHours()+(_b*Math.floor(_d/_b));}else{_e=_c.getHours()-(_b*(1+Math.floor(( -_d)/_b)));}return new Date(_c.getTime()+_e*TimeUnit.HOUR.milliseconds);},_floorToHourCalendar:function(_a,_b,_c){if(_c==null){_c=GregorianCalendar.getDefaultRefDt();}var _d=_c.getHours()+_a.getHours()-_a.getHours()%_b;var _e=new Date();_e.setFullYear(_a.getFullYear(),_a.getMonth(),_a.getDate());_e.setHours(_d,_a.getMinutes(),_a.getSeconds(),_a.getMilliseconds());return _e;},_floorToDay:function(_a,_b,_c){if(_b==1&&_c==null){var _d=new Date();_d.setFullYear(_a.getFullYear(),_a.getMonth(),_a.getDate());_d.setHours(0,0,0,0);return _d;}return this._floorToDayWithReferenceDate(_a,_b,_c);},_floorToDayWithReferenceDate:function(_a,_b,_c){if(_c==null){_c=GregorianCalendar.getDefaultRefDt();}if(_b==1){var _d=new Date();_d.setFullYear(_a.getFullYear(),_a.getMonth(),_a.getDate());_d.setHours(_a.getHours(),_a.getMinutes(),_a.getSeconds(),_a.getMilliseconds());return _d;}var _e=this.getElapsedDays(_c,_a),_f;if(_c.getTime()<_a.getTime()){_f=_c.getDate()+_b*Math.floor(_e/_b);}else if(_c.getHours()==_a.getHours()&&_c.getMinutes()==_a.getMinutes()&&_c.getSeconds()==_a.getSeconds()&&_c.getMilliseconds()==_a.getMilliseconds()){_f=_c.getDate()+_b*Math.floor(_e/_b);}else{_f=_c.getDate()-_b*(1+Math.floor(( -_e)/_b));}var _d=new Date();_d.setFullYear(_c.getFullYear(),_c.getMonth(),_f);_d.setHours(_c.getHours(),_c.getMinutes(),_c.getSeconds(),_c.getMilliseconds());return _d;},_floorToWeek:function(_a,_b,_c){var _d=this.getWeek(_a);var _e=_d-(_d-1)%_b;if(_e<1){_e=1;}var _f=7*(_d-_e)+this.getRelativeDayOfWeek(_a);var _g;if(_c==null){_c=GregorianCalendar.getDefaultRefDt();_g=new Date(_a.getTime());_g=this._addDays(_g, -_f,true);_g.setHours(_c.getHours(),_c.getMinutes(),_c.getSeconds(),_c.getMilliseconds());return _g;}_g=new Date(_a.getTime());_g.setFullYear(_a.getFullYear(),_a.getMonth(),_a.getDate()-_f);_g.setHours(_a.getHours(),_a.getMinutes(),_a.getSeconds(),_a.getMilliseconds());return _g;},_floorToMonth:function(_a,_b,_c){if(_c==null){_c=GregorianCalendar.getDefaultRefDt();}var _d=this.getElapsedMonths(_c,_a),_e;if(_c.getTime()<_a.getTime()){_e=_c.getMonth()+_b*Math.floor(_d/_b);}else if(_c.getDate()==_a.getDate()&&_c.getHours()==_a.getHours()&&_c.getMinutes()==_a.getMinutes()&&_c.getSeconds()==_a.getSeconds()&&_c.getMilliseconds()==_a.getMilliseconds()){_e=_c.getMonth()+_b*Math.floor(_d/_b);}else{_e=_c.getMonth()-_b*(1+Math.floor(( -_d)/_b));}var _f=new Date();_f.setFullYear(_c.getFullYear(),_e,_c.getDate());_f.setHours(_c.getHours(),_c.getMinutes(),_c.getSeconds(),_c.getMilliseconds());return _f;},_floorToYear:function(_a,_b,_c){if(_b==1&&_c==null){var _d=new Date();_d.setFullYear(_a.getFullYear(),0,1);_d.setHours(0,0,0,0);return _d;}return this._floorToYearWithReferenceDate(_a,_b,_c);},_floorToYearWithReferenceDate:function(_a,_b,_c){if(_c==null){_c=GregorianCalendar.getDefaultRefDt();}var _d=this.getElapsedYears(_c,_a),_e;if(_c.getTime()<_a.getTime()){_e=_c.getFullYear()+_b*Math.floor(_d/_b);}else if(_c.getMonth()==_a.getMonth()&&_c.getDate()==_a.getDate()&&_c.getHours()==_a.getHours()&&_c.getMinutes()==_a.getMinutes()&&_c.getSeconds()==_a.getSeconds()&&_c.getMilliseconds()==_a.getMilliseconds()){_e=_c.getFullYear()+_b*Math.floor(_d/_b);}else{_e=_c.getFullYear()-_b*(1+Math.floor(( -_d)/_b));}var _f=new Date();_f.setFullYear(_e,_c.getMonth(),_c.getDate());_f.setHours(_c.getHours(),_c.getMinutes(),_c.getSeconds(),_c.getMilliseconds());return _f;},addUnits:function(_a,_b,_c,_d){if(_d===undefined){_d=false;}switch(_b){case TimeUnit.MILLISECOND:case TimeUnit.SECOND:case TimeUnit.MINUTE:case TimeUnit.HOUR:return this._addConstantUnits(_a,_b,_c,_d);case TimeUnit.HOUR_CALENDAR:return this._addHoursCalendar(_a,_c,_d);case TimeUnit.DAY:return this._addDays(_a,_c,_d);case TimeUnit.WEEK:return this._addDays(_a,_c*7,_d);case TimeUnit.MONTH:return this._addMonths(_a,_c,_d);case TimeUnit.QUARTER:return this._addMonths(_a,_c*3,_d);case TimeUnit.HALFYEAR:return this._addMonths(_a,_c*6,_d);case TimeUnit.YEAR:return this._addYears(_a,_c,_d);case TimeUnit.DECADE:return this._addYears(_a,_c*10,_d);default:Eco.Logger.error("unknown.timeunit("+_b.toString()+")");break;}},_addConstantUnits:function(_a,_b,_c,_d){if(_d){_a.setTime(_a.getTime()+_b.milliseconds*_c);return _a;}return new Date(_a.getTime()+_b.milliseconds*_c);},_addHoursCalendar:function(_a,_b,_c){var _d=_c?(_a):(new Date(_a.getTime()));_d.setHours(_a.getHours()+_b);return _d;},_addDays:function(_a,_b,_c){var _a=_c?(_a):(new Date(_a.getTime()));var _d=_a.getTimezoneOffset();_a.setTime(_a.getTime()+_b*TimeUnit.DAY.milliseconds);var _e=_a.getTimezoneOffset();if(_e!=_d){_a.setTime(_a.getTime()+(_e-_d)*TimeUnit.MINUTE.milliseconds);}return _a;},_addMonths:function(_a,_b,_c){var _a=_c?(_a):(new Date(_a.getTime()));_a.setMonth(_a.getMonth()+_b);return _a;},_addYears:function(_a,_b,_c){_a=_c?(_a):(new Date(_a.getTime()));var _d=_a.getFullYear()+_b;_a.setFullYear(_d);return _a;},getWeek:function(_a,_b){var _c=this.minimalDaysInFirstWeek;var _d=this.getLastDayOfWeek(_a);var _e=this._floorToYear(_d,1,_b);if(this.getDays(_e,_d)+1<_c){_e=this._addYears(_e, -1,true);}_e=this._addDays(_e,_c-- ,false);_e=this.getLastDayOfWeek(_e,true);return 1+Math.round((_d.getTime()-_e.getTime())/TimeUnit.WEEK.milliseconds);},getDaysInYear:function(_a){return this.isLeapYear(_a)?(366):(365);},getDayOfYear:function(_a){var _b=_a.getMonth();var _c=Eco.date._dayOfYearOffset[_b]+_a.getDate();if(_b>1&&this.isLeapYear(_a.getFullYear())){_c=_c+1;}return _c;},getHoursInDay:function(_a){var _b=this.floor(_a,TimeUnit.DAY,1);return Math.floor((_a.getTime()-_b.getTime())/TimeUnit.HOUR.milliseconds);},getQuarter:function(_a){return Math.floor(_a.getMonth()/3)+1;},getHalfYear:function(_a){return _a.getMonth()<6?(1):(2);},getDecade:function(_a){return Math.floor(_a.getFullYear()/10);},isLeapYear:function(_a){if(_a%400==0){return true;}if(_a%100==0){return false;}if(_a%4==0){return true;}return false;},getDaysInMonth:function(_a,_b){var _c=GregorianCalendar.DAYS_IN_MONTH[_a];if(_a==1&&this.isLeapYear(_b)){_c=_c+1;}return _c;},getDays:function(_a,_b){if(_a>_b){var _c=_b;_b=_a;_a=_c;}var _d=this.getDayOfYear(_b)-this.getDayOfYear(_a);var _e=_a.getFullYear();var _f=_b.getFullYear();while(_e++ <_f){_d=_d+this.getDaysInYear(_e);}return _d;},getUnitValue:function(_a,_b,_c){if(_c==null){return this.getPredefinedUnitValue(_a,_b);}return this._getShiftedUnitValue(_a,_b,_c);},getPredefinedUnitValue:function(_a,_b){switch(_b){case TimeUnit.MILLISECOND:return _a.getMilliseconds();case TimeUnit.SECOND:return _a.getSeconds();case TimeUnit.MINUTE:return _a.getMinutes();case TimeUnit.HOUR:return this.getHoursInDay(_a);case TimeUnit.HOUR_CALENDAR:return _a.getHours();case TimeUnit.DAY:return _a.getDate();case TimeUnit.WEEK:return this.getWeek(_a);case TimeUnit.MONTH:return _a.getMonth();case TimeUnit.QUARTER:return this.getQuarter(_a);case TimeUnit.HALFYEAR:return this.getHalfYear(_a);case TimeUnit.YEAR:return _a.getFullYear();case TimeUnit.DECADE:return this.getDecade(_a);default:Eco.Logger.error("unknown.timeunit("+_b.toString()+")");break;}},_getShiftedUnitValue:function(_a,_b,_c){if(_b==TimeUnit.WEEK){return this.getWeek(_a,_c);}if(this._previousStartOfYear==null||this._previousStartOfYear.getTime()!=_c.getTime()){this._previousStartOfYear=new Date(_c.getTime());var _d=new Date();_d.setFullYear(1999,_c.getMonth(),_c.getDate());_d.setHours(0,0,0,0);var _e=new Date();_e.setFullYear(1999,0,1);_e.setHours(0,0,0,0);this._previousStartOfYearOffset=_d.getTime()-_e.getTime();}var _f=_a.getTime()-this._previousStartOfYearOffset;if(this.isLeapYear(_a.getFullYear())&&_a.getMonth()>1){_f=_f-24*3600*1000;}return this.getPredefinedUnitValue(new Date(_f),_b);},getElapsedUnits:function(_a,_b,_c){switch(_c){case TimeUnit.MILLISECOND:return this.getElapsedMilliseconds(_a,_b);case TimeUnit.SECOND:return this.getElapsedSeconds(_a,_b);case TimeUnit.MINUTE:return this.getElapsedMinutes(_a,_b);case TimeUnit.HOUR:return this.getElapsedHours(_a,_b);case TimeUnit.HOUR_CALENDAR:return this.getElapsedCalendarHours(_a,_b);case TimeUnit.DAY:return this.getElapsedDays(_a,_b);case TimeUnit.WEEK:return this.getElapsedWeeks(_a,_b);case TimeUnit.MONTH:return this.getElapsedMonths(_a,_b);case TimeUnit.QUARTER:return this.getElapsedQuarters(_a,_b);case TimeUnit.HALFYEAR:return this.getElapsedHalfYears(_a,_b);case TimeUnit.YEAR:return this.getElapsedYears(_a,_b);case TimeUnit.DECADE:return this.getElapsedDecades(_a,_b);default:Eco.Logger.error("unknown.timeunit("+_c.toString()+")");break;}},getElapsedMilliseconds:function(_a,_b){var _c=true;if(_a>_b){var _d=_b;_b=_a;_a=_d;_c=false;}var _e=_b.getTime()-_a.getTime();return _c?(_e):( -_e);},getElapsedSeconds:function(_a,_b){var _c=true;if(_a>_b){var _d=_b;_b=_a;_a=_d;_c=false;}var _e=_b.getTime()-_a.getTime();_e=Math.floor(_e/1000);return _c?(_e):( -_e);},getElapsedMinutes:function(_a,_b){var _c=true;if(_a>_b){var _d=_b;_b=_a;_a=_d;_c=false;}var _e=_b.getTime()-_a.getTime();_e=Math.floor(_e/(60*1000));return _c?(_e):( -_e);},getElapsedHours:function(_a,_b){var _c=true;if(_a>_b){var _d=_b;_b=_a;_a=_d;_c=false;}var _e=_b.getTime()-_a.getTime();_e=Math.floor(_e/(60*60*1000));return _c?(_e):( -_e);},getElapsedCalendarHours:function(_a,_b){var _c=true;if(_a>_b){var _d=_b;_b=_a;_a=_d;_c=false;}var _e=this.getElapsedHours(_a,_b);var _f=_b.getTimezoneOffset()-_a.getTimezoneOffset();_f=Math.floor(_f/60);_e=_e-_f;return _c?(_e):( -_e);},getElapsedDays:function(_a,_b,_c){var _d=true;if(_a>_b){var _e=_b;_b=_a;_a=_e;_d=false;}var _f=_b.getTime()-_a.getTime()+TimeUnit.MINUTE.milliseconds*( -_b.getTimezoneOffset()+_a.getTimezoneOffset());if(_c>0){_f=Math.floor(_f/TimeUnit.DAY.milliseconds,_c);}else{_f=Math.floor(_f/TimeUnit.DAY.milliseconds);}return _d?(_f):( -_f);},getElapsedWeeks:function(_a,_b){var _c=true;if(_a>_b){var _d=_b;_b=_a;_a=_d;_c=false;}var _e=this.getElapsedDays(_a,_b);_e=Math.floor(_e/7);return _c?(_e):( -_e);},getElapsedMonths:function(_a,_b){var _c=true;if(_a>_b){var _d=_b;_b=_a;_a=_d;_c=false;}var _e=12*(_b.getFullYear()-_a.getFullYear());_e=_e+(_b.getMonth()-_a.getMonth());if(_b.getDate()<_a.getDate()&&_b.getDate()!=this.getDaysInMonth(_a.getMonth(),_a.getFullYear())){_e-- ;}else if(_b.getDate()==_a.getDate()&&this._getTimeOfDayInMillis(_b)<this._getTimeOfDayInMillis(_a)){_e-- ;}return _c?(_e):( -_e);},getElapsedQuarters:function(_a,_b){var _c=true;if(_a>_b){var _d=_b;_b=_a;_a=_d;_c=false;}var _e=this.getElapsedMonths(_a,_b);_e=Math.floor(_e/3);return _c?(_e):( -_e);},getElapsedHalfYears:function(_a,_b){var _c=true;if(_a>_b){var _d=_b;_b=_a;_a=_d;_c=false;}var _e=this.getElapsedMonths(_a,_b);_e=Math.floor(_e/6);return _c?(_e):( -_e);},getElapsedYears:function(_a,_b){var _c=true;if(_a>_b){var _d=_b;_b=_a;_a=_d;_c=false;}var _e;if(_a.getFullYear()==_b.getFullYear()){_e=0;}else{_e=_b.getFullYear()-_a.getFullYear();var _f=this._getDayOfLeapYear(_b);var _g=this._getDayOfLeapYear(_a);if(_f<_g){_e-- ;}else if(_f==_g&&this._getTimeOfDayInMillis(_b)<this._getTimeOfDayInMillis(_a)){_e-- ;}}return _c?(_e):( -_elapsed);},_getDayOfLeapYear:function(_a){var _b=_a.getMonth();var _c=GregorianCalendar.DAYS_OF_THE_YEAR_OFFSET[_b]+_a.getDate();if(_b>1){_c=_c+1;}return _c;},getElapsedDecades:function(_a,_b){var _c=true;if(_a>_b){var _d=_b;_b=_a;_a=_d;_c=false;}var _e=this.getElapsedYears(_a,_b);_e=Math.floor(_e/10);return _c?(_e):( -_e);},getLastDayOfWeek:function(_a,_b){if(_b===undefined){_b=false;}return this._addDays(_a,6-this.getRelativeDayOfWeek(_a),_b);},getRelativeDayOfWeek:function(_a){var _b=_a.getDay();var _c=_b-this.firstDayOfWeek;if(_c<0){_c=_c+7;}return _c;},_getTimeOfDayInMillis:function(_a){var _b=_a.getTime()-_a.getTimezoneOffset()*TimeUnit.MINUTE.milliseconds;_b=_b%TimeUnit.DAY.milliseconds;if(_b<0){_b=_b+TimeUnit.DAY.milliseconds;}return _b;}});}