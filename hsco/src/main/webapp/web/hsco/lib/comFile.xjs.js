(function(){return function(_a){var _b;this.addIncludeScript(_a,"lib::comInclude.xjs");this.registerScript(_a,function(){this.extUp;this.extDown;this.fileConfig={host:application.services["svcurl"].url,uploadUrl:"hsco/cmm/file/uploadFile.do",downloadUrl:"hsco/cmm/download/downloadFile.do",deleteUrl:"hsco/cmm/file/deleteFile.do",downImage:"theme://images/fileUpDownload/img_file.png",delImage:"theme://images/img_WF_ConfirmE.png",allowTypes:["jpg","jpeg","gif","png","bmp","txt","zip","7z","gzip","doc","docx","ppt","pptx","xls","xlsx","pdf","hwp","hwt",""],maxCount:10,maxSize:"5MB",maxTotalSize:"200MB"};this.iconInfo={file_icon_ZIP:["zip","rar","7z"],file_icon_IMG:["jpg","jpeg","gif","png","bmp"],file_icon_TXT:["txt","xml"],file_icon_DOC:["doc","docx"],file_icon_XLS:["xls","xlsx"],file_icon_PPT:["ppt","pptx"],file_icon_PDF:["pdf"],file_icon_HWP:["hwp","hwt"],file_icon_ETC:["etc"]};this.extToIcon={};this.tranFiles={added:[],downloaded:[],transferFileSize:0,transferFileIndex:0,preFileSizeSum:0};this.transferType="all";this.initFile=function(){this.initExtToIcon();var _c=Eco.getUniqueId("extUpload_");var _d=new nexacro.ExtFileUpload(_c,this);this.addChild(_d.name,_d);this.extUp=_d;_d.set_multiselect(true);_d.setResponseZone(this,this.sta_helpMessage,this.grd_files);_d.addEventHandler("onchange",this.extUpload_onchange,this);_d.addEventHandler("onsuccess",this.extUpload_onsuccess,this);_d.addEventHandler("onerror",this.extUpload_onerror,this);_d.addEventHandler("onprogress",this.extUpload_onprogress,this);_d.addEventHandler("onreadystatechange",this.extUpload_onreadystatechange,this);_d.show();var _c=Eco.getUniqueId("extDownload_");var _e=new nexacro.ExtFileDownload(_c,this);this.addChild(_e.name,_e);this.extDown=_e;_e.addEventHandler("onsuccess",this.extDownload_onsuccess,this);_e.addEventHandler("onerror",this.extDownload_onerror,this);_e.addEventHandler("onprogress",this.extDownload_onprogress,this);_e.show();if(_d.support.FileAPI==false){this.sta_helpMessage.set_visible(false);this.sta_support_dnd.style.set_color("red");this.sta_support_dnd.set_text("• Drag & Drop 미지원");}if(!_d.support.XHR2){this.grd_files.setFormat("format1");this.grd_download.setFormat("format1");this.sta_support_progressBar.style.set_color("red");this.sta_support_progressBar.set_text("• ProgressBar 미지원");}if(!_d.support.MultipleInput){this.sta_support_multiple.style.set_color("red");this.sta_support_multiple.set_text("• 다중선택 미지원");}else{if(((nexacro.Browser=="Safari")&&(nexacro.BrowserVersion==5))&&(this.extUp.multiselect==true)){this.sta_support_multiple.style.set_color("blue");this.sta_support_multiple.set_text("• File 다중선택 지원(※Safari 버그로 단건 처리)");}}};this.validateFile=function(_c){trace("this.validateFile === ");var _d=1;Eco.object.Each(_c,function(_e,_f,_g){var _h="";if(_e=="name"){var _i=_f.slice(_f.lastIndexOf(".")+1).toLowerCase();if(!Eco.array.contains(this.fileConfig.allowTypes,_i)){this.gfn_message("info.파일.업로드.타입.불가",_i+'|'+_f);_d=0;return false;}}else if(_e=="length"){if(_f>=this.fileConfig.maxCount){this.gfn_message("info.파일.업로드.허용건수초과",this.fileConfig.maxCount+"");_d= -1;return false;}}else if(_e=="size"){if(!isNaN(_f)&&(_f>=this.sizeToByte(this.fileConfig.maxSize))){this.gfn_message("info.파일.업로드.건당용량초과",this.fileConfig.maxSize);_d=0;return false;}}else if(_e=="totalSize"){if(!isNaN(_f)&&(_f>=this.sizeToByte(this.fileConfig.maxTotalSize))){this.gfn_message("info.파일.업로드.총량초과",this.fileConfig.maxTotalSize);_d= -1;return false;}}},this);return _d;};this.extFileUpload_onchanged=function(_c,_d,_e,_f,_g){var _h=_c.index;var _i=_c.files;var _j=_i.length;var _k=(this.extUp.support.XHR2&&this.extUp.support.FileAPI);for(var _z=0;_z<_j;_z++ ){var _l=_i[_z];var _m=_l.id;var _n=_l.name;var _o=_l.size;var _p=_l.type;var _q=_n.split(".");var _r=_q[_q.length-1];;trace("   fileId="+_m+",fileName="+_n+",fileSize="+_o+",fileType="+_p);var _s=_d.getRowCount();var _t;if(_k){var _u=_d.getSum("filesize")+_o;_t={"name":_n,"length":_s,"size":_o,"totalSize":_u};}else{_t={"name":_n,"length":_s};}var _v=this.validateFile(_t);if(_v==0){this.extUp.removeFile(_m);return;}else if(_v== -1){this.extUp.removeFile(_m);return;}var _w=_d.findRow("ORGINL_FILE_NM",_n);if(_w> -1){this.gfn_message("info.파일.중복",_n);this.extUp.removeFile(_m);return;}var _x=_d.addRow();var _y=this.getFileIcon(_n);if(_d.getRowCount()>0){var _g= -1;if(this.fileSn==""||this.fileSn==undefined||this.fileSn==null){_g=_d.getColumn(0,"FILE_SN");}else{_g=this.fileSn;}_d.setColumn(_x,"FILE_SN",_g);}_d.setColumn(_x,"FILE_IMAGE",_y);_d.setColumn(_x,"SN",_m);_d.setColumn(_x,"ORGINL_FILE_NM",_n);if(_o>0){_d.setColumn(_x,"FILE_MG",_o);}_d.setColumn(_x,"FILE_EXTSN",_r);_d.setColumn(_x,"USE_AT",'1');_d.setColumn(_x,"FILE_ID",_m);_d.setColumn(_x,"FILE_TY",_p);_d.setColumn(_x,"PROGRS",0);_d.setColumn(_x,"DELETE_IMAGE",this.fileConfig.delImage);if(_g>0){_d.setColumn(_x,"FILE_SN",_g);}_d.setColumn(_x,"SYS_SE_CODE",_e);_d.setColumn(_x,"JOB_SE",_f);}this.resetSn(_d);};this.extUpload_onprogress=function(_b,_c){var _d=_b.getAddedFile(),_e=_d.length||0;if(_c.lengthComputable&&(_e>0)){var _f=_c.fileId;if(_f){var _g=_c.loaded;var _h=_c.total;var _i=this.ds_files;var _j=_i.findRow("ORGINL_FILE_NM",_f);var _k=Math.floor((_g/_h)*100);trace("\n### extUpload_onprogress "+_k+"%, e.loaded="+_c.loaded+",e.total="+_c.total+", e.fileId="+_c.fileId);_i.setColumn(_j,"PROGRS",_k);_i.setColumn(_j,"FILE_MG",_h);_i.setColumn(_j,"TRNSMIS_FILE_SIZE",_g);return;}var _l,_k,_m,_n,_g,_o,_p=this.ds_files,_q= -1;var _r=this.tranFiles;_r.transferFileSize=_c.loaded;while((_r.transferFileSize>_r.preFileSizeSum)&&(_r.transferFileIndex<_e)){_n=_d[_r.transferFileIndex].id;_q=_p.findRow("FILE_ID",_n);_m=_d[_r.transferFileIndex].file;_g=_m.size;_o=_m.name;_p.setColumn(_q,"FILE_MG",_g);_l=_r.transferFileSize-_r.preFileSizeSum;_k=Math.floor((_l/_g)*100);if(_k<100){_p.setColumn(_q,"PROGRS",_k);_p.setColumn(_q,"TRNSMIS_FILE_SIZE",_l);break;}if(_k>=100){_l=_g;_k=100;_p.setColumn(_q,"PROGRS",_k);_p.setColumn(_q,"FILE_MG",_g);_p.setColumn(_q,"TRNSMIS_FILE_SIZE",_l);_r.preFileSizeSum+=_g;_r.transferFileIndex++ ;if(_r.transferFileIndex>=_e){break;}}}}};this.extUpload_onreadystatechange=function(_b,_c){if(_c.readyState==4){if(_c.status!=200){trace("extUpload_onreadystatechange > Fail request!!");var _d=this.ds_files;var _e=_d.rowcount;for(var _f=0;_f<_e;_f++ ){_d.setColumn(_f,"PROGRS", -1);}}else if(_c.status==200){}}};this.extUpload_onsuccess=function(_b,_c){trace("extUpload_onsuccess errorcode="+_c.errorcode+", errormsg="+_c.errormsg+", datasets="+_c.datasets+", url="+_c.url+", fileId="+_c.fileId);if(this.img_loading.visible){this.img_loading.set_visible(false);}this.ds_files.applyChange();if(_c.datasets){var _d=_c.datasets;if(_d.length==0){return;}var _e=_d[0];var _f=this.ds_files;if(this.transferType=="each"){if(this.extUp.support.XHR2){var _g=_f.addRow();_f.copyRow(_g,_e,0);var _h=_c.fileId;if(_h){var _f=this.ds_files;var _g=_f.findRow("ORGINL_FILE_NM",_h);trace("### [개별전송] extUpload_onsuccess 처리:"+" e.fileId="+_c.fileId);_f.setColumn(_g,"PROGRS",100);}}else{_f.copyData(_e);}}else{_f.copyData(_e);}}this.setDownloadFileIcon();if(typeof (this.fn_setModifyedInfo)=="function"){this.fn_setModifyedInfo(false);}};this.extUpload_onerror=function(_b,_c){this.gfn_message("err.서버통신.오류발생2",_c.index+'|'+_c.errortype+'|'+_c.statuscode+'|'+_c.requesturi);if(this.img_loading.visible){this.img_loading.set_visible(false);}};this.extDownload_onprogress=function(_b,_c){trace("extDownload_onprogress "+_c.type+","+_c.loaded);if(_c.lengthComputable){var _d,_e,_f,_g=this.tranFiles.downloaded,_h= -1,_i=this.ds_files;_d=Math.floor((_c.loaded/_c.total)*100);_e=_g[0].size;_h=_g[0].row;_f=Math.floor(_e*(_d/100));trace(" download 진행: prog="+_d+",tranfilesize="+_f+", filesize="+_e);_i.setColumn(_h,"PROGRS",_d);_i.setColumn(_h,"FILE_MG",_e);_i.setColumn(_h,"TRNSMIS_FILE_SIZE",_f);}};this.extDownload_onerror=function(_b,_c){this.gfn_message("err.서버통신.오류발생2",_c.index+'|'+_c.errortype+'|'+_c.statuscode+'|'+_c.requesturi);this.resetTranFilesInfo();if(this.img_loading.visible){this.img_loading.set_visible(false);}};this.resetTranFilesInfo=function(){var _c=this.tranFiles.downloaded;Eco.array.removeAt(_c,0);this.tranFiles.downloaded=[];};this.extDownload_onsuccess=function(_b,_c){trace("	 ★ extFileDownload_onsuccess url="+_c.url);this.resetTranFilesInfo();if(this.img_loading.visible){this.img_loading.set_visible(false);}if(!Eco.isEmpty(_c.url)){this.gfn_message("success.파일.다운로드.성공");}else{this.gfn_message("err.파일.다운로드.실패");}};this.resetSn=function(_c){for(var _e=0;_e<_c.rowcount;_e++ ){var _d=_e+1;_c.setColumn(_e,"SN",_d);}};this.initExtToIcon=function(){var _c=this.extToIcon;var _d=this.iconInfo;for(var _f in _d){var _e=_d[_f].length;for(var _g=0;_g<_e;_g++ ){_c[_d[_f][_g]]=_f;}}};this.getFileIcon=function(_c){if(Eco.isEmpty(_c)){return;}_c=_c.toLowerCase();var _d=(/[.]/.exec(_c))?/[^.]+$/.exec(_c):undefined;var _e=this.extToIcon[_d];if(_e==undefined){_d="etc";}return "theme://images/fileUpDownload/"+this.extToIcon[_d]+".png";};this.setDownloadFileIcon=function(){var _c=this.ds_files;var _d=_c.rowcount;for(var _g=0;_g<_d;_g++ ){var _e=_c.getColumn(_g,"filename");var _f=this.getFileIcon(_e);_c.setColumn(_g,"fileimg",_f);}};this.bytesToSize=function(_c,_d){if(Eco.isEmpty(_c)){return;}var _e=_c+" bytes",_f=["KB","MB","GB","TB","PB","EB","ZB","YB"],_g=0,_h=0;for(_g=0,_h=_c/1024;_h>1;_h/=1024,_g++ ){if(_d==1){_e=_h.toFixed(2)+_f[_g]+" ("+_c+" bytes)";}else if(_d==2){_e=_h.toFixed(2);}else{_e=_h.toFixed(2)+_f[_g];}}return _e;};this.sizeToByte=function(_c){var _d=_c.match(/[^\d]+/g),_e=_c.match(/\d+/);_d=_d?_d[0].toLowerCase():"";_e=_e?_e[0]:_c;if(_d=="mb"){return _e*1024*1024;}else if(_d=="gb"){return _e*1024*1024*1024;}else if(_d=="tb"){return _e*1024*1024*1024*1024;}else if(_d==""){return _e;}else{return _c;}};});this.loadIncludeScript(_a);_b=null;};})();