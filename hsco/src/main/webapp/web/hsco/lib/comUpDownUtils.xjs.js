(function(){return function(_a){var _b;this.registerScript(_a,function(){this.fileUpDownManager=function(_c,_d,_e){this.DEBUG=false;this.TYPE_UPLOADER="ExtFileUpload";this.TYPE_DOWNLOADER="ExtFileDownload";this.DEF_UPLOAD_URL="hsco/cmm/file/uploadFile.do";this.DEF_DOWNLOAD_URL="hsco/cmm/download/fileDownload.do";this.DEF_ALLOW_TYPE=["jpg","jpeg","gif","png","bmp","txt","zip","7z","gzip","doc","docx","ppt","pptx","xls","xlsx","pdf","hwp","hwt","ini","dwg"];this.DATASET_NAME_UP="ds_upFiles";this.DATASET_NAME_DOWN="ds_downFiles";this.DATASET_COLUMN_UP=["FILE_SN","FILE_ORDR","FILE_STRE_COURS","STRE_FILE_NM","ORGINL_FILE_NM","FILE_EXTSN","FILE_CN","FILE_MG","USE_AT","FILE_ID","FILE_TY","SN","SYS_SE_CODE","JOB_SE","FILE_IMAGE","PROGRS","TRNSMIS_FILE_SIZE","DELETE_IMAGE","STTUS"];this.DATASET_COLUMN_DOWN=["FILE_SN","FILE_ORDR"];this.maxCount=10;this.maxSize="1000MB";this.maxTotalSize="1000MB";this._form=_c;this._sysSe=_d;this._jobSe=_e;this._uploader=null;this._downloader=null;this._host=null;this._uploadUrl=null;this._downloadUrl=null;this._allowTypes=null;this._useMultiUpload=false;this._transferType="all";this._userOnChange=null;this._userOnSuccess=null;this._userOnError=null;this._userOnProgress=null;this._userOnReadyStateChange=null;this._userOnCancelFile=null;this._ds_upFile=null;this._ds_downFile=null;this._fileSn=null;this._responseGrid=null;this._responseArea=null;this.init=function(_f){if(this._sysSe==null||this._jobSe==null){alert("파일업/다운로드 : 시스템구분 또는 업무구분 값이 없습니다.");return;}var _g=this._createFileDataset(this.TYPE_UPLOADER,this.DATASET_NAME_UP,this.DATASET_COLUMN_UP);if(!_g){alert("파일 업로드 데이터셋 생성 실패");return;}var _h=this._createFileDataset(this.TYPE_DOWNLOADER,this.DATASET_NAME_DOWN,this.DATASET_COLUMN_DOWN);if(!_h){alert("파일 다운로드 데이터셋 생성 실패");return;}var _i=Eco.getUniqueId("extUpload_");this._uploader=new nexacro.ExtFileUpload(_i,this._form);this._form.addChild(_i,this._uploader);var _j=Eco.getUniqueId("extDownload_");this._downloader=new nexacro.ExtFileDownload(_j,this._form);this._form.addChild(_j,this._downloader);this._setConfig(_f);};this.setUploadUrl=function(_f){this.DEF_UPLOAD_URL=_f;};this.setDownloadUrl=function(_f){this.DEF_DOWNLOAD_URL=_f;};this._setConfig=function(_f){this._host=_f&&_f["host"]?_f["host"]:application.gv_host;this._uploadUrl=_f&&_f["uploadUrl"]?_f["uploadUrl"]:this.DEF_UPLOAD_URL;this._downloadUrl=_f&&_f["downloadUrl"]?_f["downloadUrl"]:this.DEF_DOWNLOAD_URL;this._allowTypes=_f&&_f["allowTypes"]?_f["allowTypes"]:this.DEF_ALLOW_TYPE;this._useMultiUpload=_f&&_f["useMultiUpload"]?_f["useMultiUpload"]:false;this._responseGrid=_f&&_f["responseGrid"]?_f["responseGrid"]:null;this._responseArea=_f&&_f["responseArea"]?_f["responseArea"]:null;this._userOnChange=_f&&_f["onChange"]?_f["onChange"]:null;this._userOnSuccess=_f&&_f["onSuccess"]?_f["onSuccess"]:null;this._userOnError=_f&&_f["onError"]?_f["onError"]:null;this._userOnProgress=_f&&_f["onProgress"]?_f["onProgress"]:null;this._userOnReadyStateChange=_f&&_f["onReadyStateChange"]?_f["onReadyStateChange"]:null;this._userOnCancelFile=_f&&_f["onCancel"]?_f["onCancel"]:null;this._uploader.set_multiselect(this._useMultiUpload);if(this._uploader.support.FileAPI){if(this._responseArea!=null&&this._responseGrid!=null){this._uploader.setResponseZone(this._form,this._responseArea,this._responseGrid);}}else{if(this._responseArea!=null){this._responseArea.set_visible(false);}}if(this._host.indexOf("local")> -1){this.DEBUG=true;}this._uploader.addEventHandler("onchange",this.onChangeHandler,this);this._uploader.addEventHandler("onsuccess",this.onSuccessHandler,this);this._uploader.addEventHandler("onerror",this.onErrorHandler,this);this._uploader.addEventHandler("onprogress",this.onProgressHandler,this);this._uploader.addEventHandler("onreadystatechange",this.onReadystateChangeHandler,this);this._uploader.show();this._downloader.addEventHandler("onsuccess",this.onSuccessHandler,this);this._downloader.addEventHandler("onerror",this.onErrorHandler,this);this._downloader.addEventHandler("onprogress",this.onProgressHandler,this);this._downloader.show();};this.getfileCount=function(){return this._ds_upFile.getRowCount();};this.hasFile=function(){return this._ds_upFile.getRowCount()>0?true:false;};this.addFiles=function(_f,_g){this._allowTypes=_f?_f:this.DEF_ALLOW_TYPE;var _h=_g?_g:this._useMultiUpload;if(!_h){this.cancelAllFile();}this._uploader.set_multiselect(_h);this._uploader.addFiles();};this.cancelFiles=function(_f){var _g=false;var _h= -1;var _i=null;if(this.isArray(_f)){var _j=_f.length;for(var _l=0;_l<_j;_l++ ){_h=this._ds_upFile.findRow("ORGINL_FILE_NM",_f);_i=this._ds_upFile.getColumn(_h,"FILE_ID");_g=this._cancelFile(_i,_h);if(!_g){break;}}if(!_g){var _k="선택파일 취소(삭제) 중 오류가 발생하였습니다.\n전체 파일을 취소(삭제)하시겟습니까?";if(confirm(_k)){this.cancelAllFile();}}}else{_h=this._ds_upFile.findRow("ORGINL_FILE_NM",_f);_i=this._ds_upFile.getColumn(_h,"FILE_ID");_g=this._cancelFile(_i,_h);}return _g;};this._cancelFile=function(_f,_g){var _h=this._ds_upFile.deleteRow(_g);if(_h){this._uploader.removeFile(_f);}else{this._ds_upFile.reset();}return _h;};this.cancelAllFile=function(){var _f=false;this._uploader.removeAll();this._ds_upFile.clearData();var _g=this._uploader.getAddedFileLength();var _h=this._ds_upFile.getRowCount();if(_g==0&&_g==_h){_f=true;}return _f;};this.onChangeHandler=function(_b,_f){var _g=_b._type_name;var _h=_f.index;var _i=_f.index;var _j=_f.files;var _k=_j.length;var _l=(this._uploader.support.XHR2&&this._uploader.support.FileAPI);if(this.DEBUG){var _m=_j[_k-1];for(var _z in _m){}}var _n=this._checkAllowFileList(_j);var _o=null;var _p=null;var _q=[];var _r=_n["allow"];var _s=_r==null?0:_r.length;for(var _aa=0;_aa<_s;_aa++ ){_o=_r[_aa];_p=this._putFileInfoToDs(_o);_q.push(_p);}var _t=this._uploader.getAddedFileLength();var _u=this._ds_upFile.getRowCount();if(this._userOnChange!=null){var _v=this._uploader.multiselect;var _w=null;var _x=null;if(_v){_w=[];for(var _aa=0;_aa<_s;_aa++ ){_x=_r[_aa];var _y=_x["name"];_w.push(_y);}}else{_x=_r[0];_w=_x["name"];}if(this._userOnChange!=null){if(typeof this._userOnChange=="function"){this._userOnChange.call(this._form,_g,_w);}else{this._form[this._userOnChange](_g,_w);}}}};this._checkAllowFileList=function(_f){var _g={};var _h=[];var _i=[];var _j=this.sizeToByte(this.maxSize);var _k=this.sizeToByte(this.maxTotalSize);var _l=0;var _m=_f==null?0:_f.length;var _n=0;for(_n=0;_n<_m;_n++ ){var _o=_f[_n];var _p=_o["id"];var _q=_o["name"];var _r=_o["size"];var _s=_o["type"];var _t=_q.substring(0,_q.lastIndexOf('.'));var _u=_q.substring(_q.lastIndexOf('.')+1,_q.length);var _v=this._isAllowType(_u);if(!_v){alert("파일확장자가 "+_u+"인 파일은 등록 할 수 없습니다.");_h.push(_p);continue;}var _w=_r<=_j?true:false;if(!_w){alert("첨부파일은 "+this.maxSize+"를 넘을 수 없습니다.");_h.push(_p);continue;}var _x=this._ds_upFile.findRow("ORGINL_FILE_NM",_q);if(_x> -1){_h.push(_p);continue;}_l+=_r;if(_l==null||_l==undefined){_l=0;}if(_l>_k){_h.push(_p);continue;}_i.push(_o);}var _y=_h==null?0:_h.length;for(_n=0;_n<_y;_n++ ){var _z=_h[_n];this._uploader.removeFile(_z);}_g["allow"]=_i;_g["reject"]=_h;return _g;};this._isAllowType=function(_f){var _g=false;var _h=this._allowTypes.length;for(var _j=0;_j<_h;_j++ ){var _i=this._allowTypes[_j];if(_f.toLowerCase()==_i){_g=true;break;}}return _g;};this.setFileSn=function(_f){this._fileSn=_f;};this.onSuccessHandler=function(_b,_f){this._fileSn=null;var _g=_f.errorcode;var _h=_f.errormsg;var _i=_b._type_name;switch(_i){case this.TYPE_UPLOADER:if(_g<0){this._form.gfn_callBackMsg("fileUpload",_g,_h);}var _j=this._uploader.getAddedFileLength();var _k=this._ds_upFile.getRowCount();if(_j==0&&_j!=_k){this._ds_upFile.clearData();}break;case this.TYPE_DOWNLOADER:this.debug("	"+this.TYPE_DOWNLOADER+" onSuccess!");break;default:break;}if(_g<0){if(this._userOnError!=null){if(typeof this._userOnError=="function"){this._userOnError.call(this._form,_i,_f);}else{this._form[this._userOnError](_i,_f);}}}else{if(this._userOnSuccess!=null){if(typeof this._userOnSuccess=="function"){this._userOnSuccess.call(this._form,_i,_f);}else{this._form[this._userOnSuccess](_i,_f);}}}};this.onErrorHandler=function(_b,_f){var _g=_b._type_name;var _h=_f.errorcode;var _i=_f.errormsg;switch(_g){case this.TYPE_UPLOADER:break;case this.TYPE_DOWNLOADER:if(_h<0){this._form.gfn_callBackMsg("fileDownload",_h,_i);}break;default:break;}if(_h<0){if(this._userOnError!=null){if(typeof this._userOnError=="function"){this._userOnError.call(this._form,_g,_f);}else{this._form[this._userOnError](_g,_f);}}}};this.onProgressHandler=function(_b,_f){var _g=_b._type_name;switch(_g){case this.TYPE_UPLOADER:if(this._userOnProgress!=null){if(typeof this._userOnProgress=="function"){this._userOnProgress.call(this._form,_g,_f);}else{this._form[this._userOnProgress](_g,_f);}}break;case this.TYPE_DOWNLOADER:break;default:break;}};this.onReadystateChangeHandler=function(_b,_f){var _g=_b._type_name;if(this._userOnReadyStateChange!=null){if(typeof this._userOnReadyStateChange=="function"){this._userOnReadyStateChange.call(this._form,_g,_f.readyState,_f.status,_f);}else{this._form[this._userOnReadyStateChange](_g,_f.readyState,_f.status,_f);}}};this.upload=function(_f,_g,_h){if(this._fileSn!=null){this._setUpFileSn();}var _i=this._host+(_f?_f:this._uploadUrl);var _j="inputFile="+this._ds_upFile.name;if(_g){_j+=" "+_g;}var _k=Ex.core.setTranBaseInfo(this._form,"fileUpload",_f,_j,_h);var _l=_k["strInDatasets"]+_j;var _m=_h?_h:"";var _n=this._transferType;this._uploader.upload(_i,_l,_m,_n,0);};this.download=function(_f,_g,_h){this._ds_downFile.clearData();var _i=this._ds_downFile.addRow();this._ds_downFile.setColumn(_i,"FILE_SN",_f);this._ds_downFile.setColumn(_i,"FILE_ORDR",_g);var _j=this._host+this._downloadUrl;var _k="input1="+this._ds_downFile.name;var _l=Ex.core.setTranBaseInfo(this._form,"fileDownload",this._downloadUrl,_k,"");var _m=_l["strInDatasets"]+_k;this._downloader.download(_j,_h,_m);};this.dataFileDownload=function(_f,_g,_h){var _i=this._host+_f;var _j=Ex.core.setTranBaseInfo(this._form,"fileDownload",this._downloadUrl,_g,"");var _k=_j["strInDatasets"]+_g;this._downloader.download(_i,_h,_k);};this._putFileInfoToDs=function(_f){var _g=_f["id"];var _h=_f["name"];var _i=_f["size"];var _j=_f["type"];var _k=_h.substring(0,_h.lastIndexOf('.'));var _l=_h.substring(_h.lastIndexOf('.')+1,_h.length);var _m=this._ds_upFile.addRow();this._ds_upFile.setColumn(_m,"ORGINL_FILE_NM",_h);if(_i>0){this._ds_upFile.setColumn(_m,"FILE_MG",_i);}this._ds_upFile.setColumn(_m,"FILE_EXTSN",_l);this._ds_upFile.setColumn(_m,"USE_AT",'1');this._ds_upFile.setColumn(_m,"FILE_ID",_g);this._ds_upFile.setColumn(_m,"FILE_TY",_j);this._ds_upFile.setColumn(_m,"PROGRS",0);this._ds_upFile.setColumn(_m,"SYS_SE_CODE",this._sysSe);this._ds_upFile.setColumn(_m,"JOB_SE",this._jobSe);return _m;};this._createFileDataset=function(_f,_g,_h){try{var _i=this._form.objects[_g];var _j=_i?false:true;if(_j){_i=new Dataset;_i.set_name(_g);var _k=_h.length;for(var _l=0;_l<_k;_l++ ){_i.addColumn(_h[_l],"string");}}else{_i.clearData();}if(_j){this._form.addChild(_g,_i);}if(_f==this.TYPE_UPLOADER){this._ds_upFile=_i;}else if(_f==this.TYPE_DOWNLOADER){this._ds_downFile=_i;}return true;}catch(ex){return false;}};this._setUpFileSn=function(){if(this._fileSn==null){return;}var _f=this._ds_upFile.getRowCount();for(var _g=0;_g<_f;_g++ ){this._ds_upFile.setColumn(_g,"FILE_SN",this._fileSn);}};this.isArray=function(_f){var _g="[object Array]";var _h=Object.prototype.toString.call(_f);return _h===_g;};this.sizeToByte=function(_f){var _g=_f.match(/[^\d]+/g);var _h=_f.match(/\d+/);_g=_g?_g[0].toLowerCase():"";_h=_h?_h[0]:_f;if(_g=="mb"){return _h*1024*1024;}else if(_g=="gb"){return _h*1024*1024*1024;}else if(_g=="tb"){return _h*1024*1024*1024*1024;}else if(_g==""){return _h;}else{return _f;}};this.debug=function(_f){if(this.DEBUG){trace(_f);}};};});this.loadIncludeScript(_a);_b=null;};})();