<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="HRM090403_SQL">
	
	<typeAlias alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>

    <!-- 배차신청 정보 순번 생성 -->
	<select id="HRM090403DAO.selectCaralcSeq" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT NVL(MAX(CARALC_SEQ),0)+1 
		  FROM TBHRM_CARALC
	</select>
	
	<!-- 배차신청 중복 조회 -->
	<select id="HRM090403DAO.chkCarAlc" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		<![CDATA[/*HRM090403DAO.chkCarAlc*/]]>
		<![CDATA[
			SELECT COUNT(*) AS CNT
			FROM TBHRM_CARALC
			WHERE 1=1
			AND VHCLE_CODE = #VHCLE_CODE#			
			AND (  (TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYMMDDHH24MI') <= TO_DATE(#CARALC_BGNDE# || #CARALC_BEGIN_HOUR# || #CARALC_BEGIN_MIN#, 'YYMMDDHH24MI')
			        AND 
			        TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYMMDDHH24MI') > TO_DATE(#CARALC_BGNDE# || #CARALC_BEGIN_HOUR# || #CARALC_BEGIN_MIN#, 'YYMMDDHH24MI')
			       )
			    OR (TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYMMDDHH24MI') < TO_DATE(#CARALC_ENDDE# || #CARALC_END_HOUR# || #CARALC_END_MIN#, 'YYMMDDHH24MI')
			        AND 
			        TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYMMDDHH24MI') >= TO_DATE(#CARALC_ENDDE# || #CARALC_END_HOUR# || #CARALC_END_MIN#, 'YYMMDDHH24MI')
			       )
			    OR (TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYMMDDHH24MI') >= TO_DATE(#CARALC_BGNDE# || #CARALC_BEGIN_HOUR# || #CARALC_BEGIN_MIN#, 'YYMMDDHH24MI')
			        AND 
			        TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYMMDDHH24MI') <= TO_DATE(#CARALC_ENDDE# || #CARALC_END_HOUR# || #CARALC_END_MIN#, 'YYMMDDHH24MI')
			       )
			    )
		]]>
		<isNotEmpty property="CARALC_SEQ">
		<![CDATA[
		    AND CARALC_SEQ <> #CARALC_SEQ#
		]]>
		</isNotEmpty>
	</select>
	
	<!-- 배차신청 정보 조회 -->
	<select id="HRM090403DAO.tbhrmReqstList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		<![CDATA[
			SELECT t1.CARALC_SEQ
                 , t1.BSRP_EMPNO
                 , t1.BSRP_SEQ
                 , t1.DRVER_EMPNO
                 , t3.EMPNM                        AS DRVER_EMPNM
                 , t1.DRVER_DEPT_CODE
                 , t4.DEPT_NM                      AS DRVER_DEPT_NM
                 , t1.VHCLE_CODE
                 , t2.VHCLE_NO
                 , t2.VHCLE_NM
                 , t1.CARALC_BGNDE
                 , SUBSTR(t1.CARALC_BEGIN_TM, 1,2) AS CARALC_BEGIN_HOUR
                 , SUBSTR(t1.CARALC_BEGIN_TM, 3,2) AS CARALC_BEGIN_MIN
                 , t1.CARALC_ENDDE
                 , SUBSTR(t1.CARALC_END_TM, 1,2)   AS CARALC_END_HOUR
                 , SUBSTR(t1.CARALC_END_TM, 3,2)   AS CARALC_END_MIN
                 , t1.DSTN_NM
                 , t1.OPRAT_PURPS
                 , t1.SANCTN_NO
                 , SFCOM_GET_SANCTN_KND(t1.SANCTN_NO)    AS SANCTN_STS       /* 결재상태 */
                 , DECODE(SFCOM_GET_SANCTN_KND(t1.SANCTN_NO),'5','1','1','1','4','1','0') AS CONFM_AT
                 , t1.RM
                 , TO_CHAR(t1.REGIST_DT,'YYYYMMDD') AS REGIST_DT
                 , DECODE(t5.EMPNO, NULL, '0', '1') AS BSRP_YN               /* 출장배차여부 */
              FROM TBHRM_CARALC t1
                LEFT OUTER JOIN TBHRM_VHCLE_MANAGE t2
                  ON t1.VHCLE_CODE = t2.VHCLE_CODE
                LEFT OUTER JOIN TBHRM_HR_MASTR t3
                  ON t1.DRVER_EMPNO = t3.EMPNO
                LEFT OUTER JOIN VWHRM_DEPT t4
                  ON t1.DRVER_DEPT_CODE = t4.DEPT_CODE
                LEFT OUTER JOIN TBHRM_BSRP_INDVDL t5
                  ON t1.BSRP_EMPNO = t5.EMPNO
                 AND t1.BSRP_SEQ = t5.BSRP_SEQ
             WHERE 1=1
		]]>
		    <isNotEmpty property="ENDDE">
		        AND ( #BGNDE# BETWEEN t1.CARALC_BGNDE AND t1.CARALC_ENDDE 
		              OR #ENDDE# BETWEEN t1.CARALC_BGNDE AND t1.CARALC_ENDDE
		              OR t1.CARALC_BGNDE BETWEEN #BGNDE# AND #ENDDE# 
		              OR t1.CARALC_ENDDE BETWEEN #BGNDE# AND #ENDDE#
		            )
		    </isNotEmpty>
			<isNotEmpty property="VHCLE_CODE" prepend="AND">
				t1.VHCLE_CODE = #VHCLE_CODE#
			</isNotEmpty>
			<isNotEmpty property="DEPT_CODE" prepend="AND">
				t1.DRVER_DEPT_CODE = #DEPT_CODE#
			</isNotEmpty>
		<![CDATA[
			ORDER BY t1.VHCLE_CODE, TO_DATE(t1.CARALC_BGNDE||t1.CARALC_BEGIN_TM, 'YYYYMMDDHH24MI'), TO_DATE(t1.CARALC_ENDDE||t1.CARALC_END_TM, 'YYYYMMDDHH24MI') 
		]]>
    </select>
	
	<!-- 배차신청 정보 추가 -->
	<insert id="HRM090403DAO.insertReqst" parameterClass="java.util.HashMap">
		INSERT INTO TBHRM_CARALC (
               CARALC_SEQ
             , DRVER_EMPNO
             , DRVER_DEPT_CODE
             , VHCLE_CODE
             , CARALC_BGNDE
             , CARALC_BEGIN_TM
             , CARALC_ENDDE
             , CARALC_END_TM
             , DSTN_NM
             , OPRAT_PURPS
             , SANCTN_NO
             , RM
             , REGISTER_ID
             , REGIST_DT
             , UPDUSR_ID
             , UPDT_DT
		) VALUES (
		       #CARALC_SEQ#
		     , #DRVER_EMPNO#
		     , #DRVER_DEPT_CODE#
		     , #VHCLE_CODE#
		     , #CARALC_BGNDE#
		     , #CARALC_BEGIN_HOUR# || #CARALC_BEGIN_MIN#
		     , #CARALC_ENDDE#
		     , #CARALC_END_HOUR# || #CARALC_END_MIN#
		     , #DSTN_NM#
		     , #OPRAT_PURPS#
		     , #SANCTN_NO#
		     , #RM#
		     , #S_USER_ID#
		     , SYSDATE
		     , #S_USER_ID#
		     , SYSDATE
		)
	</insert>
	
	<!-- 배차신청정보 수정 -->
	<update id="HRM090403DAO.updateReqst" parameterClass="java.util.HashMap">
		UPDATE TBHRM_CARALC
           SET DRVER_EMPNO                  = #DRVER_EMPNO#
             , DRVER_DEPT_CODE              = #DRVER_DEPT_CODE#
             , VHCLE_CODE                   = #VHCLE_CODE#
             , CARALC_BGNDE                 = #CARALC_BGNDE#
             , CARALC_BEGIN_TM              = #CARALC_BEGIN_HOUR# || #CARALC_BEGIN_MIN#
             , CARALC_ENDDE                 = #CARALC_ENDDE#
             , CARALC_END_TM                = #CARALC_END_HOUR# || #CARALC_END_MIN#
             , DSTN_NM                      = #DSTN_NM#
             , OPRAT_PURPS                  = #OPRAT_PURPS#
             , SANCTN_NO                    = #SANCTN_NO#
             , RM                           = #RM#
             , UPDUSR_ID                    = #S_USER_ID#
             , UPDT_DT                      = SYSDATE
         WHERE CARALC_SEQ                   = #CARALC_SEQ#
	</update>
	
	<!-- 배차신청정보 삭제 -->
	<delete id="HRM090403DAO.deleteReqst" parameterClass="java.util.HashMap">
		DELETE
          FROM TBHRM_CARALC
         WHERE CARALC_SEQ    = #CARALC_SEQ#
	</delete>
	
	<!-- 동승자조회 -->
	<select id="HRM090403DAO.selectCralcFlwpsg" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		<![CDATA[/*HRM090403DAO.selectCralcFlwpsg*/]]>
		<![CDATA[
			SELECT t1.CARALC_SEQ
			     , t1.FLWPSG_EMPNO
			     , t2.EMPNM
			     , t1.FLWPSG_DEPT_CODE
			     , t3.DEPT_NM
			  FROM TBHRM_CARALC_FLWPSG t1
			  LEFT OUTER JOIN TBHRM_HR_MASTR t2
			          ON t1.FLWPSG_EMPNO = t2.EMPNO
			  LEFT OUTER JOIN VWHRM_DEPT t3
			          ON t1.FLWPSG_DEPT_CODE = t3.DEPT_CODE
			 WHERE 1=1
			   AND t1.CARALC_SEQ  = #CARALC_SEQ#
		]]>
	</select>
	
	<!-- 동승자 정보 추가 -->
	<insert id="HRM090403DAO.insertFlwpsg" parameterClass="java.util.HashMap">
		INSERT INTO TBHRM_CARALC_FLWPSG (
               CARALC_SEQ
             , FLWPSG_EMPNO
             , FLWPSG_DEPT_CODE
             , REGISTER_ID
             , REGIST_DT
             , UPDUSR_ID
             , UPDT_DT
		) VALUES (
		       #CARALC_SEQ#
		     , #FLWPSG_EMPNO#
		     , #FLWPSG_DEPT_CODE#
		     , #S_USER_ID#
		     , SYSDATE
		     , #S_USER_ID#
		     , SYSDATE
		)
	</insert>
	
	<!-- 동승자 삭제 -->
	<delete id="HRM090403DAO.deleteFlwpsg" parameterClass="java.util.HashMap">
		DELETE
          FROM TBHRM_CARALC_FLWPSG
         WHERE CARALC_SEQ            = #CARALC_SEQ#
       <isNotEmpty property="FLWPSG_EMPNO">
           AND FLWPSG_EMPNO               = #FLWPSG_EMPNO#
       </isNotEmpty>
	</delete>
	
	<!-- 차량별 배차 현황 조회 -->
 	<select id="HRM090403DAO.selectVhcleCarAlcList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		<![CDATA[
			WITH temp1 AS (
				SELECT t2.IN_DATE, t1.*
				FROM TBHRM_VHCLE_MANAGE t1
				INNER JOIN (SELECT TO_CHAR(TO_DATE(#BGNDE#, 'YYYYMMDD') + LEVEL - 1, 'YYYYMMDD') AS IN_DATE
				              FROM DUAL 
				            CONNECT BY LEVEL <= TO_DATE(#ENDDE#, 'YYYYMMDD') - TO_DATE(#BGNDE#, 'YYYYMMDD') + 1
				           ) t2
				        ON 1=1
				WHERE 1=1
		]]>
				<isNotEmpty property="DEPT_CODE" prepend="AND">
				   t1.MANAGE_DEPT_CODE = #DEPT_CODE#
				</isNotEmpty>
				<isNotEmpty property="VHCLE_CODE" prepend="AND">
				   t1.VHCLE_CODE = #VHCLE_CODE#
				</isNotEmpty>
		<![CDATA[
			) 
			,temp2 AS ( 
				SELECT t1.VHCLE_CODE
				     , t1.IN_DATE
				     , t2.CARALC_BGNDE
				     , t2.CARALC_BEGIN_TM
				     , t2.CARALC_ENDDE
				     , t2.CARALC_END_TM
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'0900', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T0900
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'0910', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T0910
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'0920', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T0920
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'0930', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T0930
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'0940', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T0940
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'0950', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T0950
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1000', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1000
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1010', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1010
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1020', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1020
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1030', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1030
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1040', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1040
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1050', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1050
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1100', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1100
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1110', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1110
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1120', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1120
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1130', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1130
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1140', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1140
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1150', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1150
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1200', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1200
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1210', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1210
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1220', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1220
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1230', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1230
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1240', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1240
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1250', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1250
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1300', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1300
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1310', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1310
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1320', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1320
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1330', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1330
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1340', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1340
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1350', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1350
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1400', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1400
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1410', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1410
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1420', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1420
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1430', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1430
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1440', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1440
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1450', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1450
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1500', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1500
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1510', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1510
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1520', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1520
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1530', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1530
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1540', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1540
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1550', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1550
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1600', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1600
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1610', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1610
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1620', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1620
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1630', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1630
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1640', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1640
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1650', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1650
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1700', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1700
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1710', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1710
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1720', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1720
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1730', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1730
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1740', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1740
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1750', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1750
				     , CASE WHEN CARALC_BEGIN_TM IS NOT NULL AND TO_DATE(t1.IN_DATE||'1800', 'YYYYMMDDHH24MI') BETWEEN TO_DATE(CARALC_BGNDE||CARALC_BEGIN_TM, 'YYYYMMDDHH24MI') AND TO_DATE(CARALC_ENDDE||CARALC_END_TM, 'YYYYMMDDHH24MI') THEN '1' ELSE '0' END AS T1800
				FROM temp1 t1
				LEFT OUTER JOIN TBHRM_CARALC t2
				             ON t2.CARALC_BGNDE IS NOT NULL AND t2.CARALC_ENDDE IS NOT NULL
				            AND (#BGNDE# BETWEEN t2.CARALC_BGNDE AND t2.CARALC_ENDDE 
				                 OR #ENDDE# BETWEEN t2.CARALC_BGNDE AND t2.CARALC_ENDDE
				                 OR t2.CARALC_BGNDE BETWEEN #BGNDE# AND #ENDDE# 
				                 OR t2.CARALC_ENDDE BETWEEN #BGNDE# AND #ENDDE#
				                )
				            AND t1.VHCLE_CODE = t2.VHCLE_CODE
				            AND t1.IN_DATE BETWEEN t2.CARALC_BGNDE AND t2.CARALC_ENDDE
		]]>
				            <isNotEmpty property="CARALC_SEQ" prepend="AND">
				            <![CDATA[
				               t2.CARALC_SEQ <> #CARALC_SEQ#
				            ]]>
				            </isNotEmpty>
		<![CDATA[
				WHERE 1=1
			)
			SELECT t1.VHCLE_CODE                                    AS VHCLE_CODE
			     , t1.IN_DATE                                       AS IN_DATE
			     , MAX(t1.MANAGE_DEPT_CODE)                         AS MANAGE_DEPT_CODE
			     , MAX(t3.DEPT_NM)                                  AS DEPT_NM
			     , MAX(t1.VHCLE_NO)                                 AS VHCLE_NO
			     , MAX(t1.VHCLE_NM)                                 AS VHCLE_NM
			     , DECODE(NVL(MAX(t2.T0900),'0'), '0', 'O', 'X')    AS T0900
			     , DECODE(NVL(MAX(t2.T0910),'0'), '0', 'O', 'X')    AS T0910
			     , DECODE(NVL(MAX(t2.T0920),'0'), '0', 'O', 'X')    AS T0920
			     , DECODE(NVL(MAX(t2.T0930),'0'), '0', 'O', 'X')    AS T0930
			     , DECODE(NVL(MAX(t2.T0940),'0'), '0', 'O', 'X')    AS T0940
			     , DECODE(NVL(MAX(t2.T0950),'0'), '0', 'O', 'X')    AS T0950
			     , DECODE(NVL(MAX(t2.T1000),'0'), '0', 'O', 'X')    AS T1000
			     , DECODE(NVL(MAX(t2.T1010),'0'), '0', 'O', 'X')    AS T1010
			     , DECODE(NVL(MAX(t2.T1020),'0'), '0', 'O', 'X')    AS T1020
			     , DECODE(NVL(MAX(t2.T1030),'0'), '0', 'O', 'X')    AS T1030
			     , DECODE(NVL(MAX(t2.T1040),'0'), '0', 'O', 'X')    AS T1040
			     , DECODE(NVL(MAX(t2.T1050),'0'), '0', 'O', 'X')    AS T1050
			     , DECODE(NVL(MAX(t2.T1100),'0'), '0', 'O', 'X')    AS T1100
			     , DECODE(NVL(MAX(t2.T1110),'0'), '0', 'O', 'X')    AS T1110
			     , DECODE(NVL(MAX(t2.T1120),'0'), '0', 'O', 'X')    AS T1120
			     , DECODE(NVL(MAX(t2.T1130),'0'), '0', 'O', 'X')    AS T1130
			     , DECODE(NVL(MAX(t2.T1140),'0'), '0', 'O', 'X')    AS T1140
			     , DECODE(NVL(MAX(t2.T1150),'0'), '0', 'O', 'X')    AS T1150
			     , DECODE(NVL(MAX(t2.T1200),'0'), '0', 'O', 'X')    AS T1200
			     , DECODE(NVL(MAX(t2.T1210),'0'), '0', 'O', 'X')    AS T1210
			     , DECODE(NVL(MAX(t2.T1220),'0'), '0', 'O', 'X')    AS T1220
			     , DECODE(NVL(MAX(t2.T1230),'0'), '0', 'O', 'X')    AS T1230
			     , DECODE(NVL(MAX(t2.T1240),'0'), '0', 'O', 'X')    AS T1240
			     , DECODE(NVL(MAX(t2.T1250),'0'), '0', 'O', 'X')    AS T1250
			     , DECODE(NVL(MAX(t2.T1300),'0'), '0', 'O', 'X')    AS T1300
			     , DECODE(NVL(MAX(t2.T1310),'0'), '0', 'O', 'X')    AS T1310
			     , DECODE(NVL(MAX(t2.T1320),'0'), '0', 'O', 'X')    AS T1320
			     , DECODE(NVL(MAX(t2.T1330),'0'), '0', 'O', 'X')    AS T1330
			     , DECODE(NVL(MAX(t2.T1340),'0'), '0', 'O', 'X')    AS T1340
			     , DECODE(NVL(MAX(t2.T1350),'0'), '0', 'O', 'X')    AS T1350
			     , DECODE(NVL(MAX(t2.T1400),'0'), '0', 'O', 'X')    AS T1400
			     , DECODE(NVL(MAX(t2.T1410),'0'), '0', 'O', 'X')    AS T1410
			     , DECODE(NVL(MAX(t2.T1420),'0'), '0', 'O', 'X')    AS T1420
			     , DECODE(NVL(MAX(t2.T1430),'0'), '0', 'O', 'X')    AS T1430
			     , DECODE(NVL(MAX(t2.T1440),'0'), '0', 'O', 'X')    AS T1440
			     , DECODE(NVL(MAX(t2.T1450),'0'), '0', 'O', 'X')    AS T1450
			     , DECODE(NVL(MAX(t2.T1500),'0'), '0', 'O', 'X')    AS T1500
			     , DECODE(NVL(MAX(t2.T1510),'0'), '0', 'O', 'X')    AS T1510
			     , DECODE(NVL(MAX(t2.T1520),'0'), '0', 'O', 'X')    AS T1520
			     , DECODE(NVL(MAX(t2.T1530),'0'), '0', 'O', 'X')    AS T1530
			     , DECODE(NVL(MAX(t2.T1540),'0'), '0', 'O', 'X')    AS T1540
			     , DECODE(NVL(MAX(t2.T1550),'0'), '0', 'O', 'X')    AS T1550
			     , DECODE(NVL(MAX(t2.T1600),'0'), '0', 'O', 'X')    AS T1600
			     , DECODE(NVL(MAX(t2.T1610),'0'), '0', 'O', 'X')    AS T1610
			     , DECODE(NVL(MAX(t2.T1620),'0'), '0', 'O', 'X')    AS T1620
			     , DECODE(NVL(MAX(t2.T1630),'0'), '0', 'O', 'X')    AS T1630
			     , DECODE(NVL(MAX(t2.T1640),'0'), '0', 'O', 'X')    AS T1640
			     , DECODE(NVL(MAX(t2.T1650),'0'), '0', 'O', 'X')    AS T1650
			     , DECODE(NVL(MAX(t2.T1700),'0'), '0', 'O', 'X')    AS T1700
			     , DECODE(NVL(MAX(t2.T1710),'0'), '0', 'O', 'X')    AS T1710
			     , DECODE(NVL(MAX(t2.T1720),'0'), '0', 'O', 'X')    AS T1720
			     , DECODE(NVL(MAX(t2.T1730),'0'), '0', 'O', 'X')    AS T1730
			     , DECODE(NVL(MAX(t2.T1740),'0'), '0', 'O', 'X')    AS T1740
			     , DECODE(NVL(MAX(t2.T1750),'0'), '0', 'O', 'X')    AS T1750
			     , DECODE(NVL(MAX(t2.T1800),'0'), '0', 'O', 'X')    AS T1800
			FROM temp1 t1
			LEFT OUTER JOIN temp2 t2
			        ON t1.VHCLE_CODE = t2.VHCLE_CODE
			       AND t1.IN_DATE = t2.IN_DATE
			LEFT OUTER JOIN VWHRM_DEPT t3
			        ON  t1.MANAGE_DEPT_CODE = t3.DEPT_CODE
			GROUP BY t1.VHCLE_CODE, t1.IN_DATE
			ORDER BY MAX(t1.MANAGE_DEPT_CODE) ASC, t1.VHCLE_CODE ASC, t1.IN_DATE ASC
		]]>
	</select>
</sqlMap>