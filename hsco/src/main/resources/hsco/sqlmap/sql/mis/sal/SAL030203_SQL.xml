<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="SAL030203_SQL">	
	
	<!-- 월급여기본자료정보 목록조회 -->
	<select id="SAL030203DAO.selectYearPymntList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		WITH MAIN_T AS (
			SELECT
				 t1.EMPNO
				,SUM(DECODE(SUBSTR(t1.PYMNT_YM, -2), '01', DECODE(t2.PYMNT_DDC_SE ,'0', t1.AMOUNT ,0) - DECODE(t2.PYMNT_DDC_SE,'1',t1.AMOUNT,0), 0))    AS "MT_1"
				,SUM(DECODE(SUBSTR(t1.PYMNT_YM, -2), '02', DECODE(t2.PYMNT_DDC_SE ,'0', t1.AMOUNT ,0) - DECODE(t2.PYMNT_DDC_SE,'1',t1.AMOUNT,0), 0))    AS "MT_2"     
				,SUM(DECODE(SUBSTR(t1.PYMNT_YM, -2), '03', DECODE(t2.PYMNT_DDC_SE ,'0', t1.AMOUNT ,0) - DECODE(t2.PYMNT_DDC_SE,'1',t1.AMOUNT,0), 0))    AS "MT_3"
				,SUM(DECODE(SUBSTR(t1.PYMNT_YM, -2), '04', DECODE(t2.PYMNT_DDC_SE ,'0', t1.AMOUNT ,0) - DECODE(t2.PYMNT_DDC_SE,'1',t1.AMOUNT,0), 0))    AS "MT_4"
				,SUM(DECODE(SUBSTR(t1.PYMNT_YM, -2), '05', DECODE(t2.PYMNT_DDC_SE ,'0', t1.AMOUNT ,0) - DECODE(t2.PYMNT_DDC_SE,'1',t1.AMOUNT,0), 0))    AS "MT_5"
				,SUM(DECODE(SUBSTR(t1.PYMNT_YM, -2), '06', DECODE(t2.PYMNT_DDC_SE ,'0', t1.AMOUNT ,0) - DECODE(t2.PYMNT_DDC_SE,'1',t1.AMOUNT,0), 0))    AS "MT_6"
				,SUM(DECODE(SUBSTR(t1.PYMNT_YM, -2), '07', DECODE(t2.PYMNT_DDC_SE ,'0', t1.AMOUNT ,0) - DECODE(t2.PYMNT_DDC_SE,'1',t1.AMOUNT,0), 0))    AS "MT_7"
				,SUM(DECODE(SUBSTR(t1.PYMNT_YM, -2), '08', DECODE(t2.PYMNT_DDC_SE ,'0', t1.AMOUNT ,0) - DECODE(t2.PYMNT_DDC_SE,'1',t1.AMOUNT,0), 0))    AS "MT_8"
				,SUM(DECODE(SUBSTR(t1.PYMNT_YM, -2), '09', DECODE(t2.PYMNT_DDC_SE ,'0', t1.AMOUNT ,0) - DECODE(t2.PYMNT_DDC_SE,'1',t1.AMOUNT,0), 0))    AS "MT_9"
				,SUM(DECODE(SUBSTR(t1.PYMNT_YM, -2), '10', DECODE(t2.PYMNT_DDC_SE ,'0', t1.AMOUNT ,0) - DECODE(t2.PYMNT_DDC_SE,'1',t1.AMOUNT,0), 0))    AS "MT_10"
				,SUM(DECODE(SUBSTR(t1.PYMNT_YM, -2), '11', DECODE(t2.PYMNT_DDC_SE ,'0', t1.AMOUNT ,0) - DECODE(t2.PYMNT_DDC_SE,'1',t1.AMOUNT,0), 0))    AS "MT_11"
				,SUM(DECODE(SUBSTR(t1.PYMNT_YM, -2), '12', DECODE(t2.PYMNT_DDC_SE ,'0', t1.AMOUNT ,0) - DECODE(t2.PYMNT_DDC_SE,'1',t1.AMOUNT,0), 0))    AS "MT_12"
				,SUM(DECODE(SUBSTR(t1.PYMNT_YM, -2), '13', DECODE(t2.PYMNT_DDC_SE ,'0', t1.AMOUNT ,0) - DECODE(t2.PYMNT_DDC_SE,'1',t1.AMOUNT,0), 0))    AS "MT_13"
			FROM TBSAL_MT_SALARY_DTLS t1
			  INNER JOIN TBSAL_PYMNT_DDC_STDR_CODE t2	ON t1.PYMNT_DDC_CODE = t2.PYMNT_DDC_CODE
			WHERE t1.PYMNT_YM LIKE #PYMNT_YEAR# || '%'
		GROUP BY t1.EMPNO
		)
		
		SELECT 
			 t1.*
			,t2.EMPNM
			,t2.DEPT_CODE
			,t3.DEPT_NM
			,t4.CODE_NM   AS JSSFC_SE		/*직종*/
			,t5.CODE_NM   AS HR_CLSF		/*직급*/
			,#PYMNT_YEAR# AS PYMNT_YEAR
		FROM MAIN_T t1
			INNER JOIN      TBHRM_HR_MASTR  t2 ON t1.EMPNO 		=	t2.EMPNO
			LEFT OUTER JOIN VWHRM_DEPT      t3 ON t2.DEPT_CODE	=	t3.DEPT_CODE
			LEFT OUTER JOIN TBCOM_CMMN_CODE t4 ON t4.CODE 		= 	t2.JSSFC_SE   AND t4.GRP_CODE =	'HRM001'	/*직종*/
			LEFT OUTER JOIN TBCOM_CMMN_CODE t5 ON t5.CODE		=	t2.HR_CLSF_SE AND t5.GRP_CODE = 'HRM002'	/*직급*/
		ORDER BY t3.OUTPT_ORDR, t2.JSSFC_SE, t2.HR_CLSF_SE, t2.EMPNO		        	     
    </select>  
   

</sqlMap>