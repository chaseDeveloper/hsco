<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="FUN020204_SQL">	
	<typeAlias alias="egovMap"          type="egovframework.rte.psl.dataaccess.util.EgovMap"/>

	<!-- 원리금상환일정 사업별 조회 -->
	<select id="FUN020204DAO.selectRpaySchedule01" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
    SELECT '1' AS DV0, 
           '공사채(A=B+C)' AS DV1,
           '' AS DV2,
           '합계' AS DV3,
           NVL(TRUNC(SUM(C.RPAY_AMOUNT) / #PRT_GBN1#), 0) AS RPAY_AMOUNT,
           NVL(TRUNC(SUM(E.INTR_RPAY_AMOUNT) / #PRT_GBN1#), 0) AS INTR_RPAY_AMOUNT,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG00) / #PRT_GBN1#), 0) AS AMT00,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS AMT0                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS AMT1                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS AMT2                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS AMT3                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS AMT4                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS AMT5                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS AMT6                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS AMT7                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS AMT8                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS AMT9                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG10) / #PRT_GBN1#) ,0) AS AMT10                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG11) / #PRT_GBN1#) ,0) AS AMT11                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG12) / #PRT_GBN1#) ,0) AS AMT12                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG13) / #PRT_GBN1#) ,0) AS AMT13                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG14) / #PRT_GBN1#) ,0) AS AMT14                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG15) / #PRT_GBN1#) ,0) AS AMT15                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG16) / #PRT_GBN1#) ,0) AS AMT16                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG17) / #PRT_GBN1#) ,0) AS AMT17                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG18) / #PRT_GBN1#) ,0) AS AMT18                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG19) / #PRT_GBN1#) ,0) AS AMT19                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG00 ) / #PRT_GBN1#) ,0) AS INT00                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS INT0                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS INT1                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS INT2                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS INT3                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS INT4                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS INT5                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS INT6                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS INT7                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS INT8                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS INT9                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG10) / #PRT_GBN1#) ,0) AS INT10                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG11) / #PRT_GBN1#) ,0) AS INT11                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG12) / #PRT_GBN1#) ,0) AS INT12                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG13) / #PRT_GBN1#) ,0) AS INT13                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG14) / #PRT_GBN1#) ,0) AS INT14                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG15) / #PRT_GBN1#) ,0) AS INT15                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG16) / #PRT_GBN1#) ,0) AS INT16                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG17) / #PRT_GBN1#) ,0) AS INT17                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG18) / #PRT_GBN1#) ,0) AS INT18                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG19) / #PRT_GBN1#) ,0) AS INT19
    FROM (
        SELECT *
        FROM
        (
              SELECT AA.*
                   , SUM(AA.BRRW_BALANCE) OVER (PARTITION BY AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM) AS BAL_AMT
              FROM
              (
                      SELECT AA.PBNCD_NO
                           , AA.BSNS_CODE AS BSNS_CODE
                           , AA.BSNS_NM AS BSNS_NM
                           , AA.CPTAL_KND AS CPTAL_KND
                           , AA.CPTAL_KND_NM AS CPTAL_KND_NM
                           , AA.LEASE_YN
                           , MIN(AA.BRRW_DE) AS BRRW_DE
                           , MAX(AA.EXPRTN_DE) AS EXPRTN_DE
                           , TO_CHAR(SUM(AA.INTRT) / COUNT(AA.CPTAL_KND), 'FM9990D00') AS INTRT
                           , SUM(AA.BRRW_AMOUNT) AS BRRW_AMOUNT
                           , SUM(AA.PRNCPAL_RPAY_AMOUNT) AS PRNCPAL_RPAY_AMOUNT
                           , SUM(AA.INTR_RPAY_AMOUNT) AS INTR_RPAY_AMOUNT
                           , SUM(AA.BRRW_BALANCE) AS BRRW_BALANCE
                      FROM 
                      (
                              select A.PBNCD_NO
                                   , A.BSNS_CODE
                                   , B.BSNS_NM
                                   , A.CPTAL_KND
                                   , C.CODE_NM AS CPTAL_KND_NM
                                   , A.BRRW_DE
                                   , A.EXPRTN_DE
                                   , NVL(A.EXPRTN_AT, 0) AS EXPRTN_AT
                                   , A.INTRT     
                                   , A.BRRW_AMOUNT
                                   , A.LEASE_YM
                                   , CASE WHEN A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                          THEN 'Y'
                                          ELSE 'N'
                                     END AS LEASE_YN     
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS PRNCPAL_RPAY_AMOUNT
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_INTR_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS INTR_RPAY_AMOUNT        
                                   , NVL(A.BRRW_AMOUNT ,0) - NVL((
                                        SELECT SUM(AA.RPAY_AMOUNT)
                                        FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                        WHERE AA.PBNCD_NO = A.PBNCD_NO
                                        AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS BRRW_BALANCE         
                              from TBFUN_PBNCD A
                              LEFT OUTER JOIN TBPRJ_BSNS_CODE B
                              ON A.BSNS_CODE = B.BSNS_CODE
                              LEFT OUTER JOIN
                                (
                                  SELECT DETAIL_CODE AS CODE ,
                                    DETAIL_CODE_NM   AS CODE_NM
                                  FROM TBFUN_CPTAL_DETAIL_CODE
                                  WHERE CODE_SE = '000'
                                )
                                C
                              ON A.CPTAL_KND = C.CODE
                      ) AA
                      GROUP BY AA.PBNCD_NO, AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM
              ) AA
        ) AA
        WHERE AA.BAL_AMT > 0    
    ) A
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO    AS PBNCD_NO    ,
               SUM(A.RPAY_AMOUNT) AS RPAY_AMOUNT ,
			   SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG00,               
<isEqual property="PRT_GBN2" compareValue="Y"> 
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               0 AS PRNCPAL_RPAY_AG10,0 AS PRNCPAL_RPAY_AG11,0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,
               0 AS PRNCPAL_RPAY_AG15,0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>          
<isEqual property="PRT_GBN2" compareValue="Q">
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG12,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG13,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG14,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG15,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG16,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG17,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG18,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
              0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,0 AS PRNCPAL_RPAY_AG15,
              0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>		       
        FROM TBFUN_PBNCD_PRNCPAL_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) C
    ON A.PBNCD_NO = C.PBNCD_NO
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO AS PBNCD_NO ,
        	  SUM(A.RPAY_AMOUNT) AS INTR_RPAY_AMOUNT ,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG00,
<isEqual property="PRT_GBN2" compareValue="Y">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              0 AS INTR_RPAY_AG10,0 AS INTR_RPAY_AG11,0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,
              0 AS INTR_RPAY_AG15,0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="Q">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG12,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG13,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG14,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG15,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG16,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG17,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG18,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,0 AS INTR_RPAY_AG15,
              0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
        FROM TBFUN_PBNCD_INTR_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) E
    ON A.PBNCD_NO = E.PBNCD_NO
    
    UNION ALL
    
    SELECT '2' AS DV0, 
           '금융부채(B=B1+B2)' AS DV1,
           '' AS DV2,
           '합계' AS DV3,
           NVL(TRUNC(SUM(C.RPAY_AMOUNT) / #PRT_GBN1#), 0) AS RPAY_AMOUNT,
           NVL(TRUNC(SUM(E.INTR_RPAY_AMOUNT) / #PRT_GBN1#), 0) AS INTR_RPAY_AMOUNT,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG00) / #PRT_GBN1#), 0) AS AMT00,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS AMT0                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS AMT1                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS AMT2                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS AMT3                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS AMT4                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS AMT5                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS AMT6                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS AMT7                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS AMT8                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS AMT9                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG10) / #PRT_GBN1#) ,0) AS AMT10                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG11) / #PRT_GBN1#) ,0) AS AMT11                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG12) / #PRT_GBN1#) ,0) AS AMT12                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG13) / #PRT_GBN1#) ,0) AS AMT13                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG14) / #PRT_GBN1#) ,0) AS AMT14                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG15) / #PRT_GBN1#) ,0) AS AMT15                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG16) / #PRT_GBN1#) ,0) AS AMT16                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG17) / #PRT_GBN1#) ,0) AS AMT17                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG18) / #PRT_GBN1#) ,0) AS AMT18                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG19) / #PRT_GBN1#) ,0) AS AMT19                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG00 ) / #PRT_GBN1#) ,0) AS INT00                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS INT0                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS INT1                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS INT2                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS INT3                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS INT4                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS INT5                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS INT6                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS INT7                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS INT8                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS INT9                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG10) / #PRT_GBN1#) ,0) AS INT10                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG11) / #PRT_GBN1#) ,0) AS INT11                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG12) / #PRT_GBN1#) ,0) AS INT12                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG13) / #PRT_GBN1#) ,0) AS INT13                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG14) / #PRT_GBN1#) ,0) AS INT14                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG15) / #PRT_GBN1#) ,0) AS INT15                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG16) / #PRT_GBN1#) ,0) AS INT16                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG17) / #PRT_GBN1#) ,0) AS INT17                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG18) / #PRT_GBN1#) ,0) AS INT18                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG19) / #PRT_GBN1#) ,0) AS INT19
    FROM (
        SELECT *
        FROM
        (
              SELECT AA.*
                   , SUM(AA.BRRW_BALANCE) OVER (PARTITION BY AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM) AS BAL_AMT
              FROM
              (
                      SELECT AA.PBNCD_NO
                           , AA.BSNS_CODE AS BSNS_CODE
                           , AA.BSNS_NM AS BSNS_NM
                           , AA.CPTAL_KND AS CPTAL_KND
                           , AA.CPTAL_KND_NM AS CPTAL_KND_NM
                           , AA.LEASE_YN
                           , MIN(AA.BRRW_DE) AS BRRW_DE
                           , MAX(AA.EXPRTN_DE) AS EXPRTN_DE
                           , TO_CHAR(SUM(AA.INTRT) / COUNT(AA.CPTAL_KND), 'FM9990D00') AS INTRT
                           , SUM(AA.BRRW_AMOUNT) AS BRRW_AMOUNT
                           , SUM(AA.PRNCPAL_RPAY_AMOUNT) AS PRNCPAL_RPAY_AMOUNT
                           , SUM(AA.INTR_RPAY_AMOUNT) AS INTR_RPAY_AMOUNT
                           , SUM(AA.BRRW_BALANCE) AS BRRW_BALANCE
                      FROM 
                      (
                              select A.PBNCD_NO
                                   , A.BSNS_CODE
                                   , B.BSNS_NM
                                   , A.CPTAL_KND
                                   , C.CODE_NM AS CPTAL_KND_NM
                                   , A.BRRW_DE
                                   , A.EXPRTN_DE
                                   , NVL(A.EXPRTN_AT, 0) AS EXPRTN_AT
                                   , A.INTRT     
                                   , A.BRRW_AMOUNT
                                   , A.LEASE_YM
                                   , CASE WHEN A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                          THEN 'Y'
                                          ELSE 'N'
                                     END AS LEASE_YN     
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS PRNCPAL_RPAY_AMOUNT
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_INTR_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS INTR_RPAY_AMOUNT        
                                   , NVL(A.BRRW_AMOUNT ,0) - NVL((
                                        SELECT SUM(AA.RPAY_AMOUNT)
                                        FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                        WHERE AA.PBNCD_NO = A.PBNCD_NO
                                        AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS BRRW_BALANCE         
                              from TBFUN_PBNCD A
                              LEFT OUTER JOIN TBPRJ_BSNS_CODE B
                              ON A.BSNS_CODE = B.BSNS_CODE
                              LEFT OUTER JOIN
                                (
                                  SELECT DETAIL_CODE AS CODE ,
                                    DETAIL_CODE_NM   AS CODE_NM
                                  FROM TBFUN_CPTAL_DETAIL_CODE
                                  WHERE CODE_SE = '000'
                                )
                                C
                              ON A.CPTAL_KND = C.CODE
                              WHERE (A.LEASE_YM IS NULL OR A.LEASE_YM > #SEARCH_YEAR#||'1231')
                      ) AA
                      GROUP BY AA.PBNCD_NO, AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM
              ) AA
        ) AA
        WHERE AA.BAL_AMT > 0    
    ) A
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO    AS PBNCD_NO    ,
               SUM(A.RPAY_AMOUNT) AS RPAY_AMOUNT ,
			   SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG00,               
<isEqual property="PRT_GBN2" compareValue="Y"> 
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               0 AS PRNCPAL_RPAY_AG10,0 AS PRNCPAL_RPAY_AG11,0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,
               0 AS PRNCPAL_RPAY_AG15,0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>          
<isEqual property="PRT_GBN2" compareValue="Q">
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG12,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG13,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG14,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG15,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG16,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG17,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG18,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
              0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,0 AS PRNCPAL_RPAY_AG15,
              0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>		       
        FROM TBFUN_PBNCD_PRNCPAL_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) C
    ON A.PBNCD_NO = C.PBNCD_NO
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO AS PBNCD_NO ,
              SUM(A.RPAY_AMOUNT) AS INTR_RPAY_AMOUNT ,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG00,
<isEqual property="PRT_GBN2" compareValue="Y">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              0 AS INTR_RPAY_AG10,0 AS INTR_RPAY_AG11,0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,
              0 AS INTR_RPAY_AG15,0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="Q">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG12,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG13,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG14,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG15,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG16,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG17,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG18,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,0 AS INTR_RPAY_AG15,
              0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
        FROM TBFUN_PBNCD_INTR_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) E
    ON A.PBNCD_NO = E.PBNCD_NO
    
    UNION ALL
    
    SELECT '3' AS DV0, 
           '장기채(B1)' AS DV1,
           '' AS DV2,
           '합계' AS DV3,
           NVL(TRUNC(SUM(C.RPAY_AMOUNT) / #PRT_GBN1#), 0) AS RPAY_AMOUNT,
           NVL(TRUNC(SUM(E.INTR_RPAY_AMOUNT) / #PRT_GBN1#), 0) AS INTR_RPAY_AMOUNT,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG00) / #PRT_GBN1#), 0) AS AMT00,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS AMT0                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS AMT1                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS AMT2                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS AMT3                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS AMT4                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS AMT5                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS AMT6                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS AMT7                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS AMT8                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS AMT9                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG10) / #PRT_GBN1#) ,0) AS AMT10                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG11) / #PRT_GBN1#) ,0) AS AMT11                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG12) / #PRT_GBN1#) ,0) AS AMT12                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG13) / #PRT_GBN1#) ,0) AS AMT13                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG14) / #PRT_GBN1#) ,0) AS AMT14                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG15) / #PRT_GBN1#) ,0) AS AMT15                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG16) / #PRT_GBN1#) ,0) AS AMT16                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG17) / #PRT_GBN1#) ,0) AS AMT17                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG18) / #PRT_GBN1#) ,0) AS AMT18                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG19) / #PRT_GBN1#) ,0) AS AMT19                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG00 ) / #PRT_GBN1#) ,0) AS INT00                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS INT0                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS INT1                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS INT2                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS INT3                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS INT4                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS INT5                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS INT6                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS INT7                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS INT8                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS INT9                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG10) / #PRT_GBN1#) ,0) AS INT10                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG11) / #PRT_GBN1#) ,0) AS INT11                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG12) / #PRT_GBN1#) ,0) AS INT12                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG13) / #PRT_GBN1#) ,0) AS INT13                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG14) / #PRT_GBN1#) ,0) AS INT14                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG15) / #PRT_GBN1#) ,0) AS INT15                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG16) / #PRT_GBN1#) ,0) AS INT16                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG17) / #PRT_GBN1#) ,0) AS INT17                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG18) / #PRT_GBN1#) ,0) AS INT18                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG19) / #PRT_GBN1#) ,0) AS INT19
    FROM (
        SELECT *
        FROM
        (
              SELECT AA.*
                   , SUM(AA.BRRW_BALANCE) OVER (PARTITION BY AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM) AS BAL_AMT
              FROM
              (
                      SELECT AA.PBNCD_NO
                           , AA.BSNS_CODE AS BSNS_CODE
                           , AA.BSNS_NM AS BSNS_NM
                           , AA.CPTAL_KND AS CPTAL_KND
                           , AA.CPTAL_KND_NM AS CPTAL_KND_NM
                           , AA.LEASE_YN
                           , MIN(AA.BRRW_DE) AS BRRW_DE
                           , MAX(AA.EXPRTN_DE) AS EXPRTN_DE
                           , TO_CHAR(SUM(AA.INTRT) / COUNT(AA.CPTAL_KND), 'FM9990D00') AS INTRT
                           , SUM(AA.BRRW_AMOUNT) AS BRRW_AMOUNT
                           , SUM(AA.PRNCPAL_RPAY_AMOUNT) AS PRNCPAL_RPAY_AMOUNT
                           , SUM(AA.INTR_RPAY_AMOUNT) AS INTR_RPAY_AMOUNT
                           , SUM(AA.BRRW_BALANCE) AS BRRW_BALANCE
                      FROM 
                      (
                              select A.PBNCD_NO
                                   , A.BSNS_CODE
                                   , B.BSNS_NM
                                   , A.CPTAL_KND
                                   , C.CODE_NM AS CPTAL_KND_NM
                                   , A.BRRW_DE
                                   , A.EXPRTN_DE
                                   , NVL(A.EXPRTN_AT, 0) AS EXPRTN_AT
                                   , A.INTRT     
                                   , A.BRRW_AMOUNT
                                   , A.LEASE_YM
                                   , CASE WHEN A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                          THEN 'Y'
                                          ELSE 'N'
                                     END AS LEASE_YN     
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS PRNCPAL_RPAY_AMOUNT
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_INTR_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS INTR_RPAY_AMOUNT        
                                   , NVL(A.BRRW_AMOUNT ,0) - NVL((
                                        SELECT SUM(AA.RPAY_AMOUNT)
                                        FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                        WHERE AA.PBNCD_NO = A.PBNCD_NO
                                        AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS BRRW_BALANCE         
                              from TBFUN_PBNCD A
                              LEFT OUTER JOIN TBPRJ_BSNS_CODE B
                              ON A.BSNS_CODE = B.BSNS_CODE
                              LEFT OUTER JOIN
                                (
                                  SELECT DETAIL_CODE AS CODE ,
                                    DETAIL_CODE_NM   AS CODE_NM
                                  FROM TBFUN_CPTAL_DETAIL_CODE
                                  WHERE CODE_SE = '000'
                                )
                                C
                              ON A.CPTAL_KND = C.CODE
                              WHERE (A.LEASE_YM IS NULL OR A.LEASE_YM > #SEARCH_YEAR#||'1231')
                              AND   A.CPTAL_KND LIKE 'A%'
                      ) AA
                      GROUP BY AA.PBNCD_NO, AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM
              ) AA
        ) AA
        WHERE AA.BAL_AMT > 0    
    ) A
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO    AS PBNCD_NO    ,
               SUM(A.RPAY_AMOUNT) AS RPAY_AMOUNT ,
			   SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG00,               
<isEqual property="PRT_GBN2" compareValue="Y"> 
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               0 AS PRNCPAL_RPAY_AG10,0 AS PRNCPAL_RPAY_AG11,0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,
               0 AS PRNCPAL_RPAY_AG15,0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>          
<isEqual property="PRT_GBN2" compareValue="Q">
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG12,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG13,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG14,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG15,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG16,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG17,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG18,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
              0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,0 AS PRNCPAL_RPAY_AG15,
              0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>		       
        FROM TBFUN_PBNCD_PRNCPAL_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) C
    ON A.PBNCD_NO = C.PBNCD_NO
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO AS PBNCD_NO ,
              SUM(A.RPAY_AMOUNT) AS INTR_RPAY_AMOUNT ,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG00,
<isEqual property="PRT_GBN2" compareValue="Y">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              0 AS INTR_RPAY_AG10,0 AS INTR_RPAY_AG11,0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,
              0 AS INTR_RPAY_AG15,0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="Q">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG12,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG13,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG14,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG15,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG16,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG17,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG18,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,0 AS INTR_RPAY_AG15,
              0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
        FROM TBFUN_PBNCD_INTR_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) E
    ON A.PBNCD_NO = E.PBNCD_NO
    
    UNION ALL
    
    SELECT *
    FROM
    (
        SELECT '4' AS DV0, 
               '' AS DV1,
               DECODE(GROUPING_ID(A.BSNS_CODE, A.BSNS_NM, A.CPTAL_KND, A.CPTAL_KND_NM), '0', '', A.BSNS_NM) AS DV2,
               DECODE(GROUPING_ID(A.BSNS_CODE, A.BSNS_NM, A.CPTAL_KND, A.CPTAL_KND_NM), '0', A.CPTAL_KND_NM, '소계') AS DV3,
	           NVL(TRUNC(SUM(C.RPAY_AMOUNT) / #PRT_GBN1#), 0) AS RPAY_AMOUNT,
    	       NVL(TRUNC(SUM(E.INTR_RPAY_AMOUNT) / #PRT_GBN1#), 0) AS INTR_RPAY_AMOUNT,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG00) / #PRT_GBN1#), 0) AS AMT00,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS AMT0                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS AMT1                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS AMT2                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS AMT3                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS AMT4                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS AMT5                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS AMT6                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS AMT7                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS AMT8                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS AMT9                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG10) / #PRT_GBN1#) ,0) AS AMT10                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG11) / #PRT_GBN1#) ,0) AS AMT11                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG12) / #PRT_GBN1#) ,0) AS AMT12                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG13) / #PRT_GBN1#) ,0) AS AMT13                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG14) / #PRT_GBN1#) ,0) AS AMT14                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG15) / #PRT_GBN1#) ,0) AS AMT15                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG16) / #PRT_GBN1#) ,0) AS AMT16                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG17) / #PRT_GBN1#) ,0) AS AMT17                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG18) / #PRT_GBN1#) ,0) AS AMT18                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG19) / #PRT_GBN1#) ,0) AS AMT19                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG00 ) / #PRT_GBN1#) ,0) AS INT00                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS INT0                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS INT1                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS INT2                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS INT3                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS INT4                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS INT5                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS INT6                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS INT7                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS INT8                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS INT9                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG10) / #PRT_GBN1#) ,0) AS INT10                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG11) / #PRT_GBN1#) ,0) AS INT11                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG12) / #PRT_GBN1#) ,0) AS INT12                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG13) / #PRT_GBN1#) ,0) AS INT13                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG14) / #PRT_GBN1#) ,0) AS INT14                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG15) / #PRT_GBN1#) ,0) AS INT15                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG16) / #PRT_GBN1#) ,0) AS INT16                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG17) / #PRT_GBN1#) ,0) AS INT17                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG18) / #PRT_GBN1#) ,0) AS INT18                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG19) / #PRT_GBN1#) ,0) AS INT19
        FROM (
            SELECT *
            FROM
            (
                  SELECT AA.*
                       , SUM(AA.BRRW_BALANCE) OVER (PARTITION BY AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM) AS BAL_AMT
                  FROM
                  (
                          SELECT AA.PBNCD_NO
                               , AA.BSNS_CODE AS BSNS_CODE
                               , AA.BSNS_NM AS BSNS_NM
                               , AA.CPTAL_KND AS CPTAL_KND
                               , AA.CPTAL_KND_NM AS CPTAL_KND_NM
                               , AA.LEASE_YN
                               , MIN(AA.BRRW_DE) AS BRRW_DE
                               , MAX(AA.EXPRTN_DE) AS EXPRTN_DE
                               , TO_CHAR(SUM(AA.INTRT) / COUNT(AA.CPTAL_KND), 'FM9990D00') AS INTRT
                               , SUM(AA.BRRW_AMOUNT) AS BRRW_AMOUNT
                               , SUM(AA.PRNCPAL_RPAY_AMOUNT) AS PRNCPAL_RPAY_AMOUNT
                               , SUM(AA.INTR_RPAY_AMOUNT) AS INTR_RPAY_AMOUNT
                               , SUM(AA.BRRW_BALANCE) AS BRRW_BALANCE
                          FROM 
                          (
                                  select A.PBNCD_NO
                                       , A.BSNS_CODE
                                       , B.BSNS_NM
                                       , A.CPTAL_KND
                                       , C.CODE_NM AS CPTAL_KND_NM
                                       , A.BRRW_DE
                                       , A.EXPRTN_DE
                                       , NVL(A.EXPRTN_AT, 0) AS EXPRTN_AT
                                       , A.INTRT     
                                       , A.BRRW_AMOUNT
                                       , A.LEASE_YM
                                       , CASE WHEN A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                              THEN 'Y'
                                              ELSE 'N'
                                         END AS LEASE_YN     
                                       ,NVL((
                                          SELECT SUM(AA.RPAY_AMOUNT)
                                          FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                          WHERE AA.PBNCD_NO = A.PBNCD_NO
                                          AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                        ) ,0) AS PRNCPAL_RPAY_AMOUNT
                                       ,NVL((
                                          SELECT SUM(AA.RPAY_AMOUNT)
                                          FROM TBFUN_PBNCD_INTR_RPAY_DTLS AA
                                          WHERE AA.PBNCD_NO = A.PBNCD_NO
                                          AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                        ) ,0) AS INTR_RPAY_AMOUNT        
                                       , NVL(A.BRRW_AMOUNT ,0) - NVL((
                                            SELECT SUM(AA.RPAY_AMOUNT)
                                            FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                            WHERE AA.PBNCD_NO = A.PBNCD_NO
                                            AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                        ) ,0) AS BRRW_BALANCE         
                                  from TBFUN_PBNCD A
                                  LEFT OUTER JOIN TBPRJ_BSNS_CODE B
                                  ON A.BSNS_CODE = B.BSNS_CODE
                                  LEFT OUTER JOIN
                                    (
                                      SELECT DETAIL_CODE AS CODE ,
                                        DETAIL_CODE_NM   AS CODE_NM
                                      FROM TBFUN_CPTAL_DETAIL_CODE
                                      WHERE CODE_SE = '000'
                                    )
                                    C
                                  ON A.CPTAL_KND = C.CODE
                                  WHERE (A.LEASE_YM IS NULL OR A.LEASE_YM > #SEARCH_YEAR#||'1231')
                                  AND   A.CPTAL_KND LIKE 'A%'
                          ) AA
                          GROUP BY AA.PBNCD_NO, AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM
                  ) AA
            ) AA
            WHERE AA.BAL_AMT > 0    
        
        ) A
	    LEFT OUTER JOIN
	    (
	        SELECT A.PBNCD_NO    AS PBNCD_NO    ,
	               SUM(A.RPAY_AMOUNT) AS RPAY_AMOUNT ,
				   SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG00,               
	<isEqual property="PRT_GBN2" compareValue="Y"> 
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
	               0 AS PRNCPAL_RPAY_AG10,0 AS PRNCPAL_RPAY_AG11,0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,
	               0 AS PRNCPAL_RPAY_AG15,0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
	</isEqual>          
	<isEqual property="PRT_GBN2" compareValue="Q">
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG12,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG13,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG14,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG15,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG16,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG17,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG18,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG19
	</isEqual>
	<isEqual property="PRT_GBN2" compareValue="M">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
	              0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,0 AS PRNCPAL_RPAY_AG15,
	              0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
	</isEqual>		       
	        FROM TBFUN_PBNCD_PRNCPAL_RPAY_PLAN A
	        GROUP BY A.PBNCD_NO
	    ) C
	    ON A.PBNCD_NO = C.PBNCD_NO
	    LEFT OUTER JOIN
	    (
	        SELECT A.PBNCD_NO AS PBNCD_NO ,
	        	  SUM(A.RPAY_AMOUNT) AS INTR_RPAY_AMOUNT ,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG00,
	<isEqual property="PRT_GBN2" compareValue="Y">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
	              0 AS INTR_RPAY_AG10,0 AS INTR_RPAY_AG11,0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,
	              0 AS INTR_RPAY_AG15,0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
	</isEqual>
	<isEqual property="PRT_GBN2" compareValue="Q">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG12,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG13,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG14,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG15,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG16,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG17,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG18,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG19
	</isEqual>
	<isEqual property="PRT_GBN2" compareValue="M">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
	              0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,0 AS INTR_RPAY_AG15,
	              0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
	</isEqual>
	        FROM TBFUN_PBNCD_INTR_RPAY_PLAN A
	        GROUP BY A.PBNCD_NO
	    ) E
        ON A.PBNCD_NO = E.PBNCD_NO
        GROUP BY ROLLUP(A.BSNS_CODE, A.BSNS_NM, A.CPTAL_KND, A.CPTAL_KND_NM) 
        HAVING GROUPING_ID(A.BSNS_CODE, A.BSNS_NM, A.CPTAL_KND, A.CPTAL_KND_NM) IN (0,3) 
        order by grouping(A.BSNS_NM) desc, A.BSNS_NM
               , grouping(A.CPTAL_KND_NM) desc, A.CPTAL_KND_NM
    )    
        
    UNION ALL
    
    SELECT '5' AS DV0, 
           '단기채(B2)' AS DV1,
           '' AS DV2,
           '합계' AS DV3,
           NVL(TRUNC(SUM(C.RPAY_AMOUNT) / #PRT_GBN1#), 0) AS RPAY_AMOUNT,
           NVL(TRUNC(SUM(E.INTR_RPAY_AMOUNT) / #PRT_GBN1#), 0) AS INTR_RPAY_AMOUNT,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG00) / #PRT_GBN1#), 0) AS AMT00,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS AMT0                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS AMT1                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS AMT2                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS AMT3                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS AMT4                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS AMT5                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS AMT6                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS AMT7                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS AMT8                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS AMT9                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG10) / #PRT_GBN1#) ,0) AS AMT10                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG11) / #PRT_GBN1#) ,0) AS AMT11                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG12) / #PRT_GBN1#) ,0) AS AMT12                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG13) / #PRT_GBN1#) ,0) AS AMT13                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG14) / #PRT_GBN1#) ,0) AS AMT14                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG15) / #PRT_GBN1#) ,0) AS AMT15                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG16) / #PRT_GBN1#) ,0) AS AMT16                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG17) / #PRT_GBN1#) ,0) AS AMT17                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG18) / #PRT_GBN1#) ,0) AS AMT18                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG19) / #PRT_GBN1#) ,0) AS AMT19                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG00 ) / #PRT_GBN1#) ,0) AS INT00                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS INT0                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS INT1                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS INT2                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS INT3                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS INT4                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS INT5                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS INT6                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS INT7                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS INT8                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS INT9                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG10) / #PRT_GBN1#) ,0) AS INT10                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG11) / #PRT_GBN1#) ,0) AS INT11                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG12) / #PRT_GBN1#) ,0) AS INT12                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG13) / #PRT_GBN1#) ,0) AS INT13                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG14) / #PRT_GBN1#) ,0) AS INT14                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG15) / #PRT_GBN1#) ,0) AS INT15                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG16) / #PRT_GBN1#) ,0) AS INT16                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG17) / #PRT_GBN1#) ,0) AS INT17                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG18) / #PRT_GBN1#) ,0) AS INT18                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG19) / #PRT_GBN1#) ,0) AS INT19
    FROM (
        SELECT *
        FROM
        (
              SELECT AA.*
                   , SUM(AA.BRRW_BALANCE) OVER (PARTITION BY AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM) AS BAL_AMT
              FROM
              (
                      SELECT AA.PBNCD_NO
                           , AA.BSNS_CODE AS BSNS_CODE
                           , AA.BSNS_NM AS BSNS_NM
                           , AA.CPTAL_KND AS CPTAL_KND
                           , AA.CPTAL_KND_NM AS CPTAL_KND_NM
                           , AA.LEASE_YN
                           , MIN(AA.BRRW_DE) AS BRRW_DE
                           , MAX(AA.EXPRTN_DE) AS EXPRTN_DE
                           , TO_CHAR(SUM(AA.INTRT) / COUNT(AA.CPTAL_KND), 'FM9990D00') AS INTRT
                           , SUM(AA.BRRW_AMOUNT) AS BRRW_AMOUNT
                           , SUM(AA.PRNCPAL_RPAY_AMOUNT) AS PRNCPAL_RPAY_AMOUNT
                           , SUM(AA.INTR_RPAY_AMOUNT) AS INTR_RPAY_AMOUNT
                           , SUM(AA.BRRW_BALANCE) AS BRRW_BALANCE
                      FROM 
                      (
                              select A.PBNCD_NO
                                   , A.BSNS_CODE
                                   , B.BSNS_NM
                                   , A.CPTAL_KND
                                   , C.CODE_NM AS CPTAL_KND_NM
                                   , A.BRRW_DE
                                   , A.EXPRTN_DE
                                   , NVL(A.EXPRTN_AT, 0) AS EXPRTN_AT
                                   , A.INTRT     
                                   , A.BRRW_AMOUNT
                                   , A.LEASE_YM
                                   , CASE WHEN A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                          THEN 'Y'
                                          ELSE 'N'
                                     END AS LEASE_YN     
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS PRNCPAL_RPAY_AMOUNT
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_INTR_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS INTR_RPAY_AMOUNT        
                                   , NVL(A.BRRW_AMOUNT ,0) - NVL((
                                        SELECT SUM(AA.RPAY_AMOUNT)
                                        FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                        WHERE AA.PBNCD_NO = A.PBNCD_NO
                                        AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS BRRW_BALANCE         
                              from TBFUN_PBNCD A
                              LEFT OUTER JOIN TBPRJ_BSNS_CODE B
                              ON A.BSNS_CODE = B.BSNS_CODE
                              LEFT OUTER JOIN
                                (
                                  SELECT DETAIL_CODE AS CODE ,
                                    DETAIL_CODE_NM   AS CODE_NM
                                  FROM TBFUN_CPTAL_DETAIL_CODE
                                  WHERE CODE_SE = '000'
                                )
                                C
                              ON A.CPTAL_KND = C.CODE
                              WHERE (A.LEASE_YM IS NULL OR A.LEASE_YM > #SEARCH_YEAR#||'1231')
                              AND   A.CPTAL_KND LIKE 'B%'
                      ) AA
                      GROUP BY AA.PBNCD_NO, AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM
              ) AA
        ) AA
        WHERE AA.BAL_AMT > 0    
    ) A
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO    AS PBNCD_NO    ,
               SUM(A.RPAY_AMOUNT) AS RPAY_AMOUNT ,
			   SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG00,               
<isEqual property="PRT_GBN2" compareValue="Y"> 
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               0 AS PRNCPAL_RPAY_AG10,0 AS PRNCPAL_RPAY_AG11,0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,
               0 AS PRNCPAL_RPAY_AG15,0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>          
<isEqual property="PRT_GBN2" compareValue="Q">
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG12,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG13,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG14,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG15,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG16,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG17,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG18,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
              0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,0 AS PRNCPAL_RPAY_AG15,
              0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>		       
        FROM TBFUN_PBNCD_PRNCPAL_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) C
    ON A.PBNCD_NO = C.PBNCD_NO
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO AS PBNCD_NO ,
        	  SUM(A.RPAY_AMOUNT) AS INTR_RPAY_AMOUNT ,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG00,
<isEqual property="PRT_GBN2" compareValue="Y">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              0 AS INTR_RPAY_AG10,0 AS INTR_RPAY_AG11,0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,
              0 AS INTR_RPAY_AG15,0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="Q">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG12,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG13,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG14,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG15,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG16,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG17,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG18,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,0 AS INTR_RPAY_AG15,
              0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
        FROM TBFUN_PBNCD_INTR_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) E
    ON A.PBNCD_NO = E.PBNCD_NO
    
    UNION ALL
    
    SELECT *
    FROM
    (
        SELECT '6' AS DV0, 
               '' AS DV1,
               DECODE(GROUPING_ID(A.BSNS_CODE, A.BSNS_NM, A.CPTAL_KND, A.CPTAL_KND_NM), '0', '', A.BSNS_NM) AS DV2,
               DECODE(GROUPING_ID(A.BSNS_CODE, A.BSNS_NM, A.CPTAL_KND, A.CPTAL_KND_NM), '0', A.CPTAL_KND_NM, '소계') AS DV3,
	           NVL(TRUNC(SUM(C.RPAY_AMOUNT) / #PRT_GBN1#), 0) AS RPAY_AMOUNT,
    	       NVL(TRUNC(SUM(E.INTR_RPAY_AMOUNT) / #PRT_GBN1#), 0) AS INTR_RPAY_AMOUNT,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG00) / #PRT_GBN1#), 0) AS AMT00,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS AMT0                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS AMT1                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS AMT2                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS AMT3                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS AMT4                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS AMT5                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS AMT6                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS AMT7                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS AMT8                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS AMT9                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG10) / #PRT_GBN1#) ,0) AS AMT10                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG11) / #PRT_GBN1#) ,0) AS AMT11                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG12) / #PRT_GBN1#) ,0) AS AMT12                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG13) / #PRT_GBN1#) ,0) AS AMT13                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG14) / #PRT_GBN1#) ,0) AS AMT14                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG15) / #PRT_GBN1#) ,0) AS AMT15                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG16) / #PRT_GBN1#) ,0) AS AMT16                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG17) / #PRT_GBN1#) ,0) AS AMT17                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG18) / #PRT_GBN1#) ,0) AS AMT18                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG19) / #PRT_GBN1#) ,0) AS AMT19                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG00 ) / #PRT_GBN1#) ,0) AS INT00                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS INT0                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS INT1                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS INT2                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS INT3                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS INT4                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS INT5                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS INT6                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS INT7                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS INT8                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS INT9                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG10) / #PRT_GBN1#) ,0) AS INT10                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG11) / #PRT_GBN1#) ,0) AS INT11                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG12) / #PRT_GBN1#) ,0) AS INT12                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG13) / #PRT_GBN1#) ,0) AS INT13                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG14) / #PRT_GBN1#) ,0) AS INT14                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG15) / #PRT_GBN1#) ,0) AS INT15                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG16) / #PRT_GBN1#) ,0) AS INT16                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG17) / #PRT_GBN1#) ,0) AS INT17                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG18) / #PRT_GBN1#) ,0) AS INT18                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG19) / #PRT_GBN1#) ,0) AS INT19
        FROM (
            SELECT *
            FROM
            (
                  SELECT AA.*
                       , SUM(AA.BRRW_BALANCE) OVER (PARTITION BY AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM) AS BAL_AMT
                  FROM
                  (
                          SELECT AA.PBNCD_NO
                               , AA.BSNS_CODE AS BSNS_CODE
                               , AA.BSNS_NM AS BSNS_NM
                               , AA.CPTAL_KND AS CPTAL_KND
                               , AA.CPTAL_KND_NM AS CPTAL_KND_NM
                               , AA.LEASE_YN
                               , MIN(AA.BRRW_DE) AS BRRW_DE
                               , MAX(AA.EXPRTN_DE) AS EXPRTN_DE
                               , TO_CHAR(SUM(AA.INTRT) / COUNT(AA.CPTAL_KND), 'FM9990D00') AS INTRT
                               , SUM(AA.BRRW_AMOUNT) AS BRRW_AMOUNT
                               , SUM(AA.PRNCPAL_RPAY_AMOUNT) AS PRNCPAL_RPAY_AMOUNT
                               , SUM(AA.INTR_RPAY_AMOUNT) AS INTR_RPAY_AMOUNT
                               , SUM(AA.BRRW_BALANCE) AS BRRW_BALANCE
                          FROM 
                          (
                                  select A.PBNCD_NO
                                       , A.BSNS_CODE
                                       , B.BSNS_NM
                                       , A.CPTAL_KND
                                       , C.CODE_NM AS CPTAL_KND_NM
                                       , A.BRRW_DE
                                       , A.EXPRTN_DE
                                       , NVL(A.EXPRTN_AT, 0) AS EXPRTN_AT
                                       , A.INTRT     
                                       , A.BRRW_AMOUNT
                                       , A.LEASE_YM
                                       , CASE WHEN A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                              THEN 'Y'
                                              ELSE 'N'
                                         END AS LEASE_YN     
                                       ,NVL((
                                          SELECT SUM(AA.RPAY_AMOUNT)
                                          FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                          WHERE AA.PBNCD_NO = A.PBNCD_NO
                                          AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                        ) ,0) AS PRNCPAL_RPAY_AMOUNT
                                       ,NVL((
                                          SELECT SUM(AA.RPAY_AMOUNT)
                                          FROM TBFUN_PBNCD_INTR_RPAY_DTLS AA
                                          WHERE AA.PBNCD_NO = A.PBNCD_NO
                                          AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                        ) ,0) AS INTR_RPAY_AMOUNT        
                                       , NVL(A.BRRW_AMOUNT ,0) - NVL((
                                            SELECT SUM(AA.RPAY_AMOUNT)
                                            FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                            WHERE AA.PBNCD_NO = A.PBNCD_NO
                                            AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                        ) ,0) AS BRRW_BALANCE         
                                  from TBFUN_PBNCD A
                                  LEFT OUTER JOIN TBPRJ_BSNS_CODE B
                                  ON A.BSNS_CODE = B.BSNS_CODE
                                  LEFT OUTER JOIN
                                    (
                                      SELECT DETAIL_CODE AS CODE ,
                                        DETAIL_CODE_NM   AS CODE_NM
                                      FROM TBFUN_CPTAL_DETAIL_CODE
                                      WHERE CODE_SE = '000'
                                    )
                                    C
                                  ON A.CPTAL_KND = C.CODE
                                  WHERE (A.LEASE_YM IS NULL OR A.LEASE_YM > #SEARCH_YEAR#||'1231')
                                  AND   A.CPTAL_KND LIKE 'B%'
                          ) AA
                          GROUP BY AA.PBNCD_NO, AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM
                  ) AA
            ) AA
            WHERE AA.BAL_AMT > 0    
        
        ) A
	    LEFT OUTER JOIN
	    (
	        SELECT A.PBNCD_NO    AS PBNCD_NO    ,
	               SUM(A.RPAY_AMOUNT) AS RPAY_AMOUNT ,
				   SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG00,               
	<isEqual property="PRT_GBN2" compareValue="Y"> 
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
	               0 AS PRNCPAL_RPAY_AG10,0 AS PRNCPAL_RPAY_AG11,0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,
	               0 AS PRNCPAL_RPAY_AG15,0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
	</isEqual>          
	<isEqual property="PRT_GBN2" compareValue="Q">
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG12,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG13,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG14,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG15,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG16,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG17,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG18,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG19
	</isEqual>
	<isEqual property="PRT_GBN2" compareValue="M">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
	              0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,0 AS PRNCPAL_RPAY_AG15,
	              0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
	</isEqual>		       
	        FROM TBFUN_PBNCD_PRNCPAL_RPAY_PLAN A
	        GROUP BY A.PBNCD_NO
	    ) C
	    ON A.PBNCD_NO = C.PBNCD_NO
	    LEFT OUTER JOIN
	    (
	        SELECT A.PBNCD_NO AS PBNCD_NO ,
	        	  SUM(A.RPAY_AMOUNT) AS INTR_RPAY_AMOUNT ,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG00,
	<isEqual property="PRT_GBN2" compareValue="Y">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
	              0 AS INTR_RPAY_AG10,0 AS INTR_RPAY_AG11,0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,
	              0 AS INTR_RPAY_AG15,0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
	</isEqual>
	<isEqual property="PRT_GBN2" compareValue="Q">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG12,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG13,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG14,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG15,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG16,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG17,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG18,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG19
	</isEqual>
	<isEqual property="PRT_GBN2" compareValue="M">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
	              0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,0 AS INTR_RPAY_AG15,
	              0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
	</isEqual>
	        FROM TBFUN_PBNCD_INTR_RPAY_PLAN A
	        GROUP BY A.PBNCD_NO
	    ) E
        ON A.PBNCD_NO = E.PBNCD_NO
        GROUP BY ROLLUP(A.BSNS_CODE, A.BSNS_NM, A.CPTAL_KND, A.CPTAL_KND_NM) 
        HAVING GROUPING_ID(A.BSNS_CODE, A.BSNS_NM, A.CPTAL_KND, A.CPTAL_KND_NM) IN (0,3) 
        order by grouping(A.BSNS_NM) desc, A.BSNS_NM
               , grouping(A.CPTAL_KND_NM) desc, A.CPTAL_KND_NM
    )        
    
    UNION ALL
    
    SELECT '7' AS DV0, 
           '금융리스처리(C=C1+C2)' AS DV1,
           '' AS DV2,
           '합계' AS DV3,
           NVL(TRUNC(SUM(C.RPAY_AMOUNT) / #PRT_GBN1#), 0) AS RPAY_AMOUNT,
           NVL(TRUNC(SUM(E.INTR_RPAY_AMOUNT) / #PRT_GBN1#), 0) AS INTR_RPAY_AMOUNT,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG00) / #PRT_GBN1#), 0) AS AMT00,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS AMT0                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS AMT1                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS AMT2                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS AMT3                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS AMT4                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS AMT5                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS AMT6                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS AMT7                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS AMT8                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS AMT9                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG10) / #PRT_GBN1#) ,0) AS AMT10                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG11) / #PRT_GBN1#) ,0) AS AMT11                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG12) / #PRT_GBN1#) ,0) AS AMT12                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG13) / #PRT_GBN1#) ,0) AS AMT13                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG14) / #PRT_GBN1#) ,0) AS AMT14                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG15) / #PRT_GBN1#) ,0) AS AMT15                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG16) / #PRT_GBN1#) ,0) AS AMT16                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG17) / #PRT_GBN1#) ,0) AS AMT17                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG18) / #PRT_GBN1#) ,0) AS AMT18                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG19) / #PRT_GBN1#) ,0) AS AMT19                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG00 ) / #PRT_GBN1#) ,0) AS INT00                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS INT0                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS INT1                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS INT2                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS INT3                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS INT4                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS INT5                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS INT6                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS INT7                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS INT8                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS INT9                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG10) / #PRT_GBN1#) ,0) AS INT10                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG11) / #PRT_GBN1#) ,0) AS INT11                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG12) / #PRT_GBN1#) ,0) AS INT12                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG13) / #PRT_GBN1#) ,0) AS INT13                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG14) / #PRT_GBN1#) ,0) AS INT14                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG15) / #PRT_GBN1#) ,0) AS INT15                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG16) / #PRT_GBN1#) ,0) AS INT16                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG17) / #PRT_GBN1#) ,0) AS INT17                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG18) / #PRT_GBN1#) ,0) AS INT18                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG19) / #PRT_GBN1#) ,0) AS INT19
    FROM (
        SELECT *
        FROM
        (
              SELECT AA.*
                   , SUM(AA.BRRW_BALANCE) OVER (PARTITION BY AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM) AS BAL_AMT
              FROM
              (
                      SELECT AA.PBNCD_NO
                           , AA.BSNS_CODE AS BSNS_CODE
                           , AA.BSNS_NM AS BSNS_NM
                           , AA.CPTAL_KND AS CPTAL_KND
                           , AA.CPTAL_KND_NM AS CPTAL_KND_NM
                           , AA.LEASE_YN
                           , MIN(AA.BRRW_DE) AS BRRW_DE
                           , MAX(AA.EXPRTN_DE) AS EXPRTN_DE
                           , TO_CHAR(SUM(AA.INTRT) / COUNT(AA.CPTAL_KND), 'FM9990D00') AS INTRT
                           , SUM(AA.BRRW_AMOUNT) AS BRRW_AMOUNT
                           , SUM(AA.PRNCPAL_RPAY_AMOUNT) AS PRNCPAL_RPAY_AMOUNT
                           , SUM(AA.INTR_RPAY_AMOUNT) AS INTR_RPAY_AMOUNT
                           , SUM(AA.BRRW_BALANCE) AS BRRW_BALANCE
                      FROM 
                      (
                              select A.PBNCD_NO
                                   , A.BSNS_CODE
                                   , B.BSNS_NM
                                   , A.CPTAL_KND
                                   , C.CODE_NM AS CPTAL_KND_NM
                                   , A.BRRW_DE
                                   , A.EXPRTN_DE
                                   , NVL(A.EXPRTN_AT, 0) AS EXPRTN_AT
                                   , A.INTRT     
                                   , A.BRRW_AMOUNT
                                   , A.LEASE_YM
                                   , CASE WHEN A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                          THEN 'Y'
                                          ELSE 'N'
                                     END AS LEASE_YN     
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS PRNCPAL_RPAY_AMOUNT
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_INTR_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS INTR_RPAY_AMOUNT        
                                   , NVL(A.BRRW_AMOUNT ,0) - NVL((
                                        SELECT SUM(AA.RPAY_AMOUNT)
                                        FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                        WHERE AA.PBNCD_NO = A.PBNCD_NO
                                        AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS BRRW_BALANCE         
                              from TBFUN_PBNCD A
                              LEFT OUTER JOIN TBPRJ_BSNS_CODE B
                              ON A.BSNS_CODE = B.BSNS_CODE
                              LEFT OUTER JOIN
                                (
                                  SELECT DETAIL_CODE AS CODE ,
                                    DETAIL_CODE_NM   AS CODE_NM
                                  FROM TBFUN_CPTAL_DETAIL_CODE
                                  WHERE CODE_SE = '000'
                                )
                                C
                              ON A.CPTAL_KND = C.CODE
                              WHERE (A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231')
                      ) AA
                      GROUP BY AA.PBNCD_NO, AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM
              ) AA
        ) AA
        WHERE AA.BAL_AMT > 0    
    ) A
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO    AS PBNCD_NO    ,
               SUM(A.RPAY_AMOUNT) AS RPAY_AMOUNT ,
			   SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG00,               
<isEqual property="PRT_GBN2" compareValue="Y"> 
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               0 AS PRNCPAL_RPAY_AG10,0 AS PRNCPAL_RPAY_AG11,0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,
               0 AS PRNCPAL_RPAY_AG15,0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>          
<isEqual property="PRT_GBN2" compareValue="Q">
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG12,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG13,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG14,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG15,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG16,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG17,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG18,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
              0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,0 AS PRNCPAL_RPAY_AG15,
              0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>		       
        FROM TBFUN_PBNCD_PRNCPAL_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) C
    ON A.PBNCD_NO = C.PBNCD_NO
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO AS PBNCD_NO ,
              SUM(A.RPAY_AMOUNT) AS INTR_RPAY_AMOUNT ,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG00,
<isEqual property="PRT_GBN2" compareValue="Y">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              0 AS INTR_RPAY_AG10,0 AS INTR_RPAY_AG11,0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,
              0 AS INTR_RPAY_AG15,0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="Q">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG12,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG13,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG14,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG15,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG16,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG17,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG18,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,0 AS INTR_RPAY_AG15,
              0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
        FROM TBFUN_PBNCD_INTR_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) E
    ON A.PBNCD_NO = E.PBNCD_NO
    
    UNION ALL
    
    SELECT '8' AS DV0, 
           '장기채(C1)' AS DV1,
           '' AS DV2,
           '합계' AS DV3,
           NVL(TRUNC(SUM(C.RPAY_AMOUNT) / #PRT_GBN1#), 0) AS RPAY_AMOUNT,
           NVL(TRUNC(SUM(E.INTR_RPAY_AMOUNT) / #PRT_GBN1#), 0) AS INTR_RPAY_AMOUNT,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG00) / #PRT_GBN1#), 0) AS AMT00,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS AMT0                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS AMT1                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS AMT2                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS AMT3                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS AMT4                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS AMT5                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS AMT6                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS AMT7                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS AMT8                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS AMT9                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG10) / #PRT_GBN1#) ,0) AS AMT10                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG11) / #PRT_GBN1#) ,0) AS AMT11                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG12) / #PRT_GBN1#) ,0) AS AMT12                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG13) / #PRT_GBN1#) ,0) AS AMT13                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG14) / #PRT_GBN1#) ,0) AS AMT14                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG15) / #PRT_GBN1#) ,0) AS AMT15                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG16) / #PRT_GBN1#) ,0) AS AMT16                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG17) / #PRT_GBN1#) ,0) AS AMT17                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG18) / #PRT_GBN1#) ,0) AS AMT18                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG19) / #PRT_GBN1#) ,0) AS AMT19                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG00 ) / #PRT_GBN1#) ,0) AS INT00                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS INT0                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS INT1                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS INT2                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS INT3                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS INT4                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS INT5                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS INT6                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS INT7                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS INT8                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS INT9                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG10) / #PRT_GBN1#) ,0) AS INT10                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG11) / #PRT_GBN1#) ,0) AS INT11                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG12) / #PRT_GBN1#) ,0) AS INT12                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG13) / #PRT_GBN1#) ,0) AS INT13                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG14) / #PRT_GBN1#) ,0) AS INT14                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG15) / #PRT_GBN1#) ,0) AS INT15                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG16) / #PRT_GBN1#) ,0) AS INT16                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG17) / #PRT_GBN1#) ,0) AS INT17                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG18) / #PRT_GBN1#) ,0) AS INT18                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG19) / #PRT_GBN1#) ,0) AS INT19
    FROM (
        SELECT *
        FROM
        (
              SELECT AA.*
                   , SUM(AA.BRRW_BALANCE) OVER (PARTITION BY AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM) AS BAL_AMT
              FROM
              (
                      SELECT AA.PBNCD_NO
                           , AA.BSNS_CODE AS BSNS_CODE
                           , AA.BSNS_NM AS BSNS_NM
                           , AA.CPTAL_KND AS CPTAL_KND
                           , AA.CPTAL_KND_NM AS CPTAL_KND_NM
                           , AA.LEASE_YN
                           , MIN(AA.BRRW_DE) AS BRRW_DE
                           , MAX(AA.EXPRTN_DE) AS EXPRTN_DE
                           , TO_CHAR(SUM(AA.INTRT) / COUNT(AA.CPTAL_KND), 'FM9990D00') AS INTRT
                           , SUM(AA.BRRW_AMOUNT) AS BRRW_AMOUNT
                           , SUM(AA.PRNCPAL_RPAY_AMOUNT) AS PRNCPAL_RPAY_AMOUNT
                           , SUM(AA.INTR_RPAY_AMOUNT) AS INTR_RPAY_AMOUNT
                           , SUM(AA.BRRW_BALANCE) AS BRRW_BALANCE
                      FROM 
                      (
                              select A.PBNCD_NO
                                   , A.BSNS_CODE
                                   , B.BSNS_NM
                                   , A.CPTAL_KND
                                   , C.CODE_NM AS CPTAL_KND_NM
                                   , A.BRRW_DE
                                   , A.EXPRTN_DE
                                   , NVL(A.EXPRTN_AT, 0) AS EXPRTN_AT
                                   , A.INTRT     
                                   , A.BRRW_AMOUNT
                                   , A.LEASE_YM
                                   , CASE WHEN A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                          THEN 'Y'
                                          ELSE 'N'
                                     END AS LEASE_YN     
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS PRNCPAL_RPAY_AMOUNT
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_INTR_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS INTR_RPAY_AMOUNT        
                                   , NVL(A.BRRW_AMOUNT ,0) - NVL((
                                        SELECT SUM(AA.RPAY_AMOUNT)
                                        FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                        WHERE AA.PBNCD_NO = A.PBNCD_NO
                                        AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS BRRW_BALANCE         
                              from TBFUN_PBNCD A
                              LEFT OUTER JOIN TBPRJ_BSNS_CODE B
                              ON A.BSNS_CODE = B.BSNS_CODE
                              LEFT OUTER JOIN
                                (
                                  SELECT DETAIL_CODE AS CODE ,
                                    DETAIL_CODE_NM   AS CODE_NM
                                  FROM TBFUN_CPTAL_DETAIL_CODE
                                  WHERE CODE_SE = '000'
                                )
                                C
                              ON A.CPTAL_KND = C.CODE
                              WHERE (A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231')
                              AND   A.CPTAL_KND LIKE 'A%'
                      ) AA
                      GROUP BY AA.PBNCD_NO, AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM
              ) AA
        ) AA
        WHERE AA.BAL_AMT > 0    
    ) A
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO    AS PBNCD_NO    ,
               SUM(A.RPAY_AMOUNT) AS RPAY_AMOUNT ,
			   SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG00,               
<isEqual property="PRT_GBN2" compareValue="Y"> 
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               0 AS PRNCPAL_RPAY_AG10,0 AS PRNCPAL_RPAY_AG11,0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,
               0 AS PRNCPAL_RPAY_AG15,0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>          
<isEqual property="PRT_GBN2" compareValue="Q">
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG12,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG13,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG14,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG15,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG16,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG17,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG18,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
              0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,0 AS PRNCPAL_RPAY_AG15,
              0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>		       
        FROM TBFUN_PBNCD_PRNCPAL_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) C
    ON A.PBNCD_NO = C.PBNCD_NO
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO AS PBNCD_NO ,
        	  SUM(A.RPAY_AMOUNT) AS INTR_RPAY_AMOUNT ,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG00,
<isEqual property="PRT_GBN2" compareValue="Y">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              0 AS INTR_RPAY_AG10,0 AS INTR_RPAY_AG11,0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,
              0 AS INTR_RPAY_AG15,0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="Q">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG12,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG13,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG14,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG15,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG16,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG17,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG18,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,0 AS INTR_RPAY_AG15,
              0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
        FROM TBFUN_PBNCD_INTR_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) E
    ON A.PBNCD_NO = E.PBNCD_NO
    
    UNION ALL
    
    SELECT *
    FROM
    (
        SELECT '9' AS DV0, 
               '' AS DV1,
               DECODE(GROUPING_ID(A.BSNS_CODE, A.BSNS_NM, A.CPTAL_KND, A.CPTAL_KND_NM), '0', '', A.BSNS_NM) AS DV2,
               DECODE(GROUPING_ID(A.BSNS_CODE, A.BSNS_NM, A.CPTAL_KND, A.CPTAL_KND_NM), '0', A.CPTAL_KND_NM, '소계') AS DV3,
	           NVL(TRUNC(SUM(C.RPAY_AMOUNT) / #PRT_GBN1#), 0) AS RPAY_AMOUNT,
    	       NVL(TRUNC(SUM(E.INTR_RPAY_AMOUNT) / #PRT_GBN1#), 0) AS INTR_RPAY_AMOUNT,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG00) / #PRT_GBN1#), 0) AS AMT00,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS AMT0                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS AMT1                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS AMT2                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS AMT3                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS AMT4                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS AMT5                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS AMT6                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS AMT7                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS AMT8                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS AMT9                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG10) / #PRT_GBN1#) ,0) AS AMT10                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG11) / #PRT_GBN1#) ,0) AS AMT11                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG12) / #PRT_GBN1#) ,0) AS AMT12                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG13) / #PRT_GBN1#) ,0) AS AMT13                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG14) / #PRT_GBN1#) ,0) AS AMT14                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG15) / #PRT_GBN1#) ,0) AS AMT15                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG16) / #PRT_GBN1#) ,0) AS AMT16                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG17) / #PRT_GBN1#) ,0) AS AMT17                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG18) / #PRT_GBN1#) ,0) AS AMT18                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG19) / #PRT_GBN1#) ,0) AS AMT19                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG00 ) / #PRT_GBN1#) ,0) AS INT00                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS INT0                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS INT1                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS INT2                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS INT3                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS INT4                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS INT5                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS INT6                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS INT7                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS INT8                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS INT9                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG10) / #PRT_GBN1#) ,0) AS INT10                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG11) / #PRT_GBN1#) ,0) AS INT11                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG12) / #PRT_GBN1#) ,0) AS INT12                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG13) / #PRT_GBN1#) ,0) AS INT13                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG14) / #PRT_GBN1#) ,0) AS INT14                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG15) / #PRT_GBN1#) ,0) AS INT15                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG16) / #PRT_GBN1#) ,0) AS INT16                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG17) / #PRT_GBN1#) ,0) AS INT17                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG18) / #PRT_GBN1#) ,0) AS INT18                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG19) / #PRT_GBN1#) ,0) AS INT19
        FROM (
            SELECT *
            FROM
            (
                  SELECT AA.*
                       , SUM(AA.BRRW_BALANCE) OVER (PARTITION BY AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM) AS BAL_AMT
                  FROM
                  (
                          SELECT AA.PBNCD_NO
                               , AA.BSNS_CODE AS BSNS_CODE
                               , AA.BSNS_NM AS BSNS_NM
                               , AA.CPTAL_KND AS CPTAL_KND
                               , AA.CPTAL_KND_NM AS CPTAL_KND_NM
                               , AA.LEASE_YN
                               , MIN(AA.BRRW_DE) AS BRRW_DE
                               , MAX(AA.EXPRTN_DE) AS EXPRTN_DE
                               , TO_CHAR(SUM(AA.INTRT) / COUNT(AA.CPTAL_KND), 'FM9990D00') AS INTRT
                               , SUM(AA.BRRW_AMOUNT) AS BRRW_AMOUNT
                               , SUM(AA.PRNCPAL_RPAY_AMOUNT) AS PRNCPAL_RPAY_AMOUNT
                               , SUM(AA.INTR_RPAY_AMOUNT) AS INTR_RPAY_AMOUNT
                               , SUM(AA.BRRW_BALANCE) AS BRRW_BALANCE
                          FROM 
                          (
                                  select A.PBNCD_NO
                                       , A.BSNS_CODE
                                       , B.BSNS_NM
                                       , A.CPTAL_KND
                                       , C.CODE_NM AS CPTAL_KND_NM
                                       , A.BRRW_DE
                                       , A.EXPRTN_DE
                                       , NVL(A.EXPRTN_AT, 0) AS EXPRTN_AT
                                       , A.INTRT     
                                       , A.BRRW_AMOUNT
                                       , A.LEASE_YM
                                       , CASE WHEN A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                              THEN 'Y'
                                              ELSE 'N'
                                         END AS LEASE_YN     
                                       ,NVL((
                                          SELECT SUM(AA.RPAY_AMOUNT)
                                          FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                          WHERE AA.PBNCD_NO = A.PBNCD_NO
                                          AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                        ) ,0) AS PRNCPAL_RPAY_AMOUNT
                                       ,NVL((
                                          SELECT SUM(AA.RPAY_AMOUNT)
                                          FROM TBFUN_PBNCD_INTR_RPAY_DTLS AA
                                          WHERE AA.PBNCD_NO = A.PBNCD_NO
                                          AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                        ) ,0) AS INTR_RPAY_AMOUNT        
                                       , NVL(A.BRRW_AMOUNT ,0) - NVL((
                                            SELECT SUM(AA.RPAY_AMOUNT)
                                            FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                            WHERE AA.PBNCD_NO = A.PBNCD_NO
                                            AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                        ) ,0) AS BRRW_BALANCE         
                                  from TBFUN_PBNCD A
                                  LEFT OUTER JOIN TBPRJ_BSNS_CODE B
                                  ON A.BSNS_CODE = B.BSNS_CODE
                                  LEFT OUTER JOIN
                                    (
                                      SELECT DETAIL_CODE AS CODE ,
                                        DETAIL_CODE_NM   AS CODE_NM
                                      FROM TBFUN_CPTAL_DETAIL_CODE
                                      WHERE CODE_SE = '000'
                                    )
                                    C
                                  ON A.CPTAL_KND = C.CODE
                                  WHERE (A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231')
                                  AND   A.CPTAL_KND LIKE 'A%'
                          ) AA
                          GROUP BY AA.PBNCD_NO, AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM
                  ) AA
            ) AA
            WHERE AA.BAL_AMT > 0    
        
        ) A
	    LEFT OUTER JOIN
	    (
	        SELECT A.PBNCD_NO    AS PBNCD_NO    ,
	               SUM(A.RPAY_AMOUNT) AS RPAY_AMOUNT ,
				   SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG00,               
	<isEqual property="PRT_GBN2" compareValue="Y"> 
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
	               0 AS PRNCPAL_RPAY_AG10,0 AS PRNCPAL_RPAY_AG11,0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,
	               0 AS PRNCPAL_RPAY_AG15,0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
	</isEqual>          
	<isEqual property="PRT_GBN2" compareValue="Q">
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG12,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG13,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG14,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG15,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG16,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG17,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG18,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG19
	</isEqual>
	<isEqual property="PRT_GBN2" compareValue="M">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
	              0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,0 AS PRNCPAL_RPAY_AG15,
	              0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
	</isEqual>		       
	        FROM TBFUN_PBNCD_PRNCPAL_RPAY_PLAN A
	        GROUP BY A.PBNCD_NO
	    ) C
	    ON A.PBNCD_NO = C.PBNCD_NO
	    LEFT OUTER JOIN
	    (
	        SELECT A.PBNCD_NO AS PBNCD_NO ,
	        	  SUM(A.RPAY_AMOUNT) AS INTR_RPAY_AMOUNT ,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG00,
	<isEqual property="PRT_GBN2" compareValue="Y">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
	              0 AS INTR_RPAY_AG10,0 AS INTR_RPAY_AG11,0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,
	              0 AS INTR_RPAY_AG15,0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
	</isEqual>
	<isEqual property="PRT_GBN2" compareValue="Q">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG12,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG13,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG14,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG15,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG16,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG17,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG18,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG19
	</isEqual>
	<isEqual property="PRT_GBN2" compareValue="M">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
	              0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,0 AS INTR_RPAY_AG15,
	              0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
	</isEqual>
	        FROM TBFUN_PBNCD_INTR_RPAY_PLAN A
	        GROUP BY A.PBNCD_NO
	    ) E
        ON A.PBNCD_NO = E.PBNCD_NO
        GROUP BY ROLLUP(A.BSNS_CODE, A.BSNS_NM, A.CPTAL_KND, A.CPTAL_KND_NM) 
        HAVING GROUPING_ID(A.BSNS_CODE, A.BSNS_NM, A.CPTAL_KND, A.CPTAL_KND_NM) IN (0,3) 
        order by grouping(A.BSNS_NM) desc, A.BSNS_NM
               , grouping(A.CPTAL_KND_NM) desc, A.CPTAL_KND_NM
    )    
        
    UNION ALL
    
    SELECT '10' AS DV0, 
           '단기채(C2)' AS DV1,
           '' AS DV2,
           '합계' AS DV3,
           NVL(TRUNC(SUM(C.RPAY_AMOUNT) / #PRT_GBN1#), 0) AS RPAY_AMOUNT,
           NVL(TRUNC(SUM(E.INTR_RPAY_AMOUNT) / #PRT_GBN1#), 0) AS INTR_RPAY_AMOUNT,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG00) / #PRT_GBN1#), 0) AS AMT00,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS AMT0                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS AMT1                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS AMT2                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS AMT3                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS AMT4                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS AMT5                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS AMT6                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS AMT7                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS AMT8                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS AMT9                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG10) / #PRT_GBN1#) ,0) AS AMT10                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG11) / #PRT_GBN1#) ,0) AS AMT11                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG12) / #PRT_GBN1#) ,0) AS AMT12                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG13) / #PRT_GBN1#) ,0) AS AMT13                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG14) / #PRT_GBN1#) ,0) AS AMT14                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG15) / #PRT_GBN1#) ,0) AS AMT15                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG16) / #PRT_GBN1#) ,0) AS AMT16                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG17) / #PRT_GBN1#) ,0) AS AMT17                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG18) / #PRT_GBN1#) ,0) AS AMT18                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG19) / #PRT_GBN1#) ,0) AS AMT19                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG00 ) / #PRT_GBN1#) ,0) AS INT00                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS INT0                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS INT1                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS INT2                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS INT3                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS INT4                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS INT5                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS INT6                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS INT7                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS INT8                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS INT9                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG10) / #PRT_GBN1#) ,0) AS INT10                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG11) / #PRT_GBN1#) ,0) AS INT11                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG12) / #PRT_GBN1#) ,0) AS INT12                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG13) / #PRT_GBN1#) ,0) AS INT13                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG14) / #PRT_GBN1#) ,0) AS INT14                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG15) / #PRT_GBN1#) ,0) AS INT15                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG16) / #PRT_GBN1#) ,0) AS INT16                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG17) / #PRT_GBN1#) ,0) AS INT17                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG18) / #PRT_GBN1#) ,0) AS INT18                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG19) / #PRT_GBN1#) ,0) AS INT19
    FROM (
        SELECT *
        FROM
        (
              SELECT AA.*
                   , SUM(AA.BRRW_BALANCE) OVER (PARTITION BY AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM) AS BAL_AMT
              FROM
              (
                      SELECT AA.PBNCD_NO
                           , AA.BSNS_CODE AS BSNS_CODE
                           , AA.BSNS_NM AS BSNS_NM
                           , AA.CPTAL_KND AS CPTAL_KND
                           , AA.CPTAL_KND_NM AS CPTAL_KND_NM
                           , AA.LEASE_YN
                           , MIN(AA.BRRW_DE) AS BRRW_DE
                           , MAX(AA.EXPRTN_DE) AS EXPRTN_DE
                           , TO_CHAR(SUM(AA.INTRT) / COUNT(AA.CPTAL_KND), 'FM9990D00') AS INTRT
                           , SUM(AA.BRRW_AMOUNT) AS BRRW_AMOUNT
                           , SUM(AA.PRNCPAL_RPAY_AMOUNT) AS PRNCPAL_RPAY_AMOUNT
                           , SUM(AA.INTR_RPAY_AMOUNT) AS INTR_RPAY_AMOUNT
                           , SUM(AA.BRRW_BALANCE) AS BRRW_BALANCE
                      FROM 
                      (
                              select A.PBNCD_NO
                                   , A.BSNS_CODE
                                   , B.BSNS_NM
                                   , A.CPTAL_KND
                                   , C.CODE_NM AS CPTAL_KND_NM
                                   , A.BRRW_DE
                                   , A.EXPRTN_DE
                                   , NVL(A.EXPRTN_AT, 0) AS EXPRTN_AT
                                   , A.INTRT     
                                   , A.BRRW_AMOUNT
                                   , A.LEASE_YM
                                   , CASE WHEN A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                          THEN 'Y'
                                          ELSE 'N'
                                     END AS LEASE_YN     
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS PRNCPAL_RPAY_AMOUNT
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_INTR_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS INTR_RPAY_AMOUNT        
                                   , NVL(A.BRRW_AMOUNT ,0) - NVL((
                                        SELECT SUM(AA.RPAY_AMOUNT)
                                        FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                        WHERE AA.PBNCD_NO = A.PBNCD_NO
                                        AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS BRRW_BALANCE         
                              from TBFUN_PBNCD A
                              LEFT OUTER JOIN TBPRJ_BSNS_CODE B
                              ON A.BSNS_CODE = B.BSNS_CODE
                              LEFT OUTER JOIN
                                (
                                  SELECT DETAIL_CODE AS CODE ,
                                    DETAIL_CODE_NM   AS CODE_NM
                                  FROM TBFUN_CPTAL_DETAIL_CODE
                                  WHERE CODE_SE = '000'
                                )
                                C
                              ON A.CPTAL_KND = C.CODE
                              WHERE (A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231')
                              AND   A.CPTAL_KND LIKE 'B%'
                      ) AA
                      GROUP BY AA.PBNCD_NO, AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM
              ) AA
        ) AA
        WHERE AA.BAL_AMT > 0    
    ) A
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO    AS PBNCD_NO    ,
               SUM(A.RPAY_AMOUNT) AS RPAY_AMOUNT ,
			   SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG00,               
<isEqual property="PRT_GBN2" compareValue="Y"> 
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               0 AS PRNCPAL_RPAY_AG10,0 AS PRNCPAL_RPAY_AG11,0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,
               0 AS PRNCPAL_RPAY_AG15,0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>          
<isEqual property="PRT_GBN2" compareValue="Q">
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG12,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG13,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG14,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG15,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG16,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG17,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG18,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
              0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,0 AS PRNCPAL_RPAY_AG15,
              0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>		       
        FROM TBFUN_PBNCD_PRNCPAL_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) C
    ON A.PBNCD_NO = C.PBNCD_NO
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO AS PBNCD_NO ,
        	  SUM(A.RPAY_AMOUNT) AS INTR_RPAY_AMOUNT ,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG00,
<isEqual property="PRT_GBN2" compareValue="Y">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              0 AS INTR_RPAY_AG10,0 AS INTR_RPAY_AG11,0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,
              0 AS INTR_RPAY_AG15,0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="Q">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG12,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG13,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG14,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG15,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG16,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG17,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG18,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,0 AS INTR_RPAY_AG15,
              0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
        FROM TBFUN_PBNCD_INTR_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) E
    ON A.PBNCD_NO = E.PBNCD_NO
    
    UNION ALL
    
    SELECT *
    FROM
    (
        SELECT '11' AS DV0, 
               '' AS DV1,
               DECODE(GROUPING_ID(A.BSNS_CODE, A.BSNS_NM, A.CPTAL_KND, A.CPTAL_KND_NM), '0', '', A.BSNS_NM) AS DV2,
               DECODE(GROUPING_ID(A.BSNS_CODE, A.BSNS_NM, A.CPTAL_KND, A.CPTAL_KND_NM), '0', A.CPTAL_KND_NM, '소계') AS DV3,
	           NVL(TRUNC(SUM(C.RPAY_AMOUNT) / #PRT_GBN1#), 0) AS RPAY_AMOUNT,
    	       NVL(TRUNC(SUM(E.INTR_RPAY_AMOUNT) / #PRT_GBN1#), 0) AS INTR_RPAY_AMOUNT,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG00) / #PRT_GBN1#), 0) AS AMT00,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS AMT0                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS AMT1                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS AMT2                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS AMT3                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS AMT4                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS AMT5                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS AMT6                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS AMT7                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS AMT8                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS AMT9                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG10) / #PRT_GBN1#) ,0) AS AMT10                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG11) / #PRT_GBN1#) ,0) AS AMT11                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG12) / #PRT_GBN1#) ,0) AS AMT12                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG13) / #PRT_GBN1#) ,0) AS AMT13                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG14) / #PRT_GBN1#) ,0) AS AMT14                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG15) / #PRT_GBN1#) ,0) AS AMT15                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG16) / #PRT_GBN1#) ,0) AS AMT16                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG17) / #PRT_GBN1#) ,0) AS AMT17                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG18) / #PRT_GBN1#) ,0) AS AMT18                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG19) / #PRT_GBN1#) ,0) AS AMT19                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG00 ) / #PRT_GBN1#) ,0) AS INT00                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS INT0                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS INT1                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS INT2                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS INT3                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS INT4                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS INT5                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS INT6                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS INT7                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS INT8                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS INT9                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG10) / #PRT_GBN1#) ,0) AS INT10                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG11) / #PRT_GBN1#) ,0) AS INT11                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG12) / #PRT_GBN1#) ,0) AS INT12                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG13) / #PRT_GBN1#) ,0) AS INT13                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG14) / #PRT_GBN1#) ,0) AS INT14                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG15) / #PRT_GBN1#) ,0) AS INT15                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG16) / #PRT_GBN1#) ,0) AS INT16                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG17) / #PRT_GBN1#) ,0) AS INT17                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG18) / #PRT_GBN1#) ,0) AS INT18                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG19) / #PRT_GBN1#) ,0) AS INT19
        FROM (
            SELECT *
            FROM
            (
                  SELECT AA.*
                       , SUM(AA.BRRW_BALANCE) OVER (PARTITION BY AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM) AS BAL_AMT
                  FROM
                  (
                          SELECT AA.PBNCD_NO
                               , AA.BSNS_CODE AS BSNS_CODE
                               , AA.BSNS_NM AS BSNS_NM
                               , AA.CPTAL_KND AS CPTAL_KND
                               , AA.CPTAL_KND_NM AS CPTAL_KND_NM
                               , AA.LEASE_YN
                               , MIN(AA.BRRW_DE) AS BRRW_DE
                               , MAX(AA.EXPRTN_DE) AS EXPRTN_DE
                               , TO_CHAR(SUM(AA.INTRT) / COUNT(AA.CPTAL_KND), 'FM9990D00') AS INTRT
                               , SUM(AA.BRRW_AMOUNT) AS BRRW_AMOUNT
                               , SUM(AA.PRNCPAL_RPAY_AMOUNT) AS PRNCPAL_RPAY_AMOUNT
                               , SUM(AA.INTR_RPAY_AMOUNT) AS INTR_RPAY_AMOUNT
                               , SUM(AA.BRRW_BALANCE) AS BRRW_BALANCE
                          FROM 
                          (
                                  select A.PBNCD_NO
                                       , A.BSNS_CODE
                                       , B.BSNS_NM
                                       , A.CPTAL_KND
                                       , C.CODE_NM AS CPTAL_KND_NM
                                       , A.BRRW_DE
                                       , A.EXPRTN_DE
                                       , NVL(A.EXPRTN_AT, 0) AS EXPRTN_AT
                                       , A.INTRT     
                                       , A.BRRW_AMOUNT
                                       , A.LEASE_YM
                                       , CASE WHEN A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                              THEN 'Y'
                                              ELSE 'N'
                                         END AS LEASE_YN     
                                       ,NVL((
                                          SELECT SUM(AA.RPAY_AMOUNT)
                                          FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                          WHERE AA.PBNCD_NO = A.PBNCD_NO
                                          AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                        ) ,0) AS PRNCPAL_RPAY_AMOUNT
                                       ,NVL((
                                          SELECT SUM(AA.RPAY_AMOUNT)
                                          FROM TBFUN_PBNCD_INTR_RPAY_DTLS AA
                                          WHERE AA.PBNCD_NO = A.PBNCD_NO
                                          AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                        ) ,0) AS INTR_RPAY_AMOUNT        
                                       , NVL(A.BRRW_AMOUNT ,0) - NVL((
                                            SELECT SUM(AA.RPAY_AMOUNT)
                                            FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                            WHERE AA.PBNCD_NO = A.PBNCD_NO
                                            AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                        ) ,0) AS BRRW_BALANCE         
                                  from TBFUN_PBNCD A
                                  LEFT OUTER JOIN TBPRJ_BSNS_CODE B
                                  ON A.BSNS_CODE = B.BSNS_CODE
                                  LEFT OUTER JOIN
                                    (
                                      SELECT DETAIL_CODE AS CODE ,
                                        DETAIL_CODE_NM   AS CODE_NM
                                      FROM TBFUN_CPTAL_DETAIL_CODE
                                      WHERE CODE_SE = '000'
                                    )
                                    C
                                  ON A.CPTAL_KND = C.CODE
                                  WHERE (A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231')
                                  AND   A.CPTAL_KND LIKE 'B%'
                          ) AA
                          GROUP BY AA.PBNCD_NO, AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM
                  ) AA
            ) AA
            WHERE AA.BAL_AMT > 0    
        
        ) A
	    LEFT OUTER JOIN
	    (
	        SELECT A.PBNCD_NO    AS PBNCD_NO    ,
	               SUM(A.RPAY_AMOUNT) AS RPAY_AMOUNT ,
				   SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG00,               
	<isEqual property="PRT_GBN2" compareValue="Y"> 
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
	               0 AS PRNCPAL_RPAY_AG10,0 AS PRNCPAL_RPAY_AG11,0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,
	               0 AS PRNCPAL_RPAY_AG15,0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
	</isEqual>          
	<isEqual property="PRT_GBN2" compareValue="Q">
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG12,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG13,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG14,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG15,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG16,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG17,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG18,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG19
	</isEqual>
	<isEqual property="PRT_GBN2" compareValue="M">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
	              0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,0 AS PRNCPAL_RPAY_AG15,
	              0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
	</isEqual>		       
	        FROM TBFUN_PBNCD_PRNCPAL_RPAY_PLAN A
	        GROUP BY A.PBNCD_NO
	    ) C
	    ON A.PBNCD_NO = C.PBNCD_NO
	    LEFT OUTER JOIN
	    (
	        SELECT A.PBNCD_NO AS PBNCD_NO ,
	        	  SUM(A.RPAY_AMOUNT) AS INTR_RPAY_AMOUNT ,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG00,
	<isEqual property="PRT_GBN2" compareValue="Y">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
	              0 AS INTR_RPAY_AG10,0 AS INTR_RPAY_AG11,0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,
	              0 AS INTR_RPAY_AG15,0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
	</isEqual>
	<isEqual property="PRT_GBN2" compareValue="Q">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG12,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG13,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG14,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG15,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG16,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG17,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG18,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG19
	</isEqual>
	<isEqual property="PRT_GBN2" compareValue="M">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
	              0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,0 AS INTR_RPAY_AG15,
	              0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
	</isEqual>
	        FROM TBFUN_PBNCD_INTR_RPAY_PLAN A
	        GROUP BY A.PBNCD_NO
	    ) E
        ON A.PBNCD_NO = E.PBNCD_NO
        GROUP BY ROLLUP(A.BSNS_CODE, A.BSNS_NM, A.CPTAL_KND, A.CPTAL_KND_NM) 
        HAVING GROUPING_ID(A.BSNS_CODE, A.BSNS_NM, A.CPTAL_KND, A.CPTAL_KND_NM) IN (0,3) 
        order by grouping(A.BSNS_NM) desc, A.BSNS_NM
               , grouping(A.CPTAL_KND_NM) desc, A.CPTAL_KND_NM
    )                	
	</select>	
	
	<!-- 원리금상환일정 채권별 조회 -->
	<select id="FUN020204DAO.selectRpaySchedule02" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
    SELECT '1' AS DV0, 
           '공사채(A=B+C)' AS DV1,
           '' AS DV2,
           '합계' AS DV3,
           NVL(TRUNC(SUM(C.RPAY_AMOUNT) / #PRT_GBN1#), 0) AS RPAY_AMOUNT,
           NVL(TRUNC(SUM(E.INTR_RPAY_AMOUNT) / #PRT_GBN1#), 0) AS INTR_RPAY_AMOUNT,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG00) / #PRT_GBN1#), 0) AS AMT00,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS AMT0                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS AMT1                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS AMT2                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS AMT3                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS AMT4                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS AMT5                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS AMT6                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS AMT7                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS AMT8                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS AMT9                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG10) / #PRT_GBN1#) ,0) AS AMT10                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG11) / #PRT_GBN1#) ,0) AS AMT11                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG12) / #PRT_GBN1#) ,0) AS AMT12                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG13) / #PRT_GBN1#) ,0) AS AMT13                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG14) / #PRT_GBN1#) ,0) AS AMT14                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG15) / #PRT_GBN1#) ,0) AS AMT15                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG16) / #PRT_GBN1#) ,0) AS AMT16                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG17) / #PRT_GBN1#) ,0) AS AMT17                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG18) / #PRT_GBN1#) ,0) AS AMT18                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG19) / #PRT_GBN1#) ,0) AS AMT19                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG00 ) / #PRT_GBN1#) ,0) AS INT00                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS INT0                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS INT1                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS INT2                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS INT3                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS INT4                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS INT5                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS INT6                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS INT7                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS INT8                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS INT9                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG10) / #PRT_GBN1#) ,0) AS INT10                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG11) / #PRT_GBN1#) ,0) AS INT11                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG12) / #PRT_GBN1#) ,0) AS INT12                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG13) / #PRT_GBN1#) ,0) AS INT13                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG14) / #PRT_GBN1#) ,0) AS INT14                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG15) / #PRT_GBN1#) ,0) AS INT15                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG16) / #PRT_GBN1#) ,0) AS INT16                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG17) / #PRT_GBN1#) ,0) AS INT17                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG18) / #PRT_GBN1#) ,0) AS INT18                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG19) / #PRT_GBN1#) ,0) AS INT19
    FROM (
        SELECT *
        FROM
        (
              SELECT AA.*
                   , SUM(AA.BRRW_BALANCE) OVER (PARTITION BY AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM) AS BAL_AMT
              FROM
              (
                      SELECT AA.PBNCD_NO
                           , AA.BSNS_CODE AS BSNS_CODE
                           , AA.BSNS_NM AS BSNS_NM
                           , AA.CPTAL_KND AS CPTAL_KND
                           , AA.CPTAL_KND_NM AS CPTAL_KND_NM
                           , AA.LEASE_YN
                           , MIN(AA.BRRW_DE) AS BRRW_DE
                           , MAX(AA.EXPRTN_DE) AS EXPRTN_DE
                           , TO_CHAR(SUM(AA.INTRT) / COUNT(AA.CPTAL_KND), 'FM9990D00') AS INTRT
                           , SUM(AA.BRRW_AMOUNT) AS BRRW_AMOUNT
                           , SUM(AA.PRNCPAL_RPAY_AMOUNT) AS PRNCPAL_RPAY_AMOUNT
                           , SUM(AA.INTR_RPAY_AMOUNT) AS INTR_RPAY_AMOUNT
                           , SUM(AA.BRRW_BALANCE) AS BRRW_BALANCE
                      FROM 
                      (
                              select A.PBNCD_NO
                                   , A.BSNS_CODE
                                   , B.BSNS_NM
                                   , A.CPTAL_KND
                                   , C.CODE_NM AS CPTAL_KND_NM
                                   , A.BRRW_DE
                                   , A.EXPRTN_DE
                                   , NVL(A.EXPRTN_AT, 0) AS EXPRTN_AT
                                   , A.INTRT     
                                   , A.BRRW_AMOUNT
                                   , A.LEASE_YM
                                   , CASE WHEN A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                          THEN 'Y'
                                          ELSE 'N'
                                     END AS LEASE_YN     
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS PRNCPAL_RPAY_AMOUNT
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_INTR_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS INTR_RPAY_AMOUNT        
                                   , NVL(A.BRRW_AMOUNT ,0) - NVL((
                                        SELECT SUM(AA.RPAY_AMOUNT)
                                        FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                        WHERE AA.PBNCD_NO = A.PBNCD_NO
                                        AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS BRRW_BALANCE         
                              from TBFUN_PBNCD A
                              LEFT OUTER JOIN TBPRJ_BSNS_CODE B
                              ON A.BSNS_CODE = B.BSNS_CODE
                              LEFT OUTER JOIN
                                (
                                  SELECT DETAIL_CODE AS CODE ,
                                    DETAIL_CODE_NM   AS CODE_NM
                                  FROM TBFUN_CPTAL_DETAIL_CODE
                                  WHERE CODE_SE = '000'
                                )
                                C
                              ON A.CPTAL_KND = C.CODE
                      ) AA
                      GROUP BY AA.PBNCD_NO, AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM
              ) AA
        ) AA
        WHERE AA.BAL_AMT > 0    
    ) A
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO    AS PBNCD_NO    ,
               SUM(A.RPAY_AMOUNT) AS RPAY_AMOUNT ,
			   SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG00,               
<isEqual property="PRT_GBN2" compareValue="Y"> 
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               0 AS PRNCPAL_RPAY_AG10,0 AS PRNCPAL_RPAY_AG11,0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,
               0 AS PRNCPAL_RPAY_AG15,0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>          
<isEqual property="PRT_GBN2" compareValue="Q">
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG12,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG13,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG14,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG15,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG16,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG17,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG18,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
              0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,0 AS PRNCPAL_RPAY_AG15,
              0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>		       
        FROM TBFUN_PBNCD_PRNCPAL_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) C
    ON A.PBNCD_NO = C.PBNCD_NO
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO AS PBNCD_NO ,
        	  SUM(A.RPAY_AMOUNT) AS INTR_RPAY_AMOUNT ,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG00,
<isEqual property="PRT_GBN2" compareValue="Y">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              0 AS INTR_RPAY_AG10,0 AS INTR_RPAY_AG11,0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,
              0 AS INTR_RPAY_AG15,0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="Q">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG12,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG13,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG14,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG15,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG16,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG17,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG18,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,0 AS INTR_RPAY_AG15,
              0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
        FROM TBFUN_PBNCD_INTR_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) E
    ON A.PBNCD_NO = E.PBNCD_NO
    
    UNION ALL
    
    SELECT '2' AS DV0, 
           '금융부채(B=B1+B2)' AS DV1,
           '' AS DV2,
           '합계' AS DV3,
           NVL(TRUNC(SUM(C.RPAY_AMOUNT) / #PRT_GBN1#), 0) AS RPAY_AMOUNT,
           NVL(TRUNC(SUM(E.INTR_RPAY_AMOUNT) / #PRT_GBN1#), 0) AS INTR_RPAY_AMOUNT,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG00) / #PRT_GBN1#), 0) AS AMT00,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS AMT0                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS AMT1                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS AMT2                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS AMT3                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS AMT4                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS AMT5                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS AMT6                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS AMT7                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS AMT8                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS AMT9                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG10) / #PRT_GBN1#) ,0) AS AMT10                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG11) / #PRT_GBN1#) ,0) AS AMT11                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG12) / #PRT_GBN1#) ,0) AS AMT12                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG13) / #PRT_GBN1#) ,0) AS AMT13                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG14) / #PRT_GBN1#) ,0) AS AMT14                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG15) / #PRT_GBN1#) ,0) AS AMT15                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG16) / #PRT_GBN1#) ,0) AS AMT16                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG17) / #PRT_GBN1#) ,0) AS AMT17                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG18) / #PRT_GBN1#) ,0) AS AMT18                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG19) / #PRT_GBN1#) ,0) AS AMT19                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG00 ) / #PRT_GBN1#) ,0) AS INT00                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS INT0                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS INT1                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS INT2                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS INT3                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS INT4                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS INT5                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS INT6                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS INT7                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS INT8                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS INT9                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG10) / #PRT_GBN1#) ,0) AS INT10                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG11) / #PRT_GBN1#) ,0) AS INT11                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG12) / #PRT_GBN1#) ,0) AS INT12                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG13) / #PRT_GBN1#) ,0) AS INT13                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG14) / #PRT_GBN1#) ,0) AS INT14                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG15) / #PRT_GBN1#) ,0) AS INT15                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG16) / #PRT_GBN1#) ,0) AS INT16                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG17) / #PRT_GBN1#) ,0) AS INT17                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG18) / #PRT_GBN1#) ,0) AS INT18                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG19) / #PRT_GBN1#) ,0) AS INT19
    FROM (
        SELECT *
        FROM
        (
              SELECT AA.*
                   , SUM(AA.BRRW_BALANCE) OVER (PARTITION BY AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM) AS BAL_AMT
              FROM
              (
                      SELECT AA.PBNCD_NO
                           , AA.BSNS_CODE AS BSNS_CODE
                           , AA.BSNS_NM AS BSNS_NM
                           , AA.CPTAL_KND AS CPTAL_KND
                           , AA.CPTAL_KND_NM AS CPTAL_KND_NM
                           , AA.LEASE_YN
                           , MIN(AA.BRRW_DE) AS BRRW_DE
                           , MAX(AA.EXPRTN_DE) AS EXPRTN_DE
                           , TO_CHAR(SUM(AA.INTRT) / COUNT(AA.CPTAL_KND), 'FM9990D00') AS INTRT
                           , SUM(AA.BRRW_AMOUNT) AS BRRW_AMOUNT
                           , SUM(AA.PRNCPAL_RPAY_AMOUNT) AS PRNCPAL_RPAY_AMOUNT
                           , SUM(AA.INTR_RPAY_AMOUNT) AS INTR_RPAY_AMOUNT
                           , SUM(AA.BRRW_BALANCE) AS BRRW_BALANCE
                      FROM 
                      (
                              select A.PBNCD_NO
                                   , A.BSNS_CODE
                                   , B.BSNS_NM
                                   , A.CPTAL_KND
                                   , C.CODE_NM AS CPTAL_KND_NM
                                   , A.BRRW_DE
                                   , A.EXPRTN_DE
                                   , NVL(A.EXPRTN_AT, 0) AS EXPRTN_AT
                                   , A.INTRT     
                                   , A.BRRW_AMOUNT
                                   , A.LEASE_YM
                                   , CASE WHEN A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                          THEN 'Y'
                                          ELSE 'N'
                                     END AS LEASE_YN     
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS PRNCPAL_RPAY_AMOUNT
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_INTR_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS INTR_RPAY_AMOUNT        
                                   , NVL(A.BRRW_AMOUNT ,0) - NVL((
                                        SELECT SUM(AA.RPAY_AMOUNT)
                                        FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                        WHERE AA.PBNCD_NO = A.PBNCD_NO
                                        AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS BRRW_BALANCE         
                              from TBFUN_PBNCD A
                              LEFT OUTER JOIN TBPRJ_BSNS_CODE B
                              ON A.BSNS_CODE = B.BSNS_CODE
                              LEFT OUTER JOIN
                                (
                                  SELECT DETAIL_CODE AS CODE ,
                                    DETAIL_CODE_NM   AS CODE_NM
                                  FROM TBFUN_CPTAL_DETAIL_CODE
                                  WHERE CODE_SE = '000'
                                )
                                C
                              ON A.CPTAL_KND = C.CODE
                              WHERE (A.LEASE_YM IS NULL OR A.LEASE_YM > #SEARCH_YEAR#||'1231')
                      ) AA
                      GROUP BY AA.PBNCD_NO, AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM
              ) AA
        ) AA
        WHERE AA.BAL_AMT > 0    
    ) A
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO    AS PBNCD_NO    ,
               SUM(A.RPAY_AMOUNT) AS RPAY_AMOUNT ,
			   SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG00,               
<isEqual property="PRT_GBN2" compareValue="Y"> 
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               0 AS PRNCPAL_RPAY_AG10,0 AS PRNCPAL_RPAY_AG11,0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,
               0 AS PRNCPAL_RPAY_AG15,0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>          
<isEqual property="PRT_GBN2" compareValue="Q">
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG12,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG13,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG14,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG15,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG16,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG17,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG18,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
              0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,0 AS PRNCPAL_RPAY_AG15,
              0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>		       
        FROM TBFUN_PBNCD_PRNCPAL_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) C
    ON A.PBNCD_NO = C.PBNCD_NO
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO AS PBNCD_NO ,
              SUM(A.RPAY_AMOUNT) AS INTR_RPAY_AMOUNT ,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG00,
<isEqual property="PRT_GBN2" compareValue="Y">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              0 AS INTR_RPAY_AG10,0 AS INTR_RPAY_AG11,0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,
              0 AS INTR_RPAY_AG15,0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="Q">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG12,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG13,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG14,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG15,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG16,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG17,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG18,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,0 AS INTR_RPAY_AG15,
              0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
        FROM TBFUN_PBNCD_INTR_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) E
    ON A.PBNCD_NO = E.PBNCD_NO
    
    UNION ALL
    
    SELECT '3' AS DV0, 
           '장기채(B1)' AS DV1,
           '' AS DV2,
           '합계' AS DV3,
           NVL(TRUNC(SUM(C.RPAY_AMOUNT) / #PRT_GBN1#), 0) AS RPAY_AMOUNT,
           NVL(TRUNC(SUM(E.INTR_RPAY_AMOUNT) / #PRT_GBN1#), 0) AS INTR_RPAY_AMOUNT,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG00) / #PRT_GBN1#), 0) AS AMT00,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS AMT0                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS AMT1                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS AMT2                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS AMT3                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS AMT4                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS AMT5                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS AMT6                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS AMT7                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS AMT8                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS AMT9                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG10) / #PRT_GBN1#) ,0) AS AMT10                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG11) / #PRT_GBN1#) ,0) AS AMT11                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG12) / #PRT_GBN1#) ,0) AS AMT12                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG13) / #PRT_GBN1#) ,0) AS AMT13                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG14) / #PRT_GBN1#) ,0) AS AMT14                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG15) / #PRT_GBN1#) ,0) AS AMT15                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG16) / #PRT_GBN1#) ,0) AS AMT16                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG17) / #PRT_GBN1#) ,0) AS AMT17                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG18) / #PRT_GBN1#) ,0) AS AMT18                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG19) / #PRT_GBN1#) ,0) AS AMT19                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG00 ) / #PRT_GBN1#) ,0) AS INT00                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS INT0                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS INT1                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS INT2                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS INT3                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS INT4                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS INT5                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS INT6                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS INT7                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS INT8                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS INT9                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG10) / #PRT_GBN1#) ,0) AS INT10                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG11) / #PRT_GBN1#) ,0) AS INT11                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG12) / #PRT_GBN1#) ,0) AS INT12                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG13) / #PRT_GBN1#) ,0) AS INT13                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG14) / #PRT_GBN1#) ,0) AS INT14                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG15) / #PRT_GBN1#) ,0) AS INT15                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG16) / #PRT_GBN1#) ,0) AS INT16                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG17) / #PRT_GBN1#) ,0) AS INT17                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG18) / #PRT_GBN1#) ,0) AS INT18                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG19) / #PRT_GBN1#) ,0) AS INT19
    FROM (
        SELECT *
        FROM
        (
              SELECT AA.*
                   , SUM(AA.BRRW_BALANCE) OVER (PARTITION BY AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM) AS BAL_AMT
              FROM
              (
                      SELECT AA.PBNCD_NO
                           , AA.BSNS_CODE AS BSNS_CODE
                           , AA.BSNS_NM AS BSNS_NM
                           , AA.CPTAL_KND AS CPTAL_KND
                           , AA.CPTAL_KND_NM AS CPTAL_KND_NM
                           , AA.LEASE_YN
                           , MIN(AA.BRRW_DE) AS BRRW_DE
                           , MAX(AA.EXPRTN_DE) AS EXPRTN_DE
                           , TO_CHAR(SUM(AA.INTRT) / COUNT(AA.CPTAL_KND), 'FM9990D00') AS INTRT
                           , SUM(AA.BRRW_AMOUNT) AS BRRW_AMOUNT
                           , SUM(AA.PRNCPAL_RPAY_AMOUNT) AS PRNCPAL_RPAY_AMOUNT
                           , SUM(AA.INTR_RPAY_AMOUNT) AS INTR_RPAY_AMOUNT
                           , SUM(AA.BRRW_BALANCE) AS BRRW_BALANCE
                      FROM 
                      (
                              select A.PBNCD_NO
                                   , A.BSNS_CODE
                                   , B.BSNS_NM
                                   , A.CPTAL_KND
                                   , C.CODE_NM AS CPTAL_KND_NM
                                   , A.BRRW_DE
                                   , A.EXPRTN_DE
                                   , NVL(A.EXPRTN_AT, 0) AS EXPRTN_AT
                                   , A.INTRT     
                                   , A.BRRW_AMOUNT
                                   , A.LEASE_YM
                                   , CASE WHEN A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                          THEN 'Y'
                                          ELSE 'N'
                                     END AS LEASE_YN     
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS PRNCPAL_RPAY_AMOUNT
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_INTR_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS INTR_RPAY_AMOUNT        
                                   , NVL(A.BRRW_AMOUNT ,0) - NVL((
                                        SELECT SUM(AA.RPAY_AMOUNT)
                                        FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                        WHERE AA.PBNCD_NO = A.PBNCD_NO
                                        AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS BRRW_BALANCE         
                              from TBFUN_PBNCD A
                              LEFT OUTER JOIN TBPRJ_BSNS_CODE B
                              ON A.BSNS_CODE = B.BSNS_CODE
                              LEFT OUTER JOIN
                                (
                                  SELECT DETAIL_CODE AS CODE ,
                                    DETAIL_CODE_NM   AS CODE_NM
                                  FROM TBFUN_CPTAL_DETAIL_CODE
                                  WHERE CODE_SE = '000'
                                )
                                C
                              ON A.CPTAL_KND = C.CODE
                              WHERE (A.LEASE_YM IS NULL OR A.LEASE_YM > #SEARCH_YEAR#||'1231')
                              AND   A.CPTAL_KND LIKE 'A%'
                      ) AA
                      GROUP BY AA.PBNCD_NO, AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM
              ) AA
        ) AA
        WHERE AA.BAL_AMT > 0    
    ) A
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO    AS PBNCD_NO    ,
               SUM(A.RPAY_AMOUNT) AS RPAY_AMOUNT ,
			   SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG00,               
<isEqual property="PRT_GBN2" compareValue="Y"> 
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               0 AS PRNCPAL_RPAY_AG10,0 AS PRNCPAL_RPAY_AG11,0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,
               0 AS PRNCPAL_RPAY_AG15,0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>          
<isEqual property="PRT_GBN2" compareValue="Q">
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG12,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG13,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG14,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG15,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG16,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG17,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG18,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
              0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,0 AS PRNCPAL_RPAY_AG15,
              0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>		       
        FROM TBFUN_PBNCD_PRNCPAL_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) C
    ON A.PBNCD_NO = C.PBNCD_NO
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO AS PBNCD_NO ,
              SUM(A.RPAY_AMOUNT) AS INTR_RPAY_AMOUNT ,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG00,
<isEqual property="PRT_GBN2" compareValue="Y">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              0 AS INTR_RPAY_AG10,0 AS INTR_RPAY_AG11,0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,
              0 AS INTR_RPAY_AG15,0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="Q">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG12,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG13,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG14,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG15,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG16,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG17,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG18,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,0 AS INTR_RPAY_AG15,
              0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
        FROM TBFUN_PBNCD_INTR_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) E
    ON A.PBNCD_NO = E.PBNCD_NO
    
    UNION ALL
    
    SELECT *
    FROM
    (
        SELECT '4' AS DV0, 
               '' AS DV1,
               DECODE(GROUPING_ID(A.CPTAL_KND, A.CPTAL_KND_NM, A.BSNS_CODE, A.BSNS_NM), '0', '', A.CPTAL_KND_NM) AS DV2,
           	   DECODE(GROUPING_ID(A.CPTAL_KND, A.CPTAL_KND_NM, A.BSNS_CODE, A.BSNS_NM), '0', A.BSNS_NM, '소계') AS DV3,
	           NVL(TRUNC(SUM(C.RPAY_AMOUNT) / #PRT_GBN1#), 0) AS RPAY_AMOUNT,
    	       NVL(TRUNC(SUM(E.INTR_RPAY_AMOUNT) / #PRT_GBN1#), 0) AS INTR_RPAY_AMOUNT,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG00) / #PRT_GBN1#), 0) AS AMT00,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS AMT0                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS AMT1                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS AMT2                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS AMT3                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS AMT4                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS AMT5                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS AMT6                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS AMT7                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS AMT8                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS AMT9                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG10) / #PRT_GBN1#) ,0) AS AMT10                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG11) / #PRT_GBN1#) ,0) AS AMT11                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG12) / #PRT_GBN1#) ,0) AS AMT12                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG13) / #PRT_GBN1#) ,0) AS AMT13                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG14) / #PRT_GBN1#) ,0) AS AMT14                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG15) / #PRT_GBN1#) ,0) AS AMT15                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG16) / #PRT_GBN1#) ,0) AS AMT16                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG17) / #PRT_GBN1#) ,0) AS AMT17                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG18) / #PRT_GBN1#) ,0) AS AMT18                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG19) / #PRT_GBN1#) ,0) AS AMT19                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG00 ) / #PRT_GBN1#) ,0) AS INT00                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS INT0                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS INT1                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS INT2                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS INT3                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS INT4                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS INT5                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS INT6                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS INT7                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS INT8                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS INT9                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG10) / #PRT_GBN1#) ,0) AS INT10                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG11) / #PRT_GBN1#) ,0) AS INT11                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG12) / #PRT_GBN1#) ,0) AS INT12                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG13) / #PRT_GBN1#) ,0) AS INT13                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG14) / #PRT_GBN1#) ,0) AS INT14                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG15) / #PRT_GBN1#) ,0) AS INT15                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG16) / #PRT_GBN1#) ,0) AS INT16                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG17) / #PRT_GBN1#) ,0) AS INT17                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG18) / #PRT_GBN1#) ,0) AS INT18                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG19) / #PRT_GBN1#) ,0) AS INT19
        FROM (
            SELECT *
            FROM
            (
                  SELECT AA.*
                       , SUM(AA.BRRW_BALANCE) OVER (PARTITION BY AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM) AS BAL_AMT
                  FROM
                  (
                          SELECT AA.PBNCD_NO
                               , AA.BSNS_CODE AS BSNS_CODE
                               , AA.BSNS_NM AS BSNS_NM
                               , AA.CPTAL_KND AS CPTAL_KND
                               , AA.CPTAL_KND_NM AS CPTAL_KND_NM
                               , AA.LEASE_YN
                               , MIN(AA.BRRW_DE) AS BRRW_DE
                               , MAX(AA.EXPRTN_DE) AS EXPRTN_DE
                               , TO_CHAR(SUM(AA.INTRT) / COUNT(AA.CPTAL_KND), 'FM9990D00') AS INTRT
                               , SUM(AA.BRRW_AMOUNT) AS BRRW_AMOUNT
                               , SUM(AA.PRNCPAL_RPAY_AMOUNT) AS PRNCPAL_RPAY_AMOUNT
                               , SUM(AA.INTR_RPAY_AMOUNT) AS INTR_RPAY_AMOUNT
                               , SUM(AA.BRRW_BALANCE) AS BRRW_BALANCE
                          FROM 
                          (
                                  select A.PBNCD_NO
                                       , A.BSNS_CODE
                                       , B.BSNS_NM
                                       , A.CPTAL_KND
                                       , C.CODE_NM AS CPTAL_KND_NM
                                       , A.BRRW_DE
                                       , A.EXPRTN_DE
                                       , NVL(A.EXPRTN_AT, 0) AS EXPRTN_AT
                                       , A.INTRT     
                                       , A.BRRW_AMOUNT
                                       , A.LEASE_YM
                                       , CASE WHEN A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                              THEN 'Y'
                                              ELSE 'N'
                                         END AS LEASE_YN     
                                       ,NVL((
                                          SELECT SUM(AA.RPAY_AMOUNT)
                                          FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                          WHERE AA.PBNCD_NO = A.PBNCD_NO
                                          AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                        ) ,0) AS PRNCPAL_RPAY_AMOUNT
                                       ,NVL((
                                          SELECT SUM(AA.RPAY_AMOUNT)
                                          FROM TBFUN_PBNCD_INTR_RPAY_DTLS AA
                                          WHERE AA.PBNCD_NO = A.PBNCD_NO
                                          AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                        ) ,0) AS INTR_RPAY_AMOUNT        
                                       , NVL(A.BRRW_AMOUNT ,0) - NVL((
                                            SELECT SUM(AA.RPAY_AMOUNT)
                                            FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                            WHERE AA.PBNCD_NO = A.PBNCD_NO
                                            AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                        ) ,0) AS BRRW_BALANCE         
                                  from TBFUN_PBNCD A
                                  LEFT OUTER JOIN TBPRJ_BSNS_CODE B
                                  ON A.BSNS_CODE = B.BSNS_CODE
                                  LEFT OUTER JOIN
                                    (
                                      SELECT DETAIL_CODE AS CODE ,
                                        DETAIL_CODE_NM   AS CODE_NM
                                      FROM TBFUN_CPTAL_DETAIL_CODE
                                      WHERE CODE_SE = '000'
                                    )
                                    C
                                  ON A.CPTAL_KND = C.CODE
                                  WHERE (A.LEASE_YM IS NULL OR A.LEASE_YM > #SEARCH_YEAR#||'1231')
                                  AND   A.CPTAL_KND LIKE 'A%'
                          ) AA
                          GROUP BY AA.PBNCD_NO, AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM
                  ) AA
            ) AA
            WHERE AA.BAL_AMT > 0    
        
        ) A
	    LEFT OUTER JOIN
	    (
	        SELECT A.PBNCD_NO    AS PBNCD_NO    ,
	               SUM(A.RPAY_AMOUNT) AS RPAY_AMOUNT ,
				   SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG00,               
	<isEqual property="PRT_GBN2" compareValue="Y"> 
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
	               0 AS PRNCPAL_RPAY_AG10,0 AS PRNCPAL_RPAY_AG11,0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,
	               0 AS PRNCPAL_RPAY_AG15,0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
	</isEqual>          
	<isEqual property="PRT_GBN2" compareValue="Q">
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG12,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG13,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG14,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG15,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG16,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG17,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG18,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG19
	</isEqual>
	<isEqual property="PRT_GBN2" compareValue="M">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
	              0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,0 AS PRNCPAL_RPAY_AG15,
	              0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
	</isEqual>		       
	        FROM TBFUN_PBNCD_PRNCPAL_RPAY_PLAN A
	        GROUP BY A.PBNCD_NO
	    ) C
	    ON A.PBNCD_NO = C.PBNCD_NO
	    LEFT OUTER JOIN
	    (
	        SELECT A.PBNCD_NO AS PBNCD_NO ,
	        	  SUM(A.RPAY_AMOUNT) AS INTR_RPAY_AMOUNT ,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG00,
	<isEqual property="PRT_GBN2" compareValue="Y">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
	              0 AS INTR_RPAY_AG10,0 AS INTR_RPAY_AG11,0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,
	              0 AS INTR_RPAY_AG15,0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
	</isEqual>
	<isEqual property="PRT_GBN2" compareValue="Q">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG12,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG13,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG14,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG15,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG16,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG17,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG18,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG19
	</isEqual>
	<isEqual property="PRT_GBN2" compareValue="M">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
	              0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,0 AS INTR_RPAY_AG15,
	              0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
	</isEqual>
	        FROM TBFUN_PBNCD_INTR_RPAY_PLAN A
	        GROUP BY A.PBNCD_NO
	    ) E
        ON A.PBNCD_NO = E.PBNCD_NO
	    GROUP BY ROLLUP(A.CPTAL_KND, A.CPTAL_KND_NM, A.BSNS_CODE, A.BSNS_NM) 
	    HAVING GROUPING_ID(A.CPTAL_KND, A.CPTAL_KND_NM, A.BSNS_CODE, A.BSNS_NM) IN (0,3) 
	    order by grouping(A.CPTAL_KND_NM) desc, A.CPTAL_KND_NM
	           , grouping(A.BSNS_NM) desc, A.BSNS_NM
    )    
        
    UNION ALL
    
    SELECT '5' AS DV0, 
           '단기채(B2)' AS DV1,
           '' AS DV2,
           '합계' AS DV3,
           NVL(TRUNC(SUM(C.RPAY_AMOUNT) / #PRT_GBN1#), 0) AS RPAY_AMOUNT,
           NVL(TRUNC(SUM(E.INTR_RPAY_AMOUNT) / #PRT_GBN1#), 0) AS INTR_RPAY_AMOUNT,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG00) / #PRT_GBN1#), 0) AS AMT00,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS AMT0                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS AMT1                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS AMT2                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS AMT3                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS AMT4                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS AMT5                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS AMT6                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS AMT7                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS AMT8                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS AMT9                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG10) / #PRT_GBN1#) ,0) AS AMT10                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG11) / #PRT_GBN1#) ,0) AS AMT11                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG12) / #PRT_GBN1#) ,0) AS AMT12                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG13) / #PRT_GBN1#) ,0) AS AMT13                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG14) / #PRT_GBN1#) ,0) AS AMT14                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG15) / #PRT_GBN1#) ,0) AS AMT15                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG16) / #PRT_GBN1#) ,0) AS AMT16                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG17) / #PRT_GBN1#) ,0) AS AMT17                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG18) / #PRT_GBN1#) ,0) AS AMT18                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG19) / #PRT_GBN1#) ,0) AS AMT19                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG00 ) / #PRT_GBN1#) ,0) AS INT00                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS INT0                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS INT1                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS INT2                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS INT3                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS INT4                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS INT5                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS INT6                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS INT7                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS INT8                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS INT9                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG10) / #PRT_GBN1#) ,0) AS INT10                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG11) / #PRT_GBN1#) ,0) AS INT11                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG12) / #PRT_GBN1#) ,0) AS INT12                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG13) / #PRT_GBN1#) ,0) AS INT13                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG14) / #PRT_GBN1#) ,0) AS INT14                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG15) / #PRT_GBN1#) ,0) AS INT15                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG16) / #PRT_GBN1#) ,0) AS INT16                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG17) / #PRT_GBN1#) ,0) AS INT17                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG18) / #PRT_GBN1#) ,0) AS INT18                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG19) / #PRT_GBN1#) ,0) AS INT19
    FROM (
        SELECT *
        FROM
        (
              SELECT AA.*
                   , SUM(AA.BRRW_BALANCE) OVER (PARTITION BY AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM) AS BAL_AMT
              FROM
              (
                      SELECT AA.PBNCD_NO
                           , AA.BSNS_CODE AS BSNS_CODE
                           , AA.BSNS_NM AS BSNS_NM
                           , AA.CPTAL_KND AS CPTAL_KND
                           , AA.CPTAL_KND_NM AS CPTAL_KND_NM
                           , AA.LEASE_YN
                           , MIN(AA.BRRW_DE) AS BRRW_DE
                           , MAX(AA.EXPRTN_DE) AS EXPRTN_DE
                           , TO_CHAR(SUM(AA.INTRT) / COUNT(AA.CPTAL_KND), 'FM9990D00') AS INTRT
                           , SUM(AA.BRRW_AMOUNT) AS BRRW_AMOUNT
                           , SUM(AA.PRNCPAL_RPAY_AMOUNT) AS PRNCPAL_RPAY_AMOUNT
                           , SUM(AA.INTR_RPAY_AMOUNT) AS INTR_RPAY_AMOUNT
                           , SUM(AA.BRRW_BALANCE) AS BRRW_BALANCE
                      FROM 
                      (
                              select A.PBNCD_NO
                                   , A.BSNS_CODE
                                   , B.BSNS_NM
                                   , A.CPTAL_KND
                                   , C.CODE_NM AS CPTAL_KND_NM
                                   , A.BRRW_DE
                                   , A.EXPRTN_DE
                                   , NVL(A.EXPRTN_AT, 0) AS EXPRTN_AT
                                   , A.INTRT     
                                   , A.BRRW_AMOUNT
                                   , A.LEASE_YM
                                   , CASE WHEN A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                          THEN 'Y'
                                          ELSE 'N'
                                     END AS LEASE_YN     
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS PRNCPAL_RPAY_AMOUNT
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_INTR_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS INTR_RPAY_AMOUNT        
                                   , NVL(A.BRRW_AMOUNT ,0) - NVL((
                                        SELECT SUM(AA.RPAY_AMOUNT)
                                        FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                        WHERE AA.PBNCD_NO = A.PBNCD_NO
                                        AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS BRRW_BALANCE         
                              from TBFUN_PBNCD A
                              LEFT OUTER JOIN TBPRJ_BSNS_CODE B
                              ON A.BSNS_CODE = B.BSNS_CODE
                              LEFT OUTER JOIN
                                (
                                  SELECT DETAIL_CODE AS CODE ,
                                    DETAIL_CODE_NM   AS CODE_NM
                                  FROM TBFUN_CPTAL_DETAIL_CODE
                                  WHERE CODE_SE = '000'
                                )
                                C
                              ON A.CPTAL_KND = C.CODE
                              WHERE (A.LEASE_YM IS NULL OR A.LEASE_YM > #SEARCH_YEAR#||'1231')
                              AND   A.CPTAL_KND LIKE 'B%'
                      ) AA
                      GROUP BY AA.PBNCD_NO, AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM
              ) AA
        ) AA
        WHERE AA.BAL_AMT > 0    
    ) A
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO    AS PBNCD_NO    ,
               SUM(A.RPAY_AMOUNT) AS RPAY_AMOUNT ,
			   SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG00,               
<isEqual property="PRT_GBN2" compareValue="Y"> 
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               0 AS PRNCPAL_RPAY_AG10,0 AS PRNCPAL_RPAY_AG11,0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,
               0 AS PRNCPAL_RPAY_AG15,0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>          
<isEqual property="PRT_GBN2" compareValue="Q">
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG12,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG13,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG14,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG15,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG16,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG17,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG18,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
              0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,0 AS PRNCPAL_RPAY_AG15,
              0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>		       
        FROM TBFUN_PBNCD_PRNCPAL_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) C
    ON A.PBNCD_NO = C.PBNCD_NO
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO AS PBNCD_NO ,
        	  SUM(A.RPAY_AMOUNT) AS INTR_RPAY_AMOUNT ,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG00,
<isEqual property="PRT_GBN2" compareValue="Y">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              0 AS INTR_RPAY_AG10,0 AS INTR_RPAY_AG11,0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,
              0 AS INTR_RPAY_AG15,0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="Q">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG12,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG13,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG14,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG15,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG16,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG17,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG18,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,0 AS INTR_RPAY_AG15,
              0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
        FROM TBFUN_PBNCD_INTR_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) E
    ON A.PBNCD_NO = E.PBNCD_NO
    
    UNION ALL
    
    SELECT *
    FROM
    (
        SELECT '6' AS DV0, 
               '' AS DV1,
               DECODE(GROUPING_ID(A.CPTAL_KND, A.CPTAL_KND_NM, A.BSNS_CODE, A.BSNS_NM), '0', '', A.CPTAL_KND_NM) AS DV2,
           	   DECODE(GROUPING_ID(A.CPTAL_KND, A.CPTAL_KND_NM, A.BSNS_CODE, A.BSNS_NM), '0', A.BSNS_NM, '소계') AS DV3,
	           NVL(TRUNC(SUM(C.RPAY_AMOUNT) / #PRT_GBN1#), 0) AS RPAY_AMOUNT,
    	       NVL(TRUNC(SUM(E.INTR_RPAY_AMOUNT) / #PRT_GBN1#), 0) AS INTR_RPAY_AMOUNT,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG00) / #PRT_GBN1#), 0) AS AMT00,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS AMT0                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS AMT1                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS AMT2                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS AMT3                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS AMT4                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS AMT5                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS AMT6                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS AMT7                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS AMT8                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS AMT9                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG10) / #PRT_GBN1#) ,0) AS AMT10                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG11) / #PRT_GBN1#) ,0) AS AMT11                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG12) / #PRT_GBN1#) ,0) AS AMT12                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG13) / #PRT_GBN1#) ,0) AS AMT13                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG14) / #PRT_GBN1#) ,0) AS AMT14                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG15) / #PRT_GBN1#) ,0) AS AMT15                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG16) / #PRT_GBN1#) ,0) AS AMT16                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG17) / #PRT_GBN1#) ,0) AS AMT17                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG18) / #PRT_GBN1#) ,0) AS AMT18                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG19) / #PRT_GBN1#) ,0) AS AMT19                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG00 ) / #PRT_GBN1#) ,0) AS INT00                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS INT0                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS INT1                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS INT2                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS INT3                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS INT4                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS INT5                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS INT6                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS INT7                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS INT8                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS INT9                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG10) / #PRT_GBN1#) ,0) AS INT10                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG11) / #PRT_GBN1#) ,0) AS INT11                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG12) / #PRT_GBN1#) ,0) AS INT12                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG13) / #PRT_GBN1#) ,0) AS INT13                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG14) / #PRT_GBN1#) ,0) AS INT14                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG15) / #PRT_GBN1#) ,0) AS INT15                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG16) / #PRT_GBN1#) ,0) AS INT16                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG17) / #PRT_GBN1#) ,0) AS INT17                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG18) / #PRT_GBN1#) ,0) AS INT18                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG19) / #PRT_GBN1#) ,0) AS INT19
        FROM (
            SELECT *
            FROM
            (
                  SELECT AA.*
                       , SUM(AA.BRRW_BALANCE) OVER (PARTITION BY AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM) AS BAL_AMT
                  FROM
                  (
                          SELECT AA.PBNCD_NO
                               , AA.BSNS_CODE AS BSNS_CODE
                               , AA.BSNS_NM AS BSNS_NM
                               , AA.CPTAL_KND AS CPTAL_KND
                               , AA.CPTAL_KND_NM AS CPTAL_KND_NM
                               , AA.LEASE_YN
                               , MIN(AA.BRRW_DE) AS BRRW_DE
                               , MAX(AA.EXPRTN_DE) AS EXPRTN_DE
                               , TO_CHAR(SUM(AA.INTRT) / COUNT(AA.CPTAL_KND), 'FM9990D00') AS INTRT
                               , SUM(AA.BRRW_AMOUNT) AS BRRW_AMOUNT
                               , SUM(AA.PRNCPAL_RPAY_AMOUNT) AS PRNCPAL_RPAY_AMOUNT
                               , SUM(AA.INTR_RPAY_AMOUNT) AS INTR_RPAY_AMOUNT
                               , SUM(AA.BRRW_BALANCE) AS BRRW_BALANCE
                          FROM 
                          (
                                  select A.PBNCD_NO
                                       , A.BSNS_CODE
                                       , B.BSNS_NM
                                       , A.CPTAL_KND
                                       , C.CODE_NM AS CPTAL_KND_NM
                                       , A.BRRW_DE
                                       , A.EXPRTN_DE
                                       , NVL(A.EXPRTN_AT, 0) AS EXPRTN_AT
                                       , A.INTRT     
                                       , A.BRRW_AMOUNT
                                       , A.LEASE_YM
                                       , CASE WHEN A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                              THEN 'Y'
                                              ELSE 'N'
                                         END AS LEASE_YN     
                                       ,NVL((
                                          SELECT SUM(AA.RPAY_AMOUNT)
                                          FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                          WHERE AA.PBNCD_NO = A.PBNCD_NO
                                          AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                        ) ,0) AS PRNCPAL_RPAY_AMOUNT
                                       ,NVL((
                                          SELECT SUM(AA.RPAY_AMOUNT)
                                          FROM TBFUN_PBNCD_INTR_RPAY_DTLS AA
                                          WHERE AA.PBNCD_NO = A.PBNCD_NO
                                          AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                        ) ,0) AS INTR_RPAY_AMOUNT        
                                       , NVL(A.BRRW_AMOUNT ,0) - NVL((
                                            SELECT SUM(AA.RPAY_AMOUNT)
                                            FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                            WHERE AA.PBNCD_NO = A.PBNCD_NO
                                            AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                        ) ,0) AS BRRW_BALANCE         
                                  from TBFUN_PBNCD A
                                  LEFT OUTER JOIN TBPRJ_BSNS_CODE B
                                  ON A.BSNS_CODE = B.BSNS_CODE
                                  LEFT OUTER JOIN
                                    (
                                      SELECT DETAIL_CODE AS CODE ,
                                        DETAIL_CODE_NM   AS CODE_NM
                                      FROM TBFUN_CPTAL_DETAIL_CODE
                                      WHERE CODE_SE = '000'
                                    )
                                    C
                                  ON A.CPTAL_KND = C.CODE
                                  WHERE (A.LEASE_YM IS NULL OR A.LEASE_YM > #SEARCH_YEAR#||'1231')
                                  AND   A.CPTAL_KND LIKE 'B%'
                          ) AA
                          GROUP BY AA.PBNCD_NO, AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM
                  ) AA
            ) AA
            WHERE AA.BAL_AMT > 0    
        
        ) A
	    LEFT OUTER JOIN
	    (
	        SELECT A.PBNCD_NO    AS PBNCD_NO    ,
	               SUM(A.RPAY_AMOUNT) AS RPAY_AMOUNT ,
				   SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG00,               
	<isEqual property="PRT_GBN2" compareValue="Y"> 
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
	               0 AS PRNCPAL_RPAY_AG10,0 AS PRNCPAL_RPAY_AG11,0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,
	               0 AS PRNCPAL_RPAY_AG15,0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
	</isEqual>          
	<isEqual property="PRT_GBN2" compareValue="Q">
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG12,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG13,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG14,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG15,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG16,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG17,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG18,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG19
	</isEqual>
	<isEqual property="PRT_GBN2" compareValue="M">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
	              0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,0 AS PRNCPAL_RPAY_AG15,
	              0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
	</isEqual>		       
	        FROM TBFUN_PBNCD_PRNCPAL_RPAY_PLAN A
	        GROUP BY A.PBNCD_NO
	    ) C
	    ON A.PBNCD_NO = C.PBNCD_NO
	    LEFT OUTER JOIN
	    (
	        SELECT A.PBNCD_NO AS PBNCD_NO ,
	        	  SUM(A.RPAY_AMOUNT) AS INTR_RPAY_AMOUNT ,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG00,
	<isEqual property="PRT_GBN2" compareValue="Y">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
	              0 AS INTR_RPAY_AG10,0 AS INTR_RPAY_AG11,0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,
	              0 AS INTR_RPAY_AG15,0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
	</isEqual>
	<isEqual property="PRT_GBN2" compareValue="Q">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG12,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG13,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG14,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG15,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG16,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG17,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG18,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG19
	</isEqual>
	<isEqual property="PRT_GBN2" compareValue="M">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
	              0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,0 AS INTR_RPAY_AG15,
	              0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
	</isEqual>
	        FROM TBFUN_PBNCD_INTR_RPAY_PLAN A
	        GROUP BY A.PBNCD_NO
	    ) E
        ON A.PBNCD_NO = E.PBNCD_NO
	    GROUP BY ROLLUP(A.CPTAL_KND, A.CPTAL_KND_NM, A.BSNS_CODE, A.BSNS_NM) 
	    HAVING GROUPING_ID(A.CPTAL_KND, A.CPTAL_KND_NM, A.BSNS_CODE, A.BSNS_NM) IN (0,3) 
	    order by grouping(A.CPTAL_KND_NM) desc, A.CPTAL_KND_NM
	           , grouping(A.BSNS_NM) desc, A.BSNS_NM
    )        
    
    UNION ALL
    
    SELECT '7' AS DV0, 
           '금융리스처리(C=C1+C2)' AS DV1,
           '' AS DV2,
           '합계' AS DV3,
           NVL(TRUNC(SUM(C.RPAY_AMOUNT) / #PRT_GBN1#), 0) AS RPAY_AMOUNT,
           NVL(TRUNC(SUM(E.INTR_RPAY_AMOUNT) / #PRT_GBN1#), 0) AS INTR_RPAY_AMOUNT,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG00) / #PRT_GBN1#), 0) AS AMT00,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS AMT0                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS AMT1                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS AMT2                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS AMT3                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS AMT4                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS AMT5                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS AMT6                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS AMT7                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS AMT8                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS AMT9                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG10) / #PRT_GBN1#) ,0) AS AMT10                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG11) / #PRT_GBN1#) ,0) AS AMT11                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG12) / #PRT_GBN1#) ,0) AS AMT12                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG13) / #PRT_GBN1#) ,0) AS AMT13                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG14) / #PRT_GBN1#) ,0) AS AMT14                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG15) / #PRT_GBN1#) ,0) AS AMT15                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG16) / #PRT_GBN1#) ,0) AS AMT16                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG17) / #PRT_GBN1#) ,0) AS AMT17                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG18) / #PRT_GBN1#) ,0) AS AMT18                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG19) / #PRT_GBN1#) ,0) AS AMT19                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG00 ) / #PRT_GBN1#) ,0) AS INT00                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS INT0                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS INT1                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS INT2                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS INT3                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS INT4                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS INT5                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS INT6                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS INT7                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS INT8                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS INT9                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG10) / #PRT_GBN1#) ,0) AS INT10                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG11) / #PRT_GBN1#) ,0) AS INT11                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG12) / #PRT_GBN1#) ,0) AS INT12                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG13) / #PRT_GBN1#) ,0) AS INT13                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG14) / #PRT_GBN1#) ,0) AS INT14                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG15) / #PRT_GBN1#) ,0) AS INT15                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG16) / #PRT_GBN1#) ,0) AS INT16                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG17) / #PRT_GBN1#) ,0) AS INT17                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG18) / #PRT_GBN1#) ,0) AS INT18                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG19) / #PRT_GBN1#) ,0) AS INT19
    FROM (
        SELECT *
        FROM
        (
              SELECT AA.*
                   , SUM(AA.BRRW_BALANCE) OVER (PARTITION BY AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM) AS BAL_AMT
              FROM
              (
                      SELECT AA.PBNCD_NO
                           , AA.BSNS_CODE AS BSNS_CODE
                           , AA.BSNS_NM AS BSNS_NM
                           , AA.CPTAL_KND AS CPTAL_KND
                           , AA.CPTAL_KND_NM AS CPTAL_KND_NM
                           , AA.LEASE_YN
                           , MIN(AA.BRRW_DE) AS BRRW_DE
                           , MAX(AA.EXPRTN_DE) AS EXPRTN_DE
                           , TO_CHAR(SUM(AA.INTRT) / COUNT(AA.CPTAL_KND), 'FM9990D00') AS INTRT
                           , SUM(AA.BRRW_AMOUNT) AS BRRW_AMOUNT
                           , SUM(AA.PRNCPAL_RPAY_AMOUNT) AS PRNCPAL_RPAY_AMOUNT
                           , SUM(AA.INTR_RPAY_AMOUNT) AS INTR_RPAY_AMOUNT
                           , SUM(AA.BRRW_BALANCE) AS BRRW_BALANCE
                      FROM 
                      (
                              select A.PBNCD_NO
                                   , A.BSNS_CODE
                                   , B.BSNS_NM
                                   , A.CPTAL_KND
                                   , C.CODE_NM AS CPTAL_KND_NM
                                   , A.BRRW_DE
                                   , A.EXPRTN_DE
                                   , NVL(A.EXPRTN_AT, 0) AS EXPRTN_AT
                                   , A.INTRT     
                                   , A.BRRW_AMOUNT
                                   , A.LEASE_YM
                                   , CASE WHEN A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                          THEN 'Y'
                                          ELSE 'N'
                                     END AS LEASE_YN     
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS PRNCPAL_RPAY_AMOUNT
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_INTR_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS INTR_RPAY_AMOUNT        
                                   , NVL(A.BRRW_AMOUNT ,0) - NVL((
                                        SELECT SUM(AA.RPAY_AMOUNT)
                                        FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                        WHERE AA.PBNCD_NO = A.PBNCD_NO
                                        AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS BRRW_BALANCE         
                              from TBFUN_PBNCD A
                              LEFT OUTER JOIN TBPRJ_BSNS_CODE B
                              ON A.BSNS_CODE = B.BSNS_CODE
                              LEFT OUTER JOIN
                                (
                                  SELECT DETAIL_CODE AS CODE ,
                                    DETAIL_CODE_NM   AS CODE_NM
                                  FROM TBFUN_CPTAL_DETAIL_CODE
                                  WHERE CODE_SE = '000'
                                )
                                C
                              ON A.CPTAL_KND = C.CODE
                              WHERE (A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231')
                      ) AA
                      GROUP BY AA.PBNCD_NO, AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM
              ) AA
        ) AA
        WHERE AA.BAL_AMT > 0    
    ) A
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO    AS PBNCD_NO    ,
               SUM(A.RPAY_AMOUNT) AS RPAY_AMOUNT ,
			   SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG00,               
<isEqual property="PRT_GBN2" compareValue="Y"> 
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               0 AS PRNCPAL_RPAY_AG10,0 AS PRNCPAL_RPAY_AG11,0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,
               0 AS PRNCPAL_RPAY_AG15,0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>          
<isEqual property="PRT_GBN2" compareValue="Q">
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG12,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG13,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG14,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG15,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG16,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG17,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG18,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
              0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,0 AS PRNCPAL_RPAY_AG15,
              0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>		       
        FROM TBFUN_PBNCD_PRNCPAL_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) C
    ON A.PBNCD_NO = C.PBNCD_NO
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO AS PBNCD_NO ,
              SUM(A.RPAY_AMOUNT) AS INTR_RPAY_AMOUNT ,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG00,
<isEqual property="PRT_GBN2" compareValue="Y">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              0 AS INTR_RPAY_AG10,0 AS INTR_RPAY_AG11,0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,
              0 AS INTR_RPAY_AG15,0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="Q">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG12,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG13,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG14,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG15,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG16,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG17,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG18,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,0 AS INTR_RPAY_AG15,
              0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
        FROM TBFUN_PBNCD_INTR_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) E
    ON A.PBNCD_NO = E.PBNCD_NO
    
    UNION ALL
    
    SELECT '8' AS DV0, 
           '장기채(C1)' AS DV1,
           '' AS DV2,
           '합계' AS DV3,
           NVL(TRUNC(SUM(C.RPAY_AMOUNT) / #PRT_GBN1#), 0) AS RPAY_AMOUNT,
           NVL(TRUNC(SUM(E.INTR_RPAY_AMOUNT) / #PRT_GBN1#), 0) AS INTR_RPAY_AMOUNT,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG00) / #PRT_GBN1#), 0) AS AMT00,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS AMT0                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS AMT1                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS AMT2                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS AMT3                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS AMT4                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS AMT5                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS AMT6                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS AMT7                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS AMT8                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS AMT9                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG10) / #PRT_GBN1#) ,0) AS AMT10                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG11) / #PRT_GBN1#) ,0) AS AMT11                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG12) / #PRT_GBN1#) ,0) AS AMT12                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG13) / #PRT_GBN1#) ,0) AS AMT13                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG14) / #PRT_GBN1#) ,0) AS AMT14                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG15) / #PRT_GBN1#) ,0) AS AMT15                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG16) / #PRT_GBN1#) ,0) AS AMT16                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG17) / #PRT_GBN1#) ,0) AS AMT17                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG18) / #PRT_GBN1#) ,0) AS AMT18                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG19) / #PRT_GBN1#) ,0) AS AMT19                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG00 ) / #PRT_GBN1#) ,0) AS INT00                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS INT0                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS INT1                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS INT2                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS INT3                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS INT4                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS INT5                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS INT6                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS INT7                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS INT8                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS INT9                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG10) / #PRT_GBN1#) ,0) AS INT10                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG11) / #PRT_GBN1#) ,0) AS INT11                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG12) / #PRT_GBN1#) ,0) AS INT12                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG13) / #PRT_GBN1#) ,0) AS INT13                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG14) / #PRT_GBN1#) ,0) AS INT14                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG15) / #PRT_GBN1#) ,0) AS INT15                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG16) / #PRT_GBN1#) ,0) AS INT16                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG17) / #PRT_GBN1#) ,0) AS INT17                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG18) / #PRT_GBN1#) ,0) AS INT18                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG19) / #PRT_GBN1#) ,0) AS INT19
    FROM (
        SELECT *
        FROM
        (
              SELECT AA.*
                   , SUM(AA.BRRW_BALANCE) OVER (PARTITION BY AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM) AS BAL_AMT
              FROM
              (
                      SELECT AA.PBNCD_NO
                           , AA.BSNS_CODE AS BSNS_CODE
                           , AA.BSNS_NM AS BSNS_NM
                           , AA.CPTAL_KND AS CPTAL_KND
                           , AA.CPTAL_KND_NM AS CPTAL_KND_NM
                           , AA.LEASE_YN
                           , MIN(AA.BRRW_DE) AS BRRW_DE
                           , MAX(AA.EXPRTN_DE) AS EXPRTN_DE
                           , TO_CHAR(SUM(AA.INTRT) / COUNT(AA.CPTAL_KND), 'FM9990D00') AS INTRT
                           , SUM(AA.BRRW_AMOUNT) AS BRRW_AMOUNT
                           , SUM(AA.PRNCPAL_RPAY_AMOUNT) AS PRNCPAL_RPAY_AMOUNT
                           , SUM(AA.INTR_RPAY_AMOUNT) AS INTR_RPAY_AMOUNT
                           , SUM(AA.BRRW_BALANCE) AS BRRW_BALANCE
                      FROM 
                      (
                              select A.PBNCD_NO
                                   , A.BSNS_CODE
                                   , B.BSNS_NM
                                   , A.CPTAL_KND
                                   , C.CODE_NM AS CPTAL_KND_NM
                                   , A.BRRW_DE
                                   , A.EXPRTN_DE
                                   , NVL(A.EXPRTN_AT, 0) AS EXPRTN_AT
                                   , A.INTRT     
                                   , A.BRRW_AMOUNT
                                   , A.LEASE_YM
                                   , CASE WHEN A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                          THEN 'Y'
                                          ELSE 'N'
                                     END AS LEASE_YN     
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS PRNCPAL_RPAY_AMOUNT
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_INTR_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS INTR_RPAY_AMOUNT        
                                   , NVL(A.BRRW_AMOUNT ,0) - NVL((
                                        SELECT SUM(AA.RPAY_AMOUNT)
                                        FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                        WHERE AA.PBNCD_NO = A.PBNCD_NO
                                        AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS BRRW_BALANCE         
                              from TBFUN_PBNCD A
                              LEFT OUTER JOIN TBPRJ_BSNS_CODE B
                              ON A.BSNS_CODE = B.BSNS_CODE
                              LEFT OUTER JOIN
                                (
                                  SELECT DETAIL_CODE AS CODE ,
                                    DETAIL_CODE_NM   AS CODE_NM
                                  FROM TBFUN_CPTAL_DETAIL_CODE
                                  WHERE CODE_SE = '000'
                                )
                                C
                              ON A.CPTAL_KND = C.CODE
                              WHERE (A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231')
                              AND   A.CPTAL_KND LIKE 'A%'
                      ) AA
                      GROUP BY AA.PBNCD_NO, AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM
              ) AA
        ) AA
        WHERE AA.BAL_AMT > 0    
    ) A
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO    AS PBNCD_NO    ,
               SUM(A.RPAY_AMOUNT) AS RPAY_AMOUNT ,
			   SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG00,               
<isEqual property="PRT_GBN2" compareValue="Y"> 
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               0 AS PRNCPAL_RPAY_AG10,0 AS PRNCPAL_RPAY_AG11,0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,
               0 AS PRNCPAL_RPAY_AG15,0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>          
<isEqual property="PRT_GBN2" compareValue="Q">
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG12,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG13,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG14,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG15,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG16,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG17,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG18,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
              0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,0 AS PRNCPAL_RPAY_AG15,
              0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>		       
        FROM TBFUN_PBNCD_PRNCPAL_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) C
    ON A.PBNCD_NO = C.PBNCD_NO
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO AS PBNCD_NO ,
        	  SUM(A.RPAY_AMOUNT) AS INTR_RPAY_AMOUNT ,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG00,
<isEqual property="PRT_GBN2" compareValue="Y">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              0 AS INTR_RPAY_AG10,0 AS INTR_RPAY_AG11,0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,
              0 AS INTR_RPAY_AG15,0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="Q">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG12,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG13,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG14,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG15,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG16,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG17,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG18,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,0 AS INTR_RPAY_AG15,
              0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
        FROM TBFUN_PBNCD_INTR_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) E
    ON A.PBNCD_NO = E.PBNCD_NO
    
    UNION ALL
    
    SELECT *
    FROM
    (
        SELECT '9' AS DV0, 
               '' AS DV1,
               DECODE(GROUPING_ID(A.CPTAL_KND, A.CPTAL_KND_NM, A.BSNS_CODE, A.BSNS_NM), '0', '', A.CPTAL_KND_NM) AS DV2,
           	   DECODE(GROUPING_ID(A.CPTAL_KND, A.CPTAL_KND_NM, A.BSNS_CODE, A.BSNS_NM), '0', A.BSNS_NM, '소계') AS DV3,
	           NVL(TRUNC(SUM(C.RPAY_AMOUNT) / #PRT_GBN1#), 0) AS RPAY_AMOUNT,
    	       NVL(TRUNC(SUM(E.INTR_RPAY_AMOUNT) / #PRT_GBN1#), 0) AS INTR_RPAY_AMOUNT,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG00) / #PRT_GBN1#), 0) AS AMT00,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS AMT0                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS AMT1                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS AMT2                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS AMT3                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS AMT4                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS AMT5                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS AMT6                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS AMT7                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS AMT8                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS AMT9                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG10) / #PRT_GBN1#) ,0) AS AMT10                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG11) / #PRT_GBN1#) ,0) AS AMT11                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG12) / #PRT_GBN1#) ,0) AS AMT12                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG13) / #PRT_GBN1#) ,0) AS AMT13                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG14) / #PRT_GBN1#) ,0) AS AMT14                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG15) / #PRT_GBN1#) ,0) AS AMT15                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG16) / #PRT_GBN1#) ,0) AS AMT16                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG17) / #PRT_GBN1#) ,0) AS AMT17                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG18) / #PRT_GBN1#) ,0) AS AMT18                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG19) / #PRT_GBN1#) ,0) AS AMT19                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG00 ) / #PRT_GBN1#) ,0) AS INT00                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS INT0                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS INT1                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS INT2                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS INT3                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS INT4                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS INT5                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS INT6                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS INT7                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS INT8                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS INT9                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG10) / #PRT_GBN1#) ,0) AS INT10                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG11) / #PRT_GBN1#) ,0) AS INT11                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG12) / #PRT_GBN1#) ,0) AS INT12                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG13) / #PRT_GBN1#) ,0) AS INT13                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG14) / #PRT_GBN1#) ,0) AS INT14                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG15) / #PRT_GBN1#) ,0) AS INT15                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG16) / #PRT_GBN1#) ,0) AS INT16                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG17) / #PRT_GBN1#) ,0) AS INT17                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG18) / #PRT_GBN1#) ,0) AS INT18                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG19) / #PRT_GBN1#) ,0) AS INT19
        FROM (
            SELECT *
            FROM
            (
                  SELECT AA.*
                       , SUM(AA.BRRW_BALANCE) OVER (PARTITION BY AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM) AS BAL_AMT
                  FROM
                  (
                          SELECT AA.PBNCD_NO
                               , AA.BSNS_CODE AS BSNS_CODE
                               , AA.BSNS_NM AS BSNS_NM
                               , AA.CPTAL_KND AS CPTAL_KND
                               , AA.CPTAL_KND_NM AS CPTAL_KND_NM
                               , AA.LEASE_YN
                               , MIN(AA.BRRW_DE) AS BRRW_DE
                               , MAX(AA.EXPRTN_DE) AS EXPRTN_DE
                               , TO_CHAR(SUM(AA.INTRT) / COUNT(AA.CPTAL_KND), 'FM9990D00') AS INTRT
                               , SUM(AA.BRRW_AMOUNT) AS BRRW_AMOUNT
                               , SUM(AA.PRNCPAL_RPAY_AMOUNT) AS PRNCPAL_RPAY_AMOUNT
                               , SUM(AA.INTR_RPAY_AMOUNT) AS INTR_RPAY_AMOUNT
                               , SUM(AA.BRRW_BALANCE) AS BRRW_BALANCE
                          FROM 
                          (
                                  select A.PBNCD_NO
                                       , A.BSNS_CODE
                                       , B.BSNS_NM
                                       , A.CPTAL_KND
                                       , C.CODE_NM AS CPTAL_KND_NM
                                       , A.BRRW_DE
                                       , A.EXPRTN_DE
                                       , NVL(A.EXPRTN_AT, 0) AS EXPRTN_AT
                                       , A.INTRT     
                                       , A.BRRW_AMOUNT
                                       , A.LEASE_YM
                                       , CASE WHEN A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                              THEN 'Y'
                                              ELSE 'N'
                                         END AS LEASE_YN     
                                       ,NVL((
                                          SELECT SUM(AA.RPAY_AMOUNT)
                                          FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                          WHERE AA.PBNCD_NO = A.PBNCD_NO
                                          AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                        ) ,0) AS PRNCPAL_RPAY_AMOUNT
                                       ,NVL((
                                          SELECT SUM(AA.RPAY_AMOUNT)
                                          FROM TBFUN_PBNCD_INTR_RPAY_DTLS AA
                                          WHERE AA.PBNCD_NO = A.PBNCD_NO
                                          AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                        ) ,0) AS INTR_RPAY_AMOUNT        
                                       , NVL(A.BRRW_AMOUNT ,0) - NVL((
                                            SELECT SUM(AA.RPAY_AMOUNT)
                                            FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                            WHERE AA.PBNCD_NO = A.PBNCD_NO
                                            AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                        ) ,0) AS BRRW_BALANCE         
                                  from TBFUN_PBNCD A
                                  LEFT OUTER JOIN TBPRJ_BSNS_CODE B
                                  ON A.BSNS_CODE = B.BSNS_CODE
                                  LEFT OUTER JOIN
                                    (
                                      SELECT DETAIL_CODE AS CODE ,
                                        DETAIL_CODE_NM   AS CODE_NM
                                      FROM TBFUN_CPTAL_DETAIL_CODE
                                      WHERE CODE_SE = '000'
                                    )
                                    C
                                  ON A.CPTAL_KND = C.CODE
                                  WHERE (A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231')
                                  AND   A.CPTAL_KND LIKE 'A%'
                          ) AA
                          GROUP BY AA.PBNCD_NO, AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM
                  ) AA
            ) AA
            WHERE AA.BAL_AMT > 0    
        
        ) A
	    LEFT OUTER JOIN
	    (
	        SELECT A.PBNCD_NO    AS PBNCD_NO    ,
	               SUM(A.RPAY_AMOUNT) AS RPAY_AMOUNT ,
				   SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG00,               
	<isEqual property="PRT_GBN2" compareValue="Y"> 
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
	               0 AS PRNCPAL_RPAY_AG10,0 AS PRNCPAL_RPAY_AG11,0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,
	               0 AS PRNCPAL_RPAY_AG15,0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
	</isEqual>          
	<isEqual property="PRT_GBN2" compareValue="Q">
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG12,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG13,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG14,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG15,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG16,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG17,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG18,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG19
	</isEqual>
	<isEqual property="PRT_GBN2" compareValue="M">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
	              0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,0 AS PRNCPAL_RPAY_AG15,
	              0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
	</isEqual>		       
	        FROM TBFUN_PBNCD_PRNCPAL_RPAY_PLAN A
	        GROUP BY A.PBNCD_NO
	    ) C
	    ON A.PBNCD_NO = C.PBNCD_NO
	    LEFT OUTER JOIN
	    (
	        SELECT A.PBNCD_NO AS PBNCD_NO ,
	        	  SUM(A.RPAY_AMOUNT) AS INTR_RPAY_AMOUNT ,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG00,
	<isEqual property="PRT_GBN2" compareValue="Y">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
	              0 AS INTR_RPAY_AG10,0 AS INTR_RPAY_AG11,0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,
	              0 AS INTR_RPAY_AG15,0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
	</isEqual>
	<isEqual property="PRT_GBN2" compareValue="Q">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG12,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG13,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG14,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG15,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG16,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG17,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG18,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG19
	</isEqual>
	<isEqual property="PRT_GBN2" compareValue="M">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
	              0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,0 AS INTR_RPAY_AG15,
	              0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
	</isEqual>
	        FROM TBFUN_PBNCD_INTR_RPAY_PLAN A
	        GROUP BY A.PBNCD_NO
	    ) E
        ON A.PBNCD_NO = E.PBNCD_NO
	    GROUP BY ROLLUP(A.CPTAL_KND, A.CPTAL_KND_NM, A.BSNS_CODE, A.BSNS_NM) 
	    HAVING GROUPING_ID(A.CPTAL_KND, A.CPTAL_KND_NM, A.BSNS_CODE, A.BSNS_NM) IN (0,3) 
	    order by grouping(A.CPTAL_KND_NM) desc, A.CPTAL_KND_NM
	           , grouping(A.BSNS_NM) desc, A.BSNS_NM
    )    
        
    UNION ALL
    
    SELECT '10' AS DV0, 
           '단기채(C2)' AS DV1,
           '' AS DV2,
           '합계' AS DV3,
           NVL(TRUNC(SUM(C.RPAY_AMOUNT) / #PRT_GBN1#), 0) AS RPAY_AMOUNT,
           NVL(TRUNC(SUM(E.INTR_RPAY_AMOUNT) / #PRT_GBN1#), 0) AS INTR_RPAY_AMOUNT,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG00) / #PRT_GBN1#), 0) AS AMT00,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS AMT0                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS AMT1                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS AMT2                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS AMT3                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS AMT4                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS AMT5                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS AMT6                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS AMT7                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS AMT8                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS AMT9                 ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG10) / #PRT_GBN1#) ,0) AS AMT10                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG11) / #PRT_GBN1#) ,0) AS AMT11                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG12) / #PRT_GBN1#) ,0) AS AMT12                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG13) / #PRT_GBN1#) ,0) AS AMT13                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG14) / #PRT_GBN1#) ,0) AS AMT14                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG15) / #PRT_GBN1#) ,0) AS AMT15                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG16) / #PRT_GBN1#) ,0) AS AMT16                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG17) / #PRT_GBN1#) ,0) AS AMT17                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG18) / #PRT_GBN1#) ,0) AS AMT18                ,
           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG19) / #PRT_GBN1#) ,0) AS AMT19                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG00 ) / #PRT_GBN1#) ,0) AS INT00                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS INT0                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS INT1                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS INT2                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS INT3                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS INT4                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS INT5                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS INT6                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS INT7                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS INT8                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS INT9                 ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG10) / #PRT_GBN1#) ,0) AS INT10                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG11) / #PRT_GBN1#) ,0) AS INT11                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG12) / #PRT_GBN1#) ,0) AS INT12                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG13) / #PRT_GBN1#) ,0) AS INT13                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG14) / #PRT_GBN1#) ,0) AS INT14                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG15) / #PRT_GBN1#) ,0) AS INT15                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG16) / #PRT_GBN1#) ,0) AS INT16                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG17) / #PRT_GBN1#) ,0) AS INT17                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG18) / #PRT_GBN1#) ,0) AS INT18                ,
           NVL(TRUNC(SUM(E.INTR_RPAY_AG19) / #PRT_GBN1#) ,0) AS INT19
    FROM (
        SELECT *
        FROM
        (
              SELECT AA.*
                   , SUM(AA.BRRW_BALANCE) OVER (PARTITION BY AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM) AS BAL_AMT
              FROM
              (
                      SELECT AA.PBNCD_NO
                           , AA.BSNS_CODE AS BSNS_CODE
                           , AA.BSNS_NM AS BSNS_NM
                           , AA.CPTAL_KND AS CPTAL_KND
                           , AA.CPTAL_KND_NM AS CPTAL_KND_NM
                           , AA.LEASE_YN
                           , MIN(AA.BRRW_DE) AS BRRW_DE
                           , MAX(AA.EXPRTN_DE) AS EXPRTN_DE
                           , TO_CHAR(SUM(AA.INTRT) / COUNT(AA.CPTAL_KND), 'FM9990D00') AS INTRT
                           , SUM(AA.BRRW_AMOUNT) AS BRRW_AMOUNT
                           , SUM(AA.PRNCPAL_RPAY_AMOUNT) AS PRNCPAL_RPAY_AMOUNT
                           , SUM(AA.INTR_RPAY_AMOUNT) AS INTR_RPAY_AMOUNT
                           , SUM(AA.BRRW_BALANCE) AS BRRW_BALANCE
                      FROM 
                      (
                              select A.PBNCD_NO
                                   , A.BSNS_CODE
                                   , B.BSNS_NM
                                   , A.CPTAL_KND
                                   , C.CODE_NM AS CPTAL_KND_NM
                                   , A.BRRW_DE
                                   , A.EXPRTN_DE
                                   , NVL(A.EXPRTN_AT, 0) AS EXPRTN_AT
                                   , A.INTRT     
                                   , A.BRRW_AMOUNT
                                   , A.LEASE_YM
                                   , CASE WHEN A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                          THEN 'Y'
                                          ELSE 'N'
                                     END AS LEASE_YN     
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS PRNCPAL_RPAY_AMOUNT
                                   ,NVL((
                                      SELECT SUM(AA.RPAY_AMOUNT)
                                      FROM TBFUN_PBNCD_INTR_RPAY_DTLS AA
                                      WHERE AA.PBNCD_NO = A.PBNCD_NO
                                      AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS INTR_RPAY_AMOUNT        
                                   , NVL(A.BRRW_AMOUNT ,0) - NVL((
                                        SELECT SUM(AA.RPAY_AMOUNT)
                                        FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                        WHERE AA.PBNCD_NO = A.PBNCD_NO
                                        AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                    ) ,0) AS BRRW_BALANCE         
                              from TBFUN_PBNCD A
                              LEFT OUTER JOIN TBPRJ_BSNS_CODE B
                              ON A.BSNS_CODE = B.BSNS_CODE
                              LEFT OUTER JOIN
                                (
                                  SELECT DETAIL_CODE AS CODE ,
                                    DETAIL_CODE_NM   AS CODE_NM
                                  FROM TBFUN_CPTAL_DETAIL_CODE
                                  WHERE CODE_SE = '000'
                                )
                                C
                              ON A.CPTAL_KND = C.CODE
                              WHERE (A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231')
                              AND   A.CPTAL_KND LIKE 'B%'
                      ) AA
                      GROUP BY AA.PBNCD_NO, AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM
              ) AA
        ) AA
        WHERE AA.BAL_AMT > 0    
    ) A
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO    AS PBNCD_NO    ,
               SUM(A.RPAY_AMOUNT) AS RPAY_AMOUNT ,
			   SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG00,               
<isEqual property="PRT_GBN2" compareValue="Y"> 
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               0 AS PRNCPAL_RPAY_AG10,0 AS PRNCPAL_RPAY_AG11,0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,
               0 AS PRNCPAL_RPAY_AG15,0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>          
<isEqual property="PRT_GBN2" compareValue="Q">
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG12,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG13,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG14,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG15,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG16,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG17,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG18,
               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
              0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,0 AS PRNCPAL_RPAY_AG15,
              0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
</isEqual>		       
        FROM TBFUN_PBNCD_PRNCPAL_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) C
    ON A.PBNCD_NO = C.PBNCD_NO
    LEFT OUTER JOIN
    (
        SELECT A.PBNCD_NO AS PBNCD_NO ,
        	  SUM(A.RPAY_AMOUNT) AS INTR_RPAY_AMOUNT ,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG00,
<isEqual property="PRT_GBN2" compareValue="Y">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              0 AS INTR_RPAY_AG10,0 AS INTR_RPAY_AG11,0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,
              0 AS INTR_RPAY_AG15,0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="Q">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG12,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG13,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG14,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG15,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG16,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG17,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG18,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG19
</isEqual>
<isEqual property="PRT_GBN2" compareValue="M">
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
              0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,0 AS INTR_RPAY_AG15,
              0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
</isEqual>
        FROM TBFUN_PBNCD_INTR_RPAY_PLAN A
        GROUP BY A.PBNCD_NO
    ) E
    ON A.PBNCD_NO = E.PBNCD_NO
    
    UNION ALL
    
    SELECT *
    FROM
    (
        SELECT '11' AS DV0, 
               '' AS DV1,
               DECODE(GROUPING_ID(A.CPTAL_KND, A.CPTAL_KND_NM, A.BSNS_CODE, A.BSNS_NM), '0', '', A.CPTAL_KND_NM) AS DV2,
           	   DECODE(GROUPING_ID(A.CPTAL_KND, A.CPTAL_KND_NM, A.BSNS_CODE, A.BSNS_NM), '0', A.BSNS_NM, '소계') AS DV3,
	           NVL(TRUNC(SUM(C.RPAY_AMOUNT) / #PRT_GBN1#), 0) AS RPAY_AMOUNT,
    	       NVL(TRUNC(SUM(E.INTR_RPAY_AMOUNT) / #PRT_GBN1#), 0) AS INTR_RPAY_AMOUNT,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG00) / #PRT_GBN1#), 0) AS AMT00,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS AMT0                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS AMT1                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS AMT2                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS AMT3                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS AMT4                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS AMT5                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS AMT6                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS AMT7                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS AMT8                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS AMT9                 ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG10) / #PRT_GBN1#) ,0) AS AMT10                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG11) / #PRT_GBN1#) ,0) AS AMT11                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG12) / #PRT_GBN1#) ,0) AS AMT12                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG13) / #PRT_GBN1#) ,0) AS AMT13                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG14) / #PRT_GBN1#) ,0) AS AMT14                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG15) / #PRT_GBN1#) ,0) AS AMT15                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG16) / #PRT_GBN1#) ,0) AS AMT16                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG17) / #PRT_GBN1#) ,0) AS AMT17                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG18) / #PRT_GBN1#) ,0) AS AMT18                ,
	           NVL(TRUNC(SUM(C.PRNCPAL_RPAY_AG19) / #PRT_GBN1#) ,0) AS AMT19                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG00 ) / #PRT_GBN1#) ,0) AS INT00                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG0 ) / #PRT_GBN1#) ,0) AS INT0                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG1 ) / #PRT_GBN1#) ,0) AS INT1                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG2 ) / #PRT_GBN1#) ,0) AS INT2                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG3 ) / #PRT_GBN1#) ,0) AS INT3                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG4 ) / #PRT_GBN1#) ,0) AS INT4                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG5 ) / #PRT_GBN1#) ,0) AS INT5                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG6 ) / #PRT_GBN1#) ,0) AS INT6                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG7 ) / #PRT_GBN1#) ,0) AS INT7                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG8 ) / #PRT_GBN1#) ,0) AS INT8                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG9 ) / #PRT_GBN1#) ,0) AS INT9                 ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG10) / #PRT_GBN1#) ,0) AS INT10                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG11) / #PRT_GBN1#) ,0) AS INT11                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG12) / #PRT_GBN1#) ,0) AS INT12                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG13) / #PRT_GBN1#) ,0) AS INT13                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG14) / #PRT_GBN1#) ,0) AS INT14                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG15) / #PRT_GBN1#) ,0) AS INT15                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG16) / #PRT_GBN1#) ,0) AS INT16                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG17) / #PRT_GBN1#) ,0) AS INT17                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG18) / #PRT_GBN1#) ,0) AS INT18                ,
	           NVL(TRUNC(SUM(E.INTR_RPAY_AG19) / #PRT_GBN1#) ,0) AS INT19
        FROM (
            SELECT *
            FROM
            (
                  SELECT AA.*
                       , SUM(AA.BRRW_BALANCE) OVER (PARTITION BY AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM) AS BAL_AMT
                  FROM
                  (
                          SELECT AA.PBNCD_NO
                               , AA.BSNS_CODE AS BSNS_CODE
                               , AA.BSNS_NM AS BSNS_NM
                               , AA.CPTAL_KND AS CPTAL_KND
                               , AA.CPTAL_KND_NM AS CPTAL_KND_NM
                               , AA.LEASE_YN
                               , MIN(AA.BRRW_DE) AS BRRW_DE
                               , MAX(AA.EXPRTN_DE) AS EXPRTN_DE
                               , TO_CHAR(SUM(AA.INTRT) / COUNT(AA.CPTAL_KND), 'FM9990D00') AS INTRT
                               , SUM(AA.BRRW_AMOUNT) AS BRRW_AMOUNT
                               , SUM(AA.PRNCPAL_RPAY_AMOUNT) AS PRNCPAL_RPAY_AMOUNT
                               , SUM(AA.INTR_RPAY_AMOUNT) AS INTR_RPAY_AMOUNT
                               , SUM(AA.BRRW_BALANCE) AS BRRW_BALANCE
                          FROM 
                          (
                                  select A.PBNCD_NO
                                       , A.BSNS_CODE
                                       , B.BSNS_NM
                                       , A.CPTAL_KND
                                       , C.CODE_NM AS CPTAL_KND_NM
                                       , A.BRRW_DE
                                       , A.EXPRTN_DE
                                       , NVL(A.EXPRTN_AT, 0) AS EXPRTN_AT
                                       , A.INTRT     
                                       , A.BRRW_AMOUNT
                                       , A.LEASE_YM
                                       , CASE WHEN A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                              THEN 'Y'
                                              ELSE 'N'
                                         END AS LEASE_YN     
                                       ,NVL((
                                          SELECT SUM(AA.RPAY_AMOUNT)
                                          FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                          WHERE AA.PBNCD_NO = A.PBNCD_NO
                                          AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                        ) ,0) AS PRNCPAL_RPAY_AMOUNT
                                       ,NVL((
                                          SELECT SUM(AA.RPAY_AMOUNT)
                                          FROM TBFUN_PBNCD_INTR_RPAY_DTLS AA
                                          WHERE AA.PBNCD_NO = A.PBNCD_NO
                                          AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                        ) ,0) AS INTR_RPAY_AMOUNT        
                                       , NVL(A.BRRW_AMOUNT ,0) - NVL((
                                            SELECT SUM(AA.RPAY_AMOUNT)
                                            FROM TBFUN_PBNCD_PRNCPAL_RPAY_DTLS AA
                                            WHERE AA.PBNCD_NO = A.PBNCD_NO
                                            AND   AA.RPAY_DE <![CDATA[<=]]> #SEARCH_YEAR#||'1231'
                                        ) ,0) AS BRRW_BALANCE         
                                  from TBFUN_PBNCD A
                                  LEFT OUTER JOIN TBPRJ_BSNS_CODE B
                                  ON A.BSNS_CODE = B.BSNS_CODE
                                  LEFT OUTER JOIN
                                    (
                                      SELECT DETAIL_CODE AS CODE ,
                                        DETAIL_CODE_NM   AS CODE_NM
                                      FROM TBFUN_CPTAL_DETAIL_CODE
                                      WHERE CODE_SE = '000'
                                    )
                                    C
                                  ON A.CPTAL_KND = C.CODE
                                  WHERE (A.LEASE_YM IS NOT NULL OR A.LEASE_YM <![CDATA[<=]]> #SEARCH_YEAR#||'1231')
                                  AND   A.CPTAL_KND LIKE 'B%'
                          ) AA
                          GROUP BY AA.PBNCD_NO, AA.LEASE_YN, AA.BSNS_CODE, AA.BSNS_NM, AA.CPTAL_KND, AA.CPTAL_KND_NM
                  ) AA
            ) AA
            WHERE AA.BAL_AMT > 0    
        
        ) A
	    LEFT OUTER JOIN
	    (
	        SELECT A.PBNCD_NO    AS PBNCD_NO    ,
	               SUM(A.RPAY_AMOUNT) AS RPAY_AMOUNT ,
				   SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG00,               
	<isEqual property="PRT_GBN2" compareValue="Y"> 
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
	               0 AS PRNCPAL_RPAY_AG10,0 AS PRNCPAL_RPAY_AG11,0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,
	               0 AS PRNCPAL_RPAY_AG15,0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
	</isEqual>          
	<isEqual property="PRT_GBN2" compareValue="Q">
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG12,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG13,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG14,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG15,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG16,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG17,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG18,
	               SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG19
	</isEqual>
	<isEqual property="PRT_GBN2" compareValue="M">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG9,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG10,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS PRNCPAL_RPAY_AG11,
	              0 AS PRNCPAL_RPAY_AG12,0 AS PRNCPAL_RPAY_AG13,0 AS PRNCPAL_RPAY_AG14,0 AS PRNCPAL_RPAY_AG15,
	              0 AS PRNCPAL_RPAY_AG16,0 AS PRNCPAL_RPAY_AG17,0 AS PRNCPAL_RPAY_AG18,0 AS PRNCPAL_RPAY_AG19
	</isEqual>		       
	        FROM TBFUN_PBNCD_PRNCPAL_RPAY_PLAN A
	        GROUP BY A.PBNCD_NO
	    ) C
	    ON A.PBNCD_NO = C.PBNCD_NO
	    LEFT OUTER JOIN
	    (
	        SELECT A.PBNCD_NO AS PBNCD_NO ,
	        	  SUM(A.RPAY_AMOUNT) AS INTR_RPAY_AMOUNT ,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) <![CDATA[<]]> #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG00,
	<isEqual property="PRT_GBN2" compareValue="Y">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#    THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+5  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+6  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+7  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+8  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+9  THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
	              0 AS INTR_RPAY_AG10,0 AS INTR_RPAY_AG11,0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,
	              0 AS INTR_RPAY_AG15,0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
	</isEqual>
	<isEqual property="PRT_GBN2" compareValue="Q">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#   AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+1 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+2 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG12,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG13,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG14,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+3 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG15,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '1' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG16,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '2' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG17,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '3' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG18,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,4) = #SEARCH_YEAR#+4 AND TO_CHAR(TO_DATE(A.RPAY_DE, 'YYYYMMDD'),'Q') = '4' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG19
	</isEqual>
	<isEqual property="PRT_GBN2" compareValue="M">
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'01' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG0,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'02' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG1,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'03' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG2,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'04' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG3,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'05' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG4,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'06' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG5,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'07' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG6,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'08' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG7,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'09' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG8,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'10' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG9,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'11' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG10,
	              SUM(CASE WHEN SUBSTR(A.RPAY_DE,1,6) = #SEARCH_YEAR#||'12' THEN A.RPAY_AMOUNT ELSE 0 END) AS INTR_RPAY_AG11,
	              0 AS INTR_RPAY_AG12,0 AS INTR_RPAY_AG13,0 AS INTR_RPAY_AG14,0 AS INTR_RPAY_AG15,
	              0 AS INTR_RPAY_AG16,0 AS INTR_RPAY_AG17,0 AS INTR_RPAY_AG18,0 AS INTR_RPAY_AG19
	</isEqual>
	        FROM TBFUN_PBNCD_INTR_RPAY_PLAN A
	        GROUP BY A.PBNCD_NO
	    ) E
        ON A.PBNCD_NO = E.PBNCD_NO
	    GROUP BY ROLLUP(A.CPTAL_KND, A.CPTAL_KND_NM, A.BSNS_CODE, A.BSNS_NM) 
	    HAVING GROUPING_ID(A.CPTAL_KND, A.CPTAL_KND_NM, A.BSNS_CODE, A.BSNS_NM) IN (0,3) 
	    order by grouping(A.CPTAL_KND_NM) desc, A.CPTAL_KND_NM
	           , grouping(A.BSNS_NM) desc, A.BSNS_NM
    )                	
	</select>	

	<!-- 연간발행상환내역 조회 -->
	<select id="FUN020204DAO.selectRpaySchedule03" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT AA.YYYYMM
		     , NVL(TRUNC((
		          SELECT SUM(B.BRRW_AMOUNT)
		          FROM   TBFUN_PBNCD_CONFM A
		               , TBFUN_PBNCD B
		          WHERE  A.CONFM_AT = '1'
		          AND    A.CONFM_NO = B.CONFM_NO
		          AND    (A.GVRN_CONFM_DE IS NOT NULL OR A.CITY_CONFM_DE IS NOT NULL)
		          AND    SUBSTR(B.BRRW_DE, 0, 6) = AA.YYYYMM
		       ) / #PRT_GBN1#), 0) AS ISSUE01
		     , NVL(TRUNC((
		          SELECT SUM(B.BRRW_AMOUNT)
		          FROM   TBFUN_PBNCD_CONFM A
		               , TBFUN_PBNCD B
		          WHERE  A.CONFM_AT = '1'
		          AND    A.CONFM_NO = B.CONFM_NO
		          AND    SUBSTR(B.BRRW_DE, 0, 6) = AA.YYYYMM
		          AND    B.CPTAL_KND IN ('A06', 'B06')
		       ) / #PRT_GBN1#), 0) AS ISSUE02  
		     , NVL(TRUNC((
		          SELECT SUM(B.BRRW_AMOUNT)
		          FROM   TBFUN_PBNCD_CONFM A
		               , TBFUN_PBNCD B
		          WHERE  A.CONFM_AT = '1'
		          AND    A.CONFM_NO = B.CONFM_NO
		          AND    SUBSTR(B.BRRW_DE, 0, 6) = AA.YYYYMM
		          AND    B.CPTAL_KND IN ('A02', 'B02')
		       ) / #PRT_GBN1#), 0) AS ISSUE03  
		     , 0 AS ISSUE04
		     , NVL(TRUNC((
		          SELECT SUM(B.BRRW_AMOUNT)
		          FROM   TBFUN_PBNCD_CONFM A
		               , TBFUN_PBNCD B
		          WHERE  A.CONFM_AT = '1'
		          AND    A.CONFM_NO = B.CONFM_NO
		          AND    SUBSTR(B.BRRW_DE, 0, 6) = AA.YYYYMM
		          AND    B.CPTAL_KND NOT IN ('A02', 'B02', 'A06', 'B06')
		          AND    (A.GVRN_CONFM_DE IS NULL AND A.CITY_CONFM_DE IS NULL)
		       ) / #PRT_GBN1#), 0) AS ISSUE05       
		     , NVL(TRUNC(((
		          SELECT SUM(C.RPAY_AMOUNT)
		          FROM   TBFUN_PBNCD_CONFM A
		               , TBFUN_PBNCD B
		               , TBFUN_PBNCD_PRNCPAL_RPAY_DTLS C
		          WHERE  A.CONFM_AT = '1'
		          AND    A.CONFM_NO = B.CONFM_NO
		          AND    (A.GVRN_CONFM_DE IS NOT NULL OR A.CITY_CONFM_DE IS NOT NULL)
		          AND    SUBSTR(C.RPAY_DE, 0, 6) = AA.YYYYMM
		          AND    B.PBNCD_NO = C.PBNCD_NO
		       ) + (
		          SELECT SUM(C.RPAY_AMOUNT)
		          FROM   TBFUN_PBNCD_CONFM A
		               , TBFUN_PBNCD B
		               , TBFUN_PBNCD_INTR_RPAY_DTLS C
		          WHERE  A.CONFM_AT = '1'
		          AND    A.CONFM_NO = B.CONFM_NO
		          AND    (A.GVRN_CONFM_DE IS NOT NULL OR A.CITY_CONFM_DE IS NOT NULL)
		          AND    SUBSTR(C.RPAY_DE, 0, 6) = AA.YYYYMM
		          AND    B.PBNCD_NO = C.PBNCD_NO
		       )) / #PRT_GBN1#), 0) AS RPAY01
		     , NVL(TRUNC(((
		          SELECT SUM(C.RPAY_AMOUNT)
		          FROM   TBFUN_PBNCD_CONFM A
		               , TBFUN_PBNCD B
		               , TBFUN_PBNCD_PRNCPAL_RPAY_DTLS C
		          WHERE  A.CONFM_AT = '1'
		          AND    A.CONFM_NO = B.CONFM_NO
		          AND    SUBSTR(C.RPAY_DE, 0, 6) = AA.YYYYMM
		          AND    B.CPTAL_KND IN ('A06', 'B06')
		          AND    B.PBNCD_NO = C.PBNCD_NO
		       ) + (
		          SELECT SUM(C.RPAY_AMOUNT)
		          FROM   TBFUN_PBNCD_CONFM A
		               , TBFUN_PBNCD B
		               , TBFUN_PBNCD_INTR_RPAY_DTLS C
		          WHERE  A.CONFM_AT = '1'
		          AND    A.CONFM_NO = B.CONFM_NO
		          AND    SUBSTR(C.RPAY_DE, 0, 6) = AA.YYYYMM
		          AND    B.CPTAL_KND IN ('A06', 'B06')
		          AND    B.PBNCD_NO = C.PBNCD_NO
		       )) / #PRT_GBN1#), 0) AS RPAY02  
		     , NVL(TRUNC(((
		          SELECT SUM(C.RPAY_AMOUNT)
		          FROM   TBFUN_PBNCD_CONFM A
		               , TBFUN_PBNCD B
		               , TBFUN_PBNCD_PRNCPAL_RPAY_DTLS C
		          WHERE  A.CONFM_AT = '1'
		          AND    A.CONFM_NO = B.CONFM_NO
		          AND    SUBSTR(C.RPAY_DE, 0, 6) = AA.YYYYMM
		          AND    B.CPTAL_KND IN ('A02', 'B02')
		          AND    B.PBNCD_NO = C.PBNCD_NO
		       ) + (
		          SELECT SUM(C.RPAY_AMOUNT)
		          FROM   TBFUN_PBNCD_CONFM A
		               , TBFUN_PBNCD B
		               , TBFUN_PBNCD_INTR_RPAY_DTLS C
		          WHERE  A.CONFM_AT = '1'
		          AND    A.CONFM_NO = B.CONFM_NO
		          AND    SUBSTR(C.RPAY_DE, 0, 6) = AA.YYYYMM
		          AND    B.CPTAL_KND IN ('A02', 'B02')
		          AND    B.PBNCD_NO = C.PBNCD_NO
		       )) / #PRT_GBN1#), 0) AS RPAY03  
		     , 0 AS RPAY04
		     , NVL(TRUNC(((
		          SELECT SUM(C.RPAY_AMOUNT)
		          FROM   TBFUN_PBNCD_CONFM A
		               , TBFUN_PBNCD B
		               , TBFUN_PBNCD_PRNCPAL_RPAY_DTLS C
		          WHERE  A.CONFM_AT = '1'
		          AND    A.CONFM_NO = B.CONFM_NO
		          AND    SUBSTR(C.RPAY_DE, 0, 6) = AA.YYYYMM
		          AND    B.CPTAL_KND NOT IN ('A02', 'B02', 'A06', 'B06')
		          AND    (A.GVRN_CONFM_DE IS NULL AND A.CITY_CONFM_DE IS NULL)
		          AND    B.PBNCD_NO = C.PBNCD_NO
		       ) + (
		          SELECT SUM(C.RPAY_AMOUNT)
		          FROM   TBFUN_PBNCD_CONFM A
		               , TBFUN_PBNCD B
		               , TBFUN_PBNCD_INTR_RPAY_DTLS C
		          WHERE  A.CONFM_AT = '1'
		          AND    A.CONFM_NO = B.CONFM_NO
		          AND    SUBSTR(C.RPAY_DE, 0, 6) = AA.YYYYMM
		          AND    B.CPTAL_KND NOT IN ('A02', 'B02', 'A06', 'B06')
		          AND    (A.GVRN_CONFM_DE IS NULL AND A.CITY_CONFM_DE IS NULL)
		          AND    B.PBNCD_NO = C.PBNCD_NO
		       )) / #PRT_GBN1#), 0) AS RPAY05      
		FROM   (
		          SELECT TO_CHAR(ADD_MONTHS(TO_DATE(#SEARCH_YEAR#||'01', 'YYYYMM'), LEVEL - 1), 'YYYYMM') AS YYYYMM
		          FROM DUAL
		          CONNECT BY ADD_MONTHS(TO_DATE(#SEARCH_YEAR#||'01', 'YYYYMM'), LEVEL - 1) <![CDATA[<=]]> TO_DATE(#SEARCH_YEAR#||'12', 'YYYYMM')
		       ) AA
	</select>

</sqlMap>