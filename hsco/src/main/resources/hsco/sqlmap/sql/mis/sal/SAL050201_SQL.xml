<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="SAL050201_SQL">	
	
	<!-- 연말정산기본생성정보 목록조회 -->
	<select id="SAL050201DAO.selectYndExcclcCreatList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		<![CDATA[	
		SELECT 
			  A.EXCCLC_YEAR AS EXCCLC_YEAR
			 ,NVL((SELECT COUNT(EMPNO) FROM  TBSAL_YND_EXCCLC_BSIS WHERE EXCCLC_YEAR = A.EXCCLC_YEAR AND EMPL_SE IN ('000','001','002','003','007') AND EXCCLC_SE = '1'),0) AS A1
			 ,NVL((SELECT COUNT(EMPNO) FROM  TBSAL_YND_EXCCLC_BSIS WHERE EXCCLC_YEAR = A.EXCCLC_YEAR AND EMPL_SE IN ('004') AND EXCCLC_SE = '1'),0) AS A2
			 ,NVL((SELECT COUNT(EMPNO) FROM  TBSAL_YND_EXCCLC_BSIS WHERE EXCCLC_YEAR = A.EXCCLC_YEAR AND EMPL_SE IN ('005') AND EXCCLC_SE = '1'),0) AS A3
			 ,NVL((SELECT COUNT(EMPNO) FROM  TBSAL_YND_EXCCLC_BSIS WHERE EXCCLC_YEAR = A.EXCCLC_YEAR AND EMPL_SE IN ('000','001','002','003','007') AND EXCCLC_SE = '2'),0) AS A4
			 ,NVL((SELECT COUNT(EMPNO) FROM  TBSAL_YND_EXCCLC_BSIS WHERE EXCCLC_YEAR = A.EXCCLC_YEAR AND EMPL_SE IN ('004') AND EXCCLC_SE = '2'),0) AS A5
			 ,NVL((SELECT COUNT(EMPNO) FROM  TBSAL_YND_EXCCLC_BSIS WHERE EXCCLC_YEAR = A.EXCCLC_YEAR AND EMPL_SE IN ('005') AND EXCCLC_SE = '2'),0) AS A6
		FROM TBSAL_YND_EXCCLC_BSIS A
		GROUP BY A.EXCCLC_YEAR
		ORDER BY A.EXCCLC_YEAR DESC
		]]>	
    </select>  
    
    <!-- 연말정산기본생성정보2 목록조회 -->
	<select id="SAL050201DAO.selectYndExcclcBsisList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		<![CDATA[			 
	        SELECT 
		          A.EXCCLC_YEAR
				 ,A.EXCCLC_SE
				 ,A.EMPNO
				 ,A.EMPNM	        
			FROM TBSAL_YND_EXCCLC_BSIS A
			WHERE A.EXCCLC_YEAR = #EXCCLC_YEAR#
			AND A.EXCCLC_SE = #EXCCLC_SE#
		]]>	  
		<isNotEmpty property="EMPNO">
	 	    AND A.EMPNO = #EMPNO#
		</isNotEmpty>  	
	
    </select>  
    
    <!-- 연말정산기본생성정보 입력 -->
    <insert id="SAL050201DAO.YndExcclcCreatC" parameterClass="java.util.HashMap">
        <![CDATA[
        DECLARE
		BEGIN
			/* 일반 급여 연말정산 생성 */
            INSERT INTO TBSAL_YND_EXCCLC_BSIS (
                         EXCCLC_YEAR          /* 정산년도 */
						,EXCCLC_SE            /* 정산구분 */
						,EMPNO                /* 사번 */
						,EMPNM                /* 사원명 */
						,EXCCLC_BGNDE         /* 정산시작일자 */
						,EXCCLC_ENDDE         /* 정산종료일자 */
						,DEPT_CODE            /* 부서코드 */
						,DEPT_NM              /* 부서명 */
						,CLSF_CODE            /* 직급코드 */
						,SRCLS                /* 호봉 */
						,OFCPS_CODE           /* 직위코드 */
						,ECNY_SE              /* 입사구분 */
						,ECNY_DE              /* 입사일자 */
						,RETIRE_DE            /* 퇴사일자 */
						,DSPSN_GRAD           /* 장애자등급 */
						,RWDMRT_GRAD          /* 보훈등급 */
						,EMPL_SE              /* 사원구분 */
						
						,FYER_LABOR_INCOME    /* 연간근로소득 */
						,TAXXMPT_INCOME       /* 비과세소득 */
						,TOT_SALARY_AMOUNT    /* 총급여금액 */						
						,ERNM_DDC             /* 근로소득공제 */
						,ERNM_AMOUNT          /* 근로소득금액 */
						
						,HSHLDR_AT            /* 세대주여부 */
						,SPOUSE_AT            /* 배우자여부 */
						,LADY_HSHLDR          /* 부녀자세대주 */
						,SUPORTR_20           /* 부양자20세이하 */
						,SUPORTR_60           /* 부양자60세이상 */
						,COURS_PVLTRT_65      /* 경로우대65 */
						,COURS_PVLTRT_70      /* 경로우대70 */
						,DSPSN_CO             /* 장애인수 */
						,CHLDRN_6_BELOW       /* 자녀6세이하 */
						,CHLDBRTH_ADP_CHLDRN  /* 출산입양자녀 */
						,MNYCH                /* 다자녀 */
						,PARNTS_1             /* 한부모 */
						,NPN                  /* 국민연금 */
						,INDVDL_ANNTY_SVINGS_BEFORE   /* 개인연금저축이전 */
						,INDVDL_ANNTY_SVINGS_AFTER    /* 개인연금저축이후 */
						,ANNTY_SVINGS_DDC             /* 연금저축공제금 */
						,HLTHINS                      /* 건강보험 */
						,EMPLYMINSRNC                 /* 고용보험 */
						,GRNT_INSRNC                  /* 보장성보험 */
						,DSPSN_DVR_INSRNC             /* 장애인전용보험 */
						,GNRL_MCP                     /* 일반의료비 */
						,SELF_COURS_TROBL_MCP         /* 본인경로장애의료 */
						,ERNM_3                       /* 근로소득3프로 */
						,DDC_MCP                      /* 공제의료비 */
						,SELF_EDCCT                   /* 본인교육비 */
						,ESHL_BFE_EDCCT               /* 취학전교육비 */
						,GNRL_EDCCT                   /* 초중고교육비 */
						,UNIV_EDCCT                   /* 대학생교육비 */
						,DSPSN_EDCCT                  /* 장애인교육비 */
						,INVSTMNT_INVT                /* 출자투자 */
						,INVT_MXTR                    /* 투자조합 */
						,SUBSCRPT_SVINGS              /* 청약저축 */
						,HOUSE_SUBSCRPT_GNRLZ         /* 주택청약종합 */
						,LABRR_HOUSE_PREPRTN          /* 근로자주택마련 */
						,LFSTS_INTR                   /* 목돈안드는전세이자 */
						,PNINT_RPAY_FNNC              /* 원리금상환액금융 */
						,HOUSE_HIRE_INTR_RPAY         /* 주택임차이자상환 */
						,MTHT_AM                      /* 월세액 */
						,HOUSE_MRTG_BRRW_INSTT_NM     /* 주택저당차입기관명 */
						,HOUSE_MRTG_BRRW_DE           /* 주택저당차입일자 */
						,HOUSE_MRTG_BRRW_INTR_14      /* 주택저당차입이자14 */
						,HOUSE_MRTG_BRRW_INTR_29      /* 주택저당차입이자29 */
						,HOUSE_MRTG_BRRW_INTR_30      /* 주택저당차입이자30 */
						,HOUSE_MRTG_BRRW_INTR_FIXING  /* 주택저당차입이자고정 */
						,HOUSE_MRTG_BRRW_INTR_ETC     /* 주택저당차입이자기타 */
						,LEGAL_CNTR                   /* 법정기부 */
						,EXCPT_CNTR                   /* 특례기부 */
						,EXCPT_CNTR_LMT               /* 특례기부한도 */
						,APPN_CNTR                    /* 지정기부금액 */
						,LABOR_MXTR                   /* 노동조합비 */
						,APPN_CNTR_LMT_PRVYY          /* 지정기부한도전년 */
						,END_CNTR                     /* 종교기부금 */
						,APPN_TXCLCTPT_LMT_THSYR      /* 지정기부한도금년 */
						,LEGAL_CNTR_CYFD              /* 법정기부이월 */
						,APPN_CNTR_CYFD               /* 지정기부이월 */
						,RELGN_CNTR_CYFD              /* 종교기부이월 */
						,APPN_CNTR_LMT_UNITY          /* 지정기부한도통합 */
						,MRRG_HMV_FNRL                /* 혼인이사장례비 */
						,SPT_TCHNLGY_HNF              /* 현장기술인력 */
						,CNWK_SDYTRN                  /* 근속연수 */
						,CREDTCARD                    /* 신용카드 */
						,DBCD                         /* 직불카드 */
						,PBTRNSP_USE                  /* 대중교통이용 */
						,CASH_RCIPT                   /* 현금영수증 */
						,TRDIT_MRKT_USE               /* 전통시장사용 */
						,ERNM_25                      /* 근로소득25 */
						,ERNM_20                      /* 근로소득20 */
						,CREDTCARD_DDC                /* 신용카드공제 */
						,OUTNATN_WORK_NM              /* 국외근무지명 */
						,OUTNATN_WORK_RSPOFC          /* 국외근무직책 */
						,OUTNATN_WORK_PD              /* 국외근무기간 */
						,OUTNATN_WORK_TOT_SALARY      /* 국외근무총급여 */
						,OUTNATN_WORK_TAXPAY_YEAST    /* 국외근무납세국명 */
						,OUTNATN_WORK_TAXPAY_WON      /* 국외근무납세액원화 */
						,OUTNATN_WORK_TAXPAY_FGCRY    /* 국외근무납세액외화 */
						,OUTNATN_WORK_TAXAMT_DDC      /* 국외근무세액공제 */
						,FUND_1                       /* 펀드1 */
						,FUND_2                       /* 펀드2 */
						,FUND_3                       /* 펀드3 */
						,INORG_SCRITS_SVINGS          /* 장기증권저축 */
						,SVINGS_SM                    /* 저축계 */
						,POLITC_CPTAL_CNTR            /* 정치자금기부 */
						,HOUSE_INTR_RPAY_AMOUNT       /* 주택이자상환금 */
						
						,SELF_CREDTCARD               /* 본인신용카드 */
						,CREDTCARD_ADIT_USE_AMOUNT    /* 신용카드추가사용금액 */
						,CREDTCARD_ADIT_USE_AMOUNT_2  /* 신용카드추가사용금액2 */
						,SMALL_CRNTY_DDC              /* 소상공인공제부금 */
						,INVT_MXTR_2                  /* 투자조합2 */
						,INVT_MXTR_3                  /* 투자조합3 */
						,RETIRE_ANNTY                 /* 퇴직연금 */
						
						,PNINT_RPAY_RESIDNT           /* 원리금상환거주자 */
						,INCMTAX                      /* 소득세 */
						,LCLTY_INCMTAX                /* 지방소득세 */
						
						,REGISTER_ID    /* 등록자ID */
						,REGIST_DT      /* 등록일시 */
						,UPDUSR_ID      /* 수정자ID */
                        ,UPDT_DT        /* 수정일시 */
                        ,CLOS_AT        /* 마감여부 */						
             ) 
               SELECT 
                         #EXCCLC_YEAR#         /* 정산년도 */
						,#EXCCLC_SE#           /* 정산구분 */
						,A.EMPNO               /* 사번 */
						,A.EMPNM               /* 사원명 */
						,(SELECT CASE WHEN
						      #EXCCLC_YEAR# || '0101' < (SELECT C.ECNY_DE FROM TBHRM_HR_MASTR C WHERE C.EMPNO = B.EMPNO) THEN B.ECNY_DE
						      ELSE #EXCCLC_YEAR# || '0101' END 
						 FROM TBHRM_HR_MASTR B
						 WHERE B.EMPNO = A.EMPNO)        /* 정산시작일자 */
						,#EXCCLC_YEAR# || '1231'         /* 정산종료일자 */
						,(SELECT DEPT_CODE FROM TBHRM_HR_MASTR WHERE EMPNO = A.EMPNO)                         /* 부서코드 */
						,(SELECT SFSAL_GETDEPTNM_01(DEPT_CODE) FROM TBHRM_HR_MASTR WHERE EMPNO = A.EMPNO)     /* 부서명 */
						,(SELECT PAY_CLSF_SE FROM TBHRM_HR_MASTR WHERE EMPNO = A.EMPNO)                       /* 직급코드 */
						,(SELECT SRCLS FROM TBHRM_HR_MASTR WHERE EMPNO = A.EMPNO)                             /* 호봉 */
						,(SELECT SFHRM_GET_OFCPSCD(EMPNO, JSSFC_SE, PAY_CLSF_SE, ECNY_DE) FROM TBHRM_HR_MASTR WHERE EMPNO = A.EMPNO)          /* 직위코드 */
						,''              /* 입사구분 */
						,(SELECT ECNY_DE FROM TBHRM_HR_MASTR WHERE EMPNO = A.EMPNO)             /* 입사일자 */
						,(SELECT RETIRE_DE FROM TBHRM_HR_MASTR WHERE EMPNO = A.EMPNO)           /* 퇴사일자 */
						,''         /* 장애자등급 */
						,(SELECT MERITER_GRAD FROM TBHRM_HR_ETC WHERE EMPNO = A.EMPNO)          /* 보훈등급 */
						,(SELECT JSSFC_SE FROM TBHRM_HR_MASTR WHERE EMPNO = A.EMPNO)            /* 사원구분 */
						
						,SUM(A.TOT_PYMNTAMT) - SUM(WAGE_PEAK) + (SELECT NVL(SUM(SALARY_TOTAMT),0)+NVL(SUM(BNS_TOTAMT),0) 
				                                FROM TBSAL_YND_EXCCLC_BEFORE_WORK
				                                WHERE EXCCLC_YEAR = #EXCCLC_YEAR# AND EMPNO = A.EMPNO) AS TOT_PYMNTAMT /* 연간근로소득 */
						,SUM(A.TAXXMPT_AMOUNT)  + (SELECT NVL(SUM(ALLWNC_AMOUNT), 0)
													FROM (
															SELECT EMPNO, PYMNT_YM, CASE WHEN SUM(ALLWNC_AMOUNT) > 100000 THEN 100000 ELSE SUM(ALLWNC_AMOUNT) END ALLWNC_AMOUNT
															FROM TBSAL_FAMILY_ALLWNC_MANAGE C1
															WHERE PYMNT_YM LIKE #EXCCLC_YEAR#||'%'
															AND FLOOR( MONTHS_BETWEEN( TO_DATE(#EXCCLC_YEAR#||'0101', 'YYYYMMDD'), TO_DATE( C1.BRTHDY, 'YYYYMMDD' ) )/12) <=  6
															GROUP BY EMPNO, PYMNT_YM
													)ST
													WHERE A.EMPNO = ST.EMPNO)
				                                + (SELECT NVL(SUM(TAXXMPT_OUTNATN_ERNM),0)+NVL(SUM(TAXXMPT_NIGHT_ERNM),0)+NVL(SUM(TAXXMPT_ETC_INCOME),0) 
				                                   FROM TBSAL_YND_EXCCLC_BEFORE_WORK
				                                   WHERE EXCCLC_YEAR = #EXCCLC_YEAR# AND EMPNO = A.EMPNO)
				                                 AS TAXXMPT_AMOUNT/* 비과세소득 (6세 이하 가족수항 포함) */
						,SUM(A.TAXT_AMOUNT) - SUM(WAGE_PEAK) - (SELECT NVL(SUM(ALLWNC_AMOUNT), 0)
												FROM (
														SELECT EMPNO, PYMNT_YM, CASE WHEN SUM(ALLWNC_AMOUNT) > 100000 THEN 100000 ELSE SUM(ALLWNC_AMOUNT) END ALLWNC_AMOUNT
														FROM TBSAL_FAMILY_ALLWNC_MANAGE C1
														WHERE PYMNT_YM LIKE #EXCCLC_YEAR#||'%'
														AND FLOOR( MONTHS_BETWEEN( TO_DATE(#EXCCLC_YEAR#||'0101', 'YYYYMMDD'), TO_DATE( C1.BRTHDY, 'YYYYMMDD' ) )/12) <=  6
														GROUP BY EMPNO, PYMNT_YM
												)ST
												WHERE A.EMPNO = ST.EMPNO)
											+  (SELECT NVL(SUM(SALARY_TOTAMT),0)+NVL(SUM(BNS_TOTAMT),0)- 
				                               (NVL(SUM(TAXXMPT_OUTNATN_ERNM),0)+NVL(SUM(TAXXMPT_NIGHT_ERNM),0)+NVL(SUM(TAXXMPT_ETC_INCOME),0)) 
				                                FROM TBSAL_YND_EXCCLC_BEFORE_WORK
				                                WHERE EXCCLC_YEAR = #EXCCLC_YEAR# AND EMPNO = A.EMPNO)
				                            	AS TAXT_AMOUNT  /* 총급여금액 (6세이하 가족수당 제외) */				
						,0                      /* 근로소득공제 */
						,0                      /* 근로소득금액 */						
						
						,NVL((SELECT DECODE(HUSEDR_RELATE,'본인','1','2')  FROM TBHRM_HR_ETC WHERE EMPNO = A.EMPNO),'2')            /* 세대주여부 */
						,(SELECT CASE COUNT(EMPNO) WHEN 1 THEN '1' ELSE '0' END FROM TBHRM_HR_FAMILY WHERE FAMILY_RELATE_SE IN ('005','006') AND EMPNO = A.EMPNO)            /* 배우자여부 */
						,0      /* 부녀자세대주 */
						,NVL((SELECT  COUNT(C1.EMPNO) FROM TBHRM_HR_FAMILY C1 WHERE  C1.EMPNO = A.EMPNO AND C1.SUPORT_AT = '1' AND FLOOR( MONTHS_BETWEEN( TO_DATE(#EXCCLC_YEAR#||'0101', 'YYYYMMDD'), TO_DATE( C1.BRTHDY, 'YYYYMMDD' ) )/12) <= 20 GROUP BY C1.EMPNO),0)      /* 부양자20세이하 */
						,NVL((SELECT  COUNT(C1.EMPNO) FROM TBHRM_HR_FAMILY C1 WHERE  C1.EMPNO = A.EMPNO AND C1.SUPORT_AT = '1' AND FLOOR( MONTHS_BETWEEN( TO_DATE(#EXCCLC_YEAR#||'0101', 'YYYYMMDD'), TO_DATE( C1.BRTHDY, 'YYYYMMDD' ) )/12) >= 60 GROUP BY C1.EMPNO),0)      /* 부양자60세이상 */
						,0      /* 경로우대65 */
						,NVL((SELECT  COUNT(C1.EMPNO) FROM TBHRM_HR_FAMILY C1 WHERE  C1.EMPNO = A.EMPNO AND C1.SUPORT_AT = '1' AND FLOOR( MONTHS_BETWEEN( TO_DATE(#EXCCLC_YEAR#||'0101', 'YYYYMMDD'), TO_DATE( C1.BRTHDY, 'YYYYMMDD' ) )/12) >= 70 GROUP BY C1.EMPNO),0)      /* 경로우대70 */
						,NVL((SELECT  COUNT(C1.EMPNO) FROM TBHRM_HR_FAMILY C1 WHERE  C1.EMPNO = A.EMPNO AND C1.SUPORT_AT = '1' AND C1.TROBL_AT = '1' GROUP BY C1.EMPNO),0)                  /* 장애인수 */
						,NVL((SELECT  COUNT(C1.EMPNO) FROM TBHRM_HR_FAMILY C1 WHERE  C1.EMPNO = A.EMPNO AND C1.SUPORT_AT = '1' AND FLOOR( MONTHS_BETWEEN( TO_DATE(#EXCCLC_YEAR#||'0101', 'YYYYMMDD'), TO_DATE( C1.BRTHDY, 'YYYYMMDD' ) )/12) <=  6 GROUP BY C1.EMPNO),0)       /* 자녀6세이하 */
						,NVL((SELECT  COUNT(C1.EMPNO) FROM TBHRM_HR_FAMILY C1 WHERE  C1.EMPNO = A.EMPNO AND C1.SUPORT_AT = '1' AND SUBSTR(C1.BRTHDY,1,4) = #EXCCLC_YEAR# GROUP BY C1.EMPNO),0)  /* 출산입양자녀 */
						,0             /* 다자녀 */
						,0             /* 한부모 */
						,(NVL((SELECT SUM(DDC_AMOUNT) FROM TBSAL_MT_DDC_DTLS WHERE PYMNT_DDC_CODE = 'S2120' AND EMPNO = A.EMPNO AND PYMNT_YM LIKE #EXCCLC_YEAR#||'%'),0) +
					     (SELECT NVL(SUM(NPN),0) 
					      FROM TBSAL_YND_EXCCLC_BEFORE_WORK
					      WHERE EXCCLC_YEAR = #EXCCLC_YEAR# AND EMPNO = A.EMPNO)) AS  NPN    /* 국민연금 */
					      
						,0        /* 개인연금저축이전 */
						,0        /* 개인연금저축이후 */
						,0        /* 연금저축공제금 */
						,(NVL((SELECT SUM(DDC_AMOUNT) FROM TBSAL_MT_DDC_DTLS WHERE PYMNT_DDC_CODE = 'S2110' AND EMPNO = A.EMPNO AND PYMNT_YM LIKE #EXCCLC_YEAR#||'%'),0)  +
					     (SELECT NVL(SUM(HLTHINS),0) 
					      FROM TBSAL_YND_EXCCLC_BEFORE_WORK
					      WHERE EXCCLC_YEAR = #EXCCLC_YEAR# AND EMPNO = A.EMPNO)) AS  HLTHINS         /* 건강보험 */
					      
						,(NVL((SELECT SUM(DDC_AMOUNT) FROM TBSAL_MT_DDC_DTLS WHERE PYMNT_DDC_CODE = 'S2150' AND EMPNO = A.EMPNO AND PYMNT_YM LIKE #EXCCLC_YEAR#||'%'),0)   +
					     (SELECT NVL(SUM(EMPLYMINSRNC),0) 
					      FROM TBSAL_YND_EXCCLC_BEFORE_WORK
					      WHERE EXCCLC_YEAR = #EXCCLC_YEAR# AND EMPNO = A.EMPNO)) AS  EMPLYMINSRNC          /* 고용보험 */
					      
						,0        /* 보장성보험 */
						,0        /* 장애인전용보험 */
						,0        /* 일반의료비 */
						,0        /* 본인경로장애의료 */
						,0        /* 근로소득3프로 */
						,0        /* 공제의료비 */
						,0        /* 본인교육비 */
						,0        /* 취학전교육비 */
						,0        /* 초중고교육비 */
						,0        /* 대학생교육비 */
						,0        /* 장애인교육비 */
						,0        /* 출자투자 */
						,0        /* 투자조합 */
						,0        /* 청약저축 */
						,0        /* 주택청약종합 */
						,0        /* 근로자주택마련 */
						,0        /* 목돈안드는전세이자 */
						,0        /* 원리금상환액금융 */
						,0        /* 주택임차이자상환 */
						,0        /* 월세액 */
						,0        /* 주택저당차입기관명 */
						,0        /* 주택저당차입일자 */
						,0        /* 주택저당차입이자14 */
						,0        /* 주택저당차입이자29 */
						,0        /* 주택저당차입이자30 */
						,0        /* 주택저당차입이자고정 */
						,0        /* 주택저당차입이자기타 */
						,0        /* 법정기부 */
						,0        /* 특례기부 */
						,0        /* 특례기부한도 */
						,0        /* 지정기부금액 */
						,0        /* 노동조합비 */
						,0        /* 지정기부한도전년 */
						,0        /* 종교기부금 */
						,0        /* 지정기부한도금년 */
						,0        /* 법정기부이월 */
						,0        /* 지정기부이월 */
						,0        /* 종교기부이월 */
						,0        /* 지정기부한도통합 */
						,0        /* 혼인이사장례비 */
						,0        /* 현장기술인력 */
						,0        /* 근속연수 */
						,0        /* 신용카드 */
						,0        /* 직불카드 */
						,0        /* 대중교통이용 */
						,0        /* 현금영수증 */
						,0        /* 전통시장사용 */
						,0        /* 근로소득25 */
						,0        /* 근로소득20 */
						,0        /* 신용카드공제 */
						,0        /* 국외근무지명 */
						,0        /* 국외근무직책 */
						,0        /* 국외근무기간 */
						,0        /* 국외근무총급여 */
						,0        /* 국외근무납세국명 */
						,0        /* 국외근무납세액원화 */
						,0        /* 국외근무납세액외화 */
						,0        /* 국외근무세액공제 */
						,0        /* 펀드1 */
						,0        /* 펀드2 */
						,0        /* 펀드3 */
						,0        /* 장기증권저축 */
						,0        /* 저축계 */
						,0        /* 정치자금기부 */
						,0        /* 주택이자상환금 */
						
						,0        /* 본인신용카드 */
						,0        /* 신용카드추가사용금액 */
						,0        /* 신용카드추가사용금액2 */
						,0        /* 소상공인공제부금 */
						,0        /* 투자조합2 */
						,0        /* 투자조합3 */
						,0        /* 퇴직연금 */
						
						,0        /* 원리금상환거주자 */
						
						,NVL((SELECT SUM(DDC_AMOUNT) FROM TBSAL_MT_DDC_DTLS WHERE PYMNT_DDC_CODE = 'S2010' AND EMPNO = A.EMPNO AND PYMNT_YM LIKE #EXCCLC_YEAR#||'%'),0)        /* 소득세 */ 
						,NVL((SELECT SUM(DDC_AMOUNT) FROM TBSAL_MT_DDC_DTLS WHERE PYMNT_DDC_CODE = 'S2020' AND EMPNO = A.EMPNO AND PYMNT_YM LIKE #EXCCLC_YEAR#||'%'),0)        /* 지방소득세 */
						
						,#S_USER_ID#     /* 등록자ID */
						,SYSDATE         /* 등록일시 */
						,#S_USER_ID#     /* 수정자ID */
						,SYSDATE         /* 수정일시 */
						,'0'			 /* 마감여부 */
              FROM TBSAL_MT_SALARY_PYMNT A
			  WHERE A.PYMNT_YM LIKE #EXCCLC_YEAR#||'%'
			  AND (SELECT NVL(SUM(TOT_PYMNTAMT),0) FROM TBSAL_MT_SALARY_PYMNT WHERE PYMNT_YM LIKE #EXCCLC_YEAR#||'%' AND EMPNO = A.EMPNO) > 0
		]]>
        <isEqual property="EXCCLC_SE" compareValue="1" >	  
			  AND A.EMPNO NOT IN (SELECT EMPNO FROM TBSAL_YND_EXCCLC_BSIS WHERE EXCCLC_YEAR = #EXCCLC_YEAR# AND EXCCLC_SE = '2')
		</isEqual>
		<isNotEmpty property="EMPNO">
			  AND A.EMPNO = #EMPNO#
		</isNotEmpty>  	  
			  GROUP BY A.EMPNO, A.EMPNM;
			  
			  
			  
			/* 기간제 급여 연말정산 생성 */
			<![CDATA[
            INSERT INTO TBSAL_YND_EXCCLC_BSIS (
                         EXCCLC_YEAR          /* 정산년도 */
						,EXCCLC_SE            /* 정산구분 */
						,EMPNO                /* 사번 */
						,EMPNM                /* 사원명 */
						,EXCCLC_BGNDE         /* 정산시작일자 */
						,EXCCLC_ENDDE         /* 정산종료일자 */
						,DEPT_CODE            /* 부서코드 */
						,DEPT_NM              /* 부서명 */
						,CLSF_CODE            /* 직급코드 */
						,SRCLS                /* 호봉 */
						,OFCPS_CODE           /* 직위코드 */
						,ECNY_SE              /* 입사구분 */
						,ECNY_DE              /* 입사일자 */
						,RETIRE_DE            /* 퇴사일자 */
						,DSPSN_GRAD           /* 장애자등급 */
						,RWDMRT_GRAD          /* 보훈등급 */
						,EMPL_SE              /* 사원구분 */
						
						,FYER_LABOR_INCOME    /* 연간근로소득 */
						,TAXXMPT_INCOME       /* 비과세소득 */
						,TOT_SALARY_AMOUNT    /* 총급여금액 */						
						,ERNM_DDC             /* 근로소득공제 */
						,ERNM_AMOUNT          /* 근로소득금액 */
						
						,HSHLDR_AT            /* 세대주여부 */
						,SPOUSE_AT            /* 배우자여부 */
						,LADY_HSHLDR          /* 부녀자세대주 */
						,SUPORTR_20           /* 부양자20세이하 */
						,SUPORTR_60           /* 부양자60세이상 */
						,COURS_PVLTRT_65      /* 경로우대65 */
						,COURS_PVLTRT_70      /* 경로우대70 */
						,DSPSN_CO             /* 장애인수 */
						,CHLDRN_6_BELOW       /* 자녀6세이하 */
						,CHLDBRTH_ADP_CHLDRN  /* 출산입양자녀 */
						,MNYCH                /* 다자녀 */
						,PARNTS_1             /* 한부모 */
						,NPN                  /* 국민연금 */
						,INDVDL_ANNTY_SVINGS_BEFORE   /* 개인연금저축이전 */
						,INDVDL_ANNTY_SVINGS_AFTER    /* 개인연금저축이후 */
						,ANNTY_SVINGS_DDC             /* 연금저축공제금 */
						,HLTHINS                      /* 건강보험 */
						,EMPLYMINSRNC                 /* 고용보험 */
						,GRNT_INSRNC                  /* 보장성보험 */
						,DSPSN_DVR_INSRNC             /* 장애인전용보험 */
						,GNRL_MCP                     /* 일반의료비 */
						,SELF_COURS_TROBL_MCP         /* 본인경로장애의료 */
						,ERNM_3                       /* 근로소득3프로 */
						,DDC_MCP                      /* 공제의료비 */
						,SELF_EDCCT                   /* 본인교육비 */
						,ESHL_BFE_EDCCT               /* 취학전교육비 */
						,GNRL_EDCCT                   /* 초중고교육비 */
						,UNIV_EDCCT                   /* 대학생교육비 */
						,DSPSN_EDCCT                  /* 장애인교육비 */
						,INVSTMNT_INVT                /* 출자투자 */
						,INVT_MXTR                    /* 투자조합 */
						,SUBSCRPT_SVINGS              /* 청약저축 */
						,HOUSE_SUBSCRPT_GNRLZ         /* 주택청약종합 */
						,LABRR_HOUSE_PREPRTN          /* 근로자주택마련 */
						,LFSTS_INTR                   /* 목돈안드는전세이자 */
						,PNINT_RPAY_FNNC              /* 원리금상환액금융 */
						,HOUSE_HIRE_INTR_RPAY         /* 주택임차이자상환 */
						,MTHT_AM                      /* 월세액 */
						,HOUSE_MRTG_BRRW_INSTT_NM     /* 주택저당차입기관명 */
						,HOUSE_MRTG_BRRW_DE           /* 주택저당차입일자 */
						,HOUSE_MRTG_BRRW_INTR_14      /* 주택저당차입이자14 */
						,HOUSE_MRTG_BRRW_INTR_29      /* 주택저당차입이자29 */
						,HOUSE_MRTG_BRRW_INTR_30      /* 주택저당차입이자30 */
						,HOUSE_MRTG_BRRW_INTR_FIXING  /* 주택저당차입이자고정 */
						,HOUSE_MRTG_BRRW_INTR_ETC     /* 주택저당차입이자기타 */
						,LEGAL_CNTR                   /* 법정기부 */
						,EXCPT_CNTR                   /* 특례기부 */
						,EXCPT_CNTR_LMT               /* 특례기부한도 */
						,APPN_CNTR                    /* 지정기부금액 */
						,LABOR_MXTR                   /* 노동조합비 */
						,APPN_CNTR_LMT_PRVYY          /* 지정기부한도전년 */
						,END_CNTR                     /* 종교기부금 */
						,APPN_TXCLCTPT_LMT_THSYR      /* 지정기부한도금년 */
						,LEGAL_CNTR_CYFD              /* 법정기부이월 */
						,APPN_CNTR_CYFD               /* 지정기부이월 */
						,RELGN_CNTR_CYFD              /* 종교기부이월 */
						,APPN_CNTR_LMT_UNITY          /* 지정기부한도통합 */
						,MRRG_HMV_FNRL                /* 혼인이사장례비 */
						,SPT_TCHNLGY_HNF              /* 현장기술인력 */
						,CNWK_SDYTRN                  /* 근속연수 */
						,CREDTCARD                    /* 신용카드 */
						,DBCD                         /* 직불카드 */
						,PBTRNSP_USE                  /* 대중교통이용 */
						,CASH_RCIPT                   /* 현금영수증 */
						,TRDIT_MRKT_USE               /* 전통시장사용 */
						,ERNM_25                      /* 근로소득25 */
						,ERNM_20                      /* 근로소득20 */
						,CREDTCARD_DDC                /* 신용카드공제 */
						,OUTNATN_WORK_NM              /* 국외근무지명 */
						,OUTNATN_WORK_RSPOFC          /* 국외근무직책 */
						,OUTNATN_WORK_PD              /* 국외근무기간 */
						,OUTNATN_WORK_TOT_SALARY      /* 국외근무총급여 */
						,OUTNATN_WORK_TAXPAY_YEAST    /* 국외근무납세국명 */
						,OUTNATN_WORK_TAXPAY_WON      /* 국외근무납세액원화 */
						,OUTNATN_WORK_TAXPAY_FGCRY    /* 국외근무납세액외화 */
						,OUTNATN_WORK_TAXAMT_DDC      /* 국외근무세액공제 */
						,FUND_1                       /* 펀드1 */
						,FUND_2                       /* 펀드2 */
						,FUND_3                       /* 펀드3 */
						,INORG_SCRITS_SVINGS          /* 장기증권저축 */
						,SVINGS_SM                    /* 저축계 */
						,POLITC_CPTAL_CNTR            /* 정치자금기부 */
						,HOUSE_INTR_RPAY_AMOUNT       /* 주택이자상환금 */
						
						,SELF_CREDTCARD               /* 본인신용카드 */
						,CREDTCARD_ADIT_USE_AMOUNT    /* 신용카드추가사용금액 */
						,CREDTCARD_ADIT_USE_AMOUNT_2  /* 신용카드추가사용금액2 */
						,SMALL_CRNTY_DDC              /* 소상공인공제부금 */
						,INVT_MXTR_2                  /* 투자조합2 */
						,INVT_MXTR_3                  /* 투자조합3 */
						,RETIRE_ANNTY                 /* 퇴직연금 */
						
						,PNINT_RPAY_RESIDNT           /* 원리금상환거주자 */
						,INCMTAX                      /* 소득세 */
						,LCLTY_INCMTAX                /* 지방소득세 */
						
						,REGISTER_ID    /* 등록자ID */
						,REGIST_DT      /* 등록일시 */
						,UPDUSR_ID      /* 수정자ID */
                        ,UPDT_DT        /* 수정일시 */
                        ,CLOS_AT        /* 마감여부 */						
             ) 
               SELECT 
                         #EXCCLC_YEAR#         /* 정산년도 */
						,#EXCCLC_SE#           /* 정산구분 */
						,A.EMPNO               /* 사번 */
						,A.EMPNM               /* 사원명 */
						,(SELECT CASE WHEN
						      #EXCCLC_YEAR# || '0101' < (SELECT C.ECNY_DE FROM TBHRM_HR_MASTR C WHERE C.EMPNO = B.EMPNO) THEN B.ECNY_DE
						      ELSE #EXCCLC_YEAR# || '0101' END 
						 FROM TBHRM_HR_MASTR B
						 WHERE B.EMPNO = A.EMPNO)        /* 정산시작일자 */
						,#EXCCLC_YEAR# || '1231'         /* 정산종료일자 */
						,(SELECT DEPT_CODE FROM TBHRM_HR_MASTR WHERE EMPNO = A.EMPNO)                         /* 부서코드 */
						,(SELECT SFSAL_GETDEPTNM_01(DEPT_CODE) FROM TBHRM_HR_MASTR WHERE EMPNO = A.EMPNO)     /* 부서명 */
						,(SELECT PAY_CLSF_SE FROM TBHRM_HR_MASTR WHERE EMPNO = A.EMPNO)                       /* 직급코드 */
						,(SELECT SRCLS FROM TBHRM_HR_MASTR WHERE EMPNO = A.EMPNO)                             /* 호봉 */
						,(SELECT SFHRM_GET_OFCPSCD(EMPNO, JSSFC_SE, PAY_CLSF_SE, ECNY_DE) FROM TBHRM_HR_MASTR WHERE EMPNO = A.EMPNO)          /* 직위코드 */
						,''              /* 입사구분 */
						,(SELECT ECNY_DE FROM TBHRM_HR_MASTR WHERE EMPNO = A.EMPNO)             /* 입사일자 */
						,(SELECT RETIRE_DE FROM TBHRM_HR_MASTR WHERE EMPNO = A.EMPNO)           /* 퇴사일자 */
						,''         /* 장애자등급 */
						,(SELECT MERITER_GRAD FROM TBHRM_HR_ETC WHERE EMPNO = A.EMPNO)          /* 보훈등급 */
						,(SELECT JSSFC_SE FROM TBHRM_HR_MASTR WHERE EMPNO = A.EMPNO)            /* 사원구분 */
						
						,NVL(SUM(PYMNT_SM_AMOUNT),0)
						 + (SELECT NVL(SUM(SALARY_TOTAMT),0)+NVL(SUM(BNS_TOTAMT),0) 
				                                FROM TBSAL_YND_EXCCLC_BEFORE_WORK
				                                WHERE EXCCLC_YEAR = #EXCCLC_YEAR# AND EMPNO = A.EMPNO) AS TOT_PYMNTAMT /* 연간근로소득 */
						,SUM(CASE WHEN PD_WORK_SALARY_TYPE = '1' THEN NVL(MLSV_SBSIDY, 0)
						          WHEN PD_WORK_SALARY_TYPE = '2' THEN CASE WHEN NVL(TAXXMPT_AMOUNT,0) > 100000 THEN 100000 ELSE NVL(TAXXMPT_AMOUNT,0) END
							      ELSE 0
							      END)
						 + (SELECT NVL(SUM(TAXXMPT_OUTNATN_ERNM),0)+NVL(SUM(TAXXMPT_NIGHT_ERNM),0)+NVL(SUM(TAXXMPT_ETC_INCOME),0) 
				                                   FROM TBSAL_YND_EXCCLC_BEFORE_WORK
				                                   WHERE EXCCLC_YEAR = #EXCCLC_YEAR# AND EMPNO = A.EMPNO) AS TAXXMPT_AMOUNT /* 비과세소득 */
						,SUM(CASE WHEN PD_WORK_SALARY_TYPE = '1' THEN NVL(PYMNT_SM_AMOUNT, 0) - NVL(MLSV_SBSIDY, 0)
						          WHEN PD_WORK_SALARY_TYPE = '2' THEN NVL(TAXT_AMOUNT,0) + CASE WHEN NVL(TAXXMPT_AMOUNT,0) > 100000 THEN NVL(TAXXMPT_AMOUNT,0) - 100000 ELSE 0 END
							      ELSE 0
							      END)
						 + (SELECT NVL(SUM(SALARY_TOTAMT),0)+NVL(SUM(BNS_TOTAMT),0)- 
				                               (NVL(SUM(TAXXMPT_OUTNATN_ERNM),0)+NVL(SUM(TAXXMPT_NIGHT_ERNM),0)+NVL(SUM(TAXXMPT_ETC_INCOME),0)) 
				                                FROM TBSAL_YND_EXCCLC_BEFORE_WORK
				                                WHERE EXCCLC_YEAR = #EXCCLC_YEAR# AND EMPNO = A.EMPNO) AS TAXT_AMOUNT /* 총급여금액 */				
						,0                      /* 근로소득공제 */
						,0                      /* 근로소득금액 */						
						
						,NVL((SELECT DECODE(HUSEDR_RELATE,'본인','1','2')  FROM TBHRM_HR_ETC WHERE EMPNO = A.EMPNO),'2')            /* 세대주여부 */
						,(SELECT CASE COUNT(EMPNO) WHEN 1 THEN '1' ELSE '0' END FROM TBHRM_HR_FAMILY WHERE FAMILY_RELATE_SE IN ('005','006') AND EMPNO = A.EMPNO)            /* 배우자여부 */
						,(SELECT CASE COUNT(B1.EMPNO) WHEN 1 THEN '1' ELSE '0' END
						    FROM TBHRM_HR_ETC B1
						        ,TBHRM_HR_MASTR B2
							WHERE B1.HUSEDR_RELATE ='본인'
							AND B1.EMPNO = A.EMPNO
							AND B1.EMPNO = B2.EMPNO  
							AND B2.SEXDSTN ='2'
							AND B1.EMPNO NOT IN
							            (SELECT B3.EMPNO 
							             FROM TBHRM_HR_FAMILY B3
							             WHERE B3.FAMILY_RELATE_SE IN ('005','006') AND B3.EMPNO = A.EMPNO))          /* 부녀자세대주 */
						,NVL((SELECT  COUNT(C1.EMPNO) FROM TBHRM_HR_FAMILY C1 WHERE  C1.EMPNO = A.EMPNO AND C1.SUPORT_AT = '1' AND FLOOR( MONTHS_BETWEEN( TO_DATE(#EXCCLC_YEAR#||'0101', 'YYYYMMDD'), TO_DATE( C1.BRTHDY, 'YYYYMMDD' ) )/12) <= 20 GROUP BY C1.EMPNO),0)      /* 부양자20세이하 */
						,NVL((SELECT  COUNT(C1.EMPNO) FROM TBHRM_HR_FAMILY C1 WHERE  C1.EMPNO = A.EMPNO AND C1.SUPORT_AT = '1' AND FLOOR( MONTHS_BETWEEN( TO_DATE(#EXCCLC_YEAR#||'0101', 'YYYYMMDD'), TO_DATE( C1.BRTHDY, 'YYYYMMDD' ) )/12) >= 60 GROUP BY C1.EMPNO),0)      /* 부양자60세이상 */
						,0      /* 경로우대65 */
						,NVL((SELECT  COUNT(C1.EMPNO) FROM TBHRM_HR_FAMILY C1 WHERE  C1.EMPNO = A.EMPNO AND C1.SUPORT_AT = '1' AND FLOOR( MONTHS_BETWEEN( TO_DATE(#EXCCLC_YEAR#||'0101', 'YYYYMMDD'), TO_DATE( C1.BRTHDY, 'YYYYMMDD' ) )/12) >= 70 GROUP BY C1.EMPNO),0)      /* 경로우대70 */
						,NVL((SELECT  COUNT(C1.EMPNO) FROM TBHRM_HR_FAMILY C1 WHERE  C1.EMPNO = A.EMPNO AND C1.SUPORT_AT = '1' AND C1.TROBL_AT = '1' GROUP BY C1.EMPNO),0)                  /* 장애인수 */
						,NVL((SELECT  COUNT(C1.EMPNO) FROM TBHRM_HR_FAMILY C1 WHERE  C1.EMPNO = A.EMPNO AND C1.SUPORT_AT = '1' AND FLOOR( MONTHS_BETWEEN( TO_DATE(#EXCCLC_YEAR#||'0101', 'YYYYMMDD'), TO_DATE( C1.BRTHDY, 'YYYYMMDD' ) )/12) <=  6 GROUP BY C1.EMPNO),0)       /* 자녀6세이하 */
						,NVL((SELECT  COUNT(C1.EMPNO) FROM TBHRM_HR_FAMILY C1 WHERE  C1.EMPNO = A.EMPNO AND C1.SUPORT_AT = '1' AND SUBSTR(C1.BRTHDY,1,4) = #EXCCLC_YEAR# GROUP BY C1.EMPNO),0)  /* 출산입양자녀 */
						,0             /* 다자녀 */
						,0             /* 한부모 */
						,NVL(SUM(NPN),0)
						 + (SELECT NVL(SUM(NPN),0) 
					      FROM TBSAL_YND_EXCCLC_BEFORE_WORK
					      WHERE EXCCLC_YEAR = #EXCCLC_YEAR# AND EMPNO = A.EMPNO) AS  NPN    /* 국민연금 */
					      
						,0        /* 개인연금저축이전 */
						,0        /* 개인연금저축이후 */
						,0        /* 연금저축공제금 */
						,NVL(SUM(HLTHINS),0)
						 + (SELECT NVL(SUM(HLTHINS),0) 
					      FROM TBSAL_YND_EXCCLC_BEFORE_WORK
					      WHERE EXCCLC_YEAR = #EXCCLC_YEAR# AND EMPNO = A.EMPNO) AS  HLTHINS         /* 건강보험 */
					      
						,NVL(SUM(EMPLYMINSRNC),0)
						 + (SELECT NVL(SUM(EMPLYMINSRNC),0) 
					      FROM TBSAL_YND_EXCCLC_BEFORE_WORK
					      WHERE EXCCLC_YEAR = #EXCCLC_YEAR# AND EMPNO = A.EMPNO) AS  EMPLYMINSRNC          /* 고용보험 */
					      
						,0        /* 보장성보험 */
						,0        /* 장애인전용보험 */
						,0        /* 일반의료비 */
						,0        /* 본인경로장애의료 */
						,0        /* 근로소득3프로 */
						,0        /* 공제의료비 */
						,0        /* 본인교육비 */
						,0        /* 취학전교육비 */
						,0        /* 초중고교육비 */
						,0        /* 대학생교육비 */
						,0        /* 장애인교육비 */
						,0        /* 출자투자 */
						,0        /* 투자조합 */
						,0        /* 청약저축 */
						,0        /* 주택청약종합 */
						,0        /* 근로자주택마련 */
						,0        /* 목돈안드는전세이자 */
						,0        /* 원리금상환액금융 */
						,0        /* 주택임차이자상환 */
						,0        /* 월세액 */
						,0        /* 주택저당차입기관명 */
						,0        /* 주택저당차입일자 */
						,0        /* 주택저당차입이자14 */
						,0        /* 주택저당차입이자29 */
						,0        /* 주택저당차입이자30 */
						,0        /* 주택저당차입이자고정 */
						,0        /* 주택저당차입이자기타 */
						,0        /* 법정기부 */
						,0        /* 특례기부 */
						,0        /* 특례기부한도 */
						,0        /* 지정기부금액 */
						,0        /* 노동조합비 */
						,0        /* 지정기부한도전년 */
						,0        /* 종교기부금 */
						,0        /* 지정기부한도금년 */
						,0        /* 법정기부이월 */
						,0        /* 지정기부이월 */
						,0        /* 종교기부이월 */
						,0        /* 지정기부한도통합 */
						,0        /* 혼인이사장례비 */
						,0        /* 현장기술인력 */
						,0        /* 근속연수 */
						,0        /* 신용카드 */
						,0        /* 직불카드 */
						,0        /* 대중교통이용 */
						,0        /* 현금영수증 */
						,0        /* 전통시장사용 */
						,0        /* 근로소득25 */
						,0        /* 근로소득20 */
						,0        /* 신용카드공제 */
						,0        /* 국외근무지명 */
						,0        /* 국외근무직책 */
						,0        /* 국외근무기간 */
						,0        /* 국외근무총급여 */
						,0        /* 국외근무납세국명 */
						,0        /* 국외근무납세액원화 */
						,0        /* 국외근무납세액외화 */
						,0        /* 국외근무세액공제 */
						,0        /* 펀드1 */
						,0        /* 펀드2 */
						,0        /* 펀드3 */
						,0        /* 장기증권저축 */
						,0        /* 저축계 */
						,0        /* 정치자금기부 */
						,0        /* 주택이자상환금 */
						
						,0        /* 본인신용카드 */
						,0        /* 신용카드추가사용금액 */
						,0        /* 신용카드추가사용금액2 */
						,0        /* 소상공인공제부금 */
						,0        /* 투자조합2 */
						,0        /* 투자조합3 */
						,0        /* 퇴직연금 */
						
						,0        /* 원리금상환거주자 */
						
						,NVL(SUM(INCMTAX),0)        /* 소득세 */ 
						,NVL(SUM(LCLTY_INCMTAX),0)        /* 지방소득세 */
						
						,#S_USER_ID#     /* 등록자ID */
						,SYSDATE         /* 등록일시 */
						,#S_USER_ID#     /* 수정자ID */
						,SYSDATE         /* 수정일시 */
						,'0'			 /* 마감여부 */
              FROM TBSAL_PD_WORK_SALARY A
			  WHERE A.PYMNT_YM LIKE #EXCCLC_YEAR#||'%'
		]]>
        <isEqual property="EXCCLC_SE" compareValue="1" >	  
			  AND A.EMPNO NOT IN (SELECT EMPNO FROM TBSAL_YND_EXCCLC_BSIS WHERE EXCCLC_YEAR = #EXCCLC_YEAR# AND EXCCLC_SE = '2')
		</isEqual>
		<isNotEmpty property="EMPNO">
			  AND A.EMPNO = #EMPNO#
		</isNotEmpty>  	  
			  GROUP BY A.EMPNO, A.EMPNM;
		END;
    </insert>
    
    
    <!-- 소득세율정보 수정 -->
    <update id="SAL050201DAO.YndExcclcCreatU" parameterClass="java.util.HashMap">
        <![CDATA[
            UPDATE TBSAL_YND_EXCCLC_BSIS A  SET
                 ERNM_DDC      = FLOOR((SELECT STD_AMOUNT +  ((A.TOT_SALARY_AMOUNT - ADSBTR_AMOUNT) * DDC_RT)/100
								        FROM TBSAL_LABOR_INCOME_DDC_RT
								        WHERE LWLT_AMOUNT <= A.TOT_SALARY_AMOUNT
								        AND UPLMT_AMOUNT >= A.TOT_SALARY_AMOUNT
								        AND APPLC_YEAR = #EXCCLC_YEAR#))
				,ERNM_AMOUNT   = (A.TOT_SALARY_AMOUNT - FLOOR((SELECT STD_AMOUNT +  ((A.TOT_SALARY_AMOUNT - ADSBTR_AMOUNT) * DDC_RT)/100
														       FROM TBSAL_LABOR_INCOME_DDC_RT
														       WHERE LWLT_AMOUNT <= A.TOT_SALARY_AMOUNT
														       AND UPLMT_AMOUNT >= A.TOT_SALARY_AMOUNT
														       AND APPLC_YEAR = #EXCCLC_YEAR#)))
            WHERE EXCCLC_YEAR = #EXCCLC_YEAR#
            AND EXCCLC_SE = #EXCCLC_SE#
        ]]>    
        	<isNotEmpty property="EMPNO">
			AND A.EMPNO = #EMPNO#
			</isNotEmpty>
    </update>
    
    
    <!-- 연말정산 노동조합비 기부금 입력 -->
    <insert id="SAL050201DAO.YndExcclcCtbnyC" parameterClass="java.util.HashMap">
        <![CDATA[
            INSERT INTO TBSAL_YND_EXCCLC_NTS (
                         SN
						,EXCCLC_YEAR
						,EXCCLC_SE
						,EMPNO
						,DTA_SE
						,FORMAT_CODE
						,IEM_CODE
						,IHIDNUM
						,NM
						,RELATE_SE
						,BIZRNO
						,MTLTY
						,DETAIL_KND
						,ESNTL_NO
						,GOODS_NM
						,STDR_DE
						,BEGIN_DE
						,END_DE
						,GNRL_2
						,TRDIT_MRKT_2
						,MASS_TRNSPORT_2
						,GNRL_1
						,TRDIT_MRKT_1
						,MASS_TRNSPORT_1
						,FRHFYR_CARD
						,SHYY_CARD
						,RPAY_PD
						,BRRW_AMOUNT
						,FIXING_BRRW_AMOUNT
						,NTHG_DFR_BRRW_AMOUNT
						,PRTINT_PRNCPAL_RPAY
						,PAY_AMOUNT
						,RM
						,REGISTER_ID
						,REGIST_DT
						,UPDUSR_ID
						,UPDT_DT
      ) 
			      SELECT
			             SQ_TBSAL_3.NEXTVAL
			            ,A.EXCCLC_YEAR
						,A.EXCCLC_SE
						,A.EMPNO
						,''
						,'L101Y'
						,'G0020'
						,''
						,A.EMPNM
						,'000'
						,'5048206254'
						,'화성도시공사 노동조합'
						,'040'
						,''
						,'노동조합비'
						,''
						,''
						,''
						,0
						,0
						,0
						,0
						,0
						,0
						,0
						,0
						,0
						,0
						,0
						,0
						,0
						,(SELECT SUM(DDC_AMOUNT) FROM TBSAL_MT_DDC_DTLS WHERE PYMNT_DDC_CODE = 'S2250' AND EMPNO = A.EMPNO AND PYMNT_YM LIKE #EXCCLC_YEAR#||'%'  )
						,''
						,#S_USER_ID#
			            ,SYSDATE
			            ,#S_USER_ID#               
			            ,SYSDATE             
			      FROM TBSAL_YND_EXCCLC_BSIS A
						WHERE A.EXCCLC_YEAR = #EXCCLC_YEAR#  
						AND A.EXCCLC_SE ='1'
						AND A.EMPNO IN (SELECT EMPNO 
						                FROM TBSAL_MT_DDC_DTLS 
						                WHERE PYMNT_DDC_CODE = 'S2250' AND EMPNO = A.EMPNO AND PYMNT_YM LIKE #EXCCLC_YEAR#||'%'   GROUP BY EMPNO)	
        ]]>
        <isNotEmpty property="EMPNO">
			  AND A.EMPNO = #EMPNO#
		</isNotEmpty>  	  
    </insert>
    
     <!-- 연말정산 인적공제 본인 입력 -->
    <insert id="SAL050201DAO.YndExcclcHnddcC" parameterClass="java.util.HashMap">
        <![CDATA[
            INSERT INTO TBSAL_YND_EXCCLC_HN_DDC (
                         EXCCLC_YEAR
						,EXCCLC_SE
						,EMPNO
						,FAMILY_NM
						,FAMILY_IHIDNUM_ENCPT
						,EMPNM
						,FAMILY_RELATE
						,DDC_AT
						,ISE_FRGNR_SE
						,TROBL_AT
						,BELOW_6_AT
						,LADY_AT
						,COURS_PVLTRT_AT
						,CHLDBRTH_ADP_AT
						,PARNTS_1_AT
						,EDCCT_SE_DTA
						,EDCCT_DTA
						,CTBNY_DTA
						,MCP_SE_DTA
						,MCP_DTA
						,CREDTCARD_DTA
						,DBCD_PRPAY_DTA
						,CASH_RCIPT_DTA
						,TRDIT_MRKT_DTA
						,PBTRNSP_TRNSPORT_USE_DTA
						,EDCCT_SE_ETC
						,EDCCT_ETC
						,CTBNY_ETC
						,MCP_SE_ETC
						,MCP_ETC
						,CREDTCARD_ETC
						,DBCD_PRPAY_ETC
						,TRDIT_MRKT_ETC
						,PBTRNSP_USE_ETC
						,GRNT_INSRNC
						,GRNT_INSRNC_ETC
						,DSPSN_INSRNC
						,DSPSN_INSRNC_ETC
                        ,REGISTER_ID
                        ,REGIST_DT
                        ,UPDUSR_ID
                        ,UPDT_DT
             ) 
             SELECT
	                     A.EXCCLC_YEAR
						,A.EXCCLC_SE
						,A.EMPNO
						,A.EMPNM
						,NVL(B.IHIDNUM_ENCPT,H_ENCRYPT('1501011000000'))
						,A.EMPNM
						,'000'
						,'1'
						,'1'
						,(SELECT  CASE COUNT(TROBL_GRAD_SE) WHEN 1 THEN '1' ELSE '0' END
			              FROM TBHRM_HR_ETC WHERE EMPNO = A.EMPNO
			              AND TROBL_GRAD_SE IS NOT NULL)
						,''
						,A.LADY_HSHLDR
						,''
						,''
						,A.PARNTS_1
						,''
						,0
						,0
						,''
						,0
						,0
						,0
						,0
						,0
						,0
						,0
						,0
						,0
						,''
						,0
						,0
						,0
						,0
						,0
						,0
						,0
						,0
						,0
	                    ,#S_USER_ID#     /* 등록자ID */
						,SYSDATE         /* 등록일시 */
						,#S_USER_ID#     /* 수정자ID */
						,SYSDATE         /* 수정일시 */
             FROM TBSAL_YND_EXCCLC_BSIS A
                 ,TBHRM_HR_MASTR B
             WHERE A.EXCCLC_YEAR = #EXCCLC_YEAR#  
			 AND A.EXCCLC_SE ='1'
			 AND A.EMPNO = B.EMPNO
			
        ]]>
        <isNotEmpty property="EMPNO">
			  AND A.EMPNO = #EMPNO#
		</isNotEmpty>  	  
    </insert> 
    
     <!-- 연말정산 인적공제 가족 입력 -->
    <insert id="SAL050201DAO.YndExcclcHnddc2C" parameterClass="java.util.HashMap">
        <![CDATA[
            INSERT INTO TBSAL_YND_EXCCLC_HN_DDC (
                         EXCCLC_YEAR
						,EXCCLC_SE
						,EMPNO
						,FAMILY_NM
						,FAMILY_IHIDNUM_ENCPT
						,EMPNM
						,FAMILY_RELATE
						,DDC_AT
						,ISE_FRGNR_SE
						,TROBL_AT
						,BELOW_6_AT
						,LADY_AT
						,COURS_PVLTRT_AT
						,CHLDBRTH_ADP_AT
						,PARNTS_1_AT
						,EDCCT_SE_DTA
						,EDCCT_DTA
						,CTBNY_DTA
						,MCP_SE_DTA
						,MCP_DTA
						,CREDTCARD_DTA
						,DBCD_PRPAY_DTA
						,CASH_RCIPT_DTA
						,TRDIT_MRKT_DTA
						,PBTRNSP_TRNSPORT_USE_DTA
						,EDCCT_SE_ETC
						,EDCCT_ETC
						,CTBNY_ETC
						,MCP_SE_ETC
						,MCP_ETC
						,CREDTCARD_ETC
						,DBCD_PRPAY_ETC
						,TRDIT_MRKT_ETC
						,PBTRNSP_USE_ETC
						,GRNT_INSRNC
						,GRNT_INSRNC_ETC
						,DSPSN_INSRNC
						,DSPSN_INSRNC_ETC
                        ,REGISTER_ID
                        ,REGIST_DT
                        ,UPDUSR_ID
                        ,UPDT_DT
             ) 
             SELECT
	                     A.EXCCLC_YEAR
						,A.EXCCLC_SE
						,A.EMPNO
						,B.FAMILY_NM
						,NVL(B.IHIDNUM_ENCPT,H_ENCRYPT('1501011000000'))
						,A.EMPNM
						,B.FAMILY_RELATE_SE
						,'1'
						,'1'
						,''
						,CASE WHEN FLOOR( MONTHS_BETWEEN( TO_DATE(#EXCCLC_YEAR#||'0101', 'YYYYMMDD')
                                                          , TO_DATE( CASE SUBSTR(SFCOM_DEC_ALL(B.IHIDNUM_ENCPT),7,1) WHEN '1' THEN '19' || SUBSTR(SFCOM_DEC_ALL(B.IHIDNUM_ENCPT),1,6) 
			                                                         WHEN '2' THEN '19' || SUBSTR(SFCOM_DEC_ALL(B.IHIDNUM_ENCPT),1,6)
			                                                         WHEN '3' THEN '20' || SUBSTR(SFCOM_DEC_ALL(B.IHIDNUM_ENCPT),1,6)
			                                                         WHEN '4' THEN '20' || SUBSTR(SFCOM_DEC_ALL(B.IHIDNUM_ENCPT),1,6) END
			                                                         , 'YYYYMMDD' ) )/12) <= 6 THEN '1' ELSE '' END BELOW_6_AT
						,''
						,CASE WHEN FLOOR( MONTHS_BETWEEN( TO_DATE(#EXCCLC_YEAR#||'0101', 'YYYYMMDD')
                                                          , TO_DATE( CASE SUBSTR(SFCOM_DEC_ALL(B.IHIDNUM_ENCPT),7,1) WHEN '1' THEN '19' || SUBSTR(SFCOM_DEC_ALL(B.IHIDNUM_ENCPT),1,6) 
			                                                         WHEN '2' THEN '19' || SUBSTR(SFCOM_DEC_ALL(B.IHIDNUM_ENCPT),1,6)
			                                                         WHEN '3' THEN '20' || SUBSTR(SFCOM_DEC_ALL(B.IHIDNUM_ENCPT),1,6)
			                                                         WHEN '4' THEN '20' || SUBSTR(SFCOM_DEC_ALL(B.IHIDNUM_ENCPT),1,6) END
			                                                         , 'YYYYMMDD' ) )/12) >= 70 THEN '1' ELSE '' END COURS_PVLTRT_AT
						,''
						,''
						,''
						,0
						,0
						,''
						,0
						,0
						,0
						,0
						,0
						,0
						,0
						,0
						,0
						,''
						,0
						,0
						,0
						,0
						,0
						,0
						,0
						,0
						,0
	                    ,#S_USER_ID#     /* 등록자ID */
						,SYSDATE         /* 등록일시 */
						,#S_USER_ID#     /* 수정자ID */
						,SYSDATE         /* 수정일시 */
             FROM TBSAL_YND_EXCCLC_BSIS A
                 ,TBHRM_HR_FAMILY B
             WHERE A.EXCCLC_YEAR = #EXCCLC_YEAR#  
			 AND A.EXCCLC_SE ='1'
			 AND B.SUPORT_AT = '1'
			 AND A.EMPNO = B.EMPNO
			
        ]]>
        <isNotEmpty property="EMPNO">
			  AND A.EMPNO = #EMPNO#
		</isNotEmpty>  	  
    </insert>    
    
    
     
    
      <!-- 연말정산 비과세 입력 -->
    <insert id="SAL050201DAO.YndExcclcTaxxC" parameterClass="java.util.HashMap">
        <![CDATA[
            INSERT INTO TBSAL_YND_EXCCLC_TAXXMPT_INCOM (
							 EXCCLC_YEAR
							,EXCCLC_SE
							,EMPNO
							,EMPNM
							,WORK_STTUS
							,EMPL_SE
							,CLSF_CODE
							,FAMILY_ALLWNC
							,MLSV_SBSIDY
							,JOB_PRTN_TRNSPORT
							,BNDT_CT
							,ETC_AMOUNT
							,SM_AMOUNT
							,REGISTER_ID
							,REGIST_DT
							,UPDUSR_ID
							,UPDT_DT
			)
			SELECT 
					        #EXCCLC_YEAR#		
					       ,#EXCCLC_SE# 	
					       ,B.EMPNO
					       ,B.EMPNM
					       ,'1'
					       ,B.EMPL_SE
					       ,B.CLSF_CODE
					       ,(SELECT NVL(SUM(ALLWNC_AMOUNT), 0)
							FROM (
									SELECT EMPNO, PYMNT_YM, CASE WHEN SUM(ALLWNC_AMOUNT) > 100000 THEN 100000 ELSE SUM(ALLWNC_AMOUNT) END ALLWNC_AMOUNT
									FROM TBSAL_FAMILY_ALLWNC_MANAGE C1
									WHERE PYMNT_YM LIKE #EXCCLC_YEAR#||'%'
									AND FLOOR( MONTHS_BETWEEN( TO_DATE(#EXCCLC_YEAR#||'0101', 'YYYYMMDD'), TO_DATE( C1.BRTHDY, 'YYYYMMDD' ) )/12) <=  6
									GROUP BY EMPNO, PYMNT_YM
							)ST
							WHERE B.EMPNO = ST.EMPNO)
					       ,NVL((SELECT SUM(A.PYMNT_AMOUNT) FROM TBSAL_MT_PYMNT_DTLS A WHERE A.PYMNT_YM LIKE #EXCCLC_YEAR#||'%' AND A.TAXT_AT = '1'
					             AND A.PYMNT_DDC_CODE = 'P1940'
					             AND A.EMPNO = B.EMPNO),0)
							+(SELECT SUM(CASE WHEN PD_WORK_SALARY_TYPE = '1' THEN NVL(MLSV_SBSIDY, 0)
						          WHEN PD_WORK_SALARY_TYPE = '2' THEN CASE WHEN NVL(TRAINING_COST,0) > 100000 THEN 100000 ELSE NVL(TRAINING_COST,0) END
							      ELSE 0
							      END)
							 FROM TBSAL_PD_WORK_SALARY A
		  					 WHERE A.PYMNT_YM LIKE #EXCCLC_YEAR#||'%') AS MLSV_SBSIDY
					       ,0
					       ,0
					       ,0
					       ,(SELECT NVL(SUM(ALLWNC_AMOUNT), 0)
							FROM (
									SELECT EMPNO, PYMNT_YM, CASE WHEN SUM(ALLWNC_AMOUNT) > 100000 THEN 100000 ELSE SUM(ALLWNC_AMOUNT) END ALLWNC_AMOUNT
									FROM TBSAL_FAMILY_ALLWNC_MANAGE C1
									WHERE PYMNT_YM LIKE #EXCCLC_YEAR#||'%'
									AND FLOOR( MONTHS_BETWEEN( TO_DATE(#EXCCLC_YEAR#||'0101', 'YYYYMMDD'), TO_DATE( C1.BRTHDY, 'YYYYMMDD' ) )/12) <=  6
									GROUP BY EMPNO, PYMNT_YM
							)ST
							WHERE B.EMPNO = ST.EMPNO)
							+NVL((SELECT SUM(A.PYMNT_AMOUNT) FROM TBSAL_MT_PYMNT_DTLS A WHERE A.PYMNT_YM LIKE #EXCCLC_YEAR#||'%' AND A.TAXT_AT = '1'
					              AND A.PYMNT_DDC_CODE = 'P1940'
					              AND A.EMPNO = B.EMPNO),0)
					        +(SELECT SUM(CASE WHEN PD_WORK_SALARY_TYPE = '1' THEN NVL(MLSV_SBSIDY, 0)
						          WHEN PD_WORK_SALARY_TYPE = '2' THEN CASE WHEN NVL(TRAINING_COST,0) > 100000 THEN 100000 ELSE NVL(TRAINING_COST,0) END
							      ELSE 0
							      END)
							 FROM TBSAL_PD_WORK_SALARY A
		  					 WHERE A.PYMNT_YM LIKE #EXCCLC_YEAR#||'%') AS  SM_AMOUNT
					        ,#S_USER_ID#     /* 등록자ID */
							,SYSDATE         /* 등록일시 */
							,#S_USER_ID#     /* 수정자ID */
							,SYSDATE         /* 수정일시 */
			FROM TBSAL_YND_EXCCLC_BSIS B
			WHERE B.EXCCLC_YEAR = #EXCCLC_YEAR#		
			AND B.EXCCLC_SE = #EXCCLC_SE# 
        ]]>
        <isNotEmpty property="EMPNO">
			  AND B.EMPNO = #EMPNO#
		</isNotEmpty>  	  
    </insert>                                                         


    <!-- 연말정산 노동조합비 기부금 정보 삭제 -->
    <delete id="SAL050201DAO.YndExcclcCtbnyD" parameterClass="java.util.HashMap">
        <![CDATA[
            DELETE FROM TBSAL_YND_EXCCLC_NTS
            WHERE EXCCLC_YEAR = #EXCCLC_YEAR#            
            AND EXCCLC_SE = #EXCCLC_SE#
        ]]>    
        <isNotEmpty property="EMPNO">
			AND EMPNO = #EMPNO#
		</isNotEmpty>            
    </delete>
    
    <!-- 연말정산 인적공제 정보 삭제 -->
    <delete id="SAL050201DAO.YndExcclcHnddcD" parameterClass="java.util.HashMap">
        <![CDATA[
            DELETE FROM TBSAL_YND_EXCCLC_HN_DDC
            WHERE EXCCLC_YEAR = #EXCCLC_YEAR#            
            AND EXCCLC_SE = #EXCCLC_SE#
        ]]>    
        <isNotEmpty property="EMPNO">
			AND EMPNO = #EMPNO#
		</isNotEmpty>            
    </delete>
    
    <!-- 연말정산 비과세 정보 삭제 -->
    <delete id="SAL050201DAO.YndExcclcTaxxD" parameterClass="java.util.HashMap">
        <![CDATA[
            DELETE FROM TBSAL_YND_EXCCLC_TAXXMPT_INCOM
            WHERE EXCCLC_YEAR = #EXCCLC_YEAR#            
            AND EXCCLC_SE = #EXCCLC_SE#
        ]]>    
        <isNotEmpty property="EMPNO">
			AND EMPNO = #EMPNO#
		</isNotEmpty>            
    </delete>
    
    
    <!-- 연말정산기본생성정보 삭제 -->
    <delete id="SAL050201DAO.YndExcclcCreatD" parameterClass="java.util.HashMap">
        <![CDATA[
            DELETE FROM TBSAL_YND_EXCCLC_BSIS
            WHERE EXCCLC_YEAR = #EXCCLC_YEAR#            
            AND EXCCLC_SE = #EXCCLC_SE#
        ]]>    
        <isNotEmpty property="EMPNO">
			AND EMPNO = #EMPNO#
		</isNotEmpty>            
    </delete> 
    
    <!-- 연말정산계산정보 삭제 -->
    <delete id="SAL050201DAO.YndExcclcCalD" parameterClass="java.util.HashMap">
        <![CDATA[
            DELETE FROM TBSAL_YND_EXCCLC_DETAIL
            WHERE EXCCLC_YEAR = #EXCCLC_YEAR#            
            AND EXCCLC_SE = #EXCCLC_SE#
        ]]>    
        <isNotEmpty property="EMPNO">
			AND EMPNO = #EMPNO#
		</isNotEmpty>            
    </delete>   
    
    <!-- 국세청자료정보 삭제 -->
    <delete id="SAL050201DAO.YndExcclcNtsD" parameterClass="java.util.HashMap">
        <![CDATA[
            DELETE FROM TBSAL_YND_EXCCLC_NTS
            WHERE EXCCLC_YEAR = #EXCCLC_YEAR#            
            AND EXCCLC_SE = #EXCCLC_SE#
        ]]>    
        <isNotEmpty property="EMPNO">
			AND EMPNO = #EMPNO#
		</isNotEmpty>            
    </delete>    
           
   

</sqlMap>