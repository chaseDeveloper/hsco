<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="HRM070109_SQL">
	<typeAlias alias="egovMap"          type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
   
    <!--근태현황_일반(부서별) 목록조회 -->
	<select id="HRM070109DAO.selectdeptDclzList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		<![CDATA[
			SELECT  DEPT_CODE               AS DEPT_CODE 
			       ,SFHRM_GET_DEPTNM(DEPT_CODE,'') AS DEPT_NM
			       ,SUM(TA2.SUM1)          AS SUM
			       ,SUM(TA2.WORK_SE_1)     AS WORK_SE_1         
			       ,SUM(TA2.WORK_SE_2)     AS WORK_SE_2
			       ,SUM(TA2.WORK_SE_3)     AS WORK_SE_3        
			       ,SUM(TA2.WORK_SE_4)     AS WORK_SE_4      
			       ,SUM(TA2.SUB_SUM_1)     AS SUB_SUM_1  
			       ,SUM(TA2.ATTEND_SE_1)   AS ATTEND_SE_1       
			       ,SUM(TA2.ATTEND_SE_2)   AS ATTEND_SE_2       
			       ,SUM(TA2.ATTEND_SE_3)   AS ATTEND_SE_3        
			       ,SUM(TA2.SUB_SUM_2)     AS SUB_SUM_2      
			       ,SUM(TA2.LVFFC_TM_SE_1) AS LVFFC_TM_SE_1       
			       ,SUM(TA2.LVFFC_TM_SE_2) AS LVFFC_TM_SE_2     
			       ,SUM(TA2.LVFFC_TM_SE_3) AS LVFFC_TM_SE_3      
			       ,SUM(TA2.SUB_SUM_3)     AS SUB_SUM_3      
			       ,SUM(TA2.DCLZ_SE_1)     AS DCLZ_SE_1      
			       ,SUM(TA2.DCLZ_SE_2)     AS DCLZ_SE_2      
			       ,SUM(TA2.DCLZ_SE_3)     AS DCLZ_SE_3      
			       ,SUM(TA2.DCLZ_SE_4)     AS DCLZ_SE_4      
			       ,SUM(TA2.DCLZ_SE_5)     AS DCLZ_SE_5      
			       ,SUM(TA2.DCLZ_SE_6)     AS DCLZ_SE_6 
			       ,SUM(TA2.DCLZ_SE_7)     AS DCLZ_SE_7      
			       ,SUM(TA2.DCLZ_SE_8)     AS DCLZ_SE_8      
			       ,SUM(TA2.DCLZ_SE_9)     AS DCLZ_SE_9      
			       ,SUM(TA2.DCLZ_SE_10)    AS DCLZ_SE_10       
			       ,SUM(TA2.DCLZ_SE_11)    AS DCLZ_SE_11 
			       ,SUM(TA2.DCLZ_SE_12)    AS DCLZ_SE_12  
			       ,SUM(TA2.DCLZ_SE_13)    AS DCLZ_SE_13  
			       ,SUM(TA2.DCLZ_SE_14)    AS DCLZ_SE_14  
			       ,SUM(TA2.DCLZ_SE_15)    AS DCLZ_SE_15  
			       ,SUM(TA2.DCLZ_SE_16)    AS DCLZ_SE_16  
			       ,SUM(TA2.DCLZ_SE_17)    AS DCLZ_SE_17  
			       ,SUM(TA2.DCLZ_SE_18)    AS DCLZ_SE_18  
			       ,SUM(TA2.DCLZ_SE_19)    AS DCLZ_SE_19  
			       ,SUM(TA2.BSRP_PURPS)    AS BSRP_PURPS  
			       ,SUM(TA2.EDC_NM)        AS EDC_NM  
		 	FROM 
			     (   
             		SELECT  
	                       EMPNO
	                      ,EMPNM
	                      ,(SELECT b.DEPT_CODE
	                          FROM TBHRM_HR_MASTR m		    
                                   ,(SELECT   
	                                       p.EMPNO                                        AS EMPNO
	                                       ,SFSAL_GETEMPNO_01(p.EMPNO) 					  AS EMPNM
	                                       ,p.DEPT_CODE                				      AS DEPT_CODE
	                                       ,SFHRM_GET_DEPTNM(p.DEPT_CODE,'')         	  AS DEPT_NM
	                                       ,p.JSSFC_SE           						  AS JSSFC_SE      
	                                       ,DECODE(p.CLSF_SE,'3A','03','3B','03',CLSF_SE) AS CLSF_SE
	                                       ,p.RSPOFC_SE  		       					  AS RSPOFC_SE
	                                       ,p.GNFD_DE							          AS GNFD_DE
	                                       ,p.GNFD_SE 									  AS GNFD_SE			            
                                      FROM TBHRM_GNFD p
                                     WHERE 1=1
                                       AND p.SEQ = ( SELECT MAX(p1.SEQ)
                                                       FROM TBHRM_GNFD p1
                                                      WHERE 1=1
                                                        AND p1.EMPNO = p.EMPNO
                                                        AND p1.GNFD_DE <= #STDR_END_DE#
                                                        AND p1.GNFD_SE < '100'	
                                                    )
                                       )b
                             WHERE 1=1
                               AND m.EMPNO = b.EMPNO
                               AND B.EMPNO = TA1.EMPNO) AS DEPT_CODE
                          ,COUNT(DECODE(FLXWK_AT,0,1)) + COUNT(DECODE(FLXWK_AT,1,1)) + COUNT(SPT_WORK) + COUNT(OPERTN_OFFIC_NM) + COUNT(EDC_NM_2)+ COUNT(BSRP_PURPS) + COUNT(EDC_NM) + COUNT(DCLZ_SE) 
                                                            AS SUM1
                          ,COUNT(DECODE(FLXWK_AT,0,1))      AS WORK_SE_1 /*정상근무*/
                          ,COUNT(DECODE(FLXWK_AT,1,1))      AS WORK_SE_2 /*현장근무*/
                          ,COUNT(SPT_WORK)                  AS WORK_SE_3 /*현장근무*/
                          ,COUNT(OPERTN_OFFIC_NM) + COUNT(EDC_NM_2) + COUNT(DECODE(DCLZ_SE,216,1)) 
                                                            AS WORK_SE_4 /*기타*/
                          ,COUNT(ATTEND_TM_RE)              AS SUB_SUM_1 /*출근소계*/
                          ,COUNT(DECODE(ATTEND_TM_RE,1,1))  AS ATTEND_SE_1 /*정상출근*/
                          ,COUNT(DECODE(ATTEND_TM_RE,3,1))  AS ATTEND_SE_2 /*출근미확인*/
                          ,COUNT(DECODE(ATTEND_TM_RE,2,1))  AS ATTEND_SE_3 /*출근미확인*/
                          ,COUNT(LVFFC_TM_RE)               AS SUB_SUM_2 /*퇴근소계*/
                          ,COUNT(DECODE(LVFFC_TM_RE,1,1))   AS LVFFC_TM_SE_1 /*정상퇴근*/
                          ,COUNT(DECODE(LVFFC_TM_RE,3,1))   AS LVFFC_TM_SE_2 /*퇴근미확인*/
                          ,COUNT(DECODE(LVFFC_TM_RE,2,1))   AS LVFFC_TM_SE_3 /*조기퇴근*/
                          ,COUNT(DCLZ_SE)                   AS SUB_SUM_3     /*근무상환소계*/
                          ,COUNT(DECODE(DCLZ_SE,201,1))     AS DCLZ_SE_1     /*연차*/
                          ,COUNT(DECODE(DCLZ_SE,206,1))     AS DCLZ_SE_2     /*공가*/
                          ,COUNT(DECODE(DCLZ_SE,203,1))     AS DCLZ_SE_3     /*병가*/
                          ,COUNT(DECODE(DCLZ_SE,212,1))     AS DCLZ_SE_4     /*포상*/
                          ,COUNT(DECODE(DCLZ_SE,208,1))     AS DCLZ_SE_5     /*안식*/
                          ,COUNT(DECODE(DCLZ_SE,215,1))     AS DCLZ_SE_6     /*대체*/
                          ,COUNT(DECODE(DCLZ_SE,216,1))     AS DCLZ_SE_7     /*휴직*/
                          ,COUNT(DECODE(DCLZ_SE,205,1))     AS DCLZ_SE_8     /*청원*/
                          ,COUNT(DECODE(DCLZ_SE,211,1))     AS DCLZ_SE_9     /*출산*/
                          ,COUNT(DECODE(DCLZ_SE,217,1))     AS DCLZ_SE_10    /*장기*/
                          ,COUNT(DECODE(DCLZ_SE,200,1))     AS DCLZ_SE_11    /*결근*/
                          ,COUNT(DECODE(DCLZ_SE,210,1))     AS DCLZ_SE_12    /*조퇴*/
                          ,COUNT(DECODE(DCLZ_SE,204,1))     AS DCLZ_SE_13  /*보건휴가*/
                          ,COUNT(DECODE(DCLZ_SE,207,1))     AS DCLZ_SE_14  /*관외출장일*/
                          ,COUNT(DECODE(DCLZ_SE,209,1))     AS DCLZ_SE_15  /*노조창립일*/
                          ,COUNT(DECODE(DCLZ_SE,214,1))     AS DCLZ_SE_16  /*휴가*/
                          ,COUNT(DECODE(DCLZ_SE,218,1))     AS DCLZ_SE_17  /*외출*/
                          ,COUNT(DECODE(DCLZ_SE,219,1))     AS DCLZ_SE_18  /*창사기념일대체휴가*/
                          ,COUNT(DECODE(DCLZ_SE,999,1))     AS DCLZ_SE_19  /*기타*/
                          ,COUNT(BSRP_PURPS)                AS BSRP_PURPS    /*출장*/
                          ,COUNT(EDC_NM)                    AS EDC_NM        /*교육*/
                    FROM (      
                           SELECT T1.MONTH_DAY           AS MONTH_DAY  /*근무일*/
                                 ,T1.EMPNO           AS EMPNO      /*사번*/ 
                                 ,T1.EMPNM           AS EMPNM      /*성명*/
                                 ,T2.ATTEND_TM       AS ATTEND_TM  /*출근시간*/
                                 ,T2.LVFFC_TM        AS LVFFC_TM /*퇴근시간*/
                                 ,T2.FLXWK_AT        AS FLXWK_AT/*유연근무여부*/
                                 ,T2.F_ATTEND_TM     AS F_ATTEND_TM /*유연근무출근시간*/
                                 ,T2.F_LVFFC_TM      AS F_LVFFC_TM /*유연근무퇴근시간*/
                                 ,T2.ATTEND_TM_RE    AS ATTEND_TM_RE /*출근결과*/
                                 ,T2.LVFFC_TM_RE     AS LVFFC_TM_RE /*퇴근결과*/
                                 ,T3.DCLZ_DAYCNT     AS DCLZ_DAYCNT   
                                 ,T3.DCLZ_SE         AS DCLZ_SE /*근태정보*/
                                 ,T4.OPERTN_OFFIC_NM AS OPERTN_OFFIC_NM /*해외연수 명*/
                                 ,DECODE((SELECT COUNT(1) 
                                            FROM TBHRM_BSRP_DTLS 
                                           WHERE TO_CHAR(T1.MONTH_DAY,'YYYYMMDD') BETWEEN BGNDE AND ENDDE
                                             AND EMPNO   = T1.EMPNO
                                             AND BSRP_SE = '0'),0,'','출장') AS BSRP_PURPS  /*출장여부*/
                                 ,DECODE((SELECT COUNT(1) 
                                            FROM TBHRM_EDC_TRAING_REQST 
                                           WHERE TO_CHAR(T1.MONTH_DAY,'YYYYMMDD') BETWEEN BGNDE AND ENDDE       
                                             AND EMPNO     = T1.EMPNO
                                             AND EDC_SE IN ('001','002')
                                             AND CONFM_DE IS NOT NULL),0,'','교육') AS EDC_NM /*교육여부*/
                                 ,DECODE((SELECT COUNT(1) 
                                            FROM TBHRM_SPT_WORK 
                                           WHERE TO_CHAR(T1.MONTH_DAY,'YYYYMMDD') BETWEEN BGNDE AND ENDDE
                                             AND EMPNO = T1.EMPNO),0,'','현장') AS SPT_WORK  /*현장근무여부*/
                                 ,DECODE((SELECT COUNT(1) 
                                            FROM TBHRM_EDC_TRAING_REQST
                                           WHERE TO_CHAR(T1.MONTH_DAY,'YYYYMMDD') BETWEEN BGNDE AND ENDDE
                                             AND EMPNO     = T1.EMPNO
                                             AND EDC_SE = '003'
                                             AND CONFM_DE IS NOT NULL),0,'','교육기타') AS EDC_NM_2 /*교육 003 */
                              FROM(
                                   SELECT A.MONTH_DAY, B.EMPNO, B.EMPNM
                                     FROM(SELECT MONTH_DAY
                                            FROM(SELECT TO_DATE(#STDR_BGN_DE#, 'YYYYMMDD') + LEVEL - 1 AS MONTH_DAY
                                                   FROM DUAL
                                             CONNECT BY LEVEL <= TO_DATE(#STDR_END_DE#, 'YYYYMMDD') - TO_DATE(#STDR_BGN_DE#, 'YYYYMMDD') + 1
                                                 ) T1 
                                            WHERE NOT EXISTS (SELECT 1
				                                                FROM TBHRM_HVOF_INFO
				                                               WHERE 1      =1
				                                                 AND HVOF_DE  = TO_CHAR(T1.MONTH_DAY, 'YYYYMMDD')
				                                                 AND HVOF_DE <= #STDR_END_DE#
				                                                 AND HVOF_DE >= #STDR_BGN_DE#
                                                             )
                                                  )A 
                                                  ,TBHRM_HR_MASTR B
                                            WHERE B.EMPNO IN (SELECT  
                                                                    p.EMPNO     AS EMPNO               
                                                                FROM TBHRM_GNFD p
                                                               WHERE 1=1
                                                                 AND p.SEQ = ( SELECT MAX(p1.SEQ)
                                                                                 FROM TBHRM_GNFD p1
                                                                                WHERE 1=1
                                                                                  AND p1.EMPNO = p.EMPNO                      
                                                                                  AND p1.GNFD_DE <= #STDR_END_DE# 
                                                                                  AND p1.GNFD_SE < '100' 
																			                           )
																		            )
                                                                 AND B.STTUS_SE NOT IN ('009')
                                                   				)T1 
                                     LEFT OUTER JOIN( SELECT  A.EMPNO ,
		                                                    A.EMPNM ,
		                                                    B.MONTH_DAY AS MONTH_DAY ,
		                                                    B.ATTEND_TM ,
		                                                    B.LVFFC_TM ,
		                                                    B.FLXWK_AT ,
		                                                    B.F_ATTEND_TM ,
		                                                    B.F_LVFFC_TM ,
		                                                    DECODE(B.FLXWK_AT,1, CASE WHEN B.ATTEND_TM <= F_ATTEND_TM THEN 1
		                                                                              WHEN B.ATTEND_TM > F_ATTEND_TM THEN 2
		                                                                              ELSE 3 END ,
		                                                                         CASE WHEN REPLACE(B.ATTEND_TM,':','') <= 0900 THEN 1
		                                                                              WHEN REPLACE(B.ATTEND_TM,':','') > 0900 THEN 2
		                                                                             ELSE 3 END) AS ATTEND_TM_RE ,
		                                                    DECODE(B.FLXWK_AT,1, CASE WHEN B.LVFFC_TM >= F_LVFFC_TM THEN 1
		                                                                              WHEN B.LVFFC_TM < F_LVFFC_TM THEN 2
		                                                                              ELSE 3 END ,
		                                                    CASE WHEN REPLACE(B.LVFFC_TM,':','') > 1800 THEN 1
		                                                         WHEN REPLACE(B.LVFFC_TM,':','') <= 1800 THEN 2
		                                                         ELSE 3 END) AS LVFFC_TM_RE
		                                               FROM TBHRM_HR_MASTR A
		                                         INNER JOIN
		                                                    ( 
		                                                      SELECT
		                                                            TO_DATE(DECODE(B2.WORK_DE, NULL,A2.STDR_DE, B2.WORK_DE ),'YYYYMMDD') AS MONTH_DAY,
		                                                            A2.EMPNO           AS EMPNO ,
		                                                            A2.ATTEND_TM       AS ATTEND_TM ,
		                                                            A2.LVFFC_TM        AS LVFFC_TM ,
		                                                            B2.WORK_DE ,
		                                                            DECODE(B2.WORK_DE, NULL, 0 ,1) AS FLXWK_AT ,
		                                                            B2.ATTEND_TM                   AS F_ATTEND_TM ,
		                                                            B2.LVFFC_TM                    AS F_LVFFC_TM        
		                                                        FROM (SELECT EMPNO, ATTEND_TM, LVFFC_TM,TO_CHAR(STDR_DE,'YYYYMMDD') AS STDR_DE FROM TBHRM_CMG_INFO WHERE STDR_DE BETWEEN TO_DATE(#STDR_BGN_DE#, 'YYYYMMDD') AND TO_DATE(#STDR_END_DE#, 'YYYYMMDD')) A2
		                                                        LEFT OUTER JOIN (SELECT EMPNO,WORK_DE, ATTEND_TM, LVFFC_TM FROM TBHRM_FLXWK_DTLS WHERE WORK_DE BETWEEN #STDR_BGN_DE# AND #STDR_END_DE#) B2
		                                                        ON A2.EMPNO = B2.EMPNO
		                                                        AND A2.STDR_DE = B2.WORK_DE
		                                                        WHERE 1 = 1
		                                                        AND A2.EMPNO IN (
                                                                            SELECT   p.EMPNO     AS EMPNO               
                                                                             FROM TBHRM_GNFD p
                                                                             WHERE 1=1
                                                                                AND p.SEQ = ( SELECT MAX(p1.SEQ)
                                                                                                FROM TBHRM_GNFD p1
                                                                                                WHERE 1=1
                                                                                                AND p1.EMPNO = p.EMPNO                      
                                                                                                AND p1.GNFD_DE <= #STDR_END_DE# 
                                                                                                AND p1.GNFD_SE < '100' 
											                                                                                           	     )
										                                                                               )
					                                                     )B ON A.EMPNO     = B.EMPNO      
                                                     ) T2 
                                         ON T1.EMPNO = T2.EMPNO
                                        AND T1.MONTH_DAY = T2.MONTH_DAY
                                    LEFT OUTER JOIN 
                                                   (
                                                    SELECT A.MONTH_DAY ,
                                                           B.DCLZ_SE ,
                                                           B.WORK_DAYCNT AS DCLZ_DAYCNT,
                                                           B.EMPNO
                                                      FROM (  SELECT TO_DATE(#STDR_BGN_DE#, 'YYYYMMDD') + LEVEL - 1 AS MONTH_DAY
                                                               FROM DUAL
                                                             CONNECT BY LEVEL <= TO_DATE(#STDR_END_DE#, 'YYYYMMDD') - TO_DATE(#STDR_BGN_DE#, 'YYYYMMDD') + 1
                                                             ) A
                                                INNER JOIN TBHRM_WRKCP B
										                ON A.MONTH_DAY BETWEEN B.BGNDT AND B.ENDDT
										                AND B.CANCEL_SE IS NULL
														AND SFCOM_GET_APPRSTS(B.SANCTN_NO,B.REGIST_DT)   = '256'
                                                     WHERE EMPNO IN (
                                                                            SELECT   p.EMPNO     AS EMPNO               
                                                                             FROM TBHRM_GNFD p
                                                                             WHERE 1=1
                                                                                AND p.SEQ = ( SELECT MAX(p1.SEQ)
                                                                                                FROM TBHRM_GNFD p1
                                                                                                WHERE 1=1
                                                                                                AND p1.EMPNO = p.EMPNO                      
                                                                                                AND p1.GNFD_DE <= #STDR_END_DE# 
                                                                                                AND p1.GNFD_SE < '100' 
																								                                                                                                )
																								                                                                               )
                                   )T3
                              ON T1.EMPNO = T3.EMPNO
                              AND T1.MONTH_DAY = T3.MONTH_DAY
                  LEFT OUTER JOIN 
                                 (
                              SELECT A.MONTH_DAY ,
                                    B.OPERTN_OFFIC_NM ,
                                    B.EMPNO
                                FROM
                                    (SELECT TO_DATE(#STDR_BGN_DE#, 'YYYYMMDD') + LEVEL - 1 AS MONTH_DAY
                                       FROM DUAL
                                       CONNECT BY LEVEL <= TO_DATE(#STDR_END_DE#, 'YYYYMMDD') - TO_DATE(#STDR_BGN_DE#, 'YYYYMMDD') + 1
                                    ) A
                          INNER JOIN TBHRM_HR_FRNTN_INSPN_SDYTRN B
                                  ON A.MONTH_DAY BETWEEN B.BGNDE AND B.ENDDE
                             )T4 
                             ON T1.EMPNO = T4.EMPNO
                             AND T1.MONTH_DAY =T4.MONTH_DAY
                             ORDER BY T1.EMPNO, T1.MONTH_DAY
                      )TA1 
                      GROUP BY EMPNO, EMPNM
        )TA2
        WHERE 1=1 
		]]>
		<isNotEmpty property="DEPT_CODE">
		AND DEPT_CODE = #DEPT_CODE#
		</isNotEmpty>
		<![CDATA[
        GROUP BY DEPT_CODE
        ORDER BY DEPT_CODE
        ]]>
    </select>
    
     <!--근태현황_일반(사원별) 목록조회 -->
	<select id="HRM070109DAO.selectEmpDclzList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		<![CDATA[  
			SELECT  
					 EMPNO
					,EMPNM
					,SFHRM_GET_DEPTNM(#DEPT_CODE#,'') AS DEPT_NM
			        ,COUNT(DECODE(FLXWK_AT,0,1)) + COUNT(DECODE(FLXWK_AT,1,1)) + COUNT(SPT_WORK) + COUNT(OPERTN_OFFIC_NM) + COUNT(EDC_NM_2)+ COUNT(BSRP_PURPS) + COUNT(EDC_NM) + COUNT(DCLZ_SE)
			                                                  AS SUM /*계*/
			        ,COUNT(DECODE(FLXWK_AT,0,1))     AS WORK_SE_1       /*"정상근무"*/
			        ,COUNT(DECODE(FLXWK_AT,1,1))     AS WORK_SE_2       /*"유연근무"*/
			        ,COUNT(SPT_WORK)                 AS WORK_SE_3       /*"현장근무"*/
			        ,COUNT(OPERTN_OFFIC_NM) + COUNT(EDC_NM_2) + COUNT(DECODE(DCLZ_SE,216,1)) AS WORK_SE_4 /*기타*/
			        ,COUNT(ATTEND_TM_RE)             AS SUB_SUM_1       /*출근소계*/
			        ,COUNT(DECODE(ATTEND_TM_RE,1,1)) AS ATTEND_SE_1 /*정상출근*/
			        ,COUNT(DECODE(ATTEND_TM_RE,3,1)) AS ATTEND_SE_2 /*출근미확인*/
			        ,COUNT(DECODE(ATTEND_TM_RE,2,1)) AS ATTEND_SE_3 /*지각*/
			        ,COUNT(LVFFC_TM_RE)              AS SUB_SUM_2   /*퇴근소계*/
			        ,COUNT(DECODE(LVFFC_TM_RE,1,1))  AS LVFFC_SE_1 /*정상퇴근*/
			        ,COUNT(DECODE(LVFFC_TM_RE,3,1))  AS LVFFC_SE_2 /*퇴근미확*/
			        ,COUNT(DECODE(LVFFC_TM_RE,2,1))  AS LVFFC_SE_3 /*조기퇴근*/
			        ,COUNT(DCLZ_SE)                  AS SUB_SUM_3  /*근무상황 소계 */
                    ,COUNT(DECODE(DCLZ_SE,201,1))    AS DCLZ_SE_1   /*연차*/
			        ,COUNT(DECODE(DCLZ_SE,206,1))    AS DCLZ_SE_2   /*공가*/
			        ,COUNT(DECODE(DCLZ_SE,203,1))    AS DCLZ_SE_3   /*병가*/
			        ,COUNT(DECODE(DCLZ_SE,212,1))    AS DCLZ_SE_4   /*포상*/
			        ,COUNT(DECODE(DCLZ_SE,208,1))    AS DCLZ_SE_5   /*안식*/
			        ,COUNT(DECODE(DCLZ_SE,215,1))    AS DCLZ_SE_6   /*대체*/
			        ,COUNT(DECODE(DCLZ_SE,216,1))    AS DCLZ_SE_7   /*휴직*/
			        ,COUNT(DECODE(DCLZ_SE,205,1))    AS DCLZ_SE_8   /*청원*/
			        ,COUNT(DECODE(DCLZ_SE,211,1))    AS DCLZ_SE_9   /*출산*/
			        ,COUNT(DECODE(DCLZ_SE,217,1))    AS DCLZ_SE_10   /*장기*/
			        ,COUNT(DECODE(DCLZ_SE,200,1))    AS DCLZ_SE_11   /*결근*/
			        ,COUNT(DECODE(DCLZ_SE,210,1))    AS DCLZ_SE_12  /*조퇴*/
			        ,COUNT(DECODE(DCLZ_SE,204,1))    AS DCLZ_SE_13  /*보건휴가*/
			        ,COUNT(DECODE(DCLZ_SE,207,1))    AS DCLZ_SE_14  /*관외출장일*/
			        ,COUNT(DECODE(DCLZ_SE,209,1))    AS DCLZ_SE_15  /*노조창립일*/
			        ,COUNT(DECODE(DCLZ_SE,214,1))    AS DCLZ_SE_16  /*휴가*/
			        ,COUNT(DECODE(DCLZ_SE,218,1))    AS DCLZ_SE_17  /*외출*/
			        ,COUNT(DECODE(DCLZ_SE,219,1))    AS DCLZ_SE_18  /*창사기념일대체휴가*/
			        ,COUNT(DECODE(DCLZ_SE,999,1))    AS DCLZ_SE_19  /*기타*/
			        ,COUNT(BSRP_PURPS)               AS BSRP_PURPS /*출장*/
			        ,COUNT(EDC_NM)                   AS EDC_NM /*교육*/
  			FROM  (       
  			       SELECT T1.MONTH_DAY       AS MONTH_DAY        /*근무일*/
                         ,T1.EMPNO           AS EMPNO            /*사번*/ 
                         ,T1.EMPNM           AS EMPNM            /*성명*/
                         ,T2.ATTEND_TM       AS ATTEND_TM        /*출근시간*/
                         ,T2.LVFFC_TM        AS LVFFC_TM         /*퇴근시간*/
                         ,T2.FLXWK_AT        AS FLXWK_AT         /*유연근무여부*/
                         ,T2.F_ATTEND_TM     AS F_ATTEND_TM      /*유연근무출근시간*/
                         ,T2.F_LVFFC_TM      AS F_LVFFC_TM       /*유연근무퇴근시간*/
                         ,T2.ATTEND_TM_RE    AS ATTEND_TM_RE     /*출근결과*/
                         ,T2.LVFFC_TM_RE     AS LVFFC_TM_RE      /*퇴근결과*/
                         ,T3.DCLZ_DAYCNT     AS DCLZ_DAYCNT   
                         ,T3.DCLZ_SE         AS DCLZ_SE          /*근태정보*/
                         ,T4.OPERTN_OFFIC_NM AS OPERTN_OFFIC_NM  /*해외연수 명*/
                         ,DECODE((SELECT COUNT(1) 
                                    FROM TBHRM_BSRP_DTLS 
                                   WHERE TO_CHAR(T1.MONTH_DAY,'YYYYMMDD') BETWEEN BGNDE AND ENDDE
                                     AND EMPNO   = T1.EMPNO
                                     AND BSRP_SE = '0'),0,'','출장') AS BSRP_PURPS  /*출장여부*/
                         ,DECODE((SELECT COUNT(1) 
                                    FROM TBHRM_EDC_TRAING_REQST 
                                   WHERE TO_CHAR(T1.MONTH_DAY,'YYYYMMDD') BETWEEN BGNDE AND ENDDE       
                                     AND EMPNO     = T1.EMPNO
                                     AND EDC_SE IN ('001','002')
                                     AND CONFM_DE IS NOT NULL),0,'','교육') AS EDC_NM /*교육여부*/
                         ,DECODE((SELECT COUNT(1) 
                                    FROM TBHRM_SPT_WORK 
                                   WHERE TO_CHAR(T1.MONTH_DAY,'YYYYMMDD') BETWEEN BGNDE AND ENDDE
                                     AND EMPNO = T1.EMPNO),0,'','현장') AS SPT_WORK  /*현장근무여부*/
                         ,DECODE((SELECT COUNT(1) 
                                    FROM TBHRM_EDC_TRAING_REQST
                                   WHERE TO_CHAR(T1.MONTH_DAY,'YYYYMMDD') BETWEEN BGNDE AND ENDDE
                                     AND EMPNO     = T1.EMPNO
                                     AND EDC_SE = '003'
                                     AND CONFM_DE IS NOT NULL),0,'','교육기타') AS EDC_NM_2 /*교육 003 */
                      FROM(
		                     SELECT A.MONTH_DAY, B.EMPNO, B.EMPNM
		                       FROM
		                       		(SELECT MONTH_DAY
		                               FROM
		                                   (SELECT TO_DATE(#STDR_BGN_DE#, 'YYYYMMDD') + LEVEL - 1 AS MONTH_DAY
		                                     FROM DUAL
		                               CONNECT BY LEVEL <= TO_DATE(#STDR_END_DE#, 'YYYYMMDD') - TO_DATE(#STDR_BGN_DE#, 'YYYYMMDD') + 1
		                                    ) T1 
		                           WHERE NOT EXISTS
		                                   (SELECT 1
		                                    FROM TBHRM_HVOF_INFO
		                                    WHERE 1      =1
		                                    AND HVOF_DE  = TO_CHAR(T1.MONTH_DAY, 'YYYYMMDD')
		                                    AND HVOF_DE <= #STDR_END_DE#
		                                    AND HVOF_DE >= #STDR_BGN_DE#
		                                    )
		                             )A 
		                             ,(Select * From TBHRM_HR_MASTR Where STTUS_SE != '009') B
		                       WHERE B.EMPNO IN (
		                                          SELECT   p.EMPNO     AS EMPNO               
                                                    FROM TBHRM_GNFD p
                                                   WHERE 1=1
                                                     AND p.SEQ = ( SELECT MAX(p1.SEQ)
                                                                     FROM TBHRM_GNFD p1
                                                                    WHERE 1=1
                                                                      AND p1.EMPNO = p.EMPNO                      
                                                                      AND p1.GNFD_DE <= #STDR_END_DE# 
                                                                      AND p1.GNFD_SE < '100' 
                                                                      AND p.DEPT_CODE = #DEPT_CODE#
                                                                  )
                                                  )
		          		    )T1 
    	   LEFT OUTER JOIN(   SELECT  
    	                             A.EMPNO ,
                                     A.EMPNM ,
                                     B.MONTH_DAY AS MONTH_DAY ,
                                     B.ATTEND_TM ,
                                     B.LVFFC_TM ,
                                     B.FLXWK_AT ,
                                     B.F_ATTEND_TM ,
                                     B.F_LVFFC_TM ,
                                     DECODE(B.FLXWK_AT,1, CASE WHEN B.ATTEND_TM <= F_ATTEND_TM THEN 1
                                                               WHEN B.ATTEND_TM > F_ATTEND_TM THEN 2
                                                               ELSE 3 END ,
                                                          CASE WHEN REPLACE(B.ATTEND_TM,':','') <= 0900 THEN 1
                                                               WHEN REPLACE(B.ATTEND_TM,':','') > 0900 THEN 2
                                                               ELSE 3 END) AS ATTEND_TM_RE ,
                                     DECODE(B.FLXWK_AT,1, CASE WHEN B.LVFFC_TM >= F_LVFFC_TM THEN 1
                                                               WHEN B.LVFFC_TM < F_LVFFC_TM THEN 2
                                                               ELSE 3 END ,
                                     CASE WHEN REPLACE(B.LVFFC_TM,':','') > 1800 THEN 1
                                          WHEN REPLACE(B.LVFFC_TM,':','') <= 1800 THEN 2
                                          ELSE 3 END) AS LVFFC_TM_RE
                                FROM (Select * From TBHRM_HR_MASTR Where STTUS_SE != '009') A
                          INNER JOIN  ( 
                                       SELECT
                                              TO_DATE(DECODE(B2.WORK_DE, NULL,A2.STDR_DE, B2.WORK_DE ),'YYYYMMDD') AS MONTH_DAY,
                                              A2.EMPNO           AS EMPNO ,
                                              A2.ATTEND_TM       AS ATTEND_TM ,
                                              A2.LVFFC_TM        AS LVFFC_TM ,
                                              B2.WORK_DE ,
                                              DECODE(B2.WORK_DE, NULL, 0 ,1) AS FLXWK_AT ,
                                              B2.ATTEND_TM                   AS F_ATTEND_TM ,
                                              B2.LVFFC_TM                    AS F_LVFFC_TM        
                                         FROM (SELECT EMPNO, ATTEND_TM, LVFFC_TM,TO_CHAR(STDR_DE,'YYYYMMDD') AS STDR_DE FROM TBHRM_CMG_INFO WHERE STDR_DE BETWEEN #STDR_BGN_DE# AND #STDR_END_DE#) A2
                              LEFT OUTER JOIN (SELECT EMPNO,WORK_DE, ATTEND_TM, LVFFC_TM FROM TBHRM_FLXWK_DTLS WHERE WORK_DE BETWEEN #STDR_BGN_DE# AND #STDR_END_DE#) B2
                                           ON A2.EMPNO = B2.EMPNO
                                          AND A2.STDR_DE = B2.WORK_DE
                                        WHERE 1 = 1
                                          AND A2.EMPNO IN (
                                                           SELECT   p.EMPNO     AS EMPNO               
                                                             FROM TBHRM_GNFD p
                                                            WHERE 1=1
                                                              AND p.SEQ = ( SELECT MAX(p1.SEQ)
                                                                              FROM TBHRM_GNFD p1
                                                                             WHERE 1=1
                                                                               AND p1.EMPNO = p.EMPNO                      
                                                                               AND p1.GNFD_DE <= #STDR_END_DE# 
                                                                               AND p1.GNFD_SE < '100' 
                                                                                AND p.DEPT_CODE = #DEPT_CODE#
                                                                           )
                                                           )
                                                )B ON A.EMPNO     = B.EMPNO      
                                     ) T2 
                     ON T1.EMPNO = T2.EMPNO
                    AND T1.MONTH_DAY = T2.MONTH_DAY
        LEFT OUTER JOIN  (
                           SELECT A.MONTH_DAY ,
	                              B.DCLZ_SE ,
                                  B.WORK_DAYCNT AS DCLZ_DAYCNT,
	                              B.EMPNO
	                         FROM ( 
	                                SELECT TO_DATE(#STDR_BGN_DE#, 'YYYYMMDD') + LEVEL - 1 AS MONTH_DAY
	                                  FROM DUAL
	                                 CONNECT BY LEVEL <= TO_DATE(#STDR_END_DE#, 'YYYYMMDD') - TO_DATE(#STDR_BGN_DE#, 'YYYYMMDD') + 1
	                               ) A
	                    INNER JOIN TBHRM_WRKCP B
				                ON A.MONTH_DAY BETWEEN B.BGNDT AND B.ENDDT
								AND SFCOM_GET_APPRSTS(B.SANCTN_NO,B.REGIST_DT)   = '256'
	                         WHERE EMPNO IN (
	                                         SELECT   p.EMPNO     AS EMPNO               
                                               FROM TBHRM_GNFD p
                                              WHERE 1=1
                                                AND p.SEQ = ( SELECT MAX(p1.SEQ)
                                                                FROM TBHRM_GNFD p1
                                                               WHERE 1=1
                                                                 AND p1.EMPNO = p.EMPNO                      
                                                                 AND p1.GNFD_DE <= #STDR_END_DE# 
                                                                 AND p1.GNFD_SE < '100' 
                                                                 AND p.DEPT_CODE = #DEPT_CODE#
                                                             )
                                              )
                       )T3
	                  ON T1.EMPNO = T3.EMPNO
	                 AND T1.MONTH_DAY = T3.MONTH_DAY
         LEFT OUTER JOIN (
		                  SELECT A.MONTH_DAY ,
		                         B.OPERTN_OFFIC_NM ,
		                         B.EMPNO
		                    FROM (
		                           SELECT TO_DATE(#STDR_BGN_DE#, 'YYYYMMDD') + LEVEL - 1 AS MONTH_DAY
		                             FROM DUAL
		                       CONNECT BY LEVEL <= TO_DATE(#STDR_END_DE#, 'YYYYMMDD') - TO_DATE(#STDR_BGN_DE#, 'YYYYMMDD') + 1
		                          ) A
		              INNER JOIN TBHRM_HR_FRNTN_INSPN_SDYTRN B
		                      ON A.MONTH_DAY BETWEEN B.BGNDE AND B.ENDDE
		             )T4 
                ON T1.EMPNO = T4.EMPNO
               AND T1.MONTH_DAY =T4.MONTH_DAY
          ORDER BY T1.EMPNO, T1.MONTH_DAY
         )GROUP BY EMPNO, EMPNM
         ORDER BY EMPNO
		]]>
    </select>
    
     <!--근태현황_일반(일자별) 목록조회 -->
	<select id="HRM070109DAO.selectDayDclzList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		<![CDATA[
			SELECT
				   WORK_DE                        AS WORK_DE
		          ,EMPNO                          AS EMPNO
		          ,EMPNM                          AS EMPNM
		          ,DEPT_CODE                      AS DEPT_CODE
		          ,DEPT_NM                        AS DEPT_NM
		          ,CASE
		           WHEN DCLZ_SE IS NOT NULL OR BSRP_PURPS IS NOT NULL OR EDC_NM IS NOT NULL THEN NULL
		           ELSE ATTEND_TM_RE END          AS ATTEND_TM_RE
		          ,CASE
		           WHEN DCLZ_SE IS NOT NULL OR BSRP_PURPS IS NOT NULL OR EDC_NM IS NOT NULL THEN NULL
		           ELSE ATTEND_TM END             AS ATTEND_TM
		           ,F_ATTEND_TM
		           ,CASE
		           WHEN DCLZ_SE IS NOT NULL OR BSRP_PURPS IS NOT NULL OR EDC_NM IS NOT NULL THEN NULL
		           ELSE LVFFC_TM_RE END           AS LVFFC_TM_RE
		           ,CASE
		           WHEN DCLZ_SE IS NOT NULL OR BSRP_PURPS IS NOT NULL OR EDC_NM IS NOT NULL THEN NULL
		           ELSE LVFFC_TM END              AS LVFFC_TM
		           ,F_LVFFC_TM                    AS F_LVFFC_TM
		           ,FLXWK_AT                      AS FLXWK_AT
		           ,DCLZ_SE                       AS DCLZ_SE
		           ,BSRP_PURPS                    AS BSRP_PURPS
		           ,EDC_NM                        AS EDC_NM
			FROM(
			
					SELECT 
							T1.MONTH_DAY                                   AS WORK_DE     /*근무일*/
						   ,T1.EMPNO                                       AS EMPNO
						   ,T1.EMPNM                                       AS EMPNM
						   ,T1.DEPT_CODE                                   AS DEPT_CODE
						   ,(SELECT SFSAL_GETDEPTNM_01(T1.DEPT_CODE)FROM DUAL)
						                                                   AS DEPT_NM     
						   ,T2.ATTEND_TM_RE                                AS ATTEND_TM_RE /*출근결과*/
						   ,T2.ATTEND_TM                                   AS ATTEND_TM    /*지문인식출근시간*/
						   ,T2.F_ATTEND_TM                                 AS F_ATTEND_TM  /*유연근무출근시간*/
						   ,T2.LVFFC_TM_RE                                 AS LVFFC_TM_RE  /*퇴근결과*/
						   ,T2.LVFFC_TM                                    AS LVFFC_TM     /*지문인식퇴근시간*/
						   ,T2.F_LVFFC_TM                                  AS F_LVFFC_TM   /*유연근무퇴근시간*/
						   ,T2.FLXWK_AT                                    AS FLXWK_AT     /*유연근무구분*/
						   ,T3.DCLZ_SE                                     AS DCLZ_SE
						    /*출장 정보 있을 경우 '출장'*/
						   ,DECODE((SELECT COUNT(1)
						       FROM TBHRM_BSRP_DTLS
		  				      WHERE TO_CHAR(T1.MONTH_DAY,'YYYYMMDD') BETWEEN BGNDE AND ENDDE
						        AND EMPNO = T1.EMPNO
						        AND BSRP_SE = '0' ),0,'','출장')            AS BSRP_PURPS
						  /*교육 정보 있을 경우 '교육'*/
						   ,DECODE((SELECT COUNT(1)
						       FROM TBHRM_EDC_TRAING_REQST
						      WHERE TO_CHAR(T1.MONTH_DAY,'YYYYMMDD') BETWEEN BGNDE AND ENDDE
						        AND EMPNO = T1.EMPNO
						        AND CONFM_DE IS NOT NULL ),0,'','교육')     AS EDC_NM
					  FROM (
							SELECT MONTH_DAY
							      ,EMPNO
		        			      ,EMPNM
		        	              ,DEPT_CODE
		                      FROM (
		        					SELECT TO_DATE(#STDR_BGN_DE#, 'YYYYMMDD') + LEVEL - 1 AS MONTH_DAY
		        					       ,EMPNO
		        					       ,EMPNM
		        					       ,DEPT_CODE
		                              FROM (SELECT EMPNO, EMPNM, DEPT_CODE
									          FROM TBHRM_HR_MASTR
									          WHERE EMPNO = #EMPNO#
									          )
		                        CONNECT BY LEVEL <= TO_DATE(#STDR_END_DE#, 'YYYYMMDD') - TO_DATE(#STDR_BGN_DE#, 'YYYYMMDD') + 1 
		                            ) T1
		                      WHERE NOT EXISTS (
											    SELECT 1
											      FROM TBHRM_HVOF_INFO
											     WHERE 1=1
											       AND HVOF_DE = TO_CHAR(T1.MONTH_DAY, 'YYYYMMDD')
											       AND HVOF_DE <= #STDR_END_DE#
											       AND HVOF_DE >= #STDR_BGN_DE#
											    )
		                      )T1
		   LEFT OUTER JOIN ( 
		                     SELECT 
						           A.EMPNO
						          ,A.EMPNM
						          ,B.MONTH_DAY  AS MONTH_DAY
						          ,B.ATTEND_TM
						          ,B.LVFFC_TM
						          ,B.FLXWK_AT
						          ,B.F_ATTEND_TM
						          ,B.F_LVFFC_TM
						          ,DECODE(B.FLXWK_AT,1,CASE WHEN B.ATTEND_TM <= F_ATTEND_TM THEN 1
						                                    WHEN B.ATTEND_TM >  F_ATTEND_TM THEN 2
						                                    ELSE 3 END
						                              ,CASE WHEN REPLACE(B.ATTEND_TM,':','') <= 0900 THEN 1
						                                    WHEN REPLACE(B.ATTEND_TM,':','') >  0900 THEN 2
						                                    ELSE 3 END) AS ATTEND_TM_RE
						                                    
						          ,DECODE(B.FLXWK_AT,1,CASE WHEN B.LVFFC_TM >= F_LVFFC_TM THEN 1
						                                    WHEN B.LVFFC_TM <  F_LVFFC_TM THEN 2
						                                    ELSE 3 END
						                              ,CASE WHEN REPLACE(B.LVFFC_TM,':','') >  1800 THEN 1
						                                    WHEN REPLACE(B.LVFFC_TM,':','') <= 1800 THEN 2
						                                    ELSE 3 END) AS LVFFC_TM_RE 
						      FROM TBHRM_HR_MASTR A
		                INNER JOIN ( SELECT Z.MONTH_DAY AS MONTH_DAY
		                                   ,A.EMPNO AS EMPNO
							               ,A.ATTEND_TM AS ATTEND_TM
							               ,A.LVFFC_TM AS LVFFC_TM
		                                   ,B.WORK_DE
		                                   ,DECODE(B.WORK_DE, NULL, 0 ,1) AS FLXWK_AT
		                                   ,B.ATTEND_TM                   AS F_ATTEND_TM
		                                   ,B.LVFFC_TM                    AS F_LVFFC_TM
		                                FROM
		                                      (
		                                        SELECT TO_DATE(#STDR_BGN_DE#, 'YYYYMMDD') + LEVEL - 1 AS MONTH_DAY, EMPNO
		                                         FROM (SELECT EMPNO, EMPNM, DEPT_CODE FROM TBHRM_HR_MASTR WHERE EMPNO = #EMPNO#)
		                                        CONNECT BY LEVEL <= TO_DATE(#STDR_END_DE#, 'YYYYMMDD') - TO_DATE(#STDR_BGN_DE#, 'YYYYMMDD') + 1
		                                        ) Z
		                           LEFT JOIN  TBHRM_CMG_INFO A
		                                 ON Z.MONTH_DAY = TO_CHAR(A.STDR_DE,'YYYYMMDD') 
		                                AND A.EMPNO     = #EMPNO#
		                          LEFT JOIN TBHRM_FLXWK_DTLS B
		                                 ON Z.MONTH_DAY = B.WORK_DE
		                                AND B.EMPNO = #EMPNO#
		                               WHERE 1 = 1
		                            )B
		                         ON A.EMPNO = B.EMPNO
		                      WHERE A.EMPNO = #EMPNO#
		                   )T2      
		                ON T1.MONTH_DAY = T2.MONTH_DAY
		   LEFT OUTER JOIN
		                   (
							SELECT 
							       A.MONTH_DAY
							       ,B.DCLZ_SE
							       ,B.EMPNO
							  FROM (
							        SELECT 
							               TO_DATE(#STDR_BGN_DE#, 'YYYYMMDD') + LEVEL - 1 AS MONTH_DAY
							          FROM DUAL
							    CONNECT BY LEVEL <= TO_DATE(#STDR_END_DE#, 'YYYYMMDD') - TO_DATE(#STDR_BGN_DE#, 'YYYYMMDD') + 1 
		  			                ) A 
			            INNER JOIN TBHRM_WRKCP B
				                ON A.MONTH_DAY BETWEEN B.BGNDT AND B.ENDDT
								AND SFCOM_GET_APPRSTS(B.SANCTN_NO,B.REGIST_DT)   = '256'
					           AND EMPNO = #EMPNO#
							 )T3
		                ON T1.MONTH_DAY = T3.MONTH_DAY
		
		             ORDER BY T1.MONTH_DAY
		            )
            WHERE 1=1
		]]>
    </select>
    
     <!--근태현황_기타 목록조회 -->
	<select id="HRM070109DAO.selectEtcDclzList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		<![CDATA[
		   SELECT 
		  		  DEPT_CODE                                                AS DEPT_CODE 
				  ,SFHRM_GET_DEPTNM(DEPT_CODE,'')                          AS DEPT_NM
				  ,SUM(TA2.BSRP_PURPS)                                     AS BSRP_PURPS_DAYCNT   /*출장일수*/ 
				  ,SUM(CASE WHEN TA2.BSRP_PURPS <> 0 THEN 1 ELSE 0 END )   AS BSRP_PURPS_PECNT    /*출장인원*/
				  ,SUM(TA2.DCLZ_SE_1) + SUM(TA2.DCLZ_SE_2) + SUM(TA2.DCLZ_SE_3) 
				  +SUM(TA2.DCLZ_SE_4) + SUM(TA2.DCLZ_SE_5) + SUM(TA2.DCLZ_SE_6) 
				  +SUM(TA2.DCLZ_SE_8) + SUM(TA2.DCLZ_SE_9) + SUM(TA2.DCLZ_SE_10)
				                                                           AS DCLZ_SE_DAYCNT      /*휴가일수*/
				  ,SUM(CASE WHEN TA2.DCLZ_SE_1 <> 0 THEN 1 ELSE 0 END )
				  +SUM(CASE WHEN TA2.DCLZ_SE_2 <> 0 THEN 1 ELSE 0 END )
				  +SUM(CASE WHEN TA2.DCLZ_SE_3 <> 0 THEN 1 ELSE 0 END )
				  +SUM(CASE WHEN TA2.DCLZ_SE_4 <> 0 THEN 1 ELSE 0 END )
				  +SUM(CASE WHEN TA2.DCLZ_SE_5 <> 0 THEN 1 ELSE 0 END )
				  +SUM(CASE WHEN TA2.DCLZ_SE_6 <> 0 THEN 1 ELSE 0 END )
				  +SUM(CASE WHEN TA2.DCLZ_SE_8 <> 0 THEN 1 ELSE 0 END )
				  +SUM(CASE WHEN TA2.DCLZ_SE_9 <> 0 THEN 1 ELSE 0 END )
				  +SUM(CASE WHEN TA2.DCLZ_SE_10 <> 0 THEN 1 ELSE 0 END )   AS DCLZ_SE_PECNT        /*휴가인원*/
				  ,SUM(TA2.EDC_NM)                                         AS EDC_DAYCNT           /*교육일수*/
				  ,SUM(CASE WHEN TA2.EDC_NM <> 0 THEN 1 ELSE 0 END )       AS EDC_PECNT            /*교육인원*/
				  ,SUM(TA2.ATTEND_SE_3)                                    AS ATTEND_SE_3_DAYCNT   /*지각일수*/
				  ,SUM(CASE WHEN TA2.ATTEND_SE_3 <> 0 THEN 1 ELSE 0 END)   AS ATTEND_SE_3_PECNT    /*지각인원*/
				  ,SUM(TA2.ATTEND_SE_2)                                    AS ATTEND_SE_2_DAYCNT   /*출근미확인일수*/ 
				  ,SUM(CASE WHEN TA2.ATTEND_SE_2 <> 0 THEN 1 ELSE 0 END)   AS ATTEND_SE_2_PECNT    /*출근미확인인원*/
				  ,SUM(TA2.LVFFC_TM_SE_3)                                  AS LVFFC_TM_SE_3_DAYCNT /*조기퇴근일수*/        
				  ,SUM(CASE WHEN TA2.LVFFC_TM_SE_3 <> 0 THEN 1 ELSE 0 END) AS LVFFC_TM_SE_3_PECNT  /*조기퇴근인원*/
				  ,SUM(TA2.LVFFC_TM_SE_2)                                  AS LVFFC_TM_SE_2_DAYCNT /*퇴근미확인일수*/       
				  ,SUM(CASE WHEN TA2.LVFFC_TM_SE_2 <> 0 THEN 1 ELSE 0 END) AS LVFFC_TM_SE_2_PECNT  /*퇴근미확인인원*/
				  
		 	FROM 
			     (   
             		SELECT  
	                       EMPNO
	                      ,EMPNM
	                      ,(SELECT b.DEPT_CODE
	                          FROM TBHRM_HR_MASTR m		    
                                   ,(SELECT   
	                                       p.EMPNO                                        AS EMPNO
	                                       ,SFSAL_GETEMPNO_01(p.EMPNO) 					  AS EMPNM
	                                       ,p.DEPT_CODE                				      AS DEPT_CODE
	                                       ,SFHRM_GET_DEPTNM(p.DEPT_CODE,'')         	  AS DEPT_NM
	                                       ,p.JSSFC_SE           						  AS JSSFC_SE      
	                                       ,DECODE(p.CLSF_SE,'3A','03','3B','03',CLSF_SE) AS CLSF_SE
	                                       ,p.RSPOFC_SE  		       					  AS RSPOFC_SE
	                                       ,p.GNFD_DE							          AS GNFD_DE
	                                       ,p.GNFD_SE 									  AS GNFD_SE			            
                                      FROM TBHRM_GNFD p
                                     WHERE 1=1
                                       AND p.SEQ = ( SELECT MAX(p1.SEQ)
                                                       FROM TBHRM_GNFD p1
                                                      WHERE 1=1
                                                        AND p1.EMPNO = p.EMPNO
                                                        AND p1.GNFD_DE <= #STDR_END_DE#
                                                        AND p1.GNFD_SE < '100'	
                                                    )
                                       )b
                             WHERE 1=1
                               AND m.EMPNO = b.EMPNO
                               AND B.EMPNO = TA1.EMPNO) AS DEPT_CODE
                          ,COUNT(DECODE(FLXWK_AT,0,1)) + COUNT(DECODE(FLXWK_AT,1,1)) + COUNT(SPT_WORK) + COUNT(OPERTN_OFFIC_NM) + COUNT(EDC_NM_2)+ COUNT(BSRP_PURPS) + COUNT(EDC_NM) + COUNT(DCLZ_SE) 
                                                            AS SUM1
                          ,COUNT(DECODE(FLXWK_AT,0,1))      AS WORK_SE_1 /*정상근무*/
                          ,COUNT(DECODE(FLXWK_AT,1,1))      AS WORK_SE_2 /*현장근무*/
                          ,COUNT(SPT_WORK)                  AS WORK_SE_3 /*현장근무*/
                          ,COUNT(OPERTN_OFFIC_NM) + COUNT(EDC_NM_2) + COUNT(DECODE(DCLZ_SE,216,1)) 
                                                            AS WORK_SE_4 /*기타*/
                          ,COUNT(ATTEND_TM_RE)              AS SUB_SUM_1 /*출근소계*/
                          ,COUNT(DECODE(ATTEND_TM_RE,1,1))  AS ATTEND_SE_1 /*정상출근*/
                          ,COUNT(DECODE(ATTEND_TM_RE,3,1))  AS ATTEND_SE_2 /*출근미확인*/
                          ,COUNT(DECODE(ATTEND_TM_RE,2,1))  AS ATTEND_SE_3 /*출근미확인*/
                          ,COUNT(LVFFC_TM_RE)               AS SUB_SUM_2 /*퇴근소계*/
                          ,COUNT(DECODE(LVFFC_TM_RE,1,1))   AS LVFFC_TM_SE_1 /*정상퇴근*/
                          ,COUNT(DECODE(LVFFC_TM_RE,3,1))   AS LVFFC_TM_SE_2 /*퇴근미확인*/
                          ,COUNT(DECODE(LVFFC_TM_RE,2,1))   AS LVFFC_TM_SE_3 /*조기퇴근*/
                          ,COUNT(DCLZ_SE)                   AS SUB_SUM_3     /*근무상환소계*/
                          ,COUNT(DECODE(DCLZ_SE,201,1))     AS DCLZ_SE_1     /*연차*/
                          ,COUNT(DECODE(DCLZ_SE,206,1))     AS DCLZ_SE_2     /*공가*/
                          ,COUNT(DECODE(DCLZ_SE,203,1))     AS DCLZ_SE_3     /*병가*/
                          ,COUNT(DECODE(DCLZ_SE,212,1))     AS DCLZ_SE_4     /*포상*/
                          ,COUNT(DECODE(DCLZ_SE,208,1))     AS DCLZ_SE_5     /*안식*/
                          ,COUNT(DECODE(DCLZ_SE,215,1))     AS DCLZ_SE_6     /*대체*/
                          ,COUNT(DECODE(DCLZ_SE,216,1))     AS DCLZ_SE_7     /*휴직*/
                          ,COUNT(DECODE(DCLZ_SE,205,1))     AS DCLZ_SE_8     /*청원*/
                          ,COUNT(DECODE(DCLZ_SE,211,1))     AS DCLZ_SE_9     /*출산*/
                          ,COUNT(DECODE(DCLZ_SE,217,1))     AS DCLZ_SE_10    /*장기*/
                          ,COUNT(DECODE(DCLZ_SE,200,1))     AS DCLZ_SE_11    /*결근*/
                          ,COUNT(DECODE(DCLZ_SE,210,1))     AS DCLZ_SE_12    /*조퇴*/
                          ,COUNT(BSRP_PURPS)                AS BSRP_PURPS    /*출장*/
                          ,COUNT(EDC_NM)                    AS EDC_NM        /*교육*/
                    FROM (      
                           SELECT T1.MONTH_DAY           AS MONTH_DAY  /*근무일*/
                                 ,T1.EMPNO           AS EMPNO      /*사번*/ 
                                 ,T1.EMPNM           AS EMPNM      /*성명*/
                                 ,T2.ATTEND_TM       AS ATTEND_TM  /*출근시간*/
                                 ,T2.LVFFC_TM        AS LVFFC_TM /*퇴근시간*/
                                 ,T2.FLXWK_AT        AS FLXWK_AT/*유연근무여부*/
                                 ,T2.F_ATTEND_TM     AS F_ATTEND_TM /*유연근무출근시간*/
                                 ,T2.F_LVFFC_TM      AS F_LVFFC_TM /*유연근무퇴근시간*/
                                 ,T2.ATTEND_TM_RE    AS ATTEND_TM_RE /*출근결과*/
                                 ,T2.LVFFC_TM_RE     AS LVFFC_TM_RE /*퇴근결과*/
                                 ,T3.DCLZ_DAYCNT     AS DCLZ_DAYCNT   
                                 ,T3.DCLZ_SE         AS DCLZ_SE /*근태정보*/
                                 ,T4.OPERTN_OFFIC_NM AS OPERTN_OFFIC_NM /*해외연수 명*/
                                 ,DECODE((SELECT COUNT(1) 
                                            FROM TBHRM_BSRP_DTLS 
                                           WHERE TO_CHAR(T1.MONTH_DAY,'YYYYMMDD') BETWEEN BGNDE AND ENDDE
                                             AND EMPNO   = T1.EMPNO
                                             AND BSRP_SE = '0'),0,'','출장') AS BSRP_PURPS  /*출장여부*/
                                 ,DECODE((SELECT COUNT(1) 
                                            FROM TBHRM_EDC_TRAING_REQST 
                                           WHERE TO_CHAR(T1.MONTH_DAY,'YYYYMMDD') BETWEEN BGNDE AND ENDDE       
                                             AND EMPNO     = T1.EMPNO
                                             AND EDC_SE IN ('001','002')
                                             AND CONFM_DE IS NOT NULL),0,'','교육') AS EDC_NM /*교육여부*/
                                 ,DECODE((SELECT COUNT(1) 
                                            FROM TBHRM_SPT_WORK 
                                           WHERE TO_CHAR(T1.MONTH_DAY,'YYYYMMDD') BETWEEN BGNDE AND ENDDE
                                             AND EMPNO = T1.EMPNO),0,'','현장') AS SPT_WORK  /*현장근무여부*/
                                 ,DECODE((SELECT COUNT(1) 
                                            FROM TBHRM_EDC_TRAING_REQST
                                           WHERE TO_CHAR(T1.MONTH_DAY,'YYYYMMDD') BETWEEN BGNDE AND ENDDE
                                             AND EMPNO     = T1.EMPNO
                                             AND EDC_SE = '003'
                                             AND CONFM_DE IS NOT NULL),0,'','교육기타') AS EDC_NM_2 /*교육 003 */
                              FROM(
                                   SELECT A.MONTH_DAY, B.EMPNO, B.EMPNM
                                     FROM(SELECT MONTH_DAY
                                            FROM(SELECT TO_DATE(#STDR_BGN_DE#, 'YYYYMMDD') + LEVEL - 1 AS MONTH_DAY
                                                   FROM DUAL
                                             CONNECT BY LEVEL <= TO_DATE(#STDR_END_DE#, 'YYYYMMDD') - TO_DATE(#STDR_BGN_DE#, 'YYYYMMDD') + 1
                                                 ) T1 
                                            WHERE NOT EXISTS (SELECT 1
				                                                FROM TBHRM_HVOF_INFO
				                                               WHERE 1      =1
				                                                 AND HVOF_DE  = TO_CHAR(T1.MONTH_DAY, 'YYYYMMDD')
				                                                 AND HVOF_DE <= #STDR_END_DE#
				                                                 AND HVOF_DE >= #STDR_BGN_DE#
                                                             )
                                                  )A 
                                                  ,TBHRM_HR_MASTR B
                                            WHERE B.EMPNO IN (SELECT  
                                                                    p.EMPNO     AS EMPNO               
                                                                FROM TBHRM_GNFD p
                                                               WHERE 1=1
                                                                 AND p.SEQ = ( SELECT MAX(p1.SEQ)
                                                                                 FROM TBHRM_GNFD p1
                                                                                WHERE 1=1
                                                                                  AND p1.EMPNO = p.EMPNO                      
                                                                                  AND p1.GNFD_DE <= #STDR_END_DE# 
                                                                                  AND p1.GNFD_SE < '100' 
                                                                                  AND p.DEPT_CODE IN (SELECT a.DEPT_CODE AS DEPT_CODE
																				                        FROM TBHRM_ORGCHT_DETAIL a
																				                         /*   ,TBHRM_ORGCHT_CNNC b  */	          
																				                            ,VWHRM_DEPT_HIST c   	  
																				                       WHERE 1=1
																				                      /*    AND a.ORGCHT_CODE 	= b.ORGCHT_CODE  */	
																				                      /*    AND a.DEPT_CODE 	= b.DEPT_CODE    */	
																				                         AND a.DEPT_CODE 	= c.DEPT_CODE
																				                         AND a.HIST_SEQ 	= c.HIST_SEQ
																				                         AND a.ORGCHT_CODE	= (SELECT ORGCHT_CODE
																				                                                 FROM  TBHRM_ORGCHT		
																				                                                WHERE 1=1
 																				                                                  AND APPLC_BGNDE <= #STDR_END_DE#
																				                                                  AND NVL(APPLC_ENDDE, #STDR_END_DE# + '1') >= #STDR_END_DE#)
																				                                                  AND a.DEPT_CODE <> '000000'
																				                                               )
																			                           )
																		            )
                                                   				)T1 
                                     LEFT OUTER JOIN( SELECT  A.EMPNO ,
		                                                    A.EMPNM ,
		                                                    B.MONTH_DAY AS MONTH_DAY ,
		                                                    B.ATTEND_TM ,
		                                                    B.LVFFC_TM ,
		                                                    B.FLXWK_AT ,
		                                                    B.F_ATTEND_TM ,
		                                                    B.F_LVFFC_TM ,
		                                                    DECODE(B.FLXWK_AT,1, CASE WHEN B.ATTEND_TM <= F_ATTEND_TM THEN 1
		                                                                              WHEN B.ATTEND_TM > F_ATTEND_TM THEN 2
		                                                                              ELSE 3 END ,
		                                                                         CASE WHEN REPLACE(B.ATTEND_TM,':','') <= 0900 THEN 1
		                                                                              WHEN REPLACE(B.ATTEND_TM,':','') > 0900 THEN 2
		                                                                             ELSE 3 END) AS ATTEND_TM_RE ,
		                                                    DECODE(B.FLXWK_AT,1, CASE WHEN B.LVFFC_TM >= F_LVFFC_TM THEN 1
		                                                                              WHEN B.LVFFC_TM < F_LVFFC_TM THEN 2
		                                                                              ELSE 3 END ,
		                                                    CASE WHEN REPLACE(B.LVFFC_TM,':','') > 1800 THEN 1
		                                                         WHEN REPLACE(B.LVFFC_TM,':','') <= 1800 THEN 2
		                                                         ELSE 3 END) AS LVFFC_TM_RE
		                                               FROM TBHRM_HR_MASTR A
		                                         INNER JOIN
		                                                    ( 
		                                                      SELECT
		                                                            TO_DATE(DECODE(B2.WORK_DE, NULL,A2.STDR_DE, B2.WORK_DE ),'YYYYMMDD') AS MONTH_DAY,
		                                                            A2.EMPNO           AS EMPNO ,
		                                                            A2.ATTEND_TM       AS ATTEND_TM ,
		                                                            A2.LVFFC_TM        AS LVFFC_TM ,
		                                                            B2.WORK_DE ,
		                                                            DECODE(B2.WORK_DE, NULL, 0 ,1) AS FLXWK_AT ,
		                                                            B2.ATTEND_TM                   AS F_ATTEND_TM ,
		                                                            B2.LVFFC_TM                    AS F_LVFFC_TM        
		                                                        FROM (SELECT EMPNO, ATTEND_TM, LVFFC_TM,TO_CHAR(STDR_DE,'YYYYMMDD') AS STDR_DE FROM TBHRM_CMG_INFO WHERE STDR_DE BETWEEN #STDR_BGN_DE# AND #STDR_END_DE#) A2
		                                                        LEFT OUTER JOIN (SELECT EMPNO,WORK_DE, ATTEND_TM, LVFFC_TM FROM TBHRM_FLXWK_DTLS WHERE WORK_DE BETWEEN #STDR_BGN_DE# AND #STDR_END_DE#) B2
		                                                        ON A2.EMPNO = B2.EMPNO
		                                                        AND A2.STDR_DE = B2.WORK_DE
		                                                        WHERE 1 = 1
		                                                        AND A2.EMPNO IN (
                                                                            SELECT   p.EMPNO     AS EMPNO               
                                                                             FROM TBHRM_GNFD p
                                                                             WHERE 1=1
                                                                                AND p.SEQ = ( SELECT MAX(p1.SEQ)
                                                                                                FROM TBHRM_GNFD p1
                                                                                                WHERE 1=1
                                                                                                AND p1.EMPNO = p.EMPNO                      
                                                                                                AND p1.GNFD_DE <= #STDR_END_DE# 
                                                                                                AND p1.GNFD_SE < '100' 
                                                                                                AND p.DEPT_CODE IN (SELECT a.DEPT_CODE 			AS DEPT_CODE
																								                      FROM TBHRM_ORGCHT_DETAIL a
																								                      /*    ,TBHRM_ORGCHT_CNNC b	*/          
																								                          ,VWHRM_DEPT_HIST c   	  
																								                     WHERE 1=1
																								                    /*     AND a.ORGCHT_CODE 	= b.ORGCHT_CODE  */ 
																								                     /*    AND a.DEPT_CODE 		= b.DEPT_CODE    */ 
																								                       AND a.DEPT_CODE 		= c.DEPT_CODE
																								                       AND a.HIST_SEQ 		= c.HIST_SEQ
																								                       AND a.ORGCHT_CODE	= (SELECT	  ORGCHT_CODE
																								                                               FROM  TBHRM_ORGCHT		
																								                                              WHERE 1=1
																								                                                AND APPLC_BGNDE <= #STDR_END_DE#
																								                                                AND NVL(APPLC_ENDDE, #STDR_END_DE# + '1') >= #STDR_END_DE#)
																								                                                AND a.DEPT_CODE <> '000000')
											                                                                                           	     )
										                                                                               )
					                                                     )B ON A.EMPNO     = B.EMPNO      
                                                     ) T2 
                                         ON T1.EMPNO = T2.EMPNO
                                        AND T1.MONTH_DAY = T2.MONTH_DAY
                                    LEFT OUTER JOIN 
                                                   (
                                                    SELECT A.MONTH_DAY ,
                                                           B.DCLZ_SE ,
                                                           B.WORK_DAYCNT AS DCLZ_DAYCNT,
                                                           B.EMPNO
                                                      FROM (  SELECT TO_DATE(#STDR_BGN_DE#, 'YYYYMMDD') + LEVEL - 1 AS MONTH_DAY
                                                               FROM DUAL
                                                             CONNECT BY LEVEL <= TO_DATE(#STDR_END_DE#, 'YYYYMMDD') - TO_DATE(#STDR_BGN_DE#, 'YYYYMMDD') + 1
                                                             ) A
                                                INNER JOIN TBHRM_WRKCP B
                                                        ON A.MONTH_DAY BETWEEN B.BGNDT AND B.ENDDT
                                                        AND SFCOM_GET_APPRSTS(B.SANCTN_NO,B.REGIST_DT)   = '256'
                                                        AND B.CANCEL_SE IS NULL
                                                     WHERE EMPNO IN (
                                                                            SELECT   p.EMPNO     AS EMPNO               
                                                                             FROM TBHRM_GNFD p
                                                                             WHERE 1=1
                                                                                AND p.SEQ = ( SELECT MAX(p1.SEQ)
                                                                                                FROM TBHRM_GNFD p1
                                                                                                WHERE 1=1
                                                                                                AND p1.EMPNO = p.EMPNO                      
                                                                                                AND p1.GNFD_DE <= #STDR_END_DE# 
                                                                                                AND p1.GNFD_SE < '100' 
                                                                                                AND p.DEPT_CODE IN (SELECT a.DEPT_CODE 			AS DEPT_CODE
																								                      FROM TBHRM_ORGCHT_DETAIL a
																								                     /*     ,TBHRM_ORGCHT_CNNC b	   */       
																								                          ,VWHRM_DEPT_HIST c   	  
																								                     WHERE 1=1
																								                    /*    AND a.ORGCHT_CODE 	= b.ORGCHT_CODE   */      
																								                    /*    AND a.DEPT_CODE 		= b.DEPT_CODE     */      
																								                       AND a.DEPT_CODE 		= c.DEPT_CODE
																								                       AND a.HIST_SEQ 		= c.HIST_SEQ
																								                       AND a.ORGCHT_CODE	= (SELECT	  ORGCHT_CODE
																								                                               FROM  TBHRM_ORGCHT		
																								                                              WHERE 1=1
																								                                                AND APPLC_BGNDE <= #STDR_END_DE#
																								                                                AND NVL(APPLC_ENDDE, #STDR_END_DE# + '1') >= #STDR_END_DE#)
																								                                                AND a.DEPT_CODE <> '000000')
																								                                                                                                )
																								                                                                               )
                                   )T3
                              ON T1.EMPNO = T3.EMPNO
                              AND T1.MONTH_DAY = T3.MONTH_DAY
                  LEFT OUTER JOIN 
                                 (
                              SELECT A.MONTH_DAY ,
                                    B.OPERTN_OFFIC_NM ,
                                    B.EMPNO
                                FROM
                                    (SELECT TO_DATE(#STDR_BGN_DE#, 'YYYYMMDD') + LEVEL - 1 AS MONTH_DAY
                                       FROM DUAL
                                       CONNECT BY LEVEL <= TO_DATE(#STDR_END_DE#, 'YYYYMMDD') - TO_DATE(#STDR_BGN_DE#, 'YYYYMMDD') + 1
                                    ) A
                          INNER JOIN TBHRM_HR_FRNTN_INSPN_SDYTRN B
                                  ON A.MONTH_DAY BETWEEN B.BGNDE AND B.ENDDE
                             )T4 
                             ON T1.EMPNO = T4.EMPNO
                             AND T1.MONTH_DAY =T4.MONTH_DAY
                             ORDER BY T1.EMPNO, T1.MONTH_DAY
                      )TA1 
                      GROUP BY EMPNO, EMPNM
        )TA2
        WHERE 1=1 
		]]>
		<isNotEmpty property="DEPT_CODE">
		AND DEPT_CODE = #DEPT_CODE#
		</isNotEmpty>
		<![CDATA[
        GROUP BY DEPT_CODE
        ORDER BY DEPT_CODE
        ]]>
    </select>
    
 </sqlMap>
