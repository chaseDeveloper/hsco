<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="RNT01040202_SQL">	
   <!--  설명  : 고지서출력관리
		작성자 : 지효정 -->
	
	<select id="RNT01040202DAO.rentNhtOutptList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT 
		     A.CNTRCTR_NO		/*  계약자번호  */
		    ,B.RENT_HOUSE_NM	/*  주택명  */
		    ,A.DONG				/*  동  */
		    ,A.HO				/*  호  */
		    ,D.NM				/*  성명  */
		    ,C.MDAT_YM			/*  조정년월  */
		    ,'임대료' AS PAY_DIV	/*    */
		    ,C.RNTCHRG			/*  임대료  */
		    ,C.OVDINTR			/*  연체이자  */
		    ,C.PAY_TMLMT		/*  납부기한  */
		    ,DECODE(C.ATCNG_AT,'1','자납','일반') AS ATCNG_AT	/*    */
		    ,C.ACNUTNO			/*  계좌번호  */
		FROM 
		     TBRNT_RENT_CNTRCT A
		    ,TBRNT_RENT_HOUSE B
		    ,TBRNT_RENT_NHT_OUTPT C
		    ,TBRNT_PRMANENT_RENT_CSTMR D
		    ,(
		    	SELECT DISTINCT 
		        	CNTRCTR_NO
		            ,ACNUTNO
		            ,DPSTR 
		        FROM TBPMS_ATCNG
		   	    WHERE ATCNG_CANCL_DE IS NULL 
		     )E 
		WHERE A.RENT_HOUSE_CODE = B.RENT_HOUSE_CODE
		AND   C.CNTRCTR_NO = A.CNTRCTR_NO
		AND   D.PRMANENT_CSTMR_NO = A.PRMANENT_CSTMR_NO
		AND   C.CNTRCTR_NO = E.CNTRCTR_NO(+)
		AND   C.ACNUTNO = E.ACNUTNO(+)
		AND   C.NTIC_SE = '1'
		AND   C.MDAT_YM = #mdatYm#
		ORDER BY A.RENT_HOUSE_CODE, A.DONG, A.HO
	</select>
	
	<select id="RNT01040202DAO.rentNhtOutptCnt" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT COUNT(1) AS CNT
		FROM 
			 TBRNT_RENT_NHT_OUTPT A
		    ,TBRNT_RENT_CNTRCT B
		    ,TBRNT_RENT_HOUSE C
		WHERE A.MDAT_YM = #mdatYm#
		AND   A.CNTRCTR_NO = B.CNTRCTR_NO
		AND   B.RENT_HOUSE_CODE = C.RENT_HOUSE_CODE 
		AND   INSTR('R1,R3',C.HOUSE_SE) > 0
		AND   NTIC_SE = '1'
	</select>
	
	<insert id="RNT01040202DAO.rentNhtOutptC" parameterClass="java.util.HashMap">
		INSERT INTO TBRNT_RENT_NHT_OUTPT( 
			 NTIC_SE
			,CNTRCTR_NO
			,MDAT_YM
		    ,PAY_SE
		    ,RNTCHRG
		    ,OVDINTR
		    ,PAY_TMLMT
		    ,ATCNG_AT
		    ,ACNUTNO
		    ,REGISTER_ID
		    ,REGIST_DT
		    ,UPDUSR_ID
		    ,UPDT_DT
		)
		SELECT 
			 '1'
		    ,C.CNTRCTR_NO
			,#mdatYm#
		    ,'2'
		    ,NVL (A.RNTCHRG, 0) + NVL (A.RDCAMT_AMOUNT, 0)
		    ,NVL (A.OVDINTR, 0)
		    ,A.PAY_TMLMT
		    ,DECODE (B.ACNUTNO, NULL, '', '1') AS AUTO_DIV
		    ,B.ACNUTNO
		    ,#S_USER_ID#
		    ,SYSDATE
		    ,#S_USER_ID#
		    ,SYSDATE
		FROM 
			 TBRNT_RENT_MT_RNTCHRG A
		    ,(
		    	SELECT 
		        	 CNTRCTR_NO
		            , MAX(ACNUTNO) AS ACNUTNO
		        FROM TBPMS_ATCNG D
		        WHERE ATCNG_CANCL_DE IS NULL
		    	GROUP BY CNTRCTR_NO
		    ) B
		    ,TBRNT_RENT_CNTRCT C
		    ,TBRNT_RENT_HOUSE D		    
		 WHERE A.MDAT_YM = #mdatYm#
		   AND A.RCIV_DE IS NULL
		   AND NOT EXISTS (SELECT 1 FROM TBRNT_RENT_RESCI B WHERE C.CNTRCTR_NO = B.CNTRCTR_NO)
		   AND A.CNTRCTR_NO = B.CNTRCTR_NO(+)
		   AND A.CNTRCTR_NO = C.CNTRCTR_NO
		   AND C.RENT_HOUSE_CODE = D.RENT_HOUSE_CODE
		   AND INSTR('R1,R3',D.HOUSE_SE) > 0
	</insert>
	
	<delete id="RNT01040202DAO.rentNhtOutptD" parameterClass="java.util.HashMap">
		DELETE FROM TBRNT_RENT_NHT_OUTPT A
		WHERE MDAT_YM = #mdatYm#
		AND   NTIC_SE = '1'
		AND   EXISTS(
			SELECT 1
			FROM 
				 TBRNT_RENT_CNTRCT B
		    	,TBRNT_RENT_HOUSE C
		    WHERE A.CNTRCTR_NO = B.CNTRCTR_NO
		    AND   B.RENT_HOUSE_CODE = C.RENT_HOUSE_CODE
		)
	</delete>
	
	<select id="RNT01040202DAO.rentPrintFileList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	<!--  
		SELECT 
			 B.RENT_HOUSE_CODE				/*  주택코드  */
		    ,B.DONG							/*  동  */
		    ,B.HO							/*  호  */
		    ,G.NM							/*  납부자  */
		    ,SUBSTR(REPLACE(B1.ZIP,'-',''),1,3) || '-' || SUBSTR(REPLACE(B1.ZIP,'-',''),4,3) AS POSTNO	/*  아파트 우편번호  */
		    ,TRIM(B1.ADRES) ||' ' ||TRIM(B1.ADRES_DETAIL) AS ADDR1										/*  아파트 주소  */
		    ,D.RENT_HOUSE_NM || ' ' ||TRIM(TO_NUMBER(B.DONG) ||'-'|| TO_NUMBER(B.HO)) AS ADDR2			/*  아파트 상세 주소  */
		    ,A.MDAT_YM						/*  청구년월  */
		    ,SFCOM_GET_TREDATE(#payTmlmt#) AS  PAY_TMLMT		/*  납입기한  */
		    ,'주택(아파트)' AS C_TITLE1			/*  납부대상_TITLE1  */
		    ,D.RENT_HOUSE_NM AS C_CONT1		/*  납부대상_CONT1  */
		    ,'동   호   수' AS C_TITLE2			/*  납부대상_TITLE2  */
		    , TRIM(TO_NUMBER(B.DONG) ||'-'|| TO_NUMBER(B.HO)) AS C_CONT2	/*  납부대상_CONT2  */
		    ,'납   부   자' AS C_TITLE3			/*  납부대상_TITLE3  */
		    , G.NM AS C_CONT3				/*  납부대상_CONT3  */
		    ,'  ' AS C_TITLE4				/*  납부대상_TITLE4  */
		    ,'  ' AS C_CONT4				/*  납부대상_CONT4  */
		    ,'납부대상금액' AS A_TITLE1			/*  납부내역_TITLE1  */
		    ,C.RENT_AMT AS A_AMT1			/*  납부내역_AMT1  */
		    ,'차감금액' AS A_TITLE2				/*  납부내역_TITLE2  */
		    ,C.CHA_AMT AS A_AMT2			/*  납부내역_AMT2  */
		    ,'연체금액' AS A_TITLE3				/*  납부내역_TITLE3  */
		    ,C.APAY_AMT AS A_AMT3			/*  납부내역_AMT3  */
		    ,'  ' AS A_TITLE4				/*  납부내역_TITLE4  */
		    ,0 AS A_AMT4					/*  납부내역_AMT4  */
		    ,NVL(C.RENT_AMT,0) + NVL(C.CHA_AMT,0) + NVL(C.APAY_AMT,0) AS A_AMT5	/*  납부내역_AMT5  */
		    ,E.MIN_RATIO					/*  연체요율1  */
		    ,E.MAX_RATIO					/*  연체요율2  */
		    ,F.OPOST_NO						/*  회사우편번호  */
		    ,F.OADDR1						/*  회사주소  */
		    ,F.OADDR2						/*  회사상세주소  */
		    ,F.OTEL_NO						/*  회사전화번호  */
		    ,F.OFAX_NO						/*  회사팩스번호  */
		    ,DECODE(S.CNTRCTR_NO,'',V.BANK1,'') AS BANK1				/*  은행명1  */
		    ,DECODE(S.CNTRCTR_NO,'',V.ACCT_NO1,'') AS ACCT_NO1			/*  계좌번호1  */
		    ,DECODE(S.CNTRCTR_NO,'',V.BANK2,'') AS BANK2				/*  은행명2  */
		    ,DECODE(S.CNTRCTR_NO,'',V.ACCT_NO2,'') AS ACCT_NO2			/*  계좌번호2  */
		    ,DECODE(S.CNTRCTR_NO,'',V.BANK3,'') AS BANK3				/*  은행명3  */
		    ,DECODE(S.CNTRCTR_NO,'',V.ACCT_NO3,'') AS ACCT_NO3			/*  계좌번호3  */
		    ,DECODE(S.CNTRCTR_NO,'',V.BANK4,'') AS BANK4				/*  은행명4  */
		    ,DECODE(S.CNTRCTR_NO,'',V.ACCT_NO4,'') AS ACCT_NO4			/*  계좌번호4  */
		    ,DECODE(S.CNTRCTR_NO,'',V.BANK5,'') AS BANK5				/*  은행명5  */
		    ,DECODE(S.CNTRCTR_NO,'',V.ACCT_NO5,'') AS ACCT_NO5			/*  계좌번호5  */
		    ,DECODE(S.CNTRCTR_NO,'',V.BANK6,'') AS BANK6				/*  은행명6  */
		    ,DECODE(S.CNTRCTR_NO,'',V.ACCT_NO6,'') AS ACCT_NO6			/*  계좌번호6  */
		    ,C.*
		    ,R.REC_DATE						/*  수납일  */
		    ,R.REC_AMT						/*  수납금액  */
		    ,S.BANK_NM						/*  자동이체은행명  */
		    ,S.ACNUTNO						/*  자동이체계좌번호  */
		    ,S.DPSTR						/*  자동이체예금주  */
			,F.AUTO_NO						/*  기관코드  */
		    ,CASE WHEN B.RENT_HOUSE_CODE IN('604','654') THEN '2' || B.RENT_HOUSE_CODE || B.DONG || B.HO || SFCOM_GET_TREDATE(#payTmlmt#) || LPAD( NVL(C.RENT_AMT,0) + NVL(C.CHA_AMT,0) + NVL(C.APAY_AMT,0),10,'0') ||
				  SUBSTR(SFRNT_OCR_CODE_CHECK( '2' || B.RENT_HOUSE_CODE || B.DONG || B.HO || SFCOM_GET_TREDATE(#payTmlmt#) || LPAD( NVL(C.RENT_AMT,0) + NVL(C.CHA_AMT,0) + NVL(C.APAY_AMT,0),10,'0') ),1,50) || '00'
		          ELSE NULL END  AS OCRBAND
		FROM 
			 (SELECT * FROM TBRNT_RENT_NHT_OUTPT WHERE MDAT_YM = #mdatYm# AND NTIC_SE = '1' ) A
		    ,TBRNT_RENT_HOUSE D
		    ,TBRNT_RENT_CNTRCT B
		    ,TBRNT_PRMANENT_RENT_CSTMR G
		    ,TBRNT_RENT_HOUSE_DONG B1
		    ,(
		    	SELECT 
		        	 A.CNTRCTR_NO AS CNTRCTR_NO
		            ,MAX(RCIV_DE) AS REC_DATE
		            ,SUM(RCIV_AMOUNT) AS REC_AMT
		        FROM TBRNT_RENT_SPRMNY_RCIV A
		        WHERE A.RCIV_DE = SFCOM_GET_TREDATE(#cal_reivDt#)
		          AND A.RCIV_AMOUNT > 0
		          AND A.PAY_SE = '2'
		        GROUP BY CNTRCTR_NO
		     ) R
		    ,(
		    	SELECT 
		        	 CNTRCTR_NO AS CNTRCTR_NO
		            ,(
		            	SELECT CODE_NM
		                FROM TBCOM_CMMN_CODE 
		                WHERE GRP_CODE = 'COM021' 
		                AND CODE = BANK_CODE
		             ) AS BANK_NM
		            ,ACNUTNO
		            , DPSTR
		           FROM TBPMS_ATCNG
		           WHERE ATCNG_CANCL_DE IS NULL 
		           AND JOB_SE = 'RN1'
		           AND PAY_SE = '01'
		      ) S
		     ,(
				SELECT 
					CNTRCTR_NO
		            ,SUM(NVL(RENT_AMT,0)) AS RENT_AMT				/*  RENT_AMT(납부대상금액)  */
		            ,SUM(NVL(CHA_AMT,0)) AS CHA_AMT					/*  CHA_AMT(차감금액)  */
		            ,SUM(NVL(APAY_AMT,0)) AS APAY_AMT				/*  APAY_AMT(연체금액)  */
		            ,SUM(NVL(TOT_AMT,0)) AS TOT_AMT					/*  TOT_AMT(납부하실금액)  */
		            ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE1), 'YYYYMMDD'),'YYYY-MM') AS MONTH1
		            ,MAX(PAYEND_DATE1) AS PAYEND_DATE1
		            ,SUM(RENT_AMT1) AS RENT_AMT1
		            ,SUM(CHA_AMT1) AS CHA_AMT1
		            ,SUM(APAY_AMT1) AS APAY_AMT1
		            ,SUM(RENT_AMT1+CHA_AMT1+APAY_AMT1) AS TOT_ATM1
		            ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE2), 'YYYYMMDD'),'YYYY-MM') AS MONTH2
		            ,MAX(PAYEND_DATE2) AS PAYEND_DATE2
		            ,SUM(RENT_AMT2) AS RENT_AMT2
		            ,SUM(CHA_AMT2) AS CHA_AMT2
		            ,SUM(APAY_AMT2) AS APAY_AMT2
		            ,SUM(RENT_AMT2+CHA_AMT2+APAY_AMT2) AS TOT_ATM2
		            ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE3), 'YYYYMMDD'),'YYYY-MM') AS MONTH3
		            ,MAX(PAYEND_DATE3) AS PAYEND_DATE3
		            ,SUM(RENT_AMT3) AS RENT_AMT3
		            ,SUM(CHA_AMT3) AS CHA_AMT3
		            ,SUM(APAY_AMT3) AS APAY_AMT3
		            ,SUM(RENT_AMT3+CHA_AMT3+APAY_AMT3) AS TOT_ATM3
		            ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE4), 'YYYYMMDD'),'YYYY-MM') AS MONTH4
		            ,MAX(PAYEND_DATE4) AS PAYEND_DATE4
		            ,SUM(RENT_AMT4) AS RENT_AMT4
		            ,SUM(CHA_AMT4) AS CHA_AMT4
		            ,SUM(APAY_AMT4) AS APAY_AMT4
		            ,SUM(RENT_AMT4+CHA_AMT4+APAY_AMT4) AS TOT_ATM4
		            ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE5), 'YYYYMMDD'),'YYYY-MM') AS MONTH5
		            ,MAX(PAYEND_DATE5) AS PAYEND_DATE5
		            ,SUM(RENT_AMT5) AS RENT_AMT5
		            ,SUM(CHA_AMT5) AS CHA_AMT5
		            ,SUM(APAY_AMT5) AS APAY_AMT5
		            ,SUM(RENT_AMT5+CHA_AMT5+APAY_AMT5) AS TOT_ATM5
		            ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE6), 'YYYYMMDD'),'YYYY-MM') AS MONTH6
		            ,MAX(PAYEND_DATE6) AS PAYEND_DATE6
		            ,SUM(RENT_AMT6) AS RENT_AMT6
		            ,SUM(CHA_AMT6) AS CHA_AMT6
		            ,SUM(APAY_AMT6) AS APAY_AMT6
		            ,SUM(RENT_AMT6+CHA_AMT6+APAY_AMT6) AS TOT_ATM6
		            ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE7), 'YYYYMMDD'),'YYYY-MM') AS MONTH7
		            ,MAX(PAYEND_DATE7) AS PAYEND_DATE7
		            ,SUM(RENT_AMT7) AS RENT_AMT7
		            ,SUM(CHA_AMT7) AS CHA_AMT7
		            ,SUM(APAY_AMT7) AS APAY_AMT7
		            ,SUM(RENT_AMT7+CHA_AMT7+APAY_AMT7) AS TOT_ATM7
		            ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE8), 'YYYYMMDD'),'YYYY-MM') AS MONTH8
		            ,MAX(PAYEND_DATE8) AS PAYEND_DATE8
		            ,SUM(RENT_AMT8) AS RENT_AMT8
		            ,SUM(CHA_AMT8) AS CHA_AMT8
		            ,SUM(APAY_AMT8) AS APAY_AMT8
		            ,SUM(RENT_AMT8+CHA_AMT8+APAY_AMT8) AS TOT_ATM8
		            ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE9), 'YYYYMMDD'),'YYYY-MM') AS MONTH9
		            ,MAX(PAYEND_DATE9) AS PAYEND_DATE9
		            ,SUM(RENT_AMT9) AS RENT_AMT9
		            ,SUM(CHA_AMT9) AS CHA_AMT9
		            ,SUM(APAY_AMT9) AS APAY_AMT9
		            ,SUM(RENT_AMT9+CHA_AMT9+APAY_AMT9) AS TOT_ATM9
		            ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE10), 'YYYYMMDD'),'YYYY-MM') AS MONTH10
		            ,MAX(PAYEND_DATE10) AS PAYEND_DATE10
		            ,SUM(RENT_AMT10) AS RENT_AMT10
		            ,SUM(CHA_AMT10) AS CHA_AMT10
		            ,SUM(APAY_AMT10) AS APAY_AMT10
		            ,SUM(RENT_AMT10+CHA_AMT10+APAY_AMT10) AS TOT_ATM10
		            ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE11), 'YYYYMMDD'),'YYYY-MM') AS MONTH11
		            ,MAX(PAYEND_DATE11) AS PAYEND_DATE11
		            ,SUM(RENT_AMT11) AS RENT_AMT11
		            ,SUM(CHA_AMT11) AS CHA_AMT11
		            ,SUM(APAY_AMT11) AS APAY_AMT11
		            ,SUM(RENT_AMT11+CHA_AMT11+APAY_AMT11) AS TOT_ATM11
		            ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE12), 'YYYYMMDD'),'YYYY-MM') AS MONTH12
		            ,MAX(PAYEND_DATE12) AS PAYEND_DATE12
		            ,SUM(RENT_AMT12) AS RENT_AMT12
		            ,SUM(CHA_AMT12) AS CHA_AMT12
		            ,SUM(APAY_AMT12) AS APAY_AMT12
		            ,SUM(RENT_AMT12+CHA_AMT12+APAY_AMT12) AS TOT_ATM12
		            ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE13), 'YYYYMMDD'),'YYYY-MM') AS MONTH13
		            ,MAX(PAYEND_DATE13) AS PAYEND_DATE13
		            ,SUM(RENT_AMT13) AS RENT_AMT13
		            ,SUM(CHA_AMT13) AS CHA_AMT13
		            ,SUM(APAY_AMT13) AS APAY_AMT13
		            ,SUM(RENT_AMT13+CHA_AMT13+APAY_AMT13) AS TOT_ATM13
		        FROM ( 
					SELECT 
		            	 C.CNTRCTR_NO
		                ,NVL(RENT_AMT,0) RENT_AMT
		                ,NVL(CHA_AMT,0) CHA_AMT
		                ,NVL(APAY_AMT,0) APAY_AMT
		                ,NVL(RENT_AMT,0) + NVL(CHA_AMT,0) + NVL(APAY_AMT,0) AS TOT_AMT
		                ,DECODE(MDAT_YM,#mdatYm#,PAYEND_DATE,NULL) AS PAYEND_DATE1
		                ,DECODE(MDAT_YM,#mdatYm#,RENT_AMT,0) AS RENT_AMT1
		                ,DECODE(MDAT_YM,#mdatYm#,CHA_AMT,0)  AS CHA_AMT1
		                ,DECODE(MDAT_YM,#mdatYm#,APAY_AMT,0) AS APAY_AMT1
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-1),'YYYYMM') ,PAYEND_DATE,NULL) AS PAYEND_DATE2
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-1),'YYYYMM') ,RENT_AMT,0) AS RENT_AMT2
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-1),'YYYYMM') ,CHA_AMT,0)  AS CHA_AMT2
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-1),'YYYYMM') ,APAY_AMT,0) AS APAY_AMT2
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-2),'YYYYMM') ,PAYEND_DATE,NULL) AS PAYEND_DATE3
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-2),'YYYYMM') ,RENT_AMT,0) AS RENT_AMT3
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-2),'YYYYMM') ,CHA_AMT,0)  AS CHA_AMT3
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-2),'YYYYMM') ,APAY_AMT,0) AS APAY_AMT3
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-3),'YYYYMM') ,PAYEND_DATE,NULL) AS PAYEND_DATE4
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-3),'YYYYMM') ,RENT_AMT,0) AS RENT_AMT4
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-3),'YYYYMM') ,CHA_AMT,0)  AS CHA_AMT4
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-3),'YYYYMM') ,APAY_AMT,0) AS APAY_AMT4
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-4),'YYYYMM') ,PAYEND_DATE,NULL) AS PAYEND_DATE5
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-4),'YYYYMM') ,RENT_AMT,0) AS RENT_AMT5
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-4),'YYYYMM') ,CHA_AMT,0)  AS CHA_AMT5
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-4),'YYYYMM') ,APAY_AMT,0) AS APAY_AMT5
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-5),'YYYYMM') ,PAYEND_DATE,NULL) AS PAYEND_DATE6
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-5),'YYYYMM') ,RENT_AMT,0) AS RENT_AMT6
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-5),'YYYYMM') ,CHA_AMT,0)  AS CHA_AMT6
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-5),'YYYYMM') ,APAY_AMT,0) AS APAY_AMT6
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-6),'YYYYMM') ,PAYEND_DATE,NULL) AS PAYEND_DATE7
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-6),'YYYYMM') ,RENT_AMT,0) AS RENT_AMT7
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-6),'YYYYMM') ,CHA_AMT,0)  AS CHA_AMT7
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-6),'YYYYMM') ,APAY_AMT,0) AS APAY_AMT7
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-7),'YYYYMM') ,PAYEND_DATE,NULL) AS PAYEND_DATE8
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-7),'YYYYMM') ,RENT_AMT,0) AS RENT_AMT8
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-7),'YYYYMM') ,CHA_AMT,0)  AS CHA_AMT8
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-7),'YYYYMM') ,APAY_AMT,0) AS APAY_AMT8
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-8),'YYYYMM') ,PAYEND_DATE,NULL) AS PAYEND_DATE9
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-8),'YYYYMM') ,RENT_AMT,0) AS RENT_AMT9
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-8),'YYYYMM') ,CHA_AMT,0)  AS CHA_AMT9
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-8),'YYYYMM') ,APAY_AMT,0) AS APAY_AMT9
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-9),'YYYYMM') ,PAYEND_DATE,NULL) AS PAYEND_DATE10
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-9),'YYYYMM') ,RENT_AMT,0) AS RENT_AMT10
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-9),'YYYYMM') ,CHA_AMT,0)  AS CHA_AMT10
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-9),'YYYYMM') ,APAY_AMT,0) AS APAY_AMT10
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-10),'YYYYMM') ,PAYEND_DATE,NULL) AS PAYEND_DATE11
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-10),'YYYYMM') ,RENT_AMT,0) AS RENT_AMT11
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-10),'YYYYMM') ,CHA_AMT,0)  AS CHA_AMT11
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-10),'YYYYMM') ,APAY_AMT,0) AS APAY_AMT11
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-11),'YYYYMM') ,PAYEND_DATE,NULL) AS PAYEND_DATE12
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-11),'YYYYMM') ,RENT_AMT,0) AS RENT_AMT12
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-11),'YYYYMM') ,CHA_AMT,0)  AS CHA_AMT12
		                ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-11),'YYYYMM') ,APAY_AMT,0) AS APAY_AMT12
		                ,CASE WHEN MDAT_YM <![CDATA[<=]]> TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-12),'YYYYMM') THEN PAYEND_DATE END AS PAYEND_DATE13
		                ,CASE WHEN MDAT_YM <![CDATA[<=]]> TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-12),'YYYYMM') THEN RENT_AMT ELSE 0 END AS RENT_AMT13
		                ,CASE WHEN MDAT_YM <![CDATA[<=]]> TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-12),'YYYYMM') THEN CHA_AMT ELSE 0 END AS CHA_AMT13
		                ,CASE WHEN MDAT_YM <![CDATA[<=]]> TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-12),'YYYYMM') THEN APAY_AMT ELSE 0 END AS APAY_AMT13
            		FROM (
            			SELECT 
		                	 CNTRCTR_NO
		                    ,MDAT_YM
		                    ,PAY_TMLMT AS PAYEND_DATE
		                    ,NVL(RNTCHRG,0) AS RENT_AMT
		                    ,NVL(OVDINTR,0) AS APAY_AMT
		                    ,NVL(RDCAMT_AMOUNT,0) AS CHA_AMT
                		FROM TBRNT_RENT_MT_RNTCHRG C                
                		WHERE C.MDAT_YM <![CDATA[<=]]> #mdatYm#
                  		AND C.RCIV_DE IS NULL
                  		AND EXISTS(
                      		SELECT 1 
                      		FROM VA_BILL V
                      		WHERE CRT_DIV = 'RN'
                        		AND BILL_DIV = 'A'
                        		AND V.CRT_ID = C.CNTRCTR_NO
                		)
                		AND INSTR(PAY_TMLMT, '/') = 0
                	) C
        		) GROUP BY CNTRCTR_NO
	        ) C
	       ,(
	           SELECT 
	            	 MIN(INTRT) AS MIN_RATIO
	                ,MAX(INTRT) AS MAX_RATIO  
	            FROM TBPMS_INTRT_INFO A
               WHERE JOB_SE = 'RN1'
                 AND INTRT_KND = 'PMS'
                 AND INTRT_SE = 'A1'
	         ) E
	       ,(
	          SELECT 
	               CHRCTR_PREPAR_VALUE_0 AS OPOST_NO
	              ,CHRCTR_PREPAR_VALUE_1 AS OADDR1
	              ,CHRCTR_PREPAR_VALUE_2 AS OADDR2
	              ,'전화:' || (SELECT CHRCTR_PREPAR_VALUE_0 FROM TBCOM_CMMN_CODE WHERE GRP_CODE = 'COM027' AND CODE_NM = 'RN') AS OTEL_NO
	              ,'FAX :' || (SELECT CHRCTR_PREPAR_VALUE_1 FROM TBCOM_CMMN_CODE WHERE GRP_CODE = 'COM027' AND CODE_NM = 'RN') AS OFAX_NO
	              ,MSTK_PREPAR_VALUE AS AUTO_NO
	          FROM TBCOM_CMMN_CODE A
	          WHERE GRP_CODE = 'COM027'
	            AND CODE = 'RN'
	       ) F
	       ,(
	          SELECT *
	          FROM VI_VA_MAST 
	          WHERE CRT_DIV = 'RN'
	        ) V         
		WHERE D.RENT_HOUSE_CODE = B.RENT_HOUSE_CODE   
		  AND A.CNTRCTR_NO = B.CNTRCTR_NO
		  AND B.CNTRCTR_NO = C.CNTRCTR_NO      
		  AND B.RENT_HOUSE_CODE = B1.RENT_HOUSE_CODE(+)
		  AND B.DONG = B1.DONG(+)
		  AND EXISTS(SELECT 1 FROM VA_BILL V
		             WHERE CRT_DIV = 'RN'
		               AND BILL_DIV = 'A'
		               AND V.CRT_ID = B.CNTRCTR_NO)
		  AND B.CNTRCTR_NO = V.CRT_ID
		  AND B.CNTRCTR_NO = R.CNTRCTR_NO(+)
		  AND B.CNTRCTR_NO = S.CNTRCTR_NO(+)
		  AND B.PRMANENT_CSTMR_NO = G.PRMANENT_CSTMR_NO
		  <isEqual property="bidulgi" compareValue = "1">
		  AND B.RENT_HOUSE_CODE IN ('604', '654')
		  </isEqual>
		  <isEqual property="bidulgi" compareValue = "0">
      	  AND B.RENT_HOUSE_CODE NOT IN ('604', '654')
      	  </isEqual>
		ORDER BY 1,2,3
		-->
        SELECT  
             B.RENT_HOUSE_CODE                /*  주택코드  */
            ,B.DONG                            /*  동  */
            ,B.HO                            /*  호  */
            ,G.NM                            /*  납부자  */
            ,SUBSTR(REPLACE(B1.ZIP,'-',''),1,3) || '-' || SUBSTR(REPLACE(B1.ZIP,'-',''),4,3) AS POSTNO    /*  아파트 우편번호  */
            ,TRIM(B1.ADRES) ||' ' ||TRIM(B1.ADRES_DETAIL) AS ADDR1                                        /*  아파트 주소  */
            ,D.RENT_HOUSE_NM || ' ' ||TRIM(TO_NUMBER(B.DONG) ||'-'|| TO_NUMBER(B.HO)) AS ADDR2            /*  아파트 상세 주소  */
            ,A.MDAT_YM                        /*  청구년월  */
            ,TO_CHAR(TO_DATE(ED.PAY_TMLMT),'YYYY-MM-DD') AS PAY_TMLMT        /*  납입기한  */
            ,'주택(아파트)' AS C_TITLE1            /*  납부대상_TITLE1  */
            ,D.RENT_HOUSE_NM AS C_CONT1        /*  납부대상_CONT1  */
            ,'동   호   수' AS C_TITLE2            /*  납부대상_TITLE2  */
            , TRIM(TO_NUMBER(B.DONG) ||'-'|| TO_NUMBER(B.HO)) AS C_CONT2    /*  납부대상_CONT2  */
            ,'납   부   자' AS C_TITLE3            /*  납부대상_TITLE3  */
            , G.NM AS C_CONT3                /*  납부대상_CONT3  */
            ,'  ' AS C_TITLE4                /*  납부대상_TITLE4  */
            ,'  ' AS C_CONT4                /*  납부대상_CONT4  */
            ,'납부대상금액' AS A_TITLE1            /*  납부내역_TITLE1  */
            ,C.RENT_AMT AS A_AMT1            /*  납부내역_AMT1  */
            ,'차감금액' AS A_TITLE2                /*  납부내역_TITLE2  */
            ,C.CHA_AMT AS A_AMT2            /*  납부내역_AMT2  */
            ,'연체금액' AS A_TITLE3                /*  납부내역_TITLE3  */
            ,C.APAY_AMT AS A_AMT3            /*  납부내역_AMT3  */
            ,'  ' AS A_TITLE4                /*  납부내역_TITLE4  */
            ,0 AS A_AMT4                    /*  납부내역_AMT4  */
            ,NVL(C.RENT_AMT,0) + NVL(C.CHA_AMT,0) + NVL(C.APAY_AMT,0) AS A_AMT5    /*  납부내역_AMT5  */
            ,E.MIN_RATIO                    /*  연체요율1  */
            ,E.MAX_RATIO                    /*  연체요율2  */
            ,F.OPOST_NO                        /*  회사우편번호  */
            ,F.OADDR1                        /*  회사주소  */
            ,F.OADDR2                        /*  회사상세주소  */
            ,F.OTEL_NO                        /*  회사전화번호  */
            ,F.OFAX_NO                        /*  회사팩스번호  */
            ,DECODE(S.CNTRCTR_NO,'',V.BANK1,'') AS BANK1                /*  은행명1  */
            ,DECODE(S.CNTRCTR_NO,'',V.ACCT_NO1,'') AS ACCT_NO1            /*  계좌번호1  */
            ,DECODE(S.CNTRCTR_NO,'',V.BANK2,'') AS BANK2                /*  은행명2  */
            ,DECODE(S.CNTRCTR_NO,'',V.ACCT_NO2,'') AS ACCT_NO2            /*  계좌번호2  */
            ,DECODE(S.CNTRCTR_NO,'',V.BANK3,'') AS BANK3                /*  은행명3  */
            ,DECODE(S.CNTRCTR_NO,'',V.ACCT_NO3,'') AS ACCT_NO3            /*  계좌번호3  */
            ,DECODE(S.CNTRCTR_NO,'',V.BANK4,'') AS BANK4                /*  은행명4  */
            ,DECODE(S.CNTRCTR_NO,'',V.ACCT_NO4,'') AS ACCT_NO4            /*  계좌번호4  */
            ,DECODE(S.CNTRCTR_NO,'',V.BANK5,'') AS BANK5                /*  은행명5  */
            ,DECODE(S.CNTRCTR_NO,'',V.ACCT_NO5,'') AS ACCT_NO5            /*  계좌번호5  */
            ,DECODE(S.CNTRCTR_NO,'',V.BANK6,'') AS BANK6                /*  은행명6  */
            ,DECODE(S.CNTRCTR_NO,'',V.ACCT_NO6,'') AS ACCT_NO6            /*  계좌번호6  */
            ,C.*
            ,R.REC_DATE                        /*  수납일  */
            ,R.REC_AMT                        /*  수납금액  */
            ,S.BANK_NM                        /*  자동이체은행명  */
            ,S.ACNUTNO                        /*  자동이체계좌번호  */
            ,S.DPSTR                        /*  자동이체예금주  */
            ,Z.AUTO_NO                        /*  기관코드  */
            , '' OCRBAND                 
        FROM (SELECT SFCOM_GET_TREDATE(#payTmlmt#) AS  PAY_TMLMT FROM DUAL) ED
            , (SELECT * FROM TBRNT_RENT_NHT_OUTPT WHERE NTIC_SE = '1' AND MDAT_YM = #mdatYm# ) A            
            ,TBRNT_RENT_CNTRCT B
            ,TBRNT_PRMANENT_RENT_CSTMR G
            ,TBRNT_RENT_HOUSE D
            ,TBRNT_RENT_HOUSE_DONG B1
            ,(
                SELECT 
                     A.CNTRCTR_NO AS CNTRCTR_NO
                    ,MAX(RCIV_DE) AS REC_DATE
                    ,SUM(RCIV_AMOUNT) AS REC_AMT
                FROM TBRNT_RENT_SPRMNY_RCIV A
                WHERE A.NTIC_SE = '1'
                  AND A.RCIV_DE = SFCOM_GET_TREDATE(#reivDt#)                  
                  AND A.PAY_SE = '2'
                GROUP BY CNTRCTR_NO
             ) R
            ,(
                SELECT 
                     CNTRCTR_NO AS CNTRCTR_NO
                    ,CODE_NM AS BANK_NM
                    ,ACNUTNO
                    , DPSTR
                   FROM TBPMS_ATCNG a, 
                        (SELECT CODE, CODE_NM FROM TBCOM_CMMN_CODE WHERE GRP_CODE = 'COM021') b                    
                  WHERE a.JOB_SE = 'RN1'
                    AND a.PAY_SE = '01'     
                    AND a.ATCNG_CANCL_DE IS NULL                    
                    and a.bank_code = b.code(+)
              ) S
             ,(
                SELECT 
                    CNTRCTR_NO
                    ,SUM(NVL(RENT_AMT,0)) AS RENT_AMT                /*  RENT_AMT(납부대상금액)  */
                    ,SUM(NVL(CHA_AMT,0)) AS CHA_AMT                    /*  CHA_AMT(차감금액)  */
                    ,SUM(NVL(APAY_AMT,0)) AS APAY_AMT                /*  APAY_AMT(연체금액)  */
                    ,SUM(NVL(TOT_AMT,0)) AS TOT_AMT                    /*  TOT_AMT(납부하실금액)  */
                    ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE1), 'YYYYMMDD'),'YYYY-MM') AS MONTH1
                    ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE1), 'YYYYMMDD'),'YYYY-MM-DD') AS PAYEND_DATE1
                    ,SUM(RENT_AMT1) AS RENT_AMT1
                    ,SUM(CHA_AMT1) AS CHA_AMT1
                    ,SUM(APAY_AMT1) AS APAY_AMT1
                    ,SUM(RENT_AMT1+CHA_AMT1+APAY_AMT1) AS TOT_ATM1
                    ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE2), 'YYYYMMDD'),'YYYY-MM') AS MONTH2
                    ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE2), 'YYYYMMDD'),'YYYY-MM-DD') AS PAYEND_DATE2
                    ,SUM(RENT_AMT2) AS RENT_AMT2
                    ,SUM(CHA_AMT2) AS CHA_AMT2
                    ,SUM(APAY_AMT2) AS APAY_AMT2
                    ,SUM(RENT_AMT2+CHA_AMT2+APAY_AMT2) AS TOT_ATM2
                    ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE3), 'YYYYMMDD'),'YYYY-MM') AS MONTH3
                    ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE3), 'YYYYMMDD'),'YYYY-MM-DD') AS PAYEND_DATE3
                    ,SUM(RENT_AMT3) AS RENT_AMT3
                    ,SUM(CHA_AMT3) AS CHA_AMT3
                    ,SUM(APAY_AMT3) AS APAY_AMT3
                    ,SUM(RENT_AMT3+CHA_AMT3+APAY_AMT3) AS TOT_ATM3
                    ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE4), 'YYYYMMDD'),'YYYY-MM') AS MONTH4
                    ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE4), 'YYYYMMDD'),'YYYY-MM-DD') AS PAYEND_DATE4
                    ,SUM(RENT_AMT4) AS RENT_AMT4
                    ,SUM(CHA_AMT4) AS CHA_AMT4
                    ,SUM(APAY_AMT4) AS APAY_AMT4
                    ,SUM(RENT_AMT4+CHA_AMT4+APAY_AMT4) AS TOT_ATM4
                    ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE5), 'YYYYMMDD'),'YYYY-MM') AS MONTH5
                    ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE5), 'YYYYMMDD'),'YYYY-MM-DD') AS PAYEND_DATE5
                    ,SUM(RENT_AMT5) AS RENT_AMT5
                    ,SUM(CHA_AMT5) AS CHA_AMT5
                    ,SUM(APAY_AMT5) AS APAY_AMT5
                    ,SUM(RENT_AMT5+CHA_AMT5+APAY_AMT5) AS TOT_ATM5
                    ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE6), 'YYYYMMDD'),'YYYY-MM') AS MONTH6
                    ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE6), 'YYYYMMDD'),'YYYY-MM-DD') AS PAYEND_DATE6
                    ,SUM(RENT_AMT6) AS RENT_AMT6
                    ,SUM(CHA_AMT6) AS CHA_AMT6
                    ,SUM(APAY_AMT6) AS APAY_AMT6
                    ,SUM(RENT_AMT6+CHA_AMT6+APAY_AMT6) AS TOT_ATM6
                    ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE7), 'YYYYMMDD'),'YYYY-MM') AS MONTH7
                    ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE7), 'YYYYMMDD'),'YYYY-MM-DD') AS PAYEND_DATE7
                    ,SUM(RENT_AMT7) AS RENT_AMT7
                    ,SUM(CHA_AMT7) AS CHA_AMT7
                    ,SUM(APAY_AMT7) AS APAY_AMT7
                    ,SUM(RENT_AMT7+CHA_AMT7+APAY_AMT7) AS TOT_ATM7
                    ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE8), 'YYYYMMDD'),'YYYY-MM') AS MONTH8
                    ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE8), 'YYYYMMDD'),'YYYY-MM-DD') AS PAYEND_DATE8
                    ,SUM(RENT_AMT8) AS RENT_AMT8
                    ,SUM(CHA_AMT8) AS CHA_AMT8
                    ,SUM(APAY_AMT8) AS APAY_AMT8
                    ,SUM(RENT_AMT8+CHA_AMT8+APAY_AMT8) AS TOT_ATM8
                    ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE9), 'YYYYMMDD'),'YYYY-MM') AS MONTH9
                    ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE9), 'YYYYMMDD'),'YYYY-MM-DD') AS PAYEND_DATE9
                    ,SUM(RENT_AMT9) AS RENT_AMT9
                    ,SUM(CHA_AMT9) AS CHA_AMT9
                    ,SUM(APAY_AMT9) AS APAY_AMT9
                    ,SUM(RENT_AMT9+CHA_AMT9+APAY_AMT9) AS TOT_ATM9
                    ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE10), 'YYYYMMDD'),'YYYY-MM') AS MONTH10
                    ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE10), 'YYYYMMDD'),'YYYY-MM-DD') AS PAYEND_DATE10
                    ,SUM(RENT_AMT10) AS RENT_AMT10
                    ,SUM(CHA_AMT10) AS CHA_AMT10
                    ,SUM(APAY_AMT10) AS APAY_AMT10
                    ,SUM(RENT_AMT10+CHA_AMT10+APAY_AMT10) AS TOT_ATM10
                    ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE11), 'YYYYMMDD'),'YYYY-MM') AS MONTH11
                    ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE11), 'YYYYMMDD'),'YYYY-MM-DD') AS PAYEND_DATE11
                    ,SUM(RENT_AMT11) AS RENT_AMT11
                    ,SUM(CHA_AMT11) AS CHA_AMT11
                    ,SUM(APAY_AMT11) AS APAY_AMT11
                    ,SUM(RENT_AMT11+CHA_AMT11+APAY_AMT11) AS TOT_ATM11
                    ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE12), 'YYYYMMDD'),'YYYY-MM') AS MONTH12
                    ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE12), 'YYYYMMDD'),'YYYY-MM-DD') AS PAYEND_DATE12
                    ,SUM(RENT_AMT12) AS RENT_AMT12
                    ,SUM(CHA_AMT12) AS CHA_AMT12
                    ,SUM(APAY_AMT12) AS APAY_AMT12
                    ,SUM(RENT_AMT12+CHA_AMT12+APAY_AMT12) AS TOT_ATM12
                    ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE13), 'YYYYMMDD'),'YYYY-MM') AS MONTH13
                    ,TO_CHAR(TO_DATE(MAX(PAYEND_DATE13), 'YYYYMMDD'),'YYYY-MM-DD') AS PAYEND_DATE13
                    ,SUM(RENT_AMT13) AS RENT_AMT13
                    ,SUM(CHA_AMT13) AS CHA_AMT13
                    ,SUM(APAY_AMT13) AS APAY_AMT13
                    ,SUM(RENT_AMT13+CHA_AMT13+APAY_AMT13) AS TOT_ATM13
                FROM ( 
                    SELECT 
                         C.CNTRCTR_NO
                        ,NVL(RENT_AMT,0) RENT_AMT
                        ,NVL(CHA_AMT,0) CHA_AMT
                        ,NVL(APAY_AMT,0) APAY_AMT
                        ,NVL(RENT_AMT,0) + NVL(CHA_AMT,0) + NVL(APAY_AMT,0) AS TOT_AMT
                        ,DECODE(MDAT_YM,#mdatYm#,PAYEND_DATE,NULL) AS PAYEND_DATE1
                        ,DECODE(MDAT_YM,#mdatYm#,RENT_AMT,0) AS RENT_AMT1
                        ,DECODE(MDAT_YM,#mdatYm#,CHA_AMT,0)  AS CHA_AMT1
                        ,DECODE(MDAT_YM,#mdatYm#,APAY_AMT,0) AS APAY_AMT1
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-1),'YYYYMM') ,PAYEND_DATE,NULL) AS PAYEND_DATE2
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-1),'YYYYMM') ,RENT_AMT,0) AS RENT_AMT2
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-1),'YYYYMM') ,CHA_AMT,0)  AS CHA_AMT2
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-1),'YYYYMM') ,APAY_AMT,0) AS APAY_AMT2
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-2),'YYYYMM') ,PAYEND_DATE,NULL) AS PAYEND_DATE3
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-2),'YYYYMM') ,RENT_AMT,0) AS RENT_AMT3
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-2),'YYYYMM') ,CHA_AMT,0)  AS CHA_AMT3
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-2),'YYYYMM') ,APAY_AMT,0) AS APAY_AMT3
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-3),'YYYYMM') ,PAYEND_DATE,NULL) AS PAYEND_DATE4
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-3),'YYYYMM') ,RENT_AMT,0) AS RENT_AMT4
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-3),'YYYYMM') ,CHA_AMT,0)  AS CHA_AMT4
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-3),'YYYYMM') ,APAY_AMT,0) AS APAY_AMT4
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-4),'YYYYMM') ,PAYEND_DATE,NULL) AS PAYEND_DATE5
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-4),'YYYYMM') ,RENT_AMT,0) AS RENT_AMT5
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-4),'YYYYMM') ,CHA_AMT,0)  AS CHA_AMT5
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-4),'YYYYMM') ,APAY_AMT,0) AS APAY_AMT5
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-5),'YYYYMM') ,PAYEND_DATE,NULL) AS PAYEND_DATE6
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-5),'YYYYMM') ,RENT_AMT,0) AS RENT_AMT6
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-5),'YYYYMM') ,CHA_AMT,0)  AS CHA_AMT6
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-5),'YYYYMM') ,APAY_AMT,0) AS APAY_AMT6
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-6),'YYYYMM') ,PAYEND_DATE,NULL) AS PAYEND_DATE7
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-6),'YYYYMM') ,RENT_AMT,0) AS RENT_AMT7
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-6),'YYYYMM') ,CHA_AMT,0)  AS CHA_AMT7
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-6),'YYYYMM') ,APAY_AMT,0) AS APAY_AMT7
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-7),'YYYYMM') ,PAYEND_DATE,NULL) AS PAYEND_DATE8
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-7),'YYYYMM') ,RENT_AMT,0) AS RENT_AMT8
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-7),'YYYYMM') ,CHA_AMT,0)  AS CHA_AMT8
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-7),'YYYYMM') ,APAY_AMT,0) AS APAY_AMT8
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-8),'YYYYMM') ,PAYEND_DATE,NULL) AS PAYEND_DATE9
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-8),'YYYYMM') ,RENT_AMT,0) AS RENT_AMT9
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-8),'YYYYMM') ,CHA_AMT,0)  AS CHA_AMT9
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-8),'YYYYMM') ,APAY_AMT,0) AS APAY_AMT9
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-9),'YYYYMM') ,PAYEND_DATE,NULL) AS PAYEND_DATE10
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-9),'YYYYMM') ,RENT_AMT,0) AS RENT_AMT10
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-9),'YYYYMM') ,CHA_AMT,0)  AS CHA_AMT10
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-9),'YYYYMM') ,APAY_AMT,0) AS APAY_AMT10
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-10),'YYYYMM') ,PAYEND_DATE,NULL) AS PAYEND_DATE11
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-10),'YYYYMM') ,RENT_AMT,0) AS RENT_AMT11
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-10),'YYYYMM') ,CHA_AMT,0)  AS CHA_AMT11
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-10),'YYYYMM') ,APAY_AMT,0) AS APAY_AMT11
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-11),'YYYYMM') ,PAYEND_DATE,NULL) AS PAYEND_DATE12
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-11),'YYYYMM') ,RENT_AMT,0) AS RENT_AMT12
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-11),'YYYYMM') ,CHA_AMT,0)  AS CHA_AMT12
                        ,DECODE(MDAT_YM,TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-11),'YYYYMM') ,APAY_AMT,0) AS APAY_AMT12
                        ,CASE WHEN MDAT_YM <![CDATA[<=]]> TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-12),'YYYYMM') THEN PAYEND_DATE END AS PAYEND_DATE13
                        ,CASE WHEN MDAT_YM <![CDATA[<=]]> TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-12),'YYYYMM') THEN RENT_AMT ELSE 0 END AS RENT_AMT13
                        ,CASE WHEN MDAT_YM <![CDATA[<=]]> TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-12),'YYYYMM') THEN CHA_AMT ELSE 0 END AS CHA_AMT13
                        ,CASE WHEN MDAT_YM <![CDATA[<=]]> TO_CHAR(ADD_MONTHS(TO_DATE(#mdatYm# ||'01', 'YYYYMMDD'),-12),'YYYYMM') THEN APAY_AMT ELSE 0 END AS APAY_AMT13
                    FROM (
                        SELECT 
                             CNTRCTR_NO
                            ,MDAT_YM
                            ,PAY_TMLMT AS PAYEND_DATE
                            ,NVL(RNTCHRG,0) AS RENT_AMT
                            ,NVL(OVDINTR,0) AS APAY_AMT
                            ,NVL(RDCAMT_AMOUNT,0) AS CHA_AMT
                        FROM TBRNT_RENT_MT_RNTCHRG C                
                        WHERE C.MDAT_YM <![CDATA[<=]]> #mdatYm#
                          AND C.RCIV_DE IS NULL
                          AND EXISTS(
                              SELECT 1 
                              FROM VA_BILL V
                              WHERE CRT_DIV = 'RN'
                                AND BILL_DIV = 'A'
                                AND V.CRT_ID = C.CNTRCTR_NO
                        )
                        AND INSTR(PAY_TMLMT, '/') = 0
                    ) C
                ) GROUP BY CNTRCTR_NO
            ) C
           ,(
               SELECT 
                     MIN(INTRT) AS MIN_RATIO
                    ,MAX(INTRT) AS MAX_RATIO  
                FROM TBPMS_INTRT_INFO A
               WHERE JOB_SE    = 'RN1'
                 AND INTRT_KND = 'PMS'
                 AND INTRT_SE  = 'A1'
                 AND APPLC_DE = (SELECT MAX(APPLC_DE) FROM TBPMS_INTRT_INFO B
                                  WHERE B.JOB_SE = A.JOB_SE
                                    AND B.INTRT_KND = A.INTRT_KND
                                    AND B.INTRT_SE  = A.INTRT_SE
                                 )
             ) E
           ,(
              SELECT 
                   CHRCTR_PREPAR_VALUE_0 AS OPOST_NO
                  ,CHRCTR_PREPAR_VALUE_1 AS OADDR1
                  ,CHRCTR_PREPAR_VALUE_2 AS OADDR2
                  ,'전화:' || (SELECT CHRCTR_PREPAR_VALUE_0 FROM TBCOM_CMMN_CODE WHERE GRP_CODE = 'COM027' AND CODE_NM = 'RN') AS OTEL_NO
                  ,'FAX :' || (SELECT CHRCTR_PREPAR_VALUE_1 FROM TBCOM_CMMN_CODE WHERE GRP_CODE = 'COM027' AND CODE_NM = 'RN') AS OFAX_NO
              FROM TBCOM_CMMN_CODE A
              WHERE GRP_CODE = 'COM027'
                AND CODE = 'RN'
           ) F
           ,( SELECT * FROM VI_VA_MAST WHERE CRT_DIV = 'RN' AND OPT1 = '1' ) V       
           ,(SELECT CHRCTR_PREPAR_VALUE_2 AS AUTO_NO
                      FROM TBCOM_CMMN_CODE
                     WHERE GRP_CODE = 'PCOM05'
                       AND CODE = '01') Z  
        WHERE A.CNTRCTR_NO = B.CNTRCTR_NO
          AND B.CNTRCTR_NO = C.CNTRCTR_NO
          AND B.PRMANENT_CSTMR_NO = G.PRMANENT_CSTMR_NO      
          AND B.RENT_HOUSE_CODE = D.RENT_HOUSE_CODE
          AND B.RENT_HOUSE_CODE = B1.RENT_HOUSE_CODE(+)
          AND B.DONG = B1.DONG(+)                      
          AND B.CNTRCTR_NO = V.CRT_ID
          AND B.CNTRCTR_NO = R.CNTRCTR_NO(+)
          AND B.CNTRCTR_NO = S.CNTRCTR_NO(+)                              
        ORDER BY 1,2,3        		
	</select>
</sqlMap>