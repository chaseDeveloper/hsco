<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="SLS030202_SQL">

	<!-- 주택납부 조회  -->
	<select id="SLS030202DAO.selectHousePayList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">

		   SELECT '0' AS CHK
			 	  ,M.HOUSE_SE
			      ,SFCMP_GET_CODENM('HOU0A2', M.HOUSE_SE) AS HOUSE_SE_NM
			      
			      ,A.CNTRCTR_NO
			      ,(SELECT BB.CSTMR_NM
			          FROM TBSLS_HOUSE_CSTMR BB
			         WHERE BB.HOUSE_CSTMR_NO = B.HOUSE_CSTMR_NO) AS HOUSE_CSTMR_NM
			      ,(SELECT SFCOM_DEC_ALL(BB.IHIDNUM)
			          FROM TBSLS_HOUSE_CSTMR BB
			         WHERE BB.HOUSE_CSTMR_NO = B.HOUSE_CSTMR_NO) AS CSTMR_IHIDNUM
			      ,(SELECT BB.ADRES || ' ' || BB.ADRES_DETAIL
			          FROM TBSLS_HOUSE_CSTMR BB
			         WHERE BB.HOUSE_CSTMR_NO = B.HOUSE_CSTMR_NO) AS ADRES_FULL
			       
			      ,(SELECT BB.EMAIL
			          FROM TBSLS_HOUSE_CSTMR BB
			         WHERE BB.HOUSE_CSTMR_NO = B.HOUSE_CSTMR_NO) AS EMAIL
			      ,B.HOUSE_CODE
			      ,B.DONG
			      ,B.HO
			      ,B.CNTRCT_DE
			       
			      ,A.PBLICTE_YEAR
			      ,A.PBLICTE_QU
			      ,A.PAY_CODE
			      ,A.PAYAMT            AS GTN
			      ,A.PAY_SUPLY_AMOUNT  AS GTN_SUPLY_AMOUNT
			      ,A.PAY_VAT           AS GTN_VAT
			      ,A.DE_CO
			      ,A.REGARD_INTR_INTRT
			      ,A.UPDUSR_ID
			      ,A.UPDT_DT
			      ,C.CANCL_DE
			      ,D.BIZRNO
			      ,(SELECT SFCOM_DEC_ALL(BB.IHIDNUM)
			          FROM TBSLS_HOUSE_CSTMR BB
			         WHERE BB.HOUSE_CSTMR_NO = D.HOUSE_CSTMR_NO) AS OWNER_IHIDNUM
			      ,D.MTLTY_NM
			      ,D.ADRES
			      ,(SELECT BB.CSTMR_NM
			          FROM TBSLS_HOUSE_CSTMR BB
			         WHERE BB.HOUSE_CSTMR_NO = D.HOUSE_CSTMR_NO) AS OWNER_NM
			      ,D.BIZCND
			      ,D.INDUTY
				  ,D.BSNS_CONFM_DE
				   
			  FROM (SELECT * FROM TBSLS_HOUSE_VAT A 
                                  WHERE A.PBLICTE_YEAR = #PBLICTE_YEAR#
                                    AND A.PBLICTE_QU =  #PBLICTE_QU#
                                    AND A.PBLICTE_SE = '02'   /* 간주임대료정보 */
                                    AND A.VAT_SN = (SELECT MAX(B.VAT_SN) FROM TBSLS_HOUSE_VAT B
                                                     WHERE B.CNTRCTR_NO = A.CNTRCTR_NO
                                                       AND B.PBLICTE_YEAR = A.PBLICTE_YEAR
                                                       AND B.PBLICTE_QU = A.PBLICTE_QU
                                                       AND B.PBLICTE_SE = A.PBLICTE_SE   /* 간주임대료정보 */
                                                    )
                                 ) A /* 주택부가세 : 간주임대료정보 */
			      ,TBSLS_HCNTRCTR  B /* 주택계약자 */
			      ,TBSLS_HCNTRCTR_CANCL C /* 계약자 해약처리 내역 */
			      ,TBSLS_HCNTRCTR_BSNM  D /* 주택계약자사업자 */
			      ,TBSLS_HOUSE_INFO     M /* 주택정보 */      
			
			 WHERE A.PBLICTE_YEAR = #PBLICTE_YEAR#
			   AND A.PBLICTE_QU = #PBLICTE_QU#
			      
			   AND A.CNTRCTR_NO = B.CNTRCTR_NO
			   AND A.CNTRCTR_NO = D.CNTRCTR_NO(+)
			   AND A.CNTRCTR_NO = C.CNTRCTR_NO(+)
			   AND B.HOUSE_CODE = M.HOUSE_CODE
			   
			   AND A.PBLICTE_SE = '02' /* 간주임대료정보 */
			
			<isNotEmpty property="HOUSE_CODE">
				AND B.HOUSE_CODE = #HOUSE_CODE#
			</isNotEmpty>
						
			<isNotEmpty property="DONG">
			   	AND B.DONG LIKE LPAD(#DONG#, 4, '0')
			</isNotEmpty>
			
			<isNotEmpty property="HO">
			   	AND B.HO LIKE LPAD(#HO#, 4, '0')
			</isNotEmpty>

			 ORDER BY HOUSE_SE_NM, B.HOUSE_CODE, B.DONG, B.HO
			 
	</select>
	
	<!-- 주택납부 조회 old -->
	<select id="SLS030202DAO.selectHousePayList_old" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">

			 SELECT '0' AS CHK
			      ,A.CNTRCTR_NO /* 계약자번호       */
			      ,A.HOUSE_CODE /* 주택코드         */
			      ,A.HO /* 호               */
			      ,A.DONG /* 동               */
			      ,A.HOUSE_CSTMR_NO /* 주택고객번호     */
			      ,(SELECT CSTMR_NM
					  FROM TBSLS_HOUSE_CSTMR S
					 WHERE S.HOUSE_CSTMR_NO = A.HOUSE_CSTMR_NO) AS HOUSE_CSTMR_NM /* 거래처                      */
				  ,(SELECT SFCOM_DEC_ALL(IHIDNUM) 
					  FROM TBSLS_HOUSE_CSTMR S
					 WHERE S.HOUSE_CSTMR_NO = A.HOUSE_CSTMR_NO) AS CSTMR_IHIDNUM  /* 주민등록번호                       */
				  ,(SELECT EMAIL
					  FROM TBSLS_HOUSE_CSTMR S
					 WHERE S.HOUSE_CSTMR_NO = A.HOUSE_CSTMR_NO) AS EMAIL /* 이메일                       */
				  ,(SELECT ADRES || ' ' || ADRES_DETAIL 
					  FROM TBSLS_HOUSE_CSTMR S
					 WHERE S.HOUSE_CSTMR_NO = A.HOUSE_CSTMR_NO) AS ADRES_FULL /* 주소                        */
			      ,A.BDNBR /* 건물번호         */
			      ,A.ETC_CTTPC /* 기타연락처       */
			      ,A.RQEST_ESTBS_DM /* 청구설정_DM      */
			      ,A.ZIP_DM /* 우편번호_DM      */
			      ,A.BDNBR_DM /* 건물번호_DM      */
			      ,A.BASS_ADRES_DM /* 기본주소_DM      */
			      ,A.DETAIL_ADRES_DM /* 상세주소_DM      */
			      ,A.CNTRCTR_STTUS_CODE /* 계약자상태코드   */
			      ,A.LTTOT_QUALF_SE /* 분양자격구분     */
			      ,A.RENT_QUALF_SE /* 임대자격구분     */
			      ,A.CNTRCT_DE /* 계약일자         */
			      ,A.CTRTC_FILE_COURS /* 계약서파일경로   */
			      ,A.CTRTC_FILE /* 계약서파일       */
			      ,A.RENT_BGNDE /* 임대시작일자     */
			      ,A.RENT_ENDDE /* 임대종료일자     */
			      ,A.RENT_MVN_PRARNDE /* 임대입주예정일   */
			      ,A.RENT_MVN_TIME /* 임대입주시간     */
			      ,A.RENT_LVHS_DE /* 임대퇴거일자     */
			      ,A.RENT_LTTOT_CNVRS_DE /* 임대분양전환일자 */
			      ,A.VAT_AT /* 부가세여부       */
			      ,A.RESALE_AT /* 전매여부         */
			      ,A.NMCHANGE_CNNC_CODE /* 명의변경연결코드 */
			      /*,A.CANCL_DE /* 해약일자         */
			      ,A.RM AS RM1 /* 비고             */
			       
			      ,B.PAY_NO /* 납부번호         */
			      ,B.PAY_CODE /* 납부코드         */
			      ,B.PAY_SE /* 납부구분         */
			      ,B.PAY_SN /* 납부일련번호     */
			      ,B.RQEST_YM /* 청구년월         */
			      ,'' AS CANCL_DE /* 해약일자           */
			      ,B.LTTOT_RENT_SE /* 분양임화성분     */
			      ,B.RCIV_DE /* 수납일자           */
			      ,B.RCIV_AMOUNT /* 수납금액           */
			       
			      ,C.BSNM_SN /*사업자일련번호(SQ_TBSLS_HCNTRCTR_BSNM_1) */
			      ,C.BIZRNO /*사업자등록번호                           */
			      ,C.MTLTY_NM /*상호명                                   */
			      ,C.BIZCND /*업태                                     */
			      ,C.INDUTY /*업종                                     */
			      ,C.BSNM_ADRES /*사업자주소                               */
			      ,C.BSNS_CONFM_DE /*사업승인일자                             */
			      ,C.USE_AT /*사용여부                                 */
			      ,C.RM AS RM3 /*비고                                     */
			      ,(SELECT CSTMR_NM
			          FROM TBSLS_HOUSE_CSTMR S
			         WHERE S.HOUSE_CSTMR_NO = C.HOUSE_CSTMR_NO) AS CSTMR_NM /* 대표자명                      */
			      ,(SELECT IHIDNUM
			          FROM TBSLS_HOUSE_CSTMR S
			         WHERE S.HOUSE_CSTMR_NO = C.HOUSE_CSTMR_NO) AS IHIDNUM /* 주민등록번호                */
			      ,D.HOUSE_SE 
			      ,'01' AS PBLICTE_SE /*  발행구분       */
				  ,#PBLICTE_YEAR# AS PBLICTE_YEAR /* 발행년도       */
				  ,#PBLICTE_QU# AS PBLICTE_QU /* 발행분기       */
				  ,E.CANCL_DE /* 해약일자         */
				  
			  FROM TBSLS_HCNTRCTR        A /* 주택계약자       */
			      ,TBSLS_HOUSE_LTTOT_PAY B /* 주택분양납부       */
			      ,TBSLS_HCNTRCTR_BSNM   C /* 주택계약자사업자       */
			      ,TBSLS_HOUSE_INFO	     D /* 주택정보       */
			      ,TBSLS_HCNTRCTR_CANCL  E /* 주택계약자해약 */
			
			 WHERE 1 = 1
			   AND A.CNTRCTR_NO = B.CNTRCTR_NO
			   AND A.CNTRCTR_NO = C.CNTRCTR_NO(+)
			   AND NVL(A.VAT_AT, '0') = '1' /* 부가세여부               */
			   AND B.RCIV_DE IS NOT NULL
			   AND A.HOUSE_CODE = D.HOUSE_CODE
			   AND D.HOUSE_SE IN ('S1','S2','S3','S4','S5','S9')
			   AND A.CNTRCTR_NO = E.CNTRCTR_NO(+)
			   
			<isNotEmpty property="PBLICTE_YEAR">
			   	AND SUBSTR(B.RCIV_DE, 0, 4) = #PBLICTE_YEAR#
			</isNotEmpty>
			
			<isEqual property="PBLICTE_QU" compareValue="1">
				AND SUBSTR(B.RCIV_DE, 0, 6) BETWEEN #PBLICTE_YEAR# || '01' AND #PBLICTE_YEAR# || '03'
			</isEqual>
			
			<isEqual property="PBLICTE_QU" compareValue="2">
				AND SUBSTR(B.RCIV_DE, 0, 6) BETWEEN #PBLICTE_YEAR# || '04' AND #PBLICTE_YEAR# || '06'
			</isEqual>
			
			<isEqual property="PBLICTE_QU" compareValue="3">
				AND SUBSTR(B.RCIV_DE, 0, 6) BETWEEN #PBLICTE_YEAR# || '07' AND #PBLICTE_YEAR# || '09'
			</isEqual>
			
			<isEqual property="PBLICTE_QU" compareValue="4">
				AND SUBSTR(B.RCIV_DE, 0, 6) BETWEEN #PBLICTE_YEAR# || '10' AND #PBLICTE_YEAR# || '12'
			</isEqual>
			
			<isNotEmpty property="HOUSE_CODE">
			   	AND A.HOUSE_CODE = #HOUSE_CODE#
			</isNotEmpty>
						
			<isNotEmpty property="DONG">
			   	AND A.DONG LIKE '%' || #DONG# || '%'
			</isNotEmpty>
			
			<isNotEmpty property="HO">
			   	AND A.HO LIKE '%' || #HO# || '%'
			</isNotEmpty>
			
			UNION ALL
			
			SELECT '0' AS CHK
			      ,A.CNTRCTR_NO /* 계약자번호       */
			      ,A.HOUSE_CODE /* 주택코드         */
			      ,A.HO /* 호               */
			      ,A.DONG /* 동               */
			      ,A.HOUSE_CSTMR_NO /* 주택고객번호     */
			      ,(SELECT CSTMR_NM
					  FROM TBSLS_HOUSE_CSTMR S
					 WHERE S.HOUSE_CSTMR_NO = A.HOUSE_CSTMR_NO) AS HOUSE_CSTMR_NM /* 거래처                      */
				  ,(SELECT IHIDNUM 
					  FROM TBSLS_HOUSE_CSTMR S
					 WHERE S.HOUSE_CSTMR_NO = A.HOUSE_CSTMR_NO) AS CSTMR_IHIDNUM  /* 주민등록번호                       */
				  ,(SELECT EMAIL
					  FROM TBSLS_HOUSE_CSTMR S
					 WHERE S.HOUSE_CSTMR_NO = A.HOUSE_CSTMR_NO) AS EMAIL /* 이메일                       */
				  ,(SELECT ADRES || ' ' || ADRES_DETAIL 
					  FROM TBSLS_HOUSE_CSTMR S
					 WHERE S.HOUSE_CSTMR_NO = A.HOUSE_CSTMR_NO) AS ADRES_FULL /* 주소                        */
			      ,A.BDNBR /* 건물번호         */
			      ,A.ETC_CTTPC /* 기타연락처       */
			      ,A.RQEST_ESTBS_DM /* 청구설정_DM      */
			      ,A.ZIP_DM /* 우편번호_DM      */
			      ,A.BDNBR_DM /* 건물번호_DM      */
			      ,A.BASS_ADRES_DM /* 기본주소_DM      */
			      ,A.DETAIL_ADRES_DM /* 상세주소_DM      */
			      ,A.CNTRCTR_STTUS_CODE /* 계약자상태코드   */
			      ,A.LTTOT_QUALF_SE /* 분양자격구분     */
			      ,A.RENT_QUALF_SE /* 임대자격구분     */
			      ,A.CNTRCT_DE /* 계약일자         */
			      ,A.CTRTC_FILE_COURS /* 계약서파일경로   */
			      ,A.CTRTC_FILE /* 계약서파일       */
			      ,A.RENT_BGNDE /* 임대시작일자     */
			      ,A.RENT_ENDDE /* 임대종료일자     */
			      ,A.RENT_MVN_PRARNDE /* 임대입주예정일   */
			      ,A.RENT_MVN_TIME /* 임대입주시간     */
			      ,A.RENT_LVHS_DE /* 임대퇴거일자     */
			      ,A.RENT_LTTOT_CNVRS_DE /* 임대분양전환일자 */
			      ,A.VAT_AT /* 부가세여부       */
			      ,A.RESALE_AT /* 전매여부         */
			      ,A.NMCHANGE_CNNC_CODE /* 명의변경연결코드 */
			      /*,A.CANCL_DE /* 해약일자         */
			      ,A.RM AS RM1 /* 비고             */
			       
			      ,B.PAY_NO /* 납부번호           */
			      ,B.PAY_CODE /* 납부코드           */
			      ,'' AS PAY_SE /* 납부구분         */
			      ,0 AS PAY_SN /* 납부일련번호     */
			      ,B.RQEST_YM /* 청구년월           */
			      ,B.CANCL_DE /* 해약일자           */
			      ,B.LTTOT_RENT_SE /* 분양임화성분       */
			      ,B.RCIV_DE /* 수납일자           */
			      ,B.RCIV_AMOUNT /* 수납금액           */
			       
			      ,C.BSNM_SN /*사업자일련번호(SQ_TBSLS_HCNTRCTR_BSNM_1) */
			      ,C.BIZRNO /*사업자등록번호                           */
			      ,C.MTLTY_NM /*상호명                                   */
			      ,C.BIZCND /*업태                                     */
			      ,C.INDUTY /*업종                                     */
			      ,C.BSNM_ADRES /*사업자주소                               */
			      ,C.BSNS_CONFM_DE /*사업승인일자                             */
			      ,C.USE_AT /*사용여부                                 */
			      ,C.RM AS RM3 /*비고                                     */
			      ,(SELECT CSTMR_NM
			          FROM TBSLS_HOUSE_CSTMR S
			         WHERE S.HOUSE_CSTMR_NO = C.HOUSE_CSTMR_NO) AS CSTMR_NM /* 대표자명                      */
			      ,(SELECT IHIDNUM
			          FROM TBSLS_HOUSE_CSTMR S
			         WHERE S.HOUSE_CSTMR_NO = C.HOUSE_CSTMR_NO) AS IHIDNUM /* 주민등록번호                */
			      ,D.HOUSE_SE 
			      ,'02' AS PBLICTE_SE /*  발행구분       */
				  ,#PBLICTE_YEAR# AS PBLICTE_YEAR /* 발행년도       */
				  ,#PBLICTE_QU# AS PBLICTE_QU /* 발행분기       */
				  ,E.CANCL_DE /* 해약일자         */
				  
			  FROM TBSLS_HCNTRCTR       A /* 주택계약자       */
			      ,TBSLS_HOUSE_RENT_PAY B /* 주택임대납부       */
			      ,TBSLS_HCNTRCTR_BSNM  C /* 주택계약자사업자       */
			      ,TBSLS_HOUSE_INFO	    D /* 주택정보       */
				  ,TBSLS_HCNTRCTR_CANCL  E /* 주택계약자해약 */
				  
			 WHERE 1 = 1
			   AND A.CNTRCTR_NO = B.CNTRCTR_NO
			   AND A.CNTRCTR_NO = C.CNTRCTR_NO(+)
			   AND NVL(A.VAT_AT, '0') = '1' /* 부가세여부               */
			   AND B.RCIV_DE IS NOT NULL
			   AND A.HOUSE_CODE = D.HOUSE_CODE
			   AND D.HOUSE_SE IN ('S1','S2','S3','S4','S5','S9')
			   AND A.CNTRCTR_NO = E.CNTRCTR_NO
			   AND A.HOUSE_CODE = E.HOUSE_CODE(+)
			   
			<isNotEmpty property="PBLICTE_YEAR">
			    AND SUBSTR(B.RCIV_DE, 0, 4) = #PBLICTE_YEAR#
			</isNotEmpty>
			
			<isEqual property="PBLICTE_QU" compareValue="1">
				AND SUBSTR(B.RCIV_DE, 0, 6) BETWEEN #PBLICTE_YEAR# || '01' AND #PBLICTE_YEAR# || '03'
			</isEqual>
			
			<isEqual property="PBLICTE_QU" compareValue="2">
				AND SUBSTR(B.RCIV_DE, 0, 6) BETWEEN #PBLICTE_YEAR# || '04' AND #PBLICTE_YEAR# || '06'
			</isEqual>
			
			<isEqual property="PBLICTE_QU" compareValue="3">
				AND SUBSTR(B.RCIV_DE, 0, 6) BETWEEN #PBLICTE_YEAR# || '07' AND #PBLICTE_YEAR# || '09'
			</isEqual>
			
			<isEqual property="PBLICTE_QU" compareValue="4">
				AND SUBSTR(B.RCIV_DE, 0, 6) BETWEEN #PBLICTE_YEAR# || '10' AND #PBLICTE_YEAR# || '12'
			</isEqual>
			
			<isNotEmpty property="HOUSE_CODE">
				AND A.HOUSE_CODE = #HOUSE_CODE#
			</isNotEmpty>
						
			<isNotEmpty property="DONG">
			   	AND A.DONG LIKE '%' || #DONG# || '%'
			</isNotEmpty>
			
			<isNotEmpty property="HO">
			   	AND A.HO LIKE '%' || #HO# || '%'
			</isNotEmpty>

			 ORDER BY PAY_CODE, HOUSE_CODE, DONG, HO
			 
	</select>
	
	
	<!-- 주택부가세 조회  -->
	<select id="SLS030202DAO.selectHouseVatList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		<![CDATA[
			 SELECT '0' AS CHK
			        ,PBLICTE_SE            /* 발행구분       */
			        ,VAT_SN          	   /* 부가세일련번호       */
			        ,BILL_SE          	   /* 계산서구분       */
					,PBLICTE_YEAR          /* 발행년도       */
					,PBLICTE_QU            /* 발행분기       */
					,MT_SE                 /* 월구분         */
					,CNTRCTR_NO            /* 계약자번호     */
					,PAY_CODE              /* 납부코드       */
					,PBLICTE_DE            /* 발행일자       */
					,PAYAMT                /* 납부금액       */
					,PAY_SUPLY_AMOUNT      /* 납부공급금액   */
					,PAY_VAT               /* 납부부가세     */
					,REGARD_INTR_INTRT     /* 간주이자이율   */
					,DE_CO                 /* 일자수         */
					,NTS_CONFM_NO          /* 국세청승인번호 */
					,REGISTER_ID           /* 등록자ID       */
					,REGIST_DT             /* 등록일시       */
					,UPDUSR_ID             /* 수정자ID       */
					,UPDT_DT               /* 수정일시       */
			
			   FROM TBSLS_HOUSE_VAT /* 주택부가세       */  
			  WHERE 1 = 1
			  	AND BILL_SE = '1'
		]]>
			   
			<isNotEmpty property="PBLICTE_SE">
			   	AND PBLICTE_SE = #PBLICTE_SE#
			</isNotEmpty>
			
			<isNotEmpty property="PBLICTE_YEAR">
			   	AND PBLICTE_YEAR = #PBLICTE_YEAR#
			</isNotEmpty>
			
			<isNotEmpty property="PBLICTE_QU">
			   	AND PBLICTE_QU = #PBLICTE_QU#
			</isNotEmpty>
			
			<isNotEmpty property="MT_SE">
			   	AND MT_SE = #MT_SE#
			</isNotEmpty>
			
			<isNotEmpty property="CNTRCTR_NO">
			   	AND CNTRCTR_NO = #CNTRCTR_NO#
			</isNotEmpty>
			
			  ORDER BY PBLICTE_YEAR, PBLICTE_QU, MT_SE , CNTRCTR_NO
			 
	</select>
	
	
	<!-- 주택부가세생성 여부  -->
	<select id="SLS030202DAO.selectHouseVatExsitYn" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		 SELECT DECODE(COUNT(CNTRCTR_NO), 0, 'N', 'Y') AS EXIST_YN
		   FROM TBSLS_HOUSE_VAT
		  WHERE 1 = 1
		    AND PBLICTE_SE IN ('01','02')
			AND PBLICTE_YEAR 	= #PBLICTE_YEAR#
			AND PBLICTE_QU 		= #PBLICTE_QU#
		<isNotEmpty property="HOUSE_CODE">
		    AND CNTRCTR_NO IN (SELECT CNTRCTR_NO
			                      FROM TBSLS_HCNTRCTR
			                     WHERE HOUSE_CODE = #HOUSE_CODE#
			                  	)
		</isNotEmpty>
	</select>
	
	
	<!-- 주택부가세 삭제 -->
	<delete id="SLS030202DAO.deleteHouseVat" parameterClass="java.util.Map">
	      DELETE TBSLS_HOUSE_VAT
		   WHERE 1 = 1
		     AND PBLICTE_SE IN ('01','02')
		     AND PBLICTE_YEAR 	= #PBLICTE_YEAR#
		     AND PBLICTE_QU 	= #PBLICTE_QU#
		
		<isNotEmpty property="HOUSE_CODE">
		     AND CNTRCTR_NO IN (SELECT CNTRCTR_NO
			                      FROM TBSLS_HCNTRCTR
			                     WHERE HOUSE_CODE = #HOUSE_CODE#
			                  	)
		</isNotEmpty>
		   
	</delete>
	

	<!-- 주택부가세 추가1 주택분양납부 -->
	<insert id="SLS030202DAO.insertHouseVat1" parameterClass="java.util.Map">
	      INSERT INTO TBSLS_HOUSE_VAT
		  (    
		     	 PBLICTE_SE            /* 발행구분       */
		     	,VAT_SN          	   /* 부가세일련번호       */
			    ,BILL_SE          	   /* 계산서구분       */
				,PBLICTE_YEAR          /* 발행년도       */
				,PBLICTE_QU            /* 발행분기       */
				,MT_SE                 /* 월구분         */
				,CNTRCTR_NO            /* 계약자번호     */
				,PAY_CODE              /* 납부코드       */
				,PBLICTE_DE            /* 발행일자       */
				,PAYAMT                /* 납부금액       */
				,PAY_SUPLY_AMOUNT      /* 납부공급금액   */
				,PAY_VAT               /* 납부부가세     */
				,REGARD_INTR_INTRT     /* 간주이자이율   */
				,DE_CO                 /* 일자수         */
				,NTS_CONFM_NO          /* 국세청승인번호 */
				,REGISTER_ID           /* 등록자ID       */
				,REGIST_DT             /* 등록일시       */
				,UPDUSR_ID             /* 수정자ID       */
				,UPDT_DT               /* 수정일시       */
			                
		  ) 
		  		
		  <![CDATA[
		  		
			SELECT '01' AS PBLICTE_SE /* 발행구분: 01 - 부가세 */
			      ,(ROW_NUMBER() OVER(ORDER BY Z.PAY_CODE) +
			        (SELECT NVL(MAX(VAT_SN), 0)
			                        FROM TBSLS_HOUSE_VAT
			                       WHERE 1 = 1
			                         AND PBLICTE_SE = '01')) AS VAT_SN /* 부가세일련번호       */
			      ,'1' AS BILL_SE /* 계산서구분       */
			      ,#PBLICTE_YEAR# AS PBLICTE_YEAR /* 발행년도 */
			      ,#PBLICTE_QU# AS PBLICTE_QU /* 발행분기 */
			      ,Z.MT_SE
			      ,Z.CNTRCTR_NO
			      ,Z.PAY_CODE
			      ,Z.RENT_DATE AS PBLICTE_DE /* 수납일자                 */
			      ,SUM(Z.RENT_AMT) AS PAYAMT /* 납부금액                 */
			      ,CASE
			         WHEN Z.RENT_DATE > '20100331' AND Z.PAY_CODE IN ('SB', 'SC') THEN /* -- 확장 분양금 2010.3.31 이후 부터 10% */
			          TRUNC(SUM(Z.RENT_AMT) / 1.1, 0)
			         ELSE
			          SFSLS_HOUSE_VAT('S'
			                         ,MAX(Z.PLOT_CT)
			                         ,MAX(Z.BILDNG_CT)
			                         ,SUM(Z.RENT_AMT))
			       END AS PAY_SUPLY_AMOUNT /* 납부공급가액             */
			      ,CASE
			         WHEN Z.RENT_DATE > '20100331' AND Z.PAY_CODE IN ('SB', 'SC') THEN /*-- 확장 분양금 2010.3.31 이후 부터 10% */
			          SUM(Z.RENT_AMT) - TRUNC(SUM(Z.RENT_AMT) / 1.1, 0)
			         ELSE
			          SFSLS_HOUSE_VAT('V'
			                         ,MAX(Z.PLOT_CT)
			                         ,MAX(Z.BILDNG_CT)
			                         ,SUM(Z.RENT_AMT))
			       END AS PAY_VAT /* 납부부가세               */
			      ,0 AS REGARD_INTR_INTRT /* 간주이자이율   */
			      ,0 AS DE_CO /* 일자수         */
			      ,'' AS NTS_CONFM_NO /* 국세청승인번호 */
			      ,#S_USER_ID# AS REGISTER_ID /*등록자ID            */
			      ,SYSDATE AS REGIST_DT /*등록일시                   */
			      ,#S_USER_ID# AS UPDUSR_ID /*수정자ID            */
			      ,SYSDATE AS UPDT_DT /*수정일시                   */
			  FROM (SELECT B.CNTRCTR_NO
				             ,A.CNTRCT_DE
				             ,D.PLOT_CT
				             ,CASE
				                WHEN D.HOUSE_STLE = '01' AND B.PAY_CODE IN ('SB', 'SC') THEN
				                 0
				                ELSE
				                 CASE
				                   WHEN NVL(A.RENT_QUALF_SE, A.LTTOT_QUALF_SE) = '28' THEN /*-- 지구주민*/
				                    DECODE(NVL(D.INHBTNT_BILDNG_CT, 0)
				                          ,0
				                          ,D.BILDNG_CT
				                          ,D.INHBTNT_BILDNG_CT)
				                   ELSE
				                    D.BILDNG_CT
				                 END
				              END AS BILDNG_CT
				             ,(SELECT SUM(R.PAYAMT)
				                 FROM TBSLS_HOUSE_TYBY_PAY R /* 주택타입별납부 */
				                WHERE R.HOUSE_CODE = D.HOUSE_CODE
				                  AND R.HOUSE_TY_CODE = D.HOUSE_TY_CODE
				                  AND R.PAY_CODE = B.PAY_CODE) AS TOT_AMT
				             ,B.PAY_TMLMT AS RENT_DATE
				             ,B.PAY_CODE
				             ,CASE
				                WHEN B.PAY_TMLMT < '20110101' THEN  /* -- 2011.1.1 일 이후 부터 선납할인 금액 제외함 */
				                 NVL(B.PAYAMT, 0)
				                ELSE
				                 NVL(B.PAYAMT, 0) + NVL(B.ARRRG_AMOUNT, 0)
				              END AS RENT_AMT
				             ,(CASE
				                WHEN SUBSTR(B.PAY_TMLMT, 5, 2) = Q.MIN_MM THEN
				                 '1'
				                WHEN (SUBSTR(B.PAY_TMLMT, 5, 2) > Q.MIN_MM) AND
				                     (SUBSTR(B.PAY_TMLMT, 5, 2) < Q.MAX_MM) THEN
				                 '2'
				                WHEN SUBSTR(B.PAY_TMLMT, 5, 2) = Q.MAX_MM THEN
				                 '3'
				                ELSE
				                 '0'
				              END) AS MT_SE
				       
				         FROM TBSLS_HCNTRCTR A 		/* 주택계약자 */
  				                 , TBSLS_HOUSE_DONG_HO C /* 주택동호 */
				                 , TBSLS_HOUSE_TY D 		/* 주택타입 */
				                 , VISLS_QUARTER_YEAR Q
				                 , (SELECT BB.CNTRCTR_NO
				                               , BB.RQEST_YM
				                               , BB.PAY_CODE
				                               , BB.PAYAMT
				                               , NVL(BB.ARRRG_DSCNT_AMOUNT,0) AS ARRRG_AMOUNT
				                               ,(CASE  WHEN SUBSTR(BB.PAY_TMLMT, 0, 6) BETWEEN
     				                                                 #PBLICTE_YEAR# || Q.MIN_MM AND #PBLICTE_YEAR# || Q.MAX_MM THEN
				                                                     (CASE WHEN SUBSTR(BB.RCIV_DE, 0, 6) BETWEEN
				                                                                         #PBLICTE_YEAR# || Q.MIN_MM AND #PBLICTE_YEAR# || Q.MAX_MM AND
				                                                                         BB.RCIV_DE < BB.PAY_TMLMT THEN  BB.RCIV_DE
				                                                       ELSE  BB.PAY_TMLMT  END)
				                                             WHEN SUBSTR(BB.PAY_TMLMT, 0, 6) > #PBLICTE_YEAR# || Q.MAX_MM AND
				                                                       SUBSTR(BB.RCIV_DE, 0, 6) BETWEEN  #PBLICTE_YEAR# || Q.MIN_MM AND #PBLICTE_YEAR# || Q.MAX_MM THEN
				                                                       BB.RCIV_DE
				                                   END) AS PAY_TMLMT
				                 FROM TBSLS_HOUSE_LTTOT_PAY BB /* 주택분양납부       */
				                         , VISLS_QUARTER_YEAR    Q
				                WHERE 1 = 1
				                     AND Q.QUARTER = #PBLICTE_QU#
				                     AND ((SUBSTR(BB.PAY_TMLMT, 0, 6) BETWEEN #PBLICTE_YEAR# || Q.MIN_MM AND #PBLICTE_YEAR# || Q.MAX_MM 
				                     AND  (SUBSTR(BB.RCIV_DE, 0, 6) >= #PBLICTE_YEAR# || Q.MIN_MM OR  BB.RCIV_DE IS NULL) 
				                     AND  BB.CNTRCTR_NO IN (SELECT A.CNTRCTR_NO
				                                                               FROM TBSLS_HCNTRCTR A /* 주택계약자       */
				                                                             WHERE CNTRCTR_STTUS_CODE = '01'
				                                                              UNION
				                                                           SELECT E.CNTRCTR_NO
				                                                             FROM TBSLS_HCNTRCTR_CANCL    E /* 주택계약자해약       */
				                                                                      ,TBSLS_HOUSE_LTTOT_CANCL F /* 주택분양해약       */
				                                                           WHERE 1 = 1
				                                                               AND E.CNTRCTR_NO = F.CNTRCTR_NO
				                                                               AND SUBSTR(E.CANCL_DE, 0, 6) >
				                                                                      #PBLICTE_YEAR# || DECODE(#PBLICTE_QU#, '1','03','2','06','3','09','12'))) 
				                                                                OR ((SUBSTR(BB.PAY_TMLMT, 0, 6) < #PBLICTE_YEAR# || Q.MIN_MM OR
				                      SUBSTR(BB.PAY_TMLMT, 0, 6) > #PBLICTE_YEAR# || Q.MAX_MM) AND
				                      SUBSTR(BB.RCIV_DE, 0, 6) BETWEEN #PBLICTE_YEAR# || Q.MIN_MM AND
				                      #PBLICTE_YEAR# || Q.MAX_MM))
				                  AND BB.PAY_CODE LIKE 'S%'
				                ORDER BY BB.CNTRCTR_NO, BB.RQEST_YM, BB.PAY_CODE ) B
				                
				        WHERE 1 = 1
				          AND A.CNTRCTR_NO = B.CNTRCTR_NO				      
				          AND Q.QUARTER = #PBLICTE_QU#
				          AND (NVL(A.VAT_AT, '0') = '1' OR NVL(D.HOUSE_STLE, '01') = '02' /* 부가세여부 1,  민영주택 */
				              OR EXISTS (SELECT 1
				                           FROM TBSLS_HOUSE_INFO X
				                          WHERE X.HOUSE_CODE = A.HOUSE_CODE
				                            AND X.HOUSE_SE = 'S3'))
				          AND A.CNTRCT_DE IS NOT NULL
				          AND B.PAY_TMLMT IS NOT NULL
				          
				          AND A.HOUSE_CODE = D.HOUSE_CODE
						  AND A.HOUSE_CODE = C.HOUSE_CODE
						  AND A.DONG = C.DONG
						  AND A.HO = C.HO
						  AND C.HOUSE_TY_CODE = D.HOUSE_TY_CODE

			      ]]>
			           
					<isNotEmpty property="HOUSE_CODE">
						 AND A.HOUSE_CODE = #HOUSE_CODE#
					</isNotEmpty>
					  	 
					<isEqual property="PBLICTE_QU" compareValue="1">
						 AND SUBSTR(B.PAY_TMLMT, 0, 6) BETWEEN #PBLICTE_YEAR# || '01' AND #PBLICTE_YEAR# || '03'
					</isEqual>
					
					<isEqual property="PBLICTE_QU" compareValue="2">
						 AND SUBSTR(B.PAY_TMLMT, 0, 6) BETWEEN #PBLICTE_YEAR# || '04' AND #PBLICTE_YEAR# || '06'
					</isEqual>
					
					<isEqual property="PBLICTE_QU" compareValue="3">
						 AND SUBSTR(B.PAY_TMLMT, 0, 6) BETWEEN #PBLICTE_YEAR# || '07' AND #PBLICTE_YEAR# || '09'
					</isEqual>
					
					<isEqual property="PBLICTE_QU" compareValue="4">
						 AND SUBSTR(B.PAY_TMLMT, 0, 6) BETWEEN #PBLICTE_YEAR# || '10' AND #PBLICTE_YEAR# || '12'
					</isEqual>
			           
			           ) Z
			
			 GROUP BY Z.CNTRCTR_NO, Z.MT_SE, Z.CNTRCT_DE, Z.RENT_DATE, Z.PAY_CODE
			
			HAVING SUM(Z.RENT_AMT) > 0
	  
	</insert>
	
	
	<!-- 주택부가세 추가2  주택임대납부 -->
	<insert id="SLS030202DAO.insertHouseVat2" parameterClass="java.util.Map">
	      INSERT INTO TBSLS_HOUSE_VAT
		  (    
		     	 PBLICTE_SE            /* 발행구분       */
		     	,VAT_SN          	   /* 부가세일련번호       */
			    ,BILL_SE          	   /* 계산서구분       */
				,PBLICTE_YEAR          /* 발행년도       */
				,PBLICTE_QU            /* 발행분기       */
				,MT_SE                 /* 월구분         */
				,CNTRCTR_NO            /* 계약자번호     */
				,PAY_CODE              /* 납부코드       */
				,PBLICTE_DE            /* 발행일자       */
				,PAYAMT                /* 납부금액       */
				,PAY_SUPLY_AMOUNT      /* 납부공급금액   */
				,PAY_VAT               /* 납부부가세     */
				,REGARD_INTR_INTRT     /* 간주이자이율   */
				,DE_CO                 /* 일자수         */
				,NTS_CONFM_NO          /* 국세청승인번호 */
				,REGISTER_ID           /* 등록자ID       */
				,REGIST_DT             /* 등록일시       */
				,UPDUSR_ID             /* 수정자ID       */
				,UPDT_DT               /* 수정일시       */
			                
		  ) 
		  		
			  SELECT '01' AS PBLICTE_SE          /* 발행구분 : 01 - 부가세 */
			  		,(ROW_NUMBER() OVER(ORDER BY A.CNTRCTR_NO) +
				        (SELECT NVL(MAX(VAT_SN), 0)
				                        FROM TBSLS_HOUSE_VAT
				                       WHERE 1 = 1
				                         AND PBLICTE_SE = '01')) AS VAT_SN /* 부가세일련번호       */					
					,'1' AS BILL_SE         	   /* 계산서구분       */
			  		,#PBLICTE_YEAR# AS PBLICTE_YEAR      /* 발행년도 */
			  		,#PBLICTE_QU# AS PBLICTE_QU          /* 발행분기 */
			  		,(CASE
			           WHEN SUBSTR(B.RQEST_YM, 5, 2) = '01' OR
			                SUBSTR(B.RQEST_YM, 5, 2) = '04' OR
			                SUBSTR(B.RQEST_YM, 5, 2) = '07' OR
			                SUBSTR(B.RQEST_YM, 5, 2) = '10' THEN
			            '1'
			           WHEN SUBSTR(B.RQEST_YM, 5, 2) = '02' OR
			                SUBSTR(B.RQEST_YM, 5, 2) = '05' OR
			                SUBSTR(B.RQEST_YM, 5, 2) = '08' OR
			                SUBSTR(B.RQEST_YM, 5, 2) = '11' THEN
			            '2'
			           WHEN SUBSTR(B.RQEST_YM, 5, 2) = '03' OR
			                SUBSTR(B.RQEST_YM, 5, 2) = '06' OR
			                SUBSTR(B.RQEST_YM, 5, 2) = '09' OR
			                SUBSTR(B.RQEST_YM, 5, 2) = '12' THEN
			            '3'
			           ELSE
			            '0'
			         END) AS MT_SE /* 월구분         */
                 
			        ,B.CNTRCTR_NO               /* 계약자번호               */
					,'RN' AS PAY_CODE /* B.PAY_CODE                 /* 납부코드                 */					
					,B.PAY_TMLMT AS PBLICTE_DE    /* 납부기한                 */
					,B.RCIV_AMOUNT AS PAYAMT                   									   /* 납부금액                 */
					,TRUNC(TO_NUMBER(B.RCIV_AMOUNT) / 1.1) AS PAY_SUPLY_AMOUNT         			   /* 납부공급가액             */
					,TO_NUMBER(B.RCIV_AMOUNT) - TRUNC(TO_NUMBER(B.RCIV_AMOUNT) / 1.1) AS PAY_VAT   /* 납부부가세               */
					,0 AS REGARD_INTR_INTRT     /* 간주이자이율   */
					,0 AS DE_CO                 /* 일자수         */
					,'' AS NTS_CONFM_NO          /* 국세청승인번호 */
					,#S_USER_ID# AS  REGISTER_ID        /*등록자ID            */        
					,SYSDATE AS REGIST_DT       		/*등록일시                   */
					,#S_USER_ID# AS UPDUSR_ID           /*수정자ID            */          
					,SYSDATE AS UPDT_DT                 /*수정일시                   */
				
			    FROM TBSLS_HCNTRCTR       A /* 주택계약자       */
			        ,TBSLS_HOUSE_RENT_PAY B /* 주택임대납부       */
			   WHERE 1 = 1			  	 
			  	 AND A.CNTRCTR_NO = B.CNTRCTR_NO
			     AND NVL(A.VAT_AT, '0') = '1' /* 부가세여부               */
			     AND B.RCIV_DE IS NOT NULL
			     AND A.HOUSE_CODE IN (SELECT HOUSE_CODE FROM TBSLS_HOUSE_INFO WHERE HOUSE_SE = 'S4')
			  
			<isNotEmpty property="HOUSE_CODE">
				 AND A.HOUSE_CODE = #HOUSE_CODE#
			</isNotEmpty>
				 
			<isEqual property="PBLICTE_QU" compareValue="1">
				 AND B.RQEST_YM BETWEEN #PBLICTE_YEAR# || '01' AND #PBLICTE_YEAR# || '03'
			</isEqual>
			
			<isEqual property="PBLICTE_QU" compareValue="2">
				 AND B.RQEST_YM BETWEEN #PBLICTE_YEAR# || '04' AND #PBLICTE_YEAR# || '06'
			</isEqual>
			
			<isEqual property="PBLICTE_QU" compareValue="3">
				 AND B.RQEST_YM BETWEEN #PBLICTE_YEAR# || '07' AND #PBLICTE_YEAR# || '09'
			</isEqual>
			
			<isEqual property="PBLICTE_QU" compareValue="4">
				 AND B.RQEST_YM BETWEEN #PBLICTE_YEAR# || '10' AND #PBLICTE_YEAR# || '12'
			</isEqual>
	  
	</insert>
	
	
	<!-- 주택부가세 추가3  해약자 분양금 (-)부가세 생성 -->
	<insert id="SLS030202DAO.insertHouseVat3" parameterClass="java.util.Map">
	      INSERT INTO TBSLS_HOUSE_VAT
		  (    
		     	 PBLICTE_SE            /* 발행구분       */
		     	,VAT_SN          	   /* 부가세일련번호       */
			    ,BILL_SE          	   /* 계산서구분       */
				,PBLICTE_YEAR          /* 발행년도       */
				,PBLICTE_QU            /* 발행분기       */
				,MT_SE                 /* 월구분         */
				,CNTRCTR_NO            /* 계약자번호     */
				,PAY_CODE              /* 납부코드       */
				,PBLICTE_DE            /* 발행일자       */
				,PAYAMT                /* 납부금액       */
				,PAY_SUPLY_AMOUNT      /* 납부공급금액   */
				,PAY_VAT               /* 납부부가세     */
				,REGARD_INTR_INTRT     /* 간주이자이율   */
				,DE_CO                 /* 일자수         */
				,NTS_CONFM_NO          /* 국세청승인번호 */
				,REGISTER_ID           /* 등록자ID       */
				,REGIST_DT             /* 등록일시       */
				,UPDUSR_ID             /* 수정자ID       */
				,UPDT_DT               /* 수정일시       */
			                
		  ) 
		  		
			  SELECT '01' AS PBLICTE_SE          /* 발행구분 : 01 - 부가세 */
			  		,(ROW_NUMBER() OVER(ORDER BY B.PAY_CODE) +
				        (SELECT NVL(MAX(VAT_SN), 0)
				                        FROM TBSLS_HOUSE_VAT
				                       WHERE 1 = 1
				                         AND PBLICTE_SE = '01')) AS VAT_SN /* 부가세일련번호       */					
					,'1' AS BILL_SE          	   /* 계산서구분       */
			  		,#PBLICTE_YEAR# AS PBLICTE_YEAR      /* 발행년도 */
			  		,#PBLICTE_QU# AS PBLICTE_QU          /* 발행분기 */
			  		,(CASE
			           WHEN SUBSTR(C.CANCL_DE, 5, 2) = '01' OR
			                SUBSTR(C.CANCL_DE, 5, 2) = '04' OR
			                SUBSTR(C.CANCL_DE, 5, 2) = '07' OR
			                SUBSTR(C.CANCL_DE, 5, 2) = '10' THEN
			            '1'
			           WHEN SUBSTR(C.CANCL_DE, 5, 2) = '02' OR
			                SUBSTR(C.CANCL_DE, 5, 2) = '05' OR
			                SUBSTR(C.CANCL_DE, 5, 2) = '08' OR
			                SUBSTR(C.CANCL_DE, 5, 2) = '11' THEN
			            '2'
			           WHEN SUBSTR(C.CANCL_DE, 5, 2) = '03' OR
			                SUBSTR(C.CANCL_DE, 5, 2) = '06' OR
			                SUBSTR(C.CANCL_DE, 5, 2) = '09' OR
			                SUBSTR(C.CANCL_DE, 5, 2) = '12' THEN
			            '3'
			           ELSE
			            '0'
			         END) AS MT_SE /* 월구분         */
                 
			        ,B.CNTRCTR_NO               /* 계약자번호               */
					,B.PAY_CODE /* 납부코드                 */
				    ,C.CANCL_DE AS PBLICTE_DE /* 수납일자                 */
				    ,B.PAYAMT * (-1) AS PAYAMT /* 납부금액                 */
				    ,B.PAY_SUPLY_AMOUNT * (-1) AS PAY_SUPLY_AMOUNT /* 납부공급가액             */
				    ,B.PAY_VAT * (-1) AS PAY_VAT /* 납부부가세               */
					,0 AS REGARD_INTR_INTRT     /* 간주이자이율   */
					,0 AS DE_CO                 /* 일자수         */
					,'' AS NTS_CONFM_NO          /* 국세청승인번호 */
					,#S_USER_ID# AS  REGISTER_ID        /*등록자ID            */        
					,SYSDATE AS REGIST_DT       		/*등록일시                   */
					,#S_USER_ID# AS UPDUSR_ID           /*수정자ID            */          
					,SYSDATE AS UPDT_DT                 /*수정일시                   */
				
			    FROM TBSLS_HCNTRCTR          A /* 주택계약자       */
				    ,TBSLS_HOUSE_VAT         B /* 주택부가세       */
				    ,TBSLS_HCNTRCTR_CANCL    C /* 주택계약자해약       */
				    ,TBSLS_HOUSE_LTTOT_CANCL D /* 주택분양해약       */
			   WHERE 1 = 1			  	 
			  	 AND A.CNTRCTR_NO = B.CNTRCTR_NO
			  	 AND A.CNTRCTR_NO = C.CNTRCTR_NO
				 AND A.CNTRCTR_NO = D.CNTRCTR_NO
			     AND NVL(A.VAT_AT, '0') = '1' /* 부가세여부               */
			     AND A.RENT_BGNDE IS NOT NULL
			     AND A.HOUSE_CODE IN (SELECT HOUSE_CODE
			                            FROM TBSLS_HOUSE_INFO
			                           WHERE HOUSE_SE IN ('S1', 'S3') AND USE_AT = '1')
			  
			<isNotEmpty property="HOUSE_CODE">
				 AND A.HOUSE_CODE = #HOUSE_CODE#
			</isNotEmpty>
				 
			<isEqual property="PBLICTE_QU" compareValue="1">
				 AND SUBSTR(C.CANCL_DE, 0, 6) BETWEEN #PBLICTE_YEAR# || '01' AND #PBLICTE_YEAR# || '03'
			</isEqual>
			
			<isEqual property="PBLICTE_QU" compareValue="2">
				 AND SUBSTR(C.CANCL_DE, 0, 6) BETWEEN #PBLICTE_YEAR# || '04' AND #PBLICTE_YEAR# || '06'
			</isEqual>
			
			<isEqual property="PBLICTE_QU" compareValue="3">
				 AND SUBSTR(C.CANCL_DE, 0, 6) BETWEEN #PBLICTE_YEAR# || '07' AND #PBLICTE_YEAR# || '09'
			</isEqual>
			
			<isEqual property="PBLICTE_QU" compareValue="4">
				 AND SUBSTR(C.CANCL_DE, 0, 6) BETWEEN #PBLICTE_YEAR# || '10' AND #PBLICTE_YEAR# || '12'
			</isEqual>
	  
	</insert>
	
	<!-- 주택부가세 추가4  해약자 임대 (-)부가세 생성 -->
	<insert id="SLS030202DAO.insertHouseVat4" parameterClass="java.util.Map">
	      INSERT INTO TBSLS_HOUSE_VAT
		  (    
		     	 PBLICTE_SE            /* 발행구분       */
		     	,VAT_SN          	   /* 부가세일련번호       */
			    ,BILL_SE          	   /* 계산서구분       */
				,PBLICTE_YEAR          /* 발행년도       */
				,PBLICTE_QU            /* 발행분기       */
				,MT_SE                 /* 월구분         */
				,CNTRCTR_NO            /* 계약자번호     */
				,PAY_CODE              /* 납부코드       */
				,PBLICTE_DE            /* 발행일자       */
				,PAYAMT                /* 납부금액       */
				,PAY_SUPLY_AMOUNT      /* 납부공급금액   */
				,PAY_VAT               /* 납부부가세     */
				,REGARD_INTR_INTRT     /* 간주이자이율   */
				,DE_CO                 /* 일자수         */
				,NTS_CONFM_NO          /* 국세청승인번호 */
				,REGISTER_ID           /* 등록자ID       */
				,REGIST_DT             /* 등록일시       */
				,UPDUSR_ID             /* 수정자ID       */
				,UPDT_DT               /* 수정일시       */
			                
		  ) 
		  		
			  SELECT '01' AS PBLICTE_SE          /* 발행구분 : 01 - 부가세 */
			  		,(ROW_NUMBER() OVER(ORDER BY B.PAY_CODE) +
				        (SELECT NVL(MAX(VAT_SN), 0)
				                        FROM TBSLS_HOUSE_VAT
				                       WHERE 1 = 1
				                         AND PBLICTE_SE = '01')) AS VAT_SN /* 부가세일련번호       */					
					,'1' AS BILL_SE          	   /* 계산서구분       */
			  		,#PBLICTE_YEAR# AS PBLICTE_YEAR      /* 발행년도 */
			  		,#PBLICTE_QU# AS PBLICTE_QU          /* 발행분기 */
			  		,(CASE
			           WHEN SUBSTR(C.CANCL_DE, 5, 2) = '01' OR
			                SUBSTR(C.CANCL_DE, 5, 2) = '04' OR
			                SUBSTR(C.CANCL_DE, 5, 2) = '07' OR
			                SUBSTR(C.CANCL_DE, 5, 2) = '10' THEN
			            '1'
			           WHEN SUBSTR(C.CANCL_DE, 5, 2) = '02' OR
			                SUBSTR(C.CANCL_DE, 5, 2) = '05' OR
			                SUBSTR(C.CANCL_DE, 5, 2) = '08' OR
			                SUBSTR(C.CANCL_DE, 5, 2) = '11' THEN
			            '2'
			           WHEN SUBSTR(C.CANCL_DE, 5, 2) = '03' OR
			                SUBSTR(C.CANCL_DE, 5, 2) = '06' OR
			                SUBSTR(C.CANCL_DE, 5, 2) = '09' OR
			                SUBSTR(C.CANCL_DE, 5, 2) = '12' THEN
			            '3'
			           ELSE
			            '0'
			         END) AS MT_SE /* 월구분         */
                 
			        ,B.CNTRCTR_NO               /* 계약자번호               */
					,B.PAY_CODE /* 납부코드                 */
				    ,C.CANCL_DE AS PBLICTE_DE /* 수납일자                 */
				    ,B.PAYAMT * (-1) AS PAYAMT /* 납부금액                 */
				    ,B.PAY_SUPLY_AMOUNT * (-1) AS PAY_SUPLY_AMOUNT /* 납부공급가액             */
				    ,B.PAY_VAT * (-1) AS PAY_VAT /* 납부부가세               */
					,0 AS REGARD_INTR_INTRT     /* 간주이자이율   */
					,0 AS DE_CO                 /* 일자수         */
					,'' AS NTS_CONFM_NO          /* 국세청승인번호 */
					,#S_USER_ID# AS  REGISTER_ID        /*등록자ID            */        
					,SYSDATE AS REGIST_DT       		/*등록일시                   */
					,#S_USER_ID# AS UPDUSR_ID           /*수정자ID            */          
					,SYSDATE AS UPDT_DT                 /*수정일시                   */
				
			    FROM TBSLS_HCNTRCTR          A /* 주택계약자       */
				    ,TBSLS_HOUSE_VAT         B /* 주택부가세       */
				    ,TBSLS_HCNTRCTR_CANCL    C /* 주택계약자해약       */
				    ,TBSLS_HOUSE_RENT_CANCL  D /* 주택임대해약       */
			   WHERE 1 = 1			  	 
			  	 AND A.CNTRCTR_NO = B.CNTRCTR_NO
			  	 AND A.CNTRCTR_NO = C.CNTRCTR_NO
				 AND A.CNTRCTR_NO = D.CNTRCTR_NO
			     AND NVL(A.VAT_AT, '0') = '1' /* 부가세여부               */
			     AND A.RENT_BGNDE IS NOT NULL
			     AND A.HOUSE_CODE IN (SELECT HOUSE_CODE
			                            FROM TBSLS_HOUSE_INFO
			                           WHERE HOUSE_SE IN ('S2', 'S4') 
			                             AND USE_AT = '1' 
			                             AND LTTOT_CNVRS_SE <![CDATA[ <> ]]> '02' /* 분양전환구분 완료가 아닌것   */
			                          )
			  
			<isNotEmpty property="HOUSE_CODE">
				 AND A.HOUSE_CODE = #HOUSE_CODE#
			</isNotEmpty>
				 
			<isEqual property="PBLICTE_QU" compareValue="1">
				 AND SUBSTR(C.CANCL_DE, 0, 6) BETWEEN #PBLICTE_YEAR# || '01' AND #PBLICTE_YEAR# || '03'
			</isEqual>
			
			<isEqual property="PBLICTE_QU" compareValue="2">
				 AND SUBSTR(C.CANCL_DE, 0, 6) BETWEEN #PBLICTE_YEAR# || '04' AND #PBLICTE_YEAR# || '06'
			</isEqual>
			
			<isEqual property="PBLICTE_QU" compareValue="3">
				 AND SUBSTR(C.CANCL_DE, 0, 6) BETWEEN #PBLICTE_YEAR# || '07' AND #PBLICTE_YEAR# || '09'
			</isEqual>
			
			<isEqual property="PBLICTE_QU" compareValue="4">
				 AND SUBSTR(C.CANCL_DE, 0, 6) BETWEEN #PBLICTE_YEAR# || '10' AND #PBLICTE_YEAR# || '12'
			</isEqual>
			
			
	</insert>		
			
			
	<!-- 주택부가세 추가5  간주임대료 생성 -->
	<insert id="SLS030202DAO.insertHouseVat5" parameterClass="java.util.Map">
	      INSERT INTO TBSLS_HOUSE_VAT
		  (    
		     	 PBLICTE_SE            /* 발행구분       */
		     	,VAT_SN          	   /* 부가세일련번호       */
			    ,BILL_SE          	   /* 계산서구분       */
				,PBLICTE_YEAR          /* 발행년도       */
				,PBLICTE_QU            /* 발행분기       */
				,MT_SE                 /* 월구분         */
				,CNTRCTR_NO            /* 계약자번호     */
				,PAY_CODE              /* 납부코드       */
				,PBLICTE_DE            /* 발행일자       */
				,PAYAMT                /* 납부금액       */
				,PAY_SUPLY_AMOUNT      /* 납부공급금액   */
				,PAY_VAT               /* 납부부가세     */
				,REGARD_INTR_INTRT     /* 간주이자이율   */
				,DE_CO                 /* 일자수         */
				,NTS_CONFM_NO          /* 국세청승인번호 */
				,REGISTER_ID           /* 등록자ID       */
				,REGIST_DT             /* 등록일시       */
				,UPDUSR_ID             /* 수정자ID       */
				,UPDT_DT               /* 수정일시       */
			                
		  ) 
		  
		 <![CDATA[
			  SELECT '02' AS PBLICTE_SE /* 발행구분: 02 - 간주임대료 */
			        ,(ROW_NUMBER() OVER(ORDER BY A.CNTRCTR_NO) +
			          (SELECT NVL(MAX(VAT_SN), 0)
			                          FROM TBSLS_HOUSE_VAT
			                         WHERE 1 = 1
			                           AND PBLICTE_SE = '02')) AS VAT_SN /* 부가세일련번호       */
			        ,#BILL_SE# /* 계산서구분       */
			        ,#PBLICTE_YEAR# AS PBLICTE_YEAR /* 발행년도 */
			        ,#PBLICTE_QU# AS PBLICTE_QU /* 발행분기 */
			        
			        /*
			        ,(CASE
			           WHEN SUBSTR(S.RQEST_YM, 5, 2) = '01' OR
			                SUBSTR(S.RQEST_YM, 5, 2) = '04' OR
			                SUBSTR(S.RQEST_YM, 5, 2) = '07' OR
			                SUBSTR(S.RQEST_YM, 5, 2) = '10' THEN
			            '1'
			           WHEN SUBSTR(S.RQEST_YM, 5, 2) = '02' OR
			                SUBSTR(S.RQEST_YM, 5, 2) = '05' OR
			                SUBSTR(S.RQEST_YM, 5, 2) = '08' OR
			                SUBSTR(S.RQEST_YM, 5, 2) = '11' THEN
			            '2'
			           WHEN SUBSTR(S.RQEST_YM, 5, 2) = '03' OR
			                SUBSTR(S.RQEST_YM, 5, 2) = '06' OR
			                SUBSTR(S.RQEST_YM, 5, 2) = '09' OR
			                SUBSTR(S.RQEST_YM, 5, 2) = '12' THEN
			            '3'
			           ELSE
			            '0'
			         END) AS MT_SE*/ /* 월구분         */
			         
			        ,0 AS MT_SE /* 월구분         */
			        ,A.CNTRCTR_NO
			        ,'' AS PAY_CODE /*,S.PAY_CODE /* 납부코드                 */
			        ,A.CNTRCT_DE AS PBLICTE_DE /* 수납일자                 */
			        ,NVL(S.PAYAMT
			            ,(SELECT BASS_LTTOT_AMOUNT
			               FROM TBSLS_HOUSE_DONG_HO
			              WHERE HOUSE_CODE = A.HOUSE_CODE
			                AND DONG = A.DONG
			                AND HO = A.HO)) AS PAYAMT /* 납부금액                 */
			        ,SFSLS_GTN_REGARD_INTR('A'
			                              ,A.HOUSE_CODE
			                              ,CASE
			                                 WHEN B.CNTRCTR_NO IS NULL THEN
			                                  TO_DATE(#PBLICTE_YEAR# || Q.LAST_DAY, 'YYYYMMDD')
			                                 ELSE
			                                  TO_DATE(B.CANCL_DE)
			                               END
			                              ,CASE
			                                 WHEN B.CNTRCTR_NO IS NULL THEN
			                                  CASE
			                                    WHEN A.CNTRCT_DE > (#PBLICTE_YEAR# || Q.FIRST_DAY) AND
			                                         A.CNTRCT_DE < (#PBLICTE_YEAR# || Q.LAST_DAY) THEN /*-- 해당 분기내 계약이면*/
			                                     TO_DATE(#PBLICTE_YEAR# || Q.LAST_DAY) - TO_DATE(A.CNTRCT_DE) + 1
			                                    ELSE
			                                     TO_DATE(#PBLICTE_YEAR# || Q.LAST_DAY) - TO_DATE(#PBLICTE_YEAR# || Q.FIRST_DAY) + 1
			                                  END
			                                 ELSE
			                                  TO_DATE(B.CANCL_DE) - TO_DATE(#PBLICTE_YEAR# || Q.FIRST_DAY) + 1
			                               END
			                              ,NVL(S.PAYAMT
			                                  ,(SELECT BASS_LTTOT_AMOUNT
			                                     FROM TBSLS_HOUSE_DONG_HO
			                                    WHERE HOUSE_CODE = A.HOUSE_CODE
			                                      AND DONG = A.DONG
			                                      AND HO = A.HO))) AS PAY_SUPLY_AMOUNT /* 납부공급가액             */
			        ,TRUNC(SFSLS_GTN_REGARD_INTR('A'
			                                    ,A.HOUSE_CODE
			                                    ,CASE
			                                       WHEN B.CNTRCTR_NO IS NULL THEN
			                                        TO_DATE(#PBLICTE_YEAR# || Q.LAST_DAY, 'YYYYMMDD')
			                                       ELSE
			                                        TO_DATE(B.CANCL_DE)
			                                     END
			                                    ,CASE
			                                       WHEN B.CNTRCTR_NO IS NULL THEN
			                                        CASE
			                                          WHEN A.CNTRCT_DE > (#PBLICTE_YEAR# || Q.FIRST_DAY) AND
			                                               A.CNTRCT_DE < (#PBLICTE_YEAR# || Q.LAST_DAY) THEN /*-- 해당 분기내 계약이면*/
			                                           TO_DATE(#PBLICTE_YEAR# || Q.LAST_DAY) - TO_DATE(A.CNTRCT_DE) + 1
			                                          ELSE
			                                           TO_DATE(#PBLICTE_YEAR# || Q.LAST_DAY) - TO_DATE(#PBLICTE_YEAR# || Q.FIRST_DAY) + 1
			                                        END
			                                       ELSE
			                                        TO_DATE(B.CANCL_DE) - TO_DATE(#PBLICTE_YEAR# || Q.FIRST_DAY) + 1
			                                     END
			                                    ,NVL(S.PAYAMT
			                                        ,(SELECT BASS_LTTOT_AMOUNT
			                                           FROM TBSLS_HOUSE_DONG_HO
			                                          WHERE HOUSE_CODE = A.HOUSE_CODE
			                                            AND DONG = A.DONG
			                                            AND HO = A.HO))) * 0.1
			              ,0) AS PAY_VAT /* 납부부가세               */
			        ,SFSLS_GTN_REGARD_INTR('R'
			                              ,A.HOUSE_CODE
			                              ,CASE
			                                 WHEN B.CNTRCTR_NO IS NULL THEN
			                                  TO_DATE(#PBLICTE_YEAR# || Q.LAST_DAY) + 1
			                                 ELSE
			                                  TO_DATE(B.CANCL_DE) + 1
			                               END
			                              ,0
			                              ,0) AS REGARD_INTR_INTRT /* 간주이자이율   */
			        ,CASE
			           WHEN B.CNTRCTR_NO IS NULL THEN
			            CASE
			              WHEN A.CNTRCT_DE > (#PBLICTE_YEAR# || Q.FIRST_DAY) AND
			                   A.CNTRCT_DE < (#PBLICTE_YEAR# || Q.LAST_DAY) THEN /*-- 해당 분기내 계약이면*/
			               TO_DATE(#PBLICTE_YEAR# || Q.LAST_DAY) - TO_DATE(A.CNTRCT_DE) + 1
			              ELSE
			               TO_DATE(#PBLICTE_YEAR# || Q.LAST_DAY) - TO_DATE(#PBLICTE_YEAR# || Q.FIRST_DAY) + 1
			            END
			           ELSE
			            TO_DATE(B.CANCL_DE) - TO_DATE(#PBLICTE_YEAR# || Q.FIRST_DAY) + 1
			         END AS DE_CO /* 일자수         */
			        ,'' AS NTS_CONFM_NO /* 국세청승인번호 */
			        ,#S_USER_ID# AS REGISTER_ID /*등록자ID            */
			        ,SYSDATE AS REGIST_DT /*등록일시                   */
			        ,#S_USER_ID# AS UPDUSR_ID /*수정자ID            */
			        ,SYSDATE AS UPDT_DT /*수정일시                   */
			    FROM TBSLS_HCNTRCTR A
			        ,(SELECT C.CNTRCTR_NO,C.CANCL_DE
			            FROM TBSLS_HCNTRCTR_CANCL C /* 주택계약자해약 */
			               , TBSLS_HOUSE_LTTOT_CANCL D /* 주택분양해약 */
			            
			           WHERE C.CANCL_DE BETWEEN
			                 #PBLICTE_YEAR# ||
			                 DECODE(#PBLICTE_QU#, '1', '01', '2', '04', '3', '07', '10') AND
			                 #PBLICTE_YEAR# ||
			                 DECODE(#PBLICTE_QU#, '1', '03', '2', '06', '3', '09', '12')
			             AND C.CNTRCTR_NO = D.CNTRCTR_NO
			                 ) B
			        ,VISLS_QUARTER_YEAR Q
			        ,(SELECT C.CNTRCTR_NO
			                /* ,C.PAY_CODE
			                ,C.RQEST_YM */
			                ,SUM(PAYAMT) AS PAYAMT
			            FROM TBSLS_HOUSE_LTTOT_PAY C /* 주택분양납부 */
			           WHERE C.PAY_CODE LIKE 'R%'
			           GROUP BY C.CNTRCTR_NO
					           /* ,C.PAY_CODE
					              ,C.RQEST_YM */
			           ) S
			   WHERE A.CNTRCTR_NO = S.CNTRCTR_NO(+)
			     AND A.CNTRCTR_NO = B.CNTRCTR_NO(+)
			     AND A.HOUSE_CODE IN
			         (SELECT HOUSE_CODE FROM TBSLS_HOUSE_INFO WHERE HOUSE_SE = 'S4')
			     AND Q.QUARTER = #PBLICTE_QU#
			     AND a.RENT_LTTOT_CNVRS_DE is null 
			     AND A.RENT_BGNDE <= #PBLICTE_YEAR# || Q.MAX_MM
			     AND (A.CNTRCTR_STTUS_CODE = '01' OR EXISTS
			          (SELECT 1
			             FROM TBSLS_HCNTRCTR_CANCL C /* 주택계약자해약 */
                			 ,TBSLS_HOUSE_LTTOT_CANCL D /* 주택분양해약 */
			            WHERE C.CNTRCTR_NO = A.CNTRCTR_NO
			              AND C.CNTRCTR_NO = D.CNTRCTR_NO
			              AND C.CANCL_DE BETWEEN #PBLICTE_YEAR# || Q.MIN_MM AND #PBLICTE_YEAR# || Q.MAX_MM))
			     AND A.HOUSE_CODE IN
			         (SELECT HOUSE_CODE FROM TBSLS_HOUSE_INFO WHERE USE_AT = '1')
			     
		]]>	 
			 
	  
	</insert>
	
	
	<!-- 주택부가세 추가6  간주임대료 생성 -->
	<insert id="SLS030202DAO.insertHouseVat6" parameterClass="java.util.Map">
	      INSERT INTO TBSLS_HOUSE_VAT
		  (
			  CNTRCTR_NO /* 계약자번호     */
			  ,PBLICTE_SE /* 발행구분       */
			  ,VAT_SN /* 부가세일련번호       */
			  ,BILL_SE /* 계산서구분       */
			  ,PBLICTE_YEAR /* 발행년도       */
			  ,PBLICTE_QU /* 발행분기       */
			  ,MT_SE /* 월구분         */
			   
			  ,PAY_CODE /* 납부코드       */
			  ,PBLICTE_DE /* 발행일자       */
			  ,PAYAMT /* 납부금액       */
			  ,PAY_SUPLY_AMOUNT /* 납부공급금액   */
			  ,PAY_VAT /* 납부부가세     */
			  ,REGARD_INTR_INTRT /* 간주이자이율   */
			  ,DE_CO /* 일자수         */
			  ,NTS_CONFM_NO /* 국세청승인번호 */
			  ,REGISTER_ID /* 등록자ID       */
			  ,REGIST_DT /* 등록일시       */
			  ,UPDUSR_ID /* 수정자ID       */
			  ,UPDT_DT /* 수정일시       */
			)
			   
			 <![CDATA[
			 
			  SELECT DISTINCT A.CNTRCTR_NO
			                 ,'02' AS PBLICTE_SE /* 발행구분 : 02 - 간주임대료 */
			                 ,(ROW_NUMBER() OVER(ORDER BY A.CNTRCTR_NO) +
			                   (SELECT NVL(MAX(VAT_SN), 0)
			                                   FROM TBSLS_HOUSE_VAT
			                                  WHERE 1 = 1
			                                    AND PBLICTE_SE = '02')) AS VAT_SN /* 부가세일련번호       */
			                 ,#BILL_SE# /* 계산서구분       */
			                 ,#PBLICTE_YEAR# AS PBLICTE_YEAR /* 발행년도 */
			                 ,#PBLICTE_QU# AS PBLICTE_QU /* 발행분기 */
			                 ,B.MT_SE /* 월구분         */
			                  
			                 ,B.PAY_CODE
			                 ,A.CNTRCT_DE AS PBLICTE_DE /* 수납일자                 */
			                 ,0 AS PAYAMT /* 납부금액                 */
			                 ,0 AS PAY_SUPLY_AMOUNT /* 납부공급가액             */
			                 ,0 AS PAY_VAT /* 납부부가세               */
			                 ,0.00 AS REGARD_INTR_INTRT /* 간주이자이율   */
			                 ,0 AS DE_CO /* 일자수         */
			                 ,'' AS NTS_CONFM_NO /* 국세청승인번호 */
			                 ,#S_USER_ID# AS REGISTER_ID /*등록자ID            */
			                 ,SYSDATE AS REGIST_DT /*등록일시                   */
			                 ,#S_USER_ID# AS UPDUSR_ID /*수정자ID            */
			                 ,SYSDATE AS UPDT_DT /*수정일시                   */
			    FROM TBSLS_HCNTRCTR A, TBSLS_HOUSE_VAT B
			   WHERE A.CNTRCTR_NO = B.CNTRCTR_NO
			     AND B.PBLICTE_YEAR = #PBLICTE_YEAR#
			     AND B.PBLICTE_QU = #PBLICTE_QU#

			     AND (B.PAY_CODE LIKE 'S%' OR B.PAY_CODE LIKE 'T%')
			     
		]]>	 
			   
			<isNotEmpty property="HOUSE_CODE">
				 AND A.HOUSE_CODE = #HOUSE_CODE#
			</isNotEmpty>
				 
	  
	</insert>
	
	
	<!-- 주택부가세 매출조서 조회  -->
	<select id="SLS030202DAO.selectHouseSellingWtnncList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		<![CDATA[
			SELECT '0' AS CHK
			      ,B.CNTRCTR_NO
			      ,T.HOUSE_DVR_AR  /* 주택전용면적 */
			      ,T.HOUSE_CMNUSE_AR /* 주택공용면적  */
			      ,T.HOUSE_LTTOT_AR /* 주택분양면적  */
			      ,T.HOUSE_CNTRCT_AR  /* 주택계약면적  */
			      ,BB.CSTMR_NM 
			      /* ,SUBSTR(CRYPTO.DEC('PATTERN8', BB.IHIDNUM), 1, 14) AS IHIDNUM */
			      ,BB.IHIDNUM
			      ,B.HOUSE_CODE
			      ,'[ ' || B.HOUSE_CODE || ' ] ' || C.HOUSE_NM AS ALL_HOUSE_NM
			      ,B.DONG
			      ,B.HO
			      ,B.DONG || '-' || B.HO AS DONGHO
			      ,D.BIZRNO
			      ,A.PBLICTE_YEAR
			      ,A.PBLICTE_QU
			      ,SFCMP_GET_CODENM('HOU0A1', A.PAY_CODE) AS PAY_CODE_NM    	/*납부코드 공통코드 HOU0A1*/ 
      			  ,SFCMP_GET_CODENM('HOU0A2', C.HOUSE_SE) AS HOUSE_SE_NM
			      ,B.CNTRCT_DE
			      ,A.PAYAMT AS GTN 								/* 보증금 */
			      ,A.PAY_SUPLY_AMOUNT AS GTN_SUPLY_AMOUNT 		/* 간주이자 공급가액 */
			      ,A.PAY_VAT AS GTN_VAT 						/* 간주이자 부가세 */
			      ,V.MIN_MM || '월' AS MONTH1
			      ,(SELECT DECODE(CHRCTR_PREPAR_VALUE_2
			                     ,NULL
			                     ,''
			                     ,'(' || CHRCTR_PREPAR_VALUE_2 || ')')
			          FROM TBCOM_CMMN_CODE /*    공통코드   */
			         WHERE GRP_CODE = 'HOU0A1'
			           AND CODE = E.PAY_CODE1) || TO_CHAR(TO_DATE(E.PBLICTE_DE1), 'YY.MM.DD') AS PBLICTE_DE1_1
			      ,E.PBLICTE_DE1
			      ,E.PAYAMT1
			      ,E.PAY_SUPLY_AMOUNT1
			      ,E.PAY_VAT1
			      ,V.MID_MM || '월' AS MONTH2
			      ,(SELECT DECODE(CHRCTR_PREPAR_VALUE_2
			                     ,NULL
			                     ,''
			                     ,'(' || CHRCTR_PREPAR_VALUE_2 || ')')
			          FROM TBCOM_CMMN_CODE
			         WHERE GRP_CODE = 'HOU0A1'
			           AND CODE = E.PAY_CODE2) || TO_CHAR(TO_DATE(E.PBLICTE_DE2), 'YY.MM.DD') AS PBLICTE_DE2_1
			      ,E.PBLICTE_DE2
			      ,E.PAYAMT2
			      ,E.PAY_SUPLY_AMOUNT2
			      ,E.PAY_VAT2
			      ,V.MAX_MM || '월' AS MONTH3
			      ,(SELECT DECODE(CHRCTR_PREPAR_VALUE_2
			                     ,NULL
			                     ,''
			                     ,'(' || CHRCTR_PREPAR_VALUE_2 || ')')
			          FROM TBCOM_CMMN_CODE
			         WHERE GRP_CODE = 'HOU0A1'
			           AND CODE = E.PAY_CODE3) || TO_CHAR(TO_DATE(E.PBLICTE_DE3), 'YY.MM.DD') AS PBLICTE_DE3_1
			      ,E.PBLICTE_DE3
			      ,E.PAYAMT3
			      ,E.PAY_SUPLY_AMOUNT3
			      ,E.PAY_VAT3
			      ,F.LTTOT_AMOUNT
			      ,E.PAYAMT1 + E.PAYAMT2 + E.PAYAMT3 AS TOT_PAYAMT
			      ,E.PAY_SUPLY_AMOUNT1 + E.PAY_SUPLY_AMOUNT2 + E.PAY_SUPLY_AMOUNT3 AS TOT_PAY_SUPLY_AMOUNT
			      ,E.PAY_VAT1 + E.PAY_VAT2 + E.PAY_VAT3 AS TOT_PAY_VAT
			      ,1 AS CNT
			      ,#PBLICTE_YEAR# || '-' || V.FIRST_DAY || ' ~ ' || #PBLICTE_YEAR# || '-' || V.LAST_DAY AS TAX_BETWEEN
			      ,NVL(T.PLOT_CT, 0) AS PLOT_CT
			      ,NVL(T.BILDNG_CT, 0) AS BILDNG_CT
			  FROM  (SELECT * FROM TBSLS_HOUSE_VAT A 
                                  WHERE A.PBLICTE_YEAR = #PBLICTE_YEAR#
                                    AND A.PBLICTE_QU =  #PBLICTE_QU#
                                    AND A.PBLICTE_SE = '02'   /* 간주임대료정보 */
                                    AND A.VAT_SN = (SELECT MAX(B.VAT_SN) FROM TBSLS_HOUSE_VAT B
                                                     WHERE B.CNTRCTR_NO = A.CNTRCTR_NO
                                                       AND B.PBLICTE_YEAR = A.PBLICTE_YEAR
                                                       AND B.PBLICTE_QU = A.PBLICTE_QU
                                                       AND B.PBLICTE_SE = A.PBLICTE_SE   /* 간주임대료정보 */
                                                    )
                                 )  A 			/*  주택부가세 : 간주임대료정보  PBLICTE_SE = '02' */
			      ,TBSLS_HCNTRCTR B 			/*  주택계약자 */
			      ,TBSLS_HOUSE_CSTMR BB 		/*  주택고객  */
			      ,TBSLS_HOUSE_INFO C 			/*  주택정보   */
			      ,TBSLS_HCNTRCTR_BSNM D 		/*  주택계약자사업자  */
			      ,TBSLS_HOUSE_DONG_HO F 		/*  주택동호   */
			      ,TBSLS_HOUSE_TY T 			/*  주택타입   */
			      ,VISLS_QUARTER_YEAR V
			      ,(SELECT PBLICTE_YEAR
			              ,PBLICTE_QU
			              ,CNTRCTR_NO
			              ,MAX(PAY_CODE1) AS PAY_CODE1
			              ,MAX(PBLICTE_DE1) AS PBLICTE_DE1
			              ,SUM(PAYAMT1) AS PAYAMT1
			              ,SUM(PAY_SUPLY_AMOUNT1) AS PAY_SUPLY_AMOUNT1
			              ,SUM(PAY_VAT1) AS PAY_VAT1
			              ,MAX(PAY_CODE2) AS PAY_CODE2
			              ,MAX(PBLICTE_DE2) AS PBLICTE_DE2
			              ,SUM(PAYAMT2) AS PAYAMT2
			              ,SUM(PAY_SUPLY_AMOUNT2) AS PAY_SUPLY_AMOUNT2
			              ,SUM(PAY_VAT2) AS PAY_VAT2
			              ,MAX(PAY_CODE3) AS PAY_CODE3
			              ,MAX(PBLICTE_DE3) AS PBLICTE_DE3
			              ,SUM(PAYAMT3) AS PAYAMT3
			              ,SUM(PAY_SUPLY_AMOUNT3) AS PAY_SUPLY_AMOUNT3
			              ,SUM(PAY_VAT3) AS PAY_VAT3
			          FROM (
			                
			                SELECT PBLICTE_YEAR
			                       ,PBLICTE_QU
			                       ,CNTRCTR_NO
			                       ,(CASE WHEN MT_SE = '1' THEN PAY_CODE ELSE NULL END) AS PAY_CODE1
			                       ,(CASE WHEN MT_SE = '1' THEN PBLICTE_DE  ELSE NULL END) AS PBLICTE_DE1
			                       ,(CASE WHEN MT_SE = '1' THEN PAYAMT ELSE 0 END) AS PAYAMT1                       
			                       ,(CASE WHEN MT_SE = '1' THEN PAY_SUPLY_AMOUNT ELSE 0 END) AS PAY_SUPLY_AMOUNT1
			                       ,(CASE WHEN MT_SE = '1' THEN PAY_VAT ELSE 0 END) AS PAY_VAT1
			                       
			                       ,(CASE WHEN MT_SE = '2' THEN PAY_CODE ELSE NULL END) AS PAY_CODE2
			                       ,(CASE WHEN MT_SE = '2' THEN PBLICTE_DE  ELSE NULL END) AS PBLICTE_DE2
			                       ,(CASE WHEN MT_SE = '2' THEN PAYAMT ELSE 0 END) AS PAYAMT2                       
			                       ,(CASE WHEN MT_SE = '2' THEN PAY_SUPLY_AMOUNT ELSE 0 END) AS PAY_SUPLY_AMOUNT2
			                       ,(CASE WHEN MT_SE = '2' THEN PAY_VAT ELSE 0 END) AS PAY_VAT2
			                       
			                       ,(CASE WHEN MT_SE = '3' THEN PAY_CODE ELSE NULL END) AS PAY_CODE3
			                       ,(CASE WHEN MT_SE = '3' THEN PBLICTE_DE  ELSE NULL END) AS PBLICTE_DE3
			                       ,(CASE WHEN MT_SE = '3' THEN PAYAMT ELSE 0 END) AS PAYAMT3                       
			                       ,(CASE WHEN MT_SE = '3' THEN PAY_SUPLY_AMOUNT ELSE 0 END) AS PAY_SUPLY_AMOUNT3
			                       ,(CASE WHEN MT_SE = '3' THEN PAY_VAT ELSE 0 END) AS PAY_VAT3
                       
			                  FROM TBSLS_HOUSE_VAT /*    주택부가세 : 계약자 부가세내역 PBLICTE_SE = '01'  */
			                 WHERE PBLICTE_YEAR = #PBLICTE_YEAR#
			                   AND PBLICTE_QU = #PBLICTE_QU#
			                   AND PBLICTE_SE = '01'
			                   )
			         GROUP BY PBLICTE_YEAR, PBLICTE_QU, CNTRCTR_NO) E
			 WHERE A.PBLICTE_YEAR = #PBLICTE_YEAR#
			   AND A.PBLICTE_QU = #PBLICTE_QU#
			   AND A.PBLICTE_SE = '02'
			   AND A.CNTRCTR_NO = B.CNTRCTR_NO
			   AND A.PBLICTE_YEAR = E.PBLICTE_YEAR
			   AND A.PBLICTE_QU = E.PBLICTE_QU
			   AND A.CNTRCTR_NO = E.CNTRCTR_NO
			      
			   AND B.HOUSE_CSTMR_NO = BB.HOUSE_CSTMR_NO
			   AND B.HOUSE_CODE = C.HOUSE_CODE
			   
			   AND A.CNTRCTR_NO = D.CNTRCTR_NO(+)
			   AND V.QUARTER = A.PBLICTE_QU
			  
			   AND B.HOUSE_CODE = T.HOUSE_CODE(+)
			  
			   AND T.HOUSE_TY_CODE = F.HOUSE_TY_CODE(+)
			      
			   AND B.HOUSE_CODE = F.HOUSE_CODE
			   AND B.DONG = F.DONG
			   AND B.HO = F.HO
			   AND B.HOUSE_CODE = F.HOUSE_CODE

		]]>
			
			<isNotEmpty property="HOUSE_CODE">
				AND B.HOUSE_CODE = #HOUSE_CODE#
			</isNotEmpty>
						
			<isNotEmpty property="DONG">
			   	AND B.DONG LIKE '%' || #DONG# || '%'
			</isNotEmpty>
			
			<isNotEmpty property="HO">
			   	AND B.HO LIKE '%' || #HO# || '%'
			</isNotEmpty>
			
			<isNotEmpty property="HOUSE_GBN">
				AND #HOUSE_GBN# = INSTR('S4', C.HOUSE_SE) /*  주택:0,  상가:1 */
			</isNotEmpty>			
						 
			 ORDER BY B.HOUSE_CODE, B.DONG, B.HO
			 
	</select>
	
	<!-- 주택부가세 매출조서 조회_old  -->
	<select id="SLS030202DAO.selectHouseSellingWtnncList_old" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		<![CDATA[
			SELECT A.PAY_CODE
				  , SFCMP_GET_CODENM('HOU0A1', A.PAY_CODE) AS PAY_CODE_NM    	/*납부코드 공통코드 HOU0A1*/ 
			 	  , B.HOUSE_CODE
			 	  , SFSLS_HOUSE_NM(B.HOUSE_CODE, 'ALL_HOUSE_NM') AS ALL_HOUSE_NM  /* [코드]주택명 */
       			  , B.DONG
       			  , B.HO       			  
			      , C.CSTMR_NM
			      , D.LTTOT_AMOUNT
      			  
      			  , E.PLOT_CT 
      			  , E.BILDNG_CT  
			      
			      , SUM(CASE WHEN A.PBLICTE_QU  = '1' AND A.MT_SE = '1' THEN A.PBLICTE_DE  ELSE NULL END) AS PBLICTE_DE1
			      , TRUNC(SUM(CASE WHEN A.PBLICTE_QU  = '1' AND A.MT_SE = '1' THEN A.PAYAMT ELSE 0 END) / 1, 0) AS PAYAMT1
			      , SUM(CASE WHEN A.PBLICTE_QU  = '1' AND A.MT_SE = '2' THEN A.PBLICTE_DE  ELSE NULL END) AS PBLICTE_DE2
			      , TRUNC(SUM(CASE WHEN A.PBLICTE_QU  = '1' AND A.MT_SE = '2' THEN A.PAYAMT ELSE 0 END) / 1, 0) AS PAYAMT2
			      , SUM(CASE WHEN A.PBLICTE_QU  = '1' AND A.MT_SE = '3' THEN A.PBLICTE_DE  ELSE NULL END) AS PBLICTE_DE3
			      , TRUNC(SUM(CASE WHEN A.PBLICTE_QU  = '1' AND A.MT_SE = '3' THEN A.PAYAMT ELSE 0 END) / 1, 0) AS PAYAMT3
			      
			      , TRUNC(SUM(CASE WHEN A.PBLICTE_QU  = '1' THEN A.PAY_SUPLY_AMOUNT ELSE 0 END) / 1, 0) AS PAY_SUPLY_AMOUNT1
			      , TRUNC(SUM(CASE WHEN A.PBLICTE_QU  = '1' THEN A.PAY_VAT ELSE 0 END) / 1, 0) AS PAY_VAT1
			      
			      , SUM(CASE WHEN A.PBLICTE_QU  = '2' AND A.MT_SE = '1' THEN A.PBLICTE_DE  ELSE NULL END) AS PBLICTE_DE4
			      , TRUNC(SUM(CASE WHEN A.PBLICTE_QU  = '2' AND A.MT_SE = '1' THEN A.PAYAMT ELSE 0 END) / 1, 0) AS PAYAMT4
			      , SUM(CASE WHEN A.PBLICTE_QU  = '2' AND A.MT_SE = '2' THEN A.PBLICTE_DE  ELSE NULL END) AS PBLICTE_DE5
			      , TRUNC(SUM(CASE WHEN A.PBLICTE_QU  = '2' AND A.MT_SE = '2' THEN A.PAYAMT ELSE 0 END) / 1, 0) AS PAYAMT5
			      , SUM(CASE WHEN A.PBLICTE_QU  = '2' AND A.MT_SE = '3' THEN A.PBLICTE_DE  ELSE NULL END) AS PBLICTE_DE5
			      , TRUNC(SUM(CASE WHEN A.PBLICTE_QU  = '2' AND A.MT_SE = '3' THEN A.PAYAMT ELSE 0 END) / 1, 0) AS PAYAMT6
			      
			      , TRUNC(SUM(CASE WHEN A.PBLICTE_QU  = '2' THEN A.PAY_SUPLY_AMOUNT ELSE 0 END) / 1, 0) AS PAY_SUPLY_AMOUNT2
			      , TRUNC(SUM(CASE WHEN A.PBLICTE_QU  = '2' THEN A.PAY_VAT ELSE 0 END) / 1, 0) AS PAY_VAT2
			      
			      , SUM(CASE WHEN A.PBLICTE_QU  = '3' AND A.MT_SE = '1' THEN A.PBLICTE_DE  ELSE NULL END) AS PBLICTE_DE7
			      , TRUNC(SUM(CASE WHEN A.PBLICTE_QU  = '3' AND A.MT_SE = '1' THEN A.PAYAMT ELSE 0 END) / 1, 0) AS PAYAMT7
			      , SUM(CASE WHEN A.PBLICTE_QU  = '3' AND A.MT_SE = '2' THEN A.PBLICTE_DE  ELSE NULL END) AS PBLICTE_DE8
			      , TRUNC(SUM(CASE WHEN A.PBLICTE_QU  = '3' AND A.MT_SE = '2' THEN A.PAYAMT ELSE 0 END) / 1, 0) AS PAYAMT8
			      , SUM(CASE WHEN A.PBLICTE_QU  = '3' AND A.MT_SE = '3' THEN A.PBLICTE_DE  ELSE NULL END) AS PBLICTE_DE9
			      , TRUNC(SUM(CASE WHEN A.PBLICTE_QU  = '3' AND A.MT_SE = '3' THEN A.PAYAMT ELSE 0 END) / 1, 0) AS PAYAMT9
			      
			      , TRUNC(SUM(CASE WHEN A.PBLICTE_QU  = '3' THEN A.PAY_SUPLY_AMOUNT ELSE 0 END) / 1, 0) AS PAY_SUPLY_AMOUNT3
			      , TRUNC(SUM(CASE WHEN A.PBLICTE_QU  = '3' THEN A.PAY_VAT ELSE 0 END) / 1, 0) AS PAY_VAT3
			      
			      , SUM(CASE WHEN A.PBLICTE_QU  = '4' AND A.MT_SE = '1' THEN A.PBLICTE_DE  ELSE NULL END) AS PBLICTE_DE10
			      , TRUNC(SUM(CASE WHEN A.PBLICTE_QU  = '4' AND A.MT_SE = '1' THEN A.PAYAMT ELSE 0 END) / 1, 0) AS PAYAMT10
			      , SUM(CASE WHEN A.PBLICTE_QU  = '4' AND A.MT_SE = '2' THEN A.PBLICTE_DE  ELSE NULL END) AS PBLICTE_DE11
			      , TRUNC(SUM(CASE WHEN A.PBLICTE_QU  = '4' AND A.MT_SE = '2' THEN A.PAYAMT ELSE 0 END) / 1, 0) AS PAYAMT11
			      , SUM(CASE WHEN A.PBLICTE_QU  = '4' AND A.MT_SE = '3' THEN A.PBLICTE_DE  ELSE NULL END) AS PBLICTE_DE12
			      , TRUNC(SUM(CASE WHEN A.PBLICTE_QU  = '4' AND A.MT_SE = '3' THEN A.PAYAMT ELSE 0 END) / 1, 0) AS PAYAMT12
			      
			      , TRUNC(SUM(CASE WHEN A.PBLICTE_QU  = '4' THEN A.PAY_SUPLY_AMOUNT ELSE 0 END) / 1, 0) AS PAY_SUPLY_AMOUNT4
			      , TRUNC(SUM(CASE WHEN A.PBLICTE_QU  = '4' THEN A.PAY_VAT ELSE 0 END) / 1, 0) AS PAY_VAT4
			       
			  FROM TBSLS_HOUSE_VAT A
			       ,TBSLS_HCNTRCTR B /* 주택계약자 */
			       ,TBSLS_HOUSE_CSTMR C /* 주택고객 */
			       ,TBSLS_HOUSE_DONG_HO D  /* 주택동호 */
			       ,TBSLS_HOUSE_TY E /* 주택타입 */
			       
			 WHERE 1 = 1
			   AND A.CNTRCTR_NO = B.CNTRCTR_NO     
			   AND B.HOUSE_CSTMR_NO = C.HOUSE_CSTMR_NO
			   AND B.HOUSE_CODE = D.HOUSE_CODE
               AND B.DONG  = D.DONG 
               AND B.HO  = D.HO
               AND B.HOUSE_CODE = E.HOUSE_CODE 
               AND D.HOUSE_TY_CODE = E.HOUSE_TY_CODE
		]]>
			   
			<isNotEmpty property="PBLICTE_SE">
			   	AND A.PBLICTE_SE = #PBLICTE_SE#
			</isNotEmpty>
			
			<isNotEmpty property="PBLICTE_YEAR">
			   	AND A.PBLICTE_YEAR = #PBLICTE_YEAR#
			</isNotEmpty>
			
			<!--
			<isNotEmpty property="PBLICTE_QU">
			   	AND A.PBLICTE_QU = #PBLICTE_QU#
			</isNotEmpty>
			-->
			
			<isNotEmpty property="MT_SE">
			   	AND A.MT_SE = #MT_SE#
			</isNotEmpty>
			
			<isNotEmpty property="CNTRCTR_NO">
			   	AND A.CNTRCTR_NO = #CNTRCTR_NO#
			</isNotEmpty>
			
			<isNotEmpty property="PAY_CODE">
			   	AND A.PAY_CODE = #PAY_CODE#
			</isNotEmpty>
			
			<isNotEmpty property="HOUSE_CODE">
				AND B.HOUSE_CODE = #HOUSE_CODE#
			</isNotEmpty>
						
			<isNotEmpty property="DONG">
			   	AND B.DONG LIKE '%' || #DONG# || '%'
			</isNotEmpty>
			
			<isNotEmpty property="HO">
			   	AND B.HO LIKE '%' || #HO# || '%'
			</isNotEmpty>
			
			GROUP BY A.PAY_CODE, B.HOUSE_CODE, B.DONG, B.HO, D.LTTOT_AMOUNT, E.PLOT_CT, E.BILDNG_CT, C.CSTMR_NM
			ORDER BY B.HOUSE_CODE, B.DONG, B.HO, A.PAY_CODE, C.CSTMR_NM
			 
	</select>
	
	
	
	<!-- 세금계산서_합계 출력 조회  -->
	<select id="SLS030202DAO.selectHouseTaxbillSumList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		<![CDATA[
			SELECT V1.MIN_DATE
			      ,V1.MAX_DATE
			      ,DECODE(V1.MIN_DATE,'01','',TO_CHAR(TO_DATE(V1.MIN_DATE), 'YYYY-MM-DD')) || ' ~ ' ||
       			   DECODE(V1.MAX_DATE,'','',TO_CHAR(TO_DATE(V1.MAX_DATE), 'YYYY-MM-DD')) AS BETWEEN_DATE
			      ,V1.BIZ_CNT1
			      ,V1.TAX_CNT1
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT1, 1, 1) AS PAY_SUPLY_AMOUNT1_1
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT1, 2, 1) AS PAY_SUPLY_AMOUNT1_2
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT1, 3, 1) AS PAY_SUPLY_AMOUNT1_3
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT1, 4, 1) AS PAY_SUPLY_AMOUNT1_4
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT1, 5, 1) AS PAY_SUPLY_AMOUNT1_5
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT1, 6, 1) AS PAY_SUPLY_AMOUNT1_6
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT1, 7, 1) AS PAY_SUPLY_AMOUNT1_7
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT1, 8, 1) AS PAY_SUPLY_AMOUNT1_8
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT1, 9, 1) AS PAY_SUPLY_AMOUNT1_9
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT1, 10, 1) AS PAY_SUPLY_AMOUNT1_10
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT1, 11, 1) AS PAY_SUPLY_AMOUNT1_11
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT1, 12, 1) AS PAY_SUPLY_AMOUNT1_12
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT1, 13, 1) AS PAY_SUPLY_AMOUNT1_13
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT1, 14, 1) AS PAY_SUPLY_AMOUNT1_14
			      ,SUBSTR(V1.TOT_PAY_VAT1, 1, 1) AS PAY_VAT1_1
			      ,SUBSTR(V1.TOT_PAY_VAT1, 2, 1) AS PAY_VAT1_2
			      ,SUBSTR(V1.TOT_PAY_VAT1, 3, 1) AS PAY_VAT1_3
			      ,SUBSTR(V1.TOT_PAY_VAT1, 4, 1) AS PAY_VAT1_4
			      ,SUBSTR(V1.TOT_PAY_VAT1, 5, 1) AS PAY_VAT1_5
			      ,SUBSTR(V1.TOT_PAY_VAT1, 6, 1) AS PAY_VAT1_6
			      ,SUBSTR(V1.TOT_PAY_VAT1, 7, 1) AS PAY_VAT1_7
			      ,SUBSTR(V1.TOT_PAY_VAT1, 8, 1) AS PAY_VAT1_8
			      ,SUBSTR(V1.TOT_PAY_VAT1, 9, 1) AS PAY_VAT1_9
			      ,SUBSTR(V1.TOT_PAY_VAT1, 10, 1) AS PAY_VAT1_10
			      ,SUBSTR(V1.TOT_PAY_VAT1, 11, 1) AS PAY_VAT1_11
			      ,SUBSTR(V1.TOT_PAY_VAT1, 12, 1) AS PAY_VAT1_12
			      ,SUBSTR(V1.TOT_PAY_VAT1, 13, 1) AS PAY_VAT1_13
			      ,V1.BIZ_CNT2
			      ,V1.TAX_CNT2
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT2, 1, 1) AS PAY_SUPLY_AMOUNT2_1
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT2, 2, 1) AS PAY_SUPLY_AMOUNT2_2
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT2, 3, 1) AS PAY_SUPLY_AMOUNT2_3
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT2, 4, 1) AS PAY_SUPLY_AMOUNT2_4
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT2, 5, 1) AS PAY_SUPLY_AMOUNT2_5
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT2, 6, 1) AS PAY_SUPLY_AMOUNT2_6
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT2, 7, 1) AS PAY_SUPLY_AMOUNT2_7
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT2, 8, 1) AS PAY_SUPLY_AMOUNT2_8
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT2, 9, 1) AS PAY_SUPLY_AMOUNT2_9
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT2, 10, 1) AS PAY_SUPLY_AMOUNT2_10
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT2, 11, 1) AS PAY_SUPLY_AMOUNT2_11
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT2, 12, 1) AS PAY_SUPLY_AMOUNT2_12
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT2, 13, 1) AS PAY_SUPLY_AMOUNT2_13
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT2, 14, 1) AS PAY_SUPLY_AMOUNT2_14
			      ,SUBSTR(V1.TOT_PAY_VAT2, 1, 1) AS PAY_VAT2_1
			      ,SUBSTR(V1.TOT_PAY_VAT2, 2, 1) AS PAY_VAT2_2
			      ,SUBSTR(V1.TOT_PAY_VAT2, 3, 1) AS PAY_VAT2_3
			      ,SUBSTR(V1.TOT_PAY_VAT2, 4, 1) AS PAY_VAT2_4
			      ,SUBSTR(V1.TOT_PAY_VAT2, 5, 1) AS PAY_VAT2_5
			      ,SUBSTR(V1.TOT_PAY_VAT2, 6, 1) AS PAY_VAT2_6
			      ,SUBSTR(V1.TOT_PAY_VAT2, 7, 1) AS PAY_VAT2_7
			      ,SUBSTR(V1.TOT_PAY_VAT2, 8, 1) AS PAY_VAT2_8
			      ,SUBSTR(V1.TOT_PAY_VAT2, 9, 1) AS PAY_VAT2_9
			      ,SUBSTR(V1.TOT_PAY_VAT2, 10, 1) AS PAY_VAT2_10
			      ,SUBSTR(V1.TOT_PAY_VAT2, 11, 1) AS PAY_VAT2_11
			      ,SUBSTR(V1.TOT_PAY_VAT2, 12, 1) AS PAY_VAT2_12
			      ,SUBSTR(V1.TOT_PAY_VAT2, 13, 1) AS PAY_VAT2_13
			      ,V1.BIZ_CNT3
			      ,V1.TAX_CNT3
			      ,V1.T_AMT3
			      ,V1.T_PAY_VAT3
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT3, 1, 1) AS PAY_SUPLY_AMOUNT3_1
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT3, 2, 1) AS PAY_SUPLY_AMOUNT3_2
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT3, 3, 1) AS PAY_SUPLY_AMOUNT3_3
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT3, 4, 1) AS PAY_SUPLY_AMOUNT3_4
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT3, 5, 1) AS PAY_SUPLY_AMOUNT3_5
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT3, 6, 1) AS PAY_SUPLY_AMOUNT3_6
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT3, 7, 1) AS PAY_SUPLY_AMOUNT3_7
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT3, 8, 1) AS PAY_SUPLY_AMOUNT3_8
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT3, 9, 1) AS PAY_SUPLY_AMOUNT3_9
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT3, 10, 1) AS PAY_SUPLY_AMOUNT3_10
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT3, 11, 1) AS PAY_SUPLY_AMOUNT3_11
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT3, 12, 1) AS PAY_SUPLY_AMOUNT3_12
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT3, 13, 1) AS PAY_SUPLY_AMOUNT3_13
			      ,SUBSTR(V1.TOT_PAY_SUPLY_AMOUNT3, 14, 1) AS PAY_SUPLY_AMOUNT3_14
			      ,SUBSTR(V1.TOT_PAY_VAT3, 1, 1) AS PAY_VAT3_1
			      ,SUBSTR(V1.TOT_PAY_VAT3, 2, 1) AS PAY_VAT3_2
			      ,SUBSTR(V1.TOT_PAY_VAT3, 3, 1) AS PAY_VAT3_3
			      ,SUBSTR(V1.TOT_PAY_VAT3, 4, 1) AS PAY_VAT3_4
			      ,SUBSTR(V1.TOT_PAY_VAT3, 5, 1) AS PAY_VAT3_5
			      ,SUBSTR(V1.TOT_PAY_VAT3, 6, 1) AS PAY_VAT3_6
			      ,SUBSTR(V1.TOT_PAY_VAT3, 7, 1) AS PAY_VAT3_7
			      ,SUBSTR(V1.TOT_PAY_VAT3, 8, 1) AS PAY_VAT3_8
			      ,SUBSTR(V1.TOT_PAY_VAT3, 9, 1) AS PAY_VAT3_9
			      ,SUBSTR(V1.TOT_PAY_VAT3, 10, 1) AS PAY_VAT3_10
			      ,SUBSTR(V1.TOT_PAY_VAT3, 11, 1) AS PAY_VAT3_11
			      ,SUBSTR(V1.TOT_PAY_VAT3, 12, 1) AS PAY_VAT3_12
			      ,SUBSTR(V1.TOT_PAY_VAT3, 13, 1) AS PAY_VAT3_13
			      ,S.*
			
			  FROM (SELECT MAX(V.MIN_DATE) AS MIN_DATE
			              ,MAX(V.MAX_DATE) AS MAX_DATE
			              ,SUM(V.BIZ_CNT1) AS BIZ_CNT1
			              ,SUM(V.TAX_CNT1) AS TAX_CNT1
			              ,LPAD(SUM(V.TOT_PAY_SUPLY_AMOUNT1), 14, '*') AS TOT_PAY_SUPLY_AMOUNT1
			              ,LPAD(SUM(V.TOT_PAY_VAT1), 13, '*') AS TOT_PAY_VAT1
			              ,SUM(V.BIZ_CNT2) AS BIZ_CNT2
			              ,SUM(V.TAX_CNT2) AS TAX_CNT2
			              ,LPAD(SUM(V.TOT_PAY_SUPLY_AMOUNT2), 14, '*') AS TOT_PAY_SUPLY_AMOUNT2
			              ,LPAD(SUM(V.TOT_PAY_VAT2), 13, '*') AS TOT_PAY_VAT2
			              ,SUM(V.BIZ_CNT3) AS BIZ_CNT3
			              ,SUM(V.TAX_CNT3) AS TAX_CNT3
			              ,LPAD(SUM(V.TOT_PAY_SUPLY_AMOUNT3), 14, '*') AS TOT_PAY_SUPLY_AMOUNT3
			              ,LPAD(SUM(V.TOT_PAY_VAT3), 13, '*') AS TOT_PAY_VAT3
			              ,SUM(V.TOT_PAY_SUPLY_AMOUNT3) AS T_AMT3
			              ,SUM(V.TOT_PAY_VAT3) AS T_PAY_VAT3
			        
			          FROM (SELECT SUBSTR(MIN(A.PBLICTE_DE), 0, 6) || '01' AS MIN_DATE
			                      ,MAX(A.PBLICTE_DE) AS MAX_DATE
			                      ,COUNT(DISTINCT CNTRCTR_NO) AS BIZ_CNT1
			                      ,COUNT(1) AS TAX_CNT1
			                      ,SUM(PAY_SUPLY_AMOUNT) AS TOT_PAY_SUPLY_AMOUNT1
			                      ,SUM(PAY_VAT) AS TOT_PAY_VAT1
			                      ,0 AS BIZ_CNT2
			                      ,0 AS TAX_CNT2
			                      ,0 AS TOT_PAY_SUPLY_AMOUNT2
			                      ,0 AS TOT_PAY_VAT2
			                      ,0 AS BIZ_CNT3
			                      ,0 AS TAX_CNT3
			                      ,0 AS TOT_PAY_SUPLY_AMOUNT3
			                      ,0 AS TOT_PAY_VAT3
			                
			                  FROM TBSLS_HOUSE_VAT A /* 주택부가세 */
			                 WHERE A.PBLICTE_YEAR = #PBLICTE_YEAR#
			                   AND A.PBLICTE_QU = #PBLICTE_QU#
			                   AND A.PAY_CODE IS NOT NULL
			                
			                UNION ALL
			                
			                SELECT NULL AS MIN_DATE
			                      ,NULL AS MAX_DATE
			                      ,0 AS BIZ_CNT1
			                      ,0 AS TAX_CNT1
			                      ,0 AS TOT_PAY_SUPLY_AMOUNT1
			                      ,0 AS TOT_PAY_VAT1
			                      ,COUNT(DISTINCT CNTRCTR_NO) BIZ_CNT2
			                      ,COUNT(1) AS TAX_CNT2
			                      ,SUM(PAY_SUPLY_AMOUNT) AS TOT_PAY_SUPLY_AMOUNT2
			                      ,SUM(PAY_VAT) AS TOT_PAY_VAT2
			                      ,0 AS BIZ_CNT3
			                      ,0 AS TAX_CNT3
			                      ,0 AS TOT_PAY_SUPLY_AMOUNT3
			                      ,0 AS TOT_PAY_VAT3
			                
			                  FROM TBSLS_HOUSE_VAT A /* 주택부가세 */
			                 WHERE A.PBLICTE_YEAR = #PBLICTE_YEAR#
			                   AND A.PBLICTE_QU = #PBLICTE_QU#
			                   AND A.PAY_CODE IS NOT NULL
			                   AND EXISTS
			                 (SELECT 1
			                          FROM TBSLS_HCNTRCTR_BSNM V /* 주택계약자사업자 */
			                         WHERE A.CNTRCTR_NO = V.CNTRCTR_NO
			                           AND V.BIZRNO IS NOT NULL
			                           AND A.PBLICTE_DE >= (CASE
			                                 WHEN SUBSTR(V.BSNS_CONFM_DE, 5, 2) >= '01' AND
			                                      SUBSTR(V.BSNS_CONFM_DE, 5, 2) <= '03' THEN
			                                  SUBSTR(V.BSNS_CONFM_DE, 0, 4) || '0101'
			                                 WHEN SUBSTR(V.BSNS_CONFM_DE, 5, 2) >= '04' AND
			                                      SUBSTR(V.BSNS_CONFM_DE, 5, 2) <= '06' THEN
			                                  SUBSTR(V.BSNS_CONFM_DE, 0, 4) || '0401'
			                                 WHEN SUBSTR(V.BSNS_CONFM_DE, 5, 2) >= '07' AND
			                                      SUBSTR(V.BSNS_CONFM_DE, 5, 2) <= '09' THEN
			                                  SUBSTR(V.BSNS_CONFM_DE, 0, 4) || '0701'
			                                 WHEN SUBSTR(V.BSNS_CONFM_DE, 5, 2) >= '10' AND
			                                      SUBSTR(V.BSNS_CONFM_DE, 5, 2) <= '12' THEN
			                                  SUBSTR(V.BSNS_CONFM_DE, 0, 4) || '1001'
			                               END))
			                
			                UNION ALL
			                
			                SELECT NULL AS MIN_DATE
			                      ,NULL AS MAX_DATE
			                      ,0 AS BIZ_CNT1
			                      ,0 AS TAX_CNT1
			                      ,0 AS TOT_PAY_SUPLY_AMOUNT1
			                      ,0 AS TOT_PAY_VAT1
			                      ,0 AS BIZ_CNT2
			                      ,0 AS TAX_CNT2
			                      ,0 AS TOT_PAY_SUPLY_AMOUNT2
			                      ,0 AS TOT_PAY_VAT2
			                      ,COUNT(DISTINCT CNTRCTR_NO) BIZ_CNT3
			                      ,COUNT(1) AS TAX_CNT3
			                      ,SUM(PAY_SUPLY_AMOUNT) AS TOT_PAY_SUPLY_AMOUNT3
			                      ,SUM(PAY_VAT) AS TOT_PAY_VAT3
			                
			                  FROM TBSLS_HOUSE_VAT A /* 주택부가세 */
			                
			                 WHERE A.PBLICTE_YEAR = #PBLICTE_YEAR#
			                   AND A.PBLICTE_QU = #PBLICTE_QU#
			                   AND A.PAY_CODE IS NOT NULL
			                   AND NOT EXISTS
			                 (SELECT 1
			                          FROM TBSLS_HCNTRCTR_BSNM V /* 주택계약자사업자 */
			                         WHERE A.CNTRCTR_NO = V.CNTRCTR_NO
			                           AND V.BIZRNO IS NOT NULL
			                           AND A.PBLICTE_DE >= (CASE
			                                 WHEN SUBSTR(V.BSNS_CONFM_DE, 5, 2) >= '01' AND
			                                      SUBSTR(V.BSNS_CONFM_DE, 5, 2) <= '03' THEN
			                                  SUBSTR(V.BSNS_CONFM_DE, 0, 4) || '0101'
			                                 WHEN SUBSTR(V.BSNS_CONFM_DE, 5, 2) >= '04' AND
			                                      SUBSTR(V.BSNS_CONFM_DE, 5, 2) <= '06' THEN
			                                  SUBSTR(V.BSNS_CONFM_DE, 0, 4) || '0401'
			                                 WHEN SUBSTR(V.BSNS_CONFM_DE, 5, 2) >= '07' AND
			                                      SUBSTR(V.BSNS_CONFM_DE, 5, 2) <= '09' THEN
			                                  SUBSTR(V.BSNS_CONFM_DE, 0, 4) || '0701'
			                                 WHEN SUBSTR(V.BSNS_CONFM_DE, 5, 2) >= '10' AND
			                                      SUBSTR(V.BSNS_CONFM_DE, 5, 2) <= '12' THEN
			                                  SUBSTR(V.BSNS_CONFM_DE, 0, 4) || '1001'
			                               END))) V) V1
			      ,TBPMS_CPR_INFO S /* 법인정보 */ 
		]]>
			 
	</select>
	
	<!-- 세금계산서_합계 출력 상세조회  -->
	<select id="SLS030202DAO.selectHouseTaxbillSumDetailList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		<![CDATA[
					SELECT B.BIZRNO
					      ,C.HOUSE_CODE
					      ,C.DONG
					      ,C.HO
					      ,B.BLANK
					      ,B.TAX_CNT
					      ,B.PAY_SUPLY_AMOUNT
					      ,B.PAY_VAT
					      ,V.MTLTY_NM
					      ,V.BIZCND
					      ,V.INDUTY
					      ,SUBSTR(B.PAY_SUPLY_AMOUNT, 1, 1) AS PAY_SUPLY_AMOUNT_1
					      ,SUBSTR(B.PAY_SUPLY_AMOUNT, 2, 1) AS PAY_SUPLY_AMOUNT_2
					      ,SUBSTR(B.PAY_SUPLY_AMOUNT, 3, 1) AS PAY_SUPLY_AMOUNT_3
					      ,SUBSTR(B.PAY_SUPLY_AMOUNT, 4, 1) AS PAY_SUPLY_AMOUNT_4
					      ,SUBSTR(B.PAY_SUPLY_AMOUNT, 5, 1) AS PAY_SUPLY_AMOUNT_5
					      ,SUBSTR(B.PAY_SUPLY_AMOUNT, 6, 1) AS PAY_SUPLY_AMOUNT_6
					      ,SUBSTR(B.PAY_SUPLY_AMOUNT, 7, 1) AS PAY_SUPLY_AMOUNT_7
					      ,SUBSTR(B.PAY_SUPLY_AMOUNT, 8, 1) AS PAY_SUPLY_AMOUNT_8
					      ,SUBSTR(B.PAY_SUPLY_AMOUNT, 9, 1) AS PAY_SUPLY_AMOUNT_9
					      ,SUBSTR(B.PAY_SUPLY_AMOUNT, 10, 1) AS PAY_SUPLY_AMOUNT_10
					      ,SUBSTR(B.PAY_SUPLY_AMOUNT, 11, 1) AS PAY_SUPLY_AMOUNT_11
					      ,SUBSTR(B.PAY_SUPLY_AMOUNT, 12, 1) AS PAY_SUPLY_AMOUNT_12
					      ,SUBSTR(B.PAY_SUPLY_AMOUNT, 13, 1) AS PAY_SUPLY_AMOUNT_13
					      ,SUBSTR(B.PAY_SUPLY_AMOUNT, 14, 1) AS PAY_SUPLY_AMOUNT_14
					      ,SUBSTR(B.PAY_VAT, 1, 1) AS PAY_VAT_1
					      ,SUBSTR(B.PAY_VAT, 2, 1) AS PAY_VAT_2
					      ,SUBSTR(B.PAY_VAT, 3, 1) AS PAY_VAT_3
					      ,SUBSTR(B.PAY_VAT, 4, 1) AS PAY_VAT_4
					      ,SUBSTR(B.PAY_VAT, 5, 1) AS PAY_VAT_5
					      ,SUBSTR(B.PAY_VAT, 6, 1) AS PAY_VAT_6
					      ,SUBSTR(B.PAY_VAT, 7, 1) AS PAY_VAT_7
					      ,SUBSTR(B.PAY_VAT, 8, 1) AS PAY_VAT_8
					      ,SUBSTR(B.PAY_VAT, 9, 1) AS PAY_VAT_9
					      ,SUBSTR(B.PAY_VAT, 10, 1) AS PAY_VAT_10
					      ,SUBSTR(B.PAY_VAT, 11, 1) AS PAY_VAT_11
					      ,SUBSTR(B.PAY_VAT, 12, 1) AS PAY_VAT_12
					      ,SUBSTR(B.PAY_VAT, 13, 1) AS PAY_VAT_13
					
					  FROM TBSLS_HCNTRCTR C /* 주택계약자 */
					      ,(SELECT BIZRNO
					              ,COUNT(1) AS TAX_CNT
					              ,14 - LENGTH(SUM(PAY_SUPLY_AMOUNT)) AS BLANK
					              ,LPAD(SUM(PAY_SUPLY_AMOUNT), 14, '*') AS PAY_SUPLY_AMOUNT
					              ,LPAD(SUM(PAY_VAT), 13, '*') AS PAY_VAT
					        
					          FROM TBSLS_HOUSE_VAT A /* 주택부가세 */
					             , TBSLS_HCNTRCTR_BSNM B /* 주택계약자사업자 */
					         WHERE A.PBLICTE_YEAR = #PBLICTE_YEAR#
					           AND A.PBLICTE_QU = #PBLICTE_QU#
					           AND A.CNTRCTR_NO = B.CNTRCTR_NO(+)
					           AND EXISTS
					         (SELECT 1
					                  FROM TBSLS_HCNTRCTR_BSNM D
					                 WHERE A.CNTRCTR_NO = D.CNTRCTR_NO
					                   AND D.BIZRNO IS NOT NULL
					                   AND A.PBLICTE_DE >= (CASE
					                         WHEN SUBSTR(D.BSNS_CONFM_DE, 5, 2) >= '01' AND
					                              SUBSTR(D.BSNS_CONFM_DE, 5, 2) <= '03' THEN
					                          SUBSTR(D.BSNS_CONFM_DE, 0, 4) || '0101'
					                         WHEN SUBSTR(D.BSNS_CONFM_DE, 5, 2) >= '04' AND
					                              SUBSTR(D.BSNS_CONFM_DE, 5, 2) <= '06' THEN
					                          SUBSTR(D.BSNS_CONFM_DE, 0, 4) || '0401'
					                         WHEN SUBSTR(D.BSNS_CONFM_DE, 5, 2) >= '07' AND
					                              SUBSTR(D.BSNS_CONFM_DE, 5, 2) <= '09' THEN
					                          SUBSTR(D.BSNS_CONFM_DE, 0, 4) || '0701'
					                         WHEN SUBSTR(D.BSNS_CONFM_DE, 5, 2) >= '10' AND
					                              SUBSTR(D.BSNS_CONFM_DE, 5, 2) <= '12' THEN
					                          SUBSTR(D.BSNS_CONFM_DE, 0, 4) || '1001'
					                       END)
					                
					                )
					        
					         GROUP BY BIZRNO) B
					      ,(SELECT V1.*
					          FROM TBSLS_HCNTRCTR_BSNM V1 /* 주택계약자사업자 */
					              ,TBSLS_HCNTRCTR      C1 /* 주택계약자 */
					         WHERE V1.CNTRCTR_NO = C1.CNTRCTR_NO
					           AND V1.HOUSE_CSTMR_NO = C1.HOUSE_CSTMR_NO
					           AND C1.DONG || C1.HO =
					               (SELECT MIN(C2.DONG || C2.HO)
					                  FROM TBSLS_HCNTRCTR_BSNM V2, TBSLS_HCNTRCTR C2
					                 WHERE V2.CNTRCTR_NO = C2.CNTRCTR_NO
					                   AND V2.HOUSE_CSTMR_NO = C2.HOUSE_CSTMR_NO
					                   AND V2.BIZRNO = V1.BIZRNO)        
					        ) V
					
					 WHERE C.CNTRCTR_NO = V.CNTRCTR_NO
					   AND B.BIZRNO = V.BIZRNO(+)
					 ORDER BY C.HOUSE_CODE, C.DONG, C.HO
		]]>
			 
	</select>
	
	
	<!-- 세금계산서_개별 출력 조회  -->
	<select id="SLS030202DAO.selectHouseTaxbillIndvdlzList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		<![CDATA[
			SELECT NVL(V.CHG_NAME, CC.CSTMR_NM) AS CSTMR_NM
			      ,CASE
			         WHEN V.LAST_DAY >= TO_CHAR((V.BSNS_CONFM_DE - 20), 'YYYY-MM-DD') THEN
			          CASE
			            WHEN V.BIZ_NO IS NULL THEN
			             NVL(V.CHG_PRSN
			                 /* ,SUBSTR(CRYPTO.DEC('PATTERN8', C.CPERSONNO_X), 1, 14) */
			                ,CC.IHIDNUM)
			            ELSE
			             SUBSTR(REPLACE(V.BIZ_NO, '-', ''), 1, 3) || '-' ||
			             SUBSTR(REPLACE(V.BIZ_NO, '-', ''), 4, 2) || '-' ||
			             SUBSTR(REPLACE(V.BIZ_NO, '-', ''), 6, 5)
			          END
			         ELSE
			          NVL(V.CHG_PRSN
			              /* ,SUBSTR(CRYPTO.DEC('PATTERN8', C.CPERSONNO_X), 1, 14) */
			             ,CC.IHIDNUM)
			       END AS RBIZ_NO
			      ,CASE
			         WHEN V.LAST_DAY >= TO_CHAR((V.BSNS_CONFM_DE - 20), 'YYYY-MM-DD') THEN
			          V.CORP_NM
			       END AS RCORP_NAME
			      ,NVL(V.BIZ_OWNER_NM, NVL(V.CHG_NAME, CC.CSTMR_NM)) AS ROWNER_NM
			      ,CASE
			         WHEN V.LAST_DAY >= TO_CHAR((V.BSNS_CONFM_DE - 20), 'YYYY-MM-DD') THEN
			          V1.BIZCND
			         ELSE
			          ''
			       END AS RBIZCND
			      ,CASE
			         WHEN V.LAST_DAY >= TO_CHAR((V.BSNS_CONFM_DE - 20), 'YYYY-MM-DD') THEN
			          V1.INDUTY
			         ELSE
			          ''
			       END AS RINDUTY
			      ,NVL(V.BIZ_ADDR, NVL(V.CHG_ADDR, CC.ADRES || ' ' || CC.ADRES_DETAIL)) AS RADDR
			      ,A.HOUSE_NM || ' ' || C.DONG || '/' || C.HO AS RADDR1
			      ,(SELECT CODE_NM
			          FROM TBCOM_CMMN_CODE /* 공통코드 */
			         WHERE GRP_CODE = 'HOU0A1'
			           AND CODE = V.PAY_CODE) AS PAY_CODE_NM
			      ,V.MT_SE
			      ,V.LAST_DAY
			      ,V.PAY_SUPLY_AMOUNT
			      ,V.PAY_VAT
			      ,V.TOTAL
			      ,V.BLANK
			      ,SUBSTR(V.PAY_SUPLY_AMOUNT1, 1, 1) AS PAY_SUPLY_AMOUNT_1
			      ,SUBSTR(V.PAY_SUPLY_AMOUNT1, 2, 1) AS PAY_SUPLY_AMOUNT_2
			      ,SUBSTR(V.PAY_SUPLY_AMOUNT1, 3, 1) AS PAY_SUPLY_AMOUNT_3
			      ,SUBSTR(V.PAY_SUPLY_AMOUNT1, 4, 1) AS PAY_SUPLY_AMOUNT_4
			      ,SUBSTR(V.PAY_SUPLY_AMOUNT1, 5, 1) AS PAY_SUPLY_AMOUNT_5
			      ,SUBSTR(V.PAY_SUPLY_AMOUNT1, 6, 1) AS PAY_SUPLY_AMOUNT_6
			      ,SUBSTR(V.PAY_SUPLY_AMOUNT1, 7, 1) AS PAY_SUPLY_AMOUNT_7
			      ,SUBSTR(V.PAY_SUPLY_AMOUNT1, 8, 1) AS PAY_SUPLY_AMOUNT_8
			      ,SUBSTR(V.PAY_SUPLY_AMOUNT1, 9, 1) AS PAY_SUPLY_AMOUNT_9
			      ,SUBSTR(V.PAY_SUPLY_AMOUNT1, 10, 1) AS PAY_SUPLY_AMOUNT_10
			      ,SUBSTR(V.PAY_VAT1, 1, 1) AS PAY_VAT_1
			      ,SUBSTR(V.PAY_VAT1, 2, 1) AS PAY_VAT_2
			      ,SUBSTR(V.PAY_VAT1, 3, 1) AS PAY_VAT_3
			      ,SUBSTR(V.PAY_VAT1, 4, 1) AS PAY_VAT_4
			      ,SUBSTR(V.PAY_VAT1, 5, 1) AS PAY_VAT_5
			      ,SUBSTR(V.PAY_VAT1, 6, 1) AS PAY_VAT_6
			      ,SUBSTR(V.PAY_VAT1, 7, 1) AS PAY_VAT_7
			      ,SUBSTR(V.PAY_VAT1, 8, 1) AS PAY_VAT_8
			      ,SUBSTR(V.PAY_VAT1, 9, 1) AS PAY_VAT_9
			      ,S.*
			
			  FROM (SELECT CNTRCTR_NO
			              ,TO_CHAR(TO_DATE(PBLICTE_DE), 'YYYY-MM-DD') AS LAST_DAY
			              ,PAY_SUPLY_AMOUNT AS PAY_SUPLY_AMOUNT
			              ,PAY_VAT AS PAY_VAT
			              ,PAY_SUPLY_AMOUNT + PAY_VAT AS TOTAL
			              ,LPAD(PAY_SUPLY_AMOUNT, 10, '*') AS PAY_SUPLY_AMOUNT1
			              ,LPAD(PAY_VAT, 9, '*') AS PAY_VAT1
			              ,14 - LENGTH(PAY_SUPLY_AMOUNT) AS BLANK
			              ,PAY_CODE AS PAY_CODE
			              ,MT_SE
			              ,TO_DATE(SFSLS_BIZ_INFO('1', A.CNTRCTR_NO, A.PBLICTE_DE)) AS BSNS_CONFM_DE
			              ,SUBSTR(SFSLS_BIZ_INFO('2', A.CNTRCTR_NO, A.PBLICTE_DE)
			                     ,1
			                     ,100) AS BIZ_NO
			              ,SUBSTR(SFSLS_BIZ_INFO('3', A.CNTRCTR_NO, A.PBLICTE_DE)
			                     ,1
			                     ,100) AS CORP_NM
			              ,SUBSTR(SFSLS_BIZ_INFO('4', A.CNTRCTR_NO, A.PBLICTE_DE)
			                     ,1
			                     ,100) AS BIZ_OWNER_NM
			              ,SUBSTR(SFSLS_BIZ_INFO('5', A.CNTRCTR_NO, A.PBLICTE_DE)
			                     ,1
			                     ,100) AS BIZCND
			              ,SUBSTR(SFSLS_BIZ_INFO('6', A.CNTRCTR_NO, A.PBLICTE_DE)
			                     ,1
			                     ,100) AS INDUTY
			              ,SUBSTR(SFSLS_BIZ_INFO('7', A.CNTRCTR_NO, A.PBLICTE_DE)
			                     ,1
			                     ,100) AS BIZ_ADDR
			              ,SUBSTR(SFSLS_BIZ_INFO('8', A.CNTRCTR_NO, A.PBLICTE_DE)
			                     ,1
			                     ,100) AS CHG_NAME
			              ,SUBSTR(SFSLS_BIZ_INFO('9', A.CNTRCTR_NO, A.PBLICTE_DE)
			                     ,1
			                     ,100) AS CHG_ADDR
			              ,SUBSTR(SFSLS_BIZ_INFO('10', A.CNTRCTR_NO, A.PBLICTE_DE)
			                     ,1
			                     ,100) AS CHG_PRSN
			        
			          FROM TBSLS_HOUSE_VAT A /* 계약자 부가세내역 */
			         WHERE A.PBLICTE_YEAR = #PBLICTE_YEAR#
			           AND A.PBLICTE_QU = #PBLICTE_QU#) V
			           
			      ,TBPMS_CPR_INFO S 		/* 법인정보 */
			      ,TBSLS_HCNTRCTR_BSNM V1 	/* 계약자 사업자등록 정보 */
			      ,TBSLS_HOUSE_INFO A 		/* 주택코드 정보(M) */
			      ,TBSLS_HCNTRCTR C 		/* 계약자 정보 */
			      ,TBSLS_HOUSE_CSTMR CC 	/* 주택고객 */
			      
			 WHERE V.CNTRCTR_NO = V1.CNTRCTR_NO(+)
			   AND V.CNTRCTR_NO = C.CNTRCTR_NO
			   AND C.HOUSE_CODE = A.HOUSE_CODE			  
			   AND V.PAY_SUPLY_AMOUNT > 0
			      
			   AND C.HOUSE_CSTMR_NO = CC.HOUSE_CSTMR_NO
			 
		]]>
		
			<!-- 개별 시작 -->   
			<isNotEmpty property="HOUSE_CODE">
				 AND C.HOUSE_CODE = #HOUSE_CODE#
			</isNotEmpty>
			
			<isNotEmpty property="CNTRCTR_NO">
				 AND C.CNTRCTR_NO = #CNTRCTR_NO#
			</isNotEmpty>
			<!-- 개별 끝 -->
			 
			ORDER BY C.HOUSE_CODE, C.DONG, C.HO, V.MT_SE, V.PAY_CODE
			
	</select>
	
	
	<!-- 전자세금계산서 조회  -->
	<select id="SLS030202DAO.selectHouseElecTaxbillList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		<![CDATA[
					SELECT '01' AS TAX_KIND
					      ,REPLACE(V.LASTDAY, '-', '') AS MADE_DATE
					      ,REPLACE(S.BIZRNO, '-', '') AS OWNER_BIZ_NO
					      ,'' AS OWNER_SUB_BIZ_NO
					      ,S.MTLTY AS OWNER_CORP_NAME
					      ,S.RPRSNTV AS OWNERER_NAME
					      ,S.ADRES AS OWNER_ADDR
					      ,S.BIZCND AS OWNER_BIZCND
					      ,S.ITEM AS OWNER_INDUTY
					      ,S.EMAIL AS OWNER_EMAIL
					      ,REPLACE(CASE
					                 WHEN V.LASTDAY >= TO_CHAR((V.BSNS_CONFM_DE - 20), 'YYYY-MM-DD') THEN
					                  CASE
					                    WHEN V.BIZ_NO IS NULL THEN
					                     NVL(V.CHG_PRSN, SFCOM_DEC_ALL(CC.IHIDNUM))
					                    ELSE
					                     SUBSTR(REPLACE(V.BIZ_NO, '-', ''), 1, 3) || '-' ||
					                     SUBSTR(REPLACE(V.BIZ_NO, '-', ''), 4, 2) || '-' ||
					                     SUBSTR(REPLACE(V.BIZ_NO, '-', ''), 6, 5)
					                  END
					                 ELSE
					                  NVL(V.CHG_PRSN, SFCOM_DEC_ALL(CC.IHIDNUM))
					               END
					              ,'-'
					              ,'') AS RBIZ_NO
					      ,'' AS RBIZ_SUB_NO
					      ,CASE
					         WHEN V.LASTDAY >= TO_CHAR((V.BSNS_CONFM_DE - 20), 'YYYY-MM-DD') THEN
					          V.CORP_NM
					       END AS RCORP_NAME
					      ,NVL(V.BIZ_OWNERER_NM, NVL(V.CHG_NAME, CC.CSTMR_NM)) AS ROWNERER_NM
					      ,A.HOUSE_NM || ' ' || C.DONG || '동 ' || C.HO || '호 ' AS RADDR1
					      ,CASE
					         WHEN V.LASTDAY >= TO_CHAR((V.BSNS_CONFM_DE - 20), 'YYYY-MM-DD') THEN
					          V1.BIZCND
					         ELSE
					          ''
					       END AS RBIZCND
					      ,CASE
					         WHEN V.LASTDAY >= TO_CHAR((V.BSNS_CONFM_DE - 20), 'YYYY-MM-DD') THEN
					          V1.INDUTY
					         ELSE
					          ''
					       END AS RINDUTY
					      ,NVL(CC.EMAIL, S.EMAIL) AS C_EMAIL
					      ,'' C_EMAIL2
					      ,'' AS REMARK
					      ,SUBSTR(REPLACE(V.LASTDAY, '-', ''), 7, 2) AS LASTDAY
					      ,(SELECT CODE_NM
					          FROM TBCOM_CMMN_CODE /* 기본코드 */
					         WHERE GRP_CODE = 'HOU0A1'
					           AND CODE = V.PAY_CODE) AS PAY_CODE_NM
					      ,V.PAY_SUPLY_AMOUNT
					      ,V.PAY_VAT
					      ,'02' AS TAX_KIND1
					      ,NVL(V.CHG_NAME, CC.CSTMR_NM) AS CSTMR_NM
					      ,NVL(V.BIZ_ADDR, NVL(CHG_ADDR, CC.ADRES || ' ' || CC.ADRES_DETAIL)) AS RADDR
					
					  FROM (SELECT CNTRCTR_NO
					              ,PBLICTE_DE AS LASTDAY
					              ,PAY_SUPLY_AMOUNT AS PAY_SUPLY_AMOUNT
					              ,PAY_VAT AS PAY_VAT
					              ,PAY_SUPLY_AMOUNT + PAY_VAT AS TOTAL
					              ,LPAD(PAY_SUPLY_AMOUNT, 10, '*') AS PAY_SUPLY_AMOUNT1
					              ,LPAD(PAY_VAT, 9, '*') AS PAY_VAT1
					              ,14 - LENGTH(PAY_SUPLY_AMOUNT) AS BLANK
					              ,PAY_CODE AS PAY_CODE
					              ,MT_SE
					              ,TO_DATE(SFSLS_BIZ_INFO('1', A.CNTRCTR_NO, A.PBLICTE_DE)) AS BSNS_CONFM_DE
					              ,SUBSTR(SFSLS_BIZ_INFO('2', A.CNTRCTR_NO, A.PBLICTE_DE)
					                     ,1
					                     ,100) AS BIZ_NO
					              ,SUBSTR(SFSLS_BIZ_INFO('3', A.CNTRCTR_NO, A.PBLICTE_DE)
					                     ,1
					                     ,100) AS CORP_NM
					              ,SUBSTR(SFSLS_BIZ_INFO('4', A.CNTRCTR_NO, A.PBLICTE_DE)
					                     ,1
					                     ,100) AS BIZ_OWNERER_NM
					              ,SUBSTR(SFSLS_BIZ_INFO('5', A.CNTRCTR_NO, A.PBLICTE_DE)
					                     ,1
					                     ,100) AS BIZCND
					              ,SUBSTR(SFSLS_BIZ_INFO('6', A.CNTRCTR_NO, A.PBLICTE_DE)
					                     ,1
					                     ,100) AS INDUTY
					              ,SUBSTR(SFSLS_BIZ_INFO('7', A.CNTRCTR_NO, A.PBLICTE_DE)
					                     ,1
					                     ,100) AS BIZ_ADDR
					              ,SUBSTR(SFSLS_BIZ_INFO('8', A.CNTRCTR_NO, A.PBLICTE_DE)
					                     ,1
					                     ,100) AS CHG_NAME
					              ,SUBSTR(SFSLS_BIZ_INFO('9', A.CNTRCTR_NO, A.PBLICTE_DE)
					                     ,1
					                     ,100) AS CHG_ADDR
					              ,SUBSTR(SFSLS_BIZ_INFO('10', A.CNTRCTR_NO, A.PBLICTE_DE)
					                     ,1
					                     ,100) AS CHG_PRSN
					        
					          FROM TBSLS_HOUSE_VAT A /* 주택부가세 */
					         WHERE A.PBLICTE_YEAR = SUBSTR(#PBLICTE_MONTH# , 0, 4)
					           AND A.PBLICTE_QU = (CASE
											           WHEN SUBSTR(#PBLICTE_MONTH# , 5, 2) = '01' OR
											                SUBSTR(#PBLICTE_MONTH# , 5, 2) = '02' OR
											                SUBSTR(#PBLICTE_MONTH# , 5, 2) = '03' THEN
											            '1'
											           WHEN SUBSTR(#PBLICTE_MONTH# , 5, 2) = '04' OR
											                SUBSTR(#PBLICTE_MONTH# , 5, 2) = '05' OR
											                SUBSTR(#PBLICTE_MONTH# , 5, 2) = '06' THEN
											            '2'
											           WHEN SUBSTR(#PBLICTE_MONTH# , 5, 2) = '07' OR
											                SUBSTR(#PBLICTE_MONTH# , 5, 2) = '08' OR
											                SUBSTR(#PBLICTE_MONTH# , 5, 2) = '09' THEN
											            '3'
											           WHEN SUBSTR(#PBLICTE_MONTH# , 5, 2) = '11' OR
											                SUBSTR(#PBLICTE_MONTH# , 5, 2) = '12' OR
											                SUBSTR(#PBLICTE_MONTH# , 5, 2) = '13' THEN
											            '4'
											           ELSE
											            '0'
											         END) ) V
					      ,TBPMS_CPR_INFO S /* 법인정보 */
					      ,TBSLS_HCNTRCTR_BSNM V1 /* 계약자 사업자등록 정보 */
					      ,TBSLS_HOUSE_INFO A /* 주택정보 */
					      ,TBSLS_HCNTRCTR C /* 주택계약자 */
					      ,TBSLS_HOUSE_CSTMR CC /* 주택고객 */
					
					 WHERE V.CNTRCTR_NO = V1.CNTRCTR_NO(+)
					   AND V.CNTRCTR_NO = C.CNTRCTR_NO
					   AND C.HOUSE_CODE = A.HOUSE_CODE
					   AND V.PAY_SUPLY_AMOUNT <> 0
					   AND C.HOUSE_CSTMR_NO = CC.HOUSE_CSTMR_NO
					      
					   AND SUBSTR(V.LASTDAY, 0, 6) = #PBLICTE_MONTH#
			 
		]]>
		
			<isNotEmpty property="HOUSE_CODE">
				 AND C.HOUSE_CODE = #HOUSE_CODE#
			</isNotEmpty>
			 
			ORDER BY C.HOUSE_CODE, C.DONG, C.HO, V.MT_SE, V.PAY_CODE
			
	</select>

</sqlMap>